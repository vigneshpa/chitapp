(self.webpackChunk=self.webpackChunk||[]).push([[321],{2043:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getDatabaseBackup:()=>q,initCore:()=>F,restoreDatabase:()=>Q});var r={};n.r(r),n.d(r,{Chit:()=>O,Client:()=>v,Group:()=>h,Payment:()=>G}),n(8706);var o=n(9668);function i(e){return async function({phone:t}){return(await e.Client.findOne({phone:t}))?.name||!1}}function a(e){return Number.isSafeInteger(e)&&Number.isFinite(e)&&e>=0}var c=n(9887),s=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class u{constructor(e){this.uuid=e||(0,c.Z)()}}s([(0,o.bsY)(),l("design:type",Number)],u.prototype,"id",void 0),s([(0,o.sgG)({type:"uuid",unique:!0}),l("design:type",String)],u.prototype,"uuid",void 0),s([(0,o.erC)(),l("design:type",Date)],u.prototype,"createdAt",void 0),s([(0,o.RUf)(),l("design:type",Date)],u.prototype,"updatedAt",void 0);var f=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},p=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class extends u{constructor(){super(...arguments),this.isActive=!1}activate(){if(this.isActive)throw new Error("Group is already active");let e=0;if(this.chits.forEach((t=>{e+=t.value})),e<this.totalValue)throw new Error("Chits are not sufficient");if(e>this.totalValue)throw new Error("Chits are more than the limit");this.isActive=!0}};f([(0,o.sgG)({unique:!0}),p("design:type",String)],d.prototype,"name",void 0),f([(0,o.sgG)({nullable:!1}),p("design:type",String)],d.prototype,"batch",void 0),f([(0,o.sgG)("integer"),p("design:type",Number)],d.prototype,"month",void 0),f([(0,o.sgG)({nullable:!1}),p("design:type",Number)],d.prototype,"year",void 0),f([(0,o.sgG)({nullable:!1,type:"integer"}),p("design:type",Number)],d.prototype,"totalValue",void 0),f([(0,o.sgG)({nullable:!1}),p("design:type",Boolean)],d.prototype,"isActive",void 0),f([(0,o.IFc)((e=>O),(e=>e.group),{cascade:!0}),p("design:type",Array)],d.prototype,"chits",void 0),d=f([(0,o.JHW)("groups")],d);const h=d;var y=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let g=class extends u{};y([(0,o.sgG)(),w("design:type",String)],g.prototype,"name",void 0),y([(0,o.sgG)(),w("design:type",String)],g.prototype,"phone",void 0),y([(0,o.sgG)(),w("design:type",String)],g.prototype,"address",void 0),y([(0,o.IFc)((e=>O),(e=>e.client)),w("design:type",Array)],g.prototype,"chits",void 0),g=y([(0,o.JHW)("clients")],g);const v=g;var b=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class extends u{constructor(){super(...arguments),this.wonAtMonth=null}};b([(0,o.Q2k)(),(0,o.hAt)((e=>v),(e=>e.chits)),m("design:type",v)],C.prototype,"client",void 0),b([(0,o.Q2k)(),(0,o.hAt)((e=>h),(e=>e.chits)),m("design:type",h)],C.prototype,"group",void 0),b([(0,o.sgG)({nullable:!1,type:"integer"}),m("design:type",Number)],C.prototype,"value",void 0),b([(0,o.IFc)((e=>G),(e=>e.chit),{cascade:!0}),m("design:type",Array)],C.prototype,"payments",void 0),b([(0,o.sgG)({type:"integer",nullable:!0}),m("design:type",Object)],C.prototype,"wonAtMonth",void 0),C=b([(0,o.JHW)("chits")],C);const O=C;var R=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},j=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let E=class extends u{get toBePaid(){let e=this.chit.value/20;const t=e/5;return this.chit.wonAtMonth&&this.chit.wonAtMonth<this.imonth&&(e+=t),e}};R([(0,o.Q2k)(),(0,o.hAt)((e=>O),(e=>e.payments)),j("design:type",O)],E.prototype,"chit",void 0),R([(0,o.sgG)("integer",{nullable:!1}),j("design:type",Number)],E.prototype,"imonth",void 0),R([(0,o.sgG)({nullable:!1}),j("design:type",Boolean)],E.prototype,"ispaid",void 0),E=R([(0,o.JHW)("payments")],E);const G=E;function A(e){return async function({clientUuid:t,groupUuid:n,value:r}){const o=await e.Client.findOne({uuid:t});if(!o)throw new Error("Client does not exists");const i=await e.Group.findOne({uuid:n});if(!i)throw new Error("Group does not exists");if(i.isActive)throw new Error("Cannot add chit to an active group");if(!a(r))throw new Error("Value of an chit is not valid");let c=new O;c.client=o,c.group=i,c.value=r,c.wonAtMonth=null,c.payments=[];for(let e=1;e<=20;e++){const t=new G;t.chit=c,t.imonth=e,t.ispaid=!1,c.payments.push(t)}return c=await e.Chit.save(c),Object.freeze(c)}}function P(e){return async function({year:t,month:n,batch:r,totalValue:o}){if(!a(t))throw new Error("Year is not valid");if(!a(n))throw new Error("Month is not valid");if(r.length>3)throw new Error("Batch cannot be longer than 3");if(!a(o))throw new Error("Specified total value is not valid");if(await e.Group.count({year:t,month:n,batch:r})>0)throw new Error("Group already exists");let i=new h;return i.year=t,i.month=n,i.batch=r,i.totalValue=o,i.isActive=!1,i.chits=[],i.name=t+"-"+n+"-"+r,i=await e.Group.save(i),Object.freeze(i)}}function D(e){return async function({name:t,phone:n,address:r}){if(t.length<3)throw new Error("Name must be longer than 2 characters");if(n.length<10)throw new Error("Phone number must be longer than 10 characters");if(r.length<5)throw new Error("Address must be longer than 5 characters");if(await e.Client.count({phone:n})>0)throw new Error("Client with same phone number already exists");let o=new v;return o.name=t,o.phone=n,o.address=r,o.chits=[],o=await e.Client.save(o),Object.freeze(o)}}function S(e){return async function({clientUuid:t,groupUuid:n,value:r}){const o=t?await e.Client.findOne({uuid:t}):void 0,i=n?await e.Group.findOne({uuid:n}):void 0;if(r&&!a(r))throw new Error("Value of an chit is not valid");const c=e.Chit.find({client:o,group:i,value:r});return Object.freeze(c)}}function k(e){return async function(t){if(!t||!t.partial)return Object.freeze(await e.Group.find());if(t.partial.year&&!a(t.partial.year))throw new Error("Year is not valid");if(t.partial.month&&!a(t.partial.month))throw new Error("Month is not valid");if(t.partial.batch&&t.partial.batch.length>3)throw new Error("Batch cannot be longer than 3");if(t.partial.totalValue&&!a(t.partial.totalValue))throw new Error("Specified total value is not valid");let n=await e.Group.find({where:t.partial});return Object.freeze(n)}}function I(e){return async function(t){if(!t||!t.partial)return Object.freeze(await e.Client.find());if(t.partial.name&&t.partial.name.length<3)throw new Error("Name must be longer than 2 characters");if(t.partial.phone&&t.partial.phone.length<10)throw new Error("Phone number must be longer than 10 characters");if(t.partial.address&&t.partial.address.length<5)throw new Error("Address must be longer than 5 characters");const n=await e.Client.find({where:t.partial});return Object.freeze(n)}}function N(e){return async function({name:t}){return!!await e.Group.findOne({name:t})}}class x{constructor(){this.isConnected=!1}async connect(e){if(this.isConnected)throw new Error("This instance is already connected");this.connection=await(0,o.I5I)({...e,entities:Object.values(r),synchronize:!0}),this.isConnected=!0,this.loadActions(),this.connection.manager.query}async close(){if(!this.isConnected||!this.connection)return console.error(new Error("Connection is already closed"));await this.connection.close(),this.isConnected=!1}loadActions(){if(!this.connection)throw new Error("Cannot load actions as the instance is not connected");const e={};for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)){const n=r[t];e[t]=this.connection.getRepository(n)}this.actions=function(e){return{checkPhone:i(e),checkGroup:N(e),createChit:A(e),createGroup:P(e),createClient:D(e),findClients:I(e),findGroups:k(e),findChits:S(e)}}(e)}}var z=n(645),V=n.n(z),M=n(8500),B=n(927);async function F(e="chitDatabase"){window.SQL||(window.SQL=await V()({locateFile:()=>M})),window.localforage=B;const t=await B.getItem(e)??void 0,n=new x;return await n.connect({type:"sqljs",database:t,autoSave:!0,logging:!1,autoSaveCallback(t){B.setItem(e,t)}}),n}async function q(e="chitDatabase"){const t=await B.getItem(e);if(!t)throw new Error("Database file does not exists");return new File([t],"backup.sqlite3",{type:"application/vnd.sqlite3",lastModified:Date.now()})}async function Q(e,t="chitDatabase"){var n;await B.setItem(t,new Int8Array(await(n=e,new Promise(((e,t)=>{const r=new FileReader;r.addEventListener("loadend",(t=>e(t.target.result))),r.addEventListener("error",t),r.readAsArrayBuffer(n)}))))),window.location.reload()}B.config({name:"chitDataStore",storeName:"chitDataStore"}),window.initCore=F},617:()=>{},9356:()=>{},1497:()=>{},7021:()=>{}}]);
//# sourceMappingURL=core.js.map