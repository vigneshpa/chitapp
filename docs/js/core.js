(self.webpackChunk=self.webpackChunk||[]).push([[321],{2043:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getDatabaseBackup:()=>U,initCore:()=>I,restoreDatabase:()=>F});var o={};n.r(o),n.d(o,{Chit:()=>E,Client:()=>v,Group:()=>y,Payment:()=>D}),n(8706);var r=n(9668);function i(e){return async function({phone:t}){return(await e.Client.findOne({phone:t}))?.name||!1}}function a(e){return Number.isSafeInteger(e)&&Number.isFinite(e)&&e>=0}var c=n(9887),l=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let u=class{constructor(e){this.uuid=e||(0,c.default)()}};l([(0,r.PrimaryGeneratedColumn)(),s("design:type",Number)],u.prototype,"id",void 0),l([(0,r.Column)({type:"uuid",unique:!0}),s("design:type",String)],u.prototype,"uuid",void 0),l([(0,r.CreateDateColumn)(),s("design:type",Date)],u.prototype,"createdAt",void 0),l([(0,r.UpdateDateColumn)(),s("design:type",Date)],u.prototype,"updatedAt",void 0),u=l([(0,r.Entity)(),s("design:paramtypes",[String])],u);const p=u;var f=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},d=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let h=class extends p{constructor(){super(...arguments),this.isActive=!1}activate(){if(this.isActive)throw new Error("Group is already active");let e=0;if(this.chits.forEach((t=>{e+=t.value})),e<this.totalValue)throw new Error("Chits are not sufficient");if(e>this.totalValue)throw new Error("Chits are more than the limit");this.isActive=!0}};f([(0,r.Column)({unique:!0}),d("design:type",String)],h.prototype,"name",void 0),f([(0,r.Column)({nullable:!1}),d("design:type",String)],h.prototype,"batch",void 0),f([(0,r.Column)("integer"),d("design:type",Number)],h.prototype,"month",void 0),f([(0,r.Column)({nullable:!1}),d("design:type",Number)],h.prototype,"year",void 0),f([(0,r.Column)({nullable:!1,type:"integer"}),d("design:type",Number)],h.prototype,"totalValue",void 0),f([(0,r.Column)({nullable:!1}),d("design:type",Boolean)],h.prototype,"isActive",void 0),f([(0,r.OneToMany)((e=>E),(e=>e.group),{cascade:!0}),d("design:type",Array)],h.prototype,"chits",void 0),h=f([(0,r.Entity)()],h);const y=h;var w=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let m=class extends p{};w([(0,r.Column)(),g("design:type",String)],m.prototype,"name",void 0),w([(0,r.Column)(),g("design:type",String)],m.prototype,"phone",void 0),w([(0,r.Column)(),g("design:type",String)],m.prototype,"address",void 0),w([(0,r.OneToMany)((e=>E),(e=>e.client)),g("design:type",Array)],m.prototype,"chits",void 0),m=w([(0,r.Entity)()],m);const v=m;var b=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let O=class extends p{constructor(){super(...arguments),this.wonAtMonth=null}};b([(0,r.JoinColumn)(),(0,r.ManyToOne)((e=>v),(e=>e.chits)),C("design:type",v)],O.prototype,"client",void 0),b([(0,r.JoinColumn)(),(0,r.ManyToOne)((e=>y),(e=>e.chits)),C("design:type",y)],O.prototype,"group",void 0),b([(0,r.Column)({nullable:!1,type:"integer"}),C("design:type",Number)],O.prototype,"value",void 0),b([(0,r.OneToMany)((e=>D),(e=>e.chit),{cascade:!0}),C("design:type",Array)],O.prototype,"payments",void 0),b([(0,r.Column)({type:"integer",nullable:!0}),C("design:type",Object)],O.prototype,"wonAtMonth",void 0),O=b([(0,r.Entity)()],O);const E=O;var j=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},R=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let A=class extends p{get toBePaid(){let e=this.chit.value/20;const t=e/5;return this.chit.wonAtMonth&&this.chit.wonAtMonth<this.imonth&&(e+=t),e}};j([(0,r.JoinColumn)(),(0,r.ManyToOne)((e=>E),(e=>e.payments)),R("design:type",E)],A.prototype,"chit",void 0),j([(0,r.Column)("integer",{nullable:!1}),R("design:type",Number)],A.prototype,"imonth",void 0),j([(0,r.Column)({nullable:!1}),R("design:type",Boolean)],A.prototype,"ispaid",void 0),A=j([(0,r.Entity)()],A);const D=A;function P(e){return async function({clientUuid:t,groupUuid:n,value:o}){const r=await e.Client.findOne({uuid:t});if(!r)throw new Error("Client does not exists");const i=await e.Group.findOne({uuid:n});if(!i)throw new Error("Group does not exists");if(i.isActive)throw new Error("Cannot add chit to an active group");if(!a(o))throw new Error("Value of an chit is not valid");let c=new E;c.client=r,c.group=i,c.value=o,c.wonAtMonth=null,c.payments=[];for(let e=1;e<=20;e++){const t=new D;t.chit=c,t.imonth=e,t.ispaid=!1,c.payments.push(t)}return c=await e.Chit.save(c),Object.freeze(c)}}function S(e){return async function({year:t,month:n,batch:o,totalValue:r}){if(!a(t))throw new Error("Year is not valid");if(!a(n))throw new Error("Month is not valid");if(o.length>3)throw new Error("Batch cannot be longer than 3");if(!a(r))throw new Error("Specified total value is not valid");if(await e.Group.count({year:t,month:n,batch:o})>0)throw new Error("Group already exists");let i=new y;return i.year=t,i.month=n,i.batch=o,i.totalValue=r,i.isActive=!1,i.chits=[],i.name=t+"-"+n+"-"+o,i=await e.Group.save(i),Object.freeze(i)}}function G(e){return async function({name:t,phone:n,address:o}){if(t.length<3)throw new Error("Name must be longer than 2 characters");if(n.length<10)throw new Error("Phone number must be longer than 10 characters");if(o.length<5)throw new Error("Address must be longer than 5 characters");if(await e.Client.count({phone:n})>0)throw new Error("Client with same phone number already exists");let r=new v;return r.name=t,r.phone=n,r.address=o,r.chits=[],r=await e.Client.save(r),Object.freeze(r)}}function M(e){return async function({clientUuid:t,groupUuid:n,value:o}){const r=t?await e.Client.findOne({uuid:t}):void 0,i=n?await e.Group.findOne({uuid:n}):void 0;if(o&&!a(o))throw new Error("Value of an chit is not valid");const c=e.Chit.find({client:r,group:i,value:o});return Object.freeze(c)}}function N(e){return async function(t){if(!t||!t.partial)return Object.freeze(await e.Group.find());if(t.partial.year&&!a(t.partial.year))throw new Error("Year is not valid");if(t.partial.month&&!a(t.partial.month))throw new Error("Month is not valid");if(t.partial.batch&&t.partial.batch.length>3)throw new Error("Batch cannot be longer than 3");if(t.partial.totalValue&&!a(t.partial.totalValue))throw new Error("Specified total value is not valid");let n=await e.Group.find({where:t.partial});return Object.freeze(n)}}function k(e){return async function(t){if(!t||!t.partial)return Object.freeze(await e.Client.find());if(t.partial.name&&t.partial.name.length<3)throw new Error("Name must be longer than 2 characters");if(t.partial.phone&&t.partial.phone.length<10)throw new Error("Phone number must be longer than 10 characters");if(t.partial.address&&t.partial.address.length<5)throw new Error("Address must be longer than 5 characters");const n=await e.Client.find({where:t.partial});return Object.freeze(n)}}function x(e){return async function({name:t}){return!!await e.Group.findOne({name:t})}}class z{constructor(){this.isConnected=!1}async connect(e){if(this.isConnected)throw new Error("This instance is already connected");this.connection=await(0,r.createConnection)({...e,entities:Object.values(o),synchronize:!0}),this.isConnected=!0,this.loadActions(),this.connection.manager.query}async close(){if(!this.isConnected||!this.connection)return console.error(new Error("Connection is already closed"));await this.connection.close(),this.isConnected=!1}loadActions(){if(!this.connection)throw new Error("Cannot load actions as the instance is not connected");const e={};for(const t in o)if(Object.prototype.hasOwnProperty.call(o,t)){const n=o[t];e[t]=this.connection.getRepository(n)}this.actions=function(e){return{checkPhone:i(e),checkGroup:x(e),createChit:P(e),createGroup:S(e),createClient:G(e),findClients:k(e),findGroups:N(e),findChits:M(e)}}(e)}}var V=n(645),B=n.n(V),T=n(8500),q=n(927);async function I(e="chitDatabase"){window.SQL||(window.SQL=await B()({locateFile:()=>T})),window.localforage=q;const t=await q.getItem(e)??void 0,n=new z;return await n.connect({type:"sqljs",database:t,autoSave:!0,logging:!1,autoSaveCallback(t){q.setItem(e,t)}}),n}async function U(e="chitDatabase"){const t=await q.getItem(e);if(!t)throw new Error("Database file does not exists");return new File([t],"backup.sqlite3",{type:"application/vnd.sqlite3",lastModified:Date.now()})}async function F(e,t="chitDatabase"){var n;await q.setItem(t,new Int8Array(await(n=e,new Promise(((e,t)=>{const o=new FileReader;o.addEventListener("loadend",(t=>e(t.target.result))),o.addEventListener("error",t),o.readAsArrayBuffer(n)}))))),window.location.reload()}q.config({name:"chitDataStore",storeName:"chitDataStore"}),window.initCore=I},617:()=>{},9356:()=>{},1497:()=>{},7021:()=>{}}]);
//# sourceMappingURL=core.js.map