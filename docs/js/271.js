/*! For license information please see 271.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[271],{4782:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=u(e),o=a[0],s=a[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=16383,s=0,u=r-i;s<u;s+=o)a.push(c(e,s,s+o>u?u:s+o));return 1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)n[o]=a[o],r[a.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},816:(e,t,n)=>{"use strict";const r=n(4782),i=n(8898),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|m(e,t);let r=s(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){const t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return p(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);const i=function(e){if(u.isBuffer(e)){const t=0|f(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||Y(e.length)?s(0):p(e):"Buffer"===e.type&&Array.isArray(e.data)?p(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),s(e<0?0:0|f(e))}function p(e){const t=e.length<0?0:0|f(e.length),n=s(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function f(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function m(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return K(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(i)return r?-1:K(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return C(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return N(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Y(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){let a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let r=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===u)return r*o}else-1!==r&&(a-=a-r),r=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){let n=!0;for(let r=0;r<u;r++)if(c(e,a+r)!==c(t,r)){n=!1;break}if(n)return a}return-1}function _(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let o;for(r>a/2&&(r=a/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(Y(r))return o;e[n+o]=r}return o}function w(e,t,n,r){return H(K(t,e.length-n),e,n,r)}function E(e,t,n,r){return H(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function T(e,t,n,r){return H(J(t),e,n,r)}function M(e,t,n,r){return H(function(e,t){let n,r,i;const a=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function N(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function C(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=n){let n,r,s,u;switch(o){case 1:t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(u=(31&t)<<6|63&n,u>127&&(a=u));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(u=(15&t)<<12|(63&n)<<6|63&r,u>2047&&(u<55296||u>57343)&&(a=u));break;case 4:n=e[i+1],r=e[i+2],s=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&s)&&(u=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&s,u>65535&&u<1114112&&(a=u))}}null===a?(a=65533,o=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=o}return function(e){const t=e.length;if(t<=R)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=R));return n}(r)}t.kMaxLength=o,u.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?s(e):void 0!==t?"string"==typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},u.allocUnsafe=function(e){return h(e)},u.allocUnsafeSlow=function(e){return h(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(G(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=u.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(G(t,Uint8Array))i+t.length>r.length?(u.isBuffer(t)||(t=u.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!u.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},u.byteLength=m,u.prototype._isBuffer=!0,u.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?C(this,0,e):y.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(u.prototype[a]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,i){if(G(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0);const s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n);for(let e=0;e<s;++e)if(c[e]!==l[e]){a=c[e],o=l[e];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const R=4096;function A(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=$[e[r]];return i}function S(e,t,n){const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function q(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r,i){Q(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function I(e,t,n,r,i){Q(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function j(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,a){return t=+t,n>>>=0,a||j(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,a){return t=+t,n>>>=0,a||j(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readBigUInt64LE=X((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),u.prototype.readBigUInt64BE=X((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readBigInt64LE=X((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),u.prototype.readBigInt64BE=X((function(e){V(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||W(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),u.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||q(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||q(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigUInt64LE=X((function(e,t=0){return D(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeBigUInt64BE=X((function(e,t=0){return I(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);q(this,e,t,n,r-1,-r)}let i=0,a=1,o=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a>>0)-o&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);q(this,e,t,n,r-1,-r)}let i=n-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a>>0)-o&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeBigInt64LE=X((function(e,t=0){return D(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeBigInt64BE=X((function(e,t=0){return I(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),u.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=u.isBuffer(e)?e:u.from(e,r),o=a.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%o]}return this};const U={};function F(e,t,n){U[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function k(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function Q(e,t,n,r,i,a){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i;throw i=a>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(a+1)}${r}`:`>= -(2${r} ** ${8*(a+1)-1}${r}) and < 2 ** ${8*(a+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new U.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){V(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||W(t,e.length-(n+1))}(r,i,a)}function V(e,t){if("number"!=typeof e)throw new U.ERR_INVALID_ARG_TYPE(t,"number",e)}function W(e,t,n){if(Math.floor(e)!==e)throw V(e,n),new U.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new U.ERR_BUFFER_OUT_OF_BOUNDS;throw new U.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}F("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),F("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),F("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=k(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=k(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const z=/[^+/0-9A-Za-z-_]/g;function K(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function J(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function Y(e){return e!=e}const $=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function X(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},8898:(e,t)=>{t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,p=n?-1:1,d=e[t+h];for(h+=p,a=d&(1<<-l)-1,d>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=p,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=p,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),a-=c}return(d?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=255&s,d+=f,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+d]=255&o,d+=f,o/=256,c-=8);e[n+d-f]|=128*m}},87:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},927:(e,t,n)=>{e.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,n,r)}return n[o].exports}for(var a=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var a=0,o=new i(l),s=e.document.createTextNode("");o.observe(s,{characterData:!0}),n=function(){s.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var u=new e.MessageChannel;u.port1.onmessage=l,n=function(){u.port2.postMessage(0)}}var c=[];function l(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}t.exports=function(e){1!==c.push(e)||r||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var a={},o=["REJECTED"],s=["FULFILLED"],u=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)}))}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function i(t){n||(n=!0,a.resolve(e,t))}var o=f((function(){t(i,r)}));"error"===o.status&&r(o.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==u?h(n,this.state===s?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){a.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=f(p,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=s,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:a.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return a.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,u=-1,c=new this(i);++u<n;)l(e[u],u);return c;function l(e,i){t.resolve(e).then((function(e){o[i]=e,++s!==n||r||(r=!0,a.resolve(c,o))}),(function(e){r||(r=!0,a.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,r=e.length,o=!1;if(!r)return this.resolve([]);for(var s=-1,u=new this(i);++s<r;)n=e[s],t.resolve(n).then((function(e){o||(o=!0,a.resolve(u,e))}),(function(e){o||(o=!0,a.reject(u,e))}));return u}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function a(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",p=void 0,d={},f=Object.prototype.toString,m="readonly",y="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function g(e){return"boolean"==typeof p?o.resolve(p):function(e){return new o((function(t){var n=e.transaction(h,y),r=a([""]);n.objectStore(h).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return p=e}))}function b(e){var t=d[e.name],n={};n.promise=new o((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function _(e){var t=d[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function w(e,t){var n=d[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function E(e,t){return new o((function(n,r){if(d[e.name]=d[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);b(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var o=i.open.apply(i,a);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(h)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),_(e)}}))}function T(e){return E(e,!1)}function M(e){return E(e,!0)}function N(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function C(e){return a([v(atob(e.data))],{type:e.type})}function R(e){return e&&e.__local_forage_encoded_blob}function A(e){var t=this,n=t._initReady().then((function(){var e=d[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(n,e,e),n}function O(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),M(e)})).then((function(){return function(e){b(e);for(var t=d[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,T(e).then((function(t){return e.db=t,N(e)?M(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw w(e,t),t}))}(e).then((function(){O(e,t,n,r-1)}))})).catch(n);n(i)}}var x={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=d[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},d[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=A);var a=[];function s(){return o.resolve()}for(var u=0;u<i.forages.length;u++){var c=i.forages[u];c!==t&&a.push(c._initReady().catch(s))}var l=i.forages.slice(0);return o.all(a).then((function(){return n.db=i.db,T(n)})).then((function(e){return n.db=e,N(n,t._defaultConfig.version)?M(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var a=l[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){O(n._dbInfo,m,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;R(r)&&(r=C(r));var i=e(r,n.key,s++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){O(n._dbInfo,m,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),R(e)&&(e=C(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var i=new o((function(n,i){var a;r.ready().then((function(){return a=r._dbInfo,"[object Blob]"===f.call(t)?g(a.db).then((function(e){return e?t:(n=t,new o((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){O(r._dbInfo,y,(function(a,o){if(a)return i(a);try{var s=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=u.error?u.error:u.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return s(i,n),i},removeItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){O(n._dbInfo,y,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(o.error)},a.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){O(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){O(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){e<0?t(null):n.ready().then((function(){O(n._dbInfo,m,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName),s=!1,u=o.openKeyCursor();u.onsuccess=function(){var n=u.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},u.onerror=function(){r(u.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){O(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];a.onsuccess=function(){var t=a.result;t?(o.push(t.key),t.continue()):e(o)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,a=this;if(e.name){var u=e.name===n.name&&a._dbInfo.db?o.resolve(a._dbInfo.db):T(e).then((function(t){var n=d[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?u.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;b(e);var r=d[e.name],a=r.forages;t.close();for(var s=0;s<a.length;s++){var u=a[s];u._dbInfo.db=null,u._dbInfo.version=n}return new o((function(t,r){var a=i.open(e.name,n);a.onerror=function(e){a.result.close(),r(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<a.length;t++){var n=a[t];n._dbInfo.db=e,_(n._dbInfo)}})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}})):u.then((function(t){b(e);var n=d[e.name],r=n.forages;t.close();for(var a=0;a<r.length;a++)r[a]._dbInfo.db=null;return new o((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)_(r[t]._dbInfo)})).catch((function(t){throw(w(e,t)||o.resolve()).catch((function(){})),t}))}))}else r=o.reject("Invalid arguments");return s(r,t),r}};var S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=/^~~local_forage_type~([^~]+)~/,q="__lfsc__:",D=q.length,I="arbf",j="blob",B="si08",L="ui08",U="uic8",F="si16",k="si32",Q="ur16",V="ui32",W="fl32",z="fl64",K=D+I.length,J=Object.prototype.toString;function H(e){var t,n,r,i,a,o=.75*e.length,s=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var c=new ArrayBuffer(o),l=new Uint8Array(c);for(t=0;t<s;t+=4)n=S.indexOf(e[t]),r=S.indexOf(e[t+1]),i=S.indexOf(e[t+2]),a=S.indexOf(e[t+3]),l[u++]=n<<2|r>>4,l[u++]=(15&r)<<4|i>>2,l[u++]=(3&i)<<6|63&a;return c}function G(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=S[n[t]>>2],r+=S[(3&n[t])<<4|n[t+1]>>4],r+=S[(15&n[t+1])<<2|n[t+2]>>6],r+=S[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var Y={serialize:function(e,t){var n="";if(e&&(n=J.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===J.call(e.buffer))){var r,i=q;e instanceof ArrayBuffer?(r=e,i+=I):(r=e.buffer,"[object Int8Array]"===n?i+=B:"[object Uint8Array]"===n?i+=L:"[object Uint8ClampedArray]"===n?i+=U:"[object Int16Array]"===n?i+=F:"[object Uint16Array]"===n?i+=Q:"[object Int32Array]"===n?i+=k:"[object Uint32Array]"===n?i+=V:"[object Float32Array]"===n?i+=W:"[object Float64Array]"===n?i+=z:t(new Error("Failed to get type for BinaryArray"))),t(i+G(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n="~~local_forage_type~"+e.type+"~"+G(this.result);t("__lfsc__:blob"+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,D)!==q)return JSON.parse(e);var t,n=e.substring(K),r=e.substring(D,K);if(r===j&&P.test(n)){var i=n.match(P);t=i[1],n=n.substring(i[0].length)}var o=H(n);switch(r){case I:return o;case j:return a([o],{type:t});case B:return new Int8Array(o);case L:return new Uint8Array(o);case U:return new Uint8ClampedArray(o);case F:return new Int16Array(o);case Q:return new Uint16Array(o);case k:return new Int32Array(o);case V:return new Uint32Array(o);case W:return new Float32Array(o);case z:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}},stringToBuffer:H,bufferToString:G};function $(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function X(e,t,n,r,i,a){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?a(e,o):$(e,t,(function(){e.executeSql(n,r,i,a)}),a)}),a):a(e,o)}),a)}function Z(e,t,n,r){var i=this;e=c(e);var a=new o((function(a,o){i.ready().then((function(){void 0===t&&(t=null);var s=t,u=i._dbInfo;u.serializer.serialize(t,(function(t,c){c?o(c):u.db.transaction((function(n){X(n,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void a(Z.apply(i,[e,s,n,r-1]));o(t)}}))}))})).catch(o)}));return s(a,n),a}function ee(e){return new o((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],a=0;a<r.rows.length;a++)i.push(r.rows.item(a).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var te={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new o((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){$(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=Y,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var a=r.rows,o=a.length,s=0;s<o;s++){var u=a.item(s),c=u.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,u.key,s+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return Z.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=c(e);var r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){X(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){X(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new o((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){X(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){X(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return s(r=e.name?new o((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(ee(r))})).then((function(e){return new o((function(t,n){e.db.transaction((function(r){function i(e){return new o((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var a=[],s=0,u=e.storeNames.length;s<u;s++)a.push(i(e.storeNames[s]));o.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments"),t),r}};function ne(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function re(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var ie={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=ne(e,this._defaultConfig),re()?(this._dbInfo=t,t.serializer=Y,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,a=localStorage.length,o=1,s=0;s<a;s++){var u=localStorage.key(s);if(0===u.indexOf(r)){var c=localStorage.getItem(u);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,u.substring(i),o++)))return c}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new o((function(i,a){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)a(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||a(e),a(e)}}))}))}));return s(i,n),i},removeItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var a=localStorage.key(i);0===a.indexOf(e.keyPrefix)&&r.push(a.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=l.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return s(r=e.name?new o((function(t){e.storeName?t(ne(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments"),t),r}},ae=function(e,t){for(var n=e.length,r=0;r<n;){if((i=e[r])===(a=t)||"number"==typeof i&&"number"==typeof a&&isNaN(i)&&isNaN(a))return!0;r++}var i,a;return!1},oe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},se={},ue={},ce={INDEXEDDB:x,WEBSQL:te,LOCALSTORAGE:ie},le=[ce.INDEXEDDB._driver,ce.WEBSQL._driver,ce.LOCALSTORAGE._driver],he=["dropInstance"],pe=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(he),de={description:"",driver:le.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function fe(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function me(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(oe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ye=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ce)if(ce.hasOwnProperty(n)){var r=ce[n],i=r._driver;this[n]=i,se[i]||this.defineDriver(r)}this._defaultConfig=me({},de),this._config=me({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new o((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var a=pe.concat("_initStorage"),u=0,c=a.length;u<c;u++){var l=a[u];if((!ae(he,l)||e[l])&&"function"!=typeof e[l])return void n(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=o.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=he.length;n<r;n++){var i=he[n];e[i]||(e[i]=t(i))}}();var h=function(n){se[r]&&console.info("Redefining LocalForage driver: "+r),se[r]=e,ue[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return u(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=se[e]?o.resolve(se[e]):o.reject(new Error("Driver not found."));return u(r,t,n),r},e.prototype.getSerializer=function(e){var t=o.resolve(Y);return u(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;oe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function s(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}a();var u=new Error("No available storage method found.");return r._driverSet=o.reject(u),r._driverSet}()}}(i)}))})).catch((function(){a();var e=new Error("No available storage method found.");return r._driverSet=o.reject(e),r._driverSet})),u(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!ue[e]},e.prototype._extend=function(e){me(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=pe.length;e<t;e++)fe(this,pe[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ye},{3:3}]},{},[4])(4)},8706:(e,t,n)=>{var r;!function(e){!function(t){var r="object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=a(e);function a(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===r.Reflect?r.Reflect=e:i=a(r.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,o={__proto__:[]}instanceof Array,s=!a&&!o,u={create:a?function(){return I(Object.create(null))}:o?function(){return I({__proto__:null})}:function(){return I({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),l="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=l||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,a)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function a(e,t){return t}function o(e,t){return[e,t]}}():Map,p=l||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(l||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+o()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(){var e,t=(e=16,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function f(e,t,n){var r=d.get(e);if(T(r)){if(!n)return;r=new h,d.set(e,r)}var i=r.get(t);if(T(i)){if(!n)return;i=new h,r.set(t,i)}return i}function m(e,t,n){if(y(e,t,n))return!0;var r=D(t);return!M(r)&&m(e,r,n)}function y(e,t,n){var r=f(t,n,!1);return!T(r)&&!!r.has(e)}function v(e,t,n){if(y(e,t,n))return g(e,t,n);var r=D(t);return M(r)?void 0:v(e,r,n)}function g(e,t,n){var r=f(t,n,!1);if(!T(r))return r.get(e)}function b(e,t,n,r){f(n,r,!0).set(e,t)}function _(e,t){var n=w(e,t),r=D(e);if(null===r)return n;var i=_(r,t);if(i.length<=0)return n;if(n.length<=0)return i;for(var a=new p,o=[],s=0,u=n;s<u.length;s++){var c=u[s];a.has(c)||(a.add(c),o.push(c))}for(var l=0,h=i;l<h.length;l++)c=h[l],a.has(c)||(a.add(c),o.push(c));return o}function w(e,t){var n=[],r=f(e,t,!1);if(T(r))return n;for(var a=function(e){var t=S(e,i);if(!O(t))throw new TypeError;var n=t.call(e);if(!N(n))throw new TypeError;return n}(r.keys()),o=0;;){var s=P(a);if(!s)return n.length=o,n;var u=s.value;try{n[o]=u}catch(e){try{q(a)}finally{throw e}}o++}}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function T(e){return void 0===e}function M(e){return null===e}function N(e){return"object"==typeof e?null!==e:"function"==typeof e}function C(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=S(e,r);if(void 0!==i){var a=i.call(e,n);if(N(a))throw new TypeError;return a}return function(e,t){if("string"===t){var n=e.toString;if(O(n)&&!N(i=n.call(e)))return i;if(O(r=e.valueOf)&&!N(i=r.call(e)))return i}else{var r;if(O(r=e.valueOf)&&!N(i=r.call(e)))return i;var i,a=e.toString;if(O(a)&&!N(i=a.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function R(e){var t=C(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function A(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function O(e){return"function"==typeof e}function x(e){return"function"==typeof e}function S(e,t){var n=e[t];if(null!=n){if(!O(n))throw new TypeError;return n}}function P(e){var t=e.next();return!t.done&&t}function q(e){var t=e.return;t&&t.call(e)}function D(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function I(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(T(n)){if(!A(e))throw new TypeError;if(!x(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!T(r)&&!M(r)){if(!x(r))throw new TypeError;t=r}}return t}(e,t)}if(!A(e))throw new TypeError;if(!N(t))throw new TypeError;if(!N(r)&&!T(r)&&!M(r))throw new TypeError;return M(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!T(a)&&!M(a)){if(!N(a))throw new TypeError;r=a}}return r}(e,t,n=R(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!N(n))throw new TypeError;if(!T(r)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;b(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!N(n))throw new TypeError;return T(r)||(r=R(r)),b(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!N(t))throw new TypeError;return T(n)||(n=R(n)),m(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!N(t))throw new TypeError;return T(n)||(n=R(n)),y(e,t,n)})),e("getMetadata",(function(e,t,n){if(!N(t))throw new TypeError;return T(n)||(n=R(n)),v(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!N(t))throw new TypeError;return T(n)||(n=R(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!N(e))throw new TypeError;return T(t)||(t=R(t)),_(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!N(e))throw new TypeError;return T(t)||(t=R(t)),w(e,t)})),e("deleteMetadata",(function(e,t,n){if(!N(t))throw new TypeError;T(n)||(n=R(n));var r=f(t,n,!1);if(T(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||d.delete(t),!0}))}(i)}()}(r||(r={}))},7172:(e,t,n)=>{var r=n(816),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),o.prototype=Object.create(i.prototype),a(i,o),o.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},8423:(e,t,n)=>{var r=n(7172).Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=r.from(e,t));for(var n=this._block,i=this._blockSize,a=e.length,o=this._len,s=0;s<a;){for(var u=o%i,c=Math.min(a-s,i-u),l=0;l<c;l++)n[u+l]=e[s+l];s+=c,(o+=c)%i==0&&this._update(n)}return this._len+=a,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=i},4458:(e,t,n)=>{var r=e.exports=function(e){e=e.toLowerCase();var t=r[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};r.sha=n(3608),r.sha1=n(6533),r.sha224=n(8203),r.sha256=n(9541),r.sha384=n(1389),r.sha512=n(6282)},3608:(e,t,n)=>{var r=n(87),i=n(8423),a=n(7172).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<30|e>>>2}function l(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,h=0;h<16;++h)n[h]=e.readInt32BE(4*h);for(;h<80;++h)n[h]=n[h-3]^n[h-8]^n[h-14]^n[h-16];for(var p=0;p<80;++p){var d=~~(p/20),f=0|((t=r)<<5|t>>>27)+l(d,i,a,s)+u+n[p]+o[d];u=s,s=a,a=c(i),i=r,r=f}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},6533:(e,t,n)=>{var r=n(87),i=n(8423),a=n(7172).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function h(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,p=0;p<16;++p)n[p]=e.readInt32BE(4*p);for(;p<80;++p)n[p]=(t=n[p-3]^n[p-8]^n[p-14]^n[p-16])<<1|t>>>31;for(var d=0;d<80;++d){var f=~~(d/20),m=c(r)+h(f,i,a,s)+u+n[d]+o[f]|0;u=s,s=a,a=l(i),i=r,r=m}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},8203:(e,t,n)=>{var r=n(87),i=n(9541),a=n(8423),o=n(7172).Buffer,s=new Array(64);function u(){this.init(),this._w=s,a.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=u},9541:(e,t,n)=>{var r=n(87),i=n(8423),a=n(7172).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function h(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function p(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function d(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(u,i),u.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,f=0|this._f,m=0|this._g,y=0|this._h,v=0;v<16;++v)n[v]=e.readInt32BE(4*v);for(;v<64;++v)n[v]=0|(((t=n[v-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+n[v-7]+d(n[v-15])+n[v-16];for(var g=0;g<64;++g){var b=y+p(u)+c(u,f,m)+o[g]+n[g]|0,_=h(r)+l(r,i,a)|0;y=m,m=f,f=u,u=s+b|0,s=a,a=i,i=r,r=b+_|0}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0,this._f=f+this._f|0,this._g=m+this._g|0,this._h=y+this._h|0},u.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=u},1389:(e,t,n)=>{var r=n(87),i=n(6282),a=n(8423),o=n(7172).Buffer,s=new Array(160);function u(){this.init(),this._w=s,a.call(this,128,112)}r(u,i),u.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=u},6282:(e,t,n)=>{var r=n(87),i=n(8423),a=n(7172).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function u(){this.init(),this._w=s,i.call(this,128,112)}function c(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function h(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function p(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function d(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function y(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function v(e,t){return e>>>0<t>>>0?1:0}r(u,i),u.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,i=0|this._ch,a=0|this._dh,s=0|this._eh,u=0|this._fh,g=0|this._gh,b=0|this._hh,_=0|this._al,w=0|this._bl,E=0|this._cl,T=0|this._dl,M=0|this._el,N=0|this._fl,C=0|this._gl,R=0|this._hl,A=0;A<32;A+=2)t[A]=e.readInt32BE(4*A),t[A+1]=e.readInt32BE(4*A+4);for(;A<160;A+=2){var O=t[A-30],x=t[A-30+1],S=d(O,x),P=f(x,O),q=m(O=t[A-4],x=t[A-4+1]),D=y(x,O),I=t[A-14],j=t[A-14+1],B=t[A-32],L=t[A-32+1],U=P+j|0,F=S+I+v(U,P)|0;F=(F=F+q+v(U=U+D|0,D)|0)+B+v(U=U+L|0,L)|0,t[A]=F,t[A+1]=U}for(var k=0;k<160;k+=2){F=t[k],U=t[k+1];var Q=l(n,r,i),V=l(_,w,E),W=h(n,_),z=h(_,n),K=p(s,M),J=p(M,s),H=o[k],G=o[k+1],Y=c(s,u,g),$=c(M,N,C),X=R+J|0,Z=b+K+v(X,R)|0;Z=(Z=(Z=Z+Y+v(X=X+$|0,$)|0)+H+v(X=X+G|0,G)|0)+F+v(X=X+U|0,U)|0;var ee=z+V|0,te=W+Q+v(ee,z)|0;b=g,R=C,g=u,C=N,u=s,N=M,s=a+Z+v(M=T+X|0,T)|0,a=i,T=E,i=r,E=w,r=n,w=_,n=Z+te+v(_=X+ee|0,X)|0}this._al=this._al+_|0,this._bl=this._bl+w|0,this._cl=this._cl+E|0,this._dl=this._dl+T|0,this._el=this._el+M|0,this._fl=this._fl+N|0,this._gl=this._gl+C|0,this._hl=this._hl+R|0,this._ah=this._ah+n+v(this._al,_)|0,this._bh=this._bh+r+v(this._bl,w)|0,this._ch=this._ch+i+v(this._cl,E)|0,this._dh=this._dh+a+v(this._dl,T)|0,this._eh=this._eh+s+v(this._el,M)|0,this._fh=this._fh+u+v(this._fl,N)|0,this._gh=this._gh+g+v(this._gl,C)|0,this._hh=this._hh+b+v(this._hl,R)|0},u.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=u},645:(e,t,n)=>{e=n.nmd(e);var r=void 0,i=function(t){return r||(r=new Promise((function(r,i){var a,o=void 0!==t?t:{},s=o.onAbort;o.onAbort=function(e){i(new Error(e)),s&&s(e)},o.postRun=o.postRun||[],o.postRun.push((function(){r(o)})),e=void 0,a||(a=void 0!==o?o:{}),a.onRuntimeInitialized=function(){function e(e,t){this.Ra=e,this.db=t,this.Qa=1,this.lb=[]}function t(e,t){if(this.db=t,t=K(e)+1,this.eb=Dt(t),null===this.eb)throw Error("Unable to allocate memory for the SQL string");z(e,B,this.eb,t),this.jb=this.eb,this.$a=this.pb=null}function n(e){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),null!=e){var t=this.filename,n=t?me("//"+t):"/";if(n=Ye(n,4095&(void 0!==(t=dt(!0,!0))?t:438)|32768,0),e){if("string"==typeof e){for(var i=Array(e.length),a=0,s=e.length;a<s;++a)i[a]=e.charCodeAt(a);e=i}it(n,146|t),ht(i=st(n,577),e,0,e.length,0,void 0),ut(i),it(n,t)}}this.handleError(o(this.filename,r)),this.db=A(r,"i32"),re(this.db),this.fb={},this.Xa={}}var r=Qt(4),i=a.cwrap,o=i("sqlite3_open","number",["string","number"]),s=i("sqlite3_close_v2","number",["number"]),u=i("sqlite3_exec","number",["number","string","number","number","number"]),c=i("sqlite3_changes","number",["number"]),l=i("sqlite3_prepare_v2","number",["number","string","number","number","number"]),h=i("sqlite3_sql","string",["number"]),p=i("sqlite3_normalized_sql","string",["number"]),d=i("sqlite3_prepare_v2","number",["number","number","number","number","number"]),f=i("sqlite3_bind_text","number",["number","number","number","number","number"]),m=i("sqlite3_bind_blob","number",["number","number","number","number","number"]),y=i("sqlite3_bind_double","number",["number","number","number"]),v=i("sqlite3_bind_int","number",["number","number","number"]),g=i("sqlite3_bind_parameter_index","number",["number","string"]),b=i("sqlite3_step","number",["number"]),_=i("sqlite3_errmsg","string",["number"]),w=i("sqlite3_column_count","number",["number"]),E=i("sqlite3_data_count","number",["number"]),M=i("sqlite3_column_double","number",["number","number"]),O=i("sqlite3_column_text","string",["number","number"]),x=i("sqlite3_column_blob","number",["number","number"]),S=i("sqlite3_column_bytes","number",["number","number"]),P=i("sqlite3_column_type","number",["number","number"]),q=i("sqlite3_column_name","string",["number","number"]),I=i("sqlite3_reset","number",["number"]),L=i("sqlite3_clear_bindings","number",["number"]),U=i("sqlite3_finalize","number",["number"]),F=i("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),k=i("sqlite3_value_type","number",["number"]),Q=i("sqlite3_value_bytes","number",["number"]),J=i("sqlite3_value_text","string",["number"]),H=i("sqlite3_value_blob","number",["number"]),Y=i("sqlite3_value_double","number",["number"]),$=i("sqlite3_result_double","",["number","number"]),X=i("sqlite3_result_null","",["number"]),Z=i("sqlite3_result_text","",["number","string","number","number"]),ee=i("sqlite3_result_blob","",["number","number","number","number"]),te=i("sqlite3_result_int","",["number","number"]),ne=i("sqlite3_result_error","",["number","string","number"]),re=i("RegisterExtensionFunctions","number",["number"]);e.prototype.bind=function(e){if(!this.Ra)throw"Statement closed";return this.reset(),Array.isArray(e)?this.Eb(e):null==e||"object"!=typeof e||this.Fb(e)},e.prototype.step=function(){if(!this.Ra)throw"Statement closed";this.Qa=1;var e=b(this.Ra);switch(e){case 100:return!0;case 101:return!1;default:throw this.db.handleError(e)}},e.prototype.zb=function(e){return null==e&&(e=this.Qa,this.Qa+=1),M(this.Ra,e)},e.prototype.Jb=function(e){if(null==e&&(e=this.Qa,this.Qa+=1),e=O(this.Ra,e),"function"!=typeof BigInt)throw Error("BigInt is not supported");return BigInt(e)},e.prototype.Kb=function(e){return null==e&&(e=this.Qa,this.Qa+=1),O(this.Ra,e)},e.prototype.getBlob=function(e){null==e&&(e=this.Qa,this.Qa+=1);var t=S(this.Ra,e);e=x(this.Ra,e);for(var n=new Uint8Array(t),r=0;r<t;r+=1)n[r]=j[e+r];return n},e.prototype.get=function(e,t){t=t||{},null!=e&&this.bind(e)&&this.step(),e=[];for(var n=E(this.Ra),r=0;r<n;r+=1)switch(P(this.Ra,r)){case 1:var i=t.useBigInt?this.Jb(r):this.zb(r);e.push(i);break;case 2:e.push(this.zb(r));break;case 3:e.push(this.Kb(r));break;case 4:e.push(this.getBlob(r));break;default:e.push(null)}return e},e.prototype.getColumnNames=function(){for(var e=[],t=w(this.Ra),n=0;n<t;n+=1)e.push(q(this.Ra,n));return e},e.prototype.getAsObject=function(e,t){e=this.get(e,t),t=this.getColumnNames();for(var n={},r=0;r<t.length;r+=1)n[t[r]]=e[r];return n},e.prototype.getSQL=function(){return h(this.Ra)},e.prototype.getNormalizedSQL=function(){return p(this.Ra)},e.prototype.run=function(e){return null!=e&&this.bind(e),this.step(),this.reset()},e.prototype.ub=function(e,t){null==t&&(t=this.Qa,this.Qa+=1);var n=D(e=Ot(e));this.lb.push(n),this.db.handleError(f(this.Ra,t,n,e.length-1,0))},e.prototype.Db=function(e,t){null==t&&(t=this.Qa,this.Qa+=1);var n=D(e);this.lb.push(n),this.db.handleError(m(this.Ra,t,n,e.length,0))},e.prototype.tb=function(e,t){null==t&&(t=this.Qa,this.Qa+=1),this.db.handleError((e===(0|e)?v:y)(this.Ra,t,e))},e.prototype.Gb=function(e){null==e&&(e=this.Qa,this.Qa+=1),m(this.Ra,e,0,0,0)},e.prototype.vb=function(e,t){switch(null==t&&(t=this.Qa,this.Qa+=1),typeof e){case"string":return void this.ub(e,t);case"number":return void this.tb(e,t);case"bigint":return void this.ub(e.toString(),t);case"boolean":return void this.tb(e+0,t);case"object":if(null===e)return void this.Gb(t);if(null!=e.length)return void this.Db(e,t)}throw"Wrong API use : tried to bind a value of an unknown type ("+e+")."},e.prototype.Fb=function(e){var t=this;return Object.keys(e).forEach((function(n){var r=g(t.Ra,n);0!==r&&t.vb(e[n],r)})),!0},e.prototype.Eb=function(e){for(var t=0;t<e.length;t+=1)this.vb(e[t],t+1);return!0},e.prototype.reset=function(){return this.freemem(),0===L(this.Ra)&&0===I(this.Ra)},e.prototype.freemem=function(){for(var e;void 0!==(e=this.lb.pop());)It(e)},e.prototype.free=function(){this.freemem();var e=0===U(this.Ra);return delete this.db.fb[this.Ra],this.Ra=0,e},t.prototype.next=function(){if(null===this.eb)return{done:!0};if(null!==this.$a&&(this.$a.free(),this.$a=null),!this.db.db)throw this.nb(),Error("Database closed");var t=Ft(),n=Qt(4);R(r),R(n);try{this.db.handleError(d(this.db.db,this.jb,-1,r,n)),this.jb=A(n,"i32");var i=A(r,"i32");return 0===i?(this.nb(),{done:!0}):(this.$a=new e(i,this.db),this.db.fb[i]=this.$a,{value:this.$a,done:!1})}catch(e){throw this.pb=W(this.jb),this.nb(),e}finally{kt(t)}},t.prototype.nb=function(){It(this.eb),this.eb=null},t.prototype.getRemainingSQL=function(){return null!==this.pb?this.pb:W(this.jb)},"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator&&(t.prototype[Symbol.iterator]=function(){return this}),n.prototype.run=function(e,t){if(!this.db)throw"Database closed";if(t){e=this.prepare(e,t);try{e.step()}finally{e.free()}}else this.handleError(u(this.db,e,0,0,r));return this},n.prototype.exec=function(t,n,i){if(!this.db)throw"Database closed";var a=Ft(),o=null;try{var s=K(t)+1,u=Qt(s);z(t,j,u,s);var c=u,l=Qt(4);for(t=[];0!==A(c,"i8");){R(r),R(l),this.handleError(d(this.db,c,-1,r,l));var h=A(r,"i32");if(c=A(l,"i32"),0!==h){for(s=null,o=new e(h,this),null!=n&&o.bind(n);o.step();)null===s&&(s={columns:o.getColumnNames(),values:[]},t.push(s)),s.values.push(o.get(null,i));o.free()}}return t}catch(e){throw o&&o.free(),e}finally{kt(a)}},n.prototype.each=function(e,t,n,r,i){"function"==typeof t&&(r=n,n=t,t=void 0),e=this.prepare(e,t);try{for(;e.step();)n(e.getAsObject(null,i))}finally{e.free()}if("function"==typeof r)return r()},n.prototype.prepare=function(t,n){if(R(r),this.handleError(l(this.db,t,-1,r,0)),0===(t=A(r,"i32")))throw"Nothing to prepare";var i=new e(t,this);return null!=n&&i.bind(n),this.fb[t]=i},n.prototype.iterateStatements=function(e){return new t(e,this)},n.prototype.export=function(){Object.values(this.fb).forEach((function(e){e.free()})),Object.values(this.Xa).forEach(C),this.Xa={},this.handleError(s(this.db));var e=function(e){var t={encoding:"binary"};if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw Error('Invalid encoding type "'+t.encoding+'"');var n,r=st(e,t.flags);e=nt(e).size;var i=new Uint8Array(e);return lt(r,i,0,e,0),"utf8"===t.encoding?n=V(i,0):"binary"===t.encoding&&(n=i),ut(r),n}(this.filename);return this.handleError(o(this.filename,r)),this.db=A(r,"i32"),e},n.prototype.close=function(){null!==this.db&&(Object.values(this.fb).forEach((function(e){e.free()})),Object.values(this.Xa).forEach(C),this.Xa={},this.handleError(s(this.db)),et("/"+this.filename),this.db=null)},n.prototype.handleError=function(e){if(0===e)return null;throw e=_(this.db),Error(e)},n.prototype.getRowsModified=function(){return c(this.db)},n.prototype.create_function=function(e,t){Object.prototype.hasOwnProperty.call(this.Xa,e)&&(C(this.Xa[e]),delete this.Xa[e]);var n=function(e){if(!T){T=new WeakMap;for(var t=0;t<G.length;t++){var n=G.get(t);n&&T.set(n,t)}}if(T.has(e))e=T.get(e);else{if(N.length)t=N.pop();else{try{G.grow(1)}catch(e){if(!(e instanceof RangeError))throw e;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}t=G.length-1}try{G.set(t,e)}catch(a){if(!(a instanceof TypeError))throw a;if("function"==typeof WebAssembly.Function){var r={i:"i32",j:"i64",f:"f32",d:"f64"},i={parameters:[],results:[]};for(n=1;4>n;++n)i.parameters.push(r["viii"[n]]);n=new WebAssembly.Function(i,e)}else{for(i={i:127,j:126,f:125,d:124},(r=[1,0,1,96]).push(3),n=0;3>n;++n)r.push(i["iii"[n]]);r.push(0),r[1]=r.length-2,n=new Uint8Array([0,97,115,109,1,0,0,0].concat(r,[2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0])),n=new WebAssembly.Module(n),n=new WebAssembly.Instance(n,{e:{f:e}}).exports.f}G.set(t,n)}T.set(e,t),e=t}return e}((function(e,n,r){for(var i,a=[],o=0;o<n;o+=1){var s=A(r+4*o,"i32"),u=k(s);if(1===u||2===u)s=Y(s);else if(3===u)s=J(s);else if(4===u){s=Q(u=s),u=H(u);for(var c=new Uint8Array(s),l=0;l<s;l+=1)c[l]=j[u+l];s=c}else s=null;a.push(s)}try{i=t.apply(null,a)}catch(t){return void ne(e,t,-1)}switch(typeof i){case"boolean":te(e,i?1:0);break;case"number":$(e,i);break;case"string":Z(e,i,-1,-1);break;case"object":null===i?X(e):null!=i.length?(n=D(i),ee(e,n,i.length,-1),It(n)):ne(e,"Wrong API use : tried to return a value of an unknown type ("+i+").",-1);break;default:X(e)}}));return this.Xa[e]=n,this.handleError(F(this.db,e,t.length,1,0,n,0,0,0)),this},a.Database=n};var u,c={};for(u in a)a.hasOwnProperty(u)&&(c[u]=a[u]);var l,h,p,d,f="./this.program";l="object"==typeof window,h="function"==typeof importScripts,p="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,d=!l&&!p&&!h;var m,y,v,g,b,_="";p?(_=h?n(1497).dirname(_)+"/":"//",m=function(e,t){return g||(g=n(9356)),b||(b=n(1497)),e=b.normalize(e),g.readFileSync(e,t?null:"utf8")},v=function(e){return(e=m(e,!0)).buffer||(e=new Uint8Array(e)),S(e.buffer),e},1<process.argv.length&&(f=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),e.exports=a,a.inspect=function(){return"[Emscripten Module object]"}):d?("undefined"!=typeof read&&(m=function(e){return read(e)}),v=function(e){return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(S("object"==typeof(e=read(e,"binary"))),e)},"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(l||h)&&(h?_=self.location.href:"undefined"!=typeof document&&document.currentScript&&(_=document.currentScript.src),_=0!==_.indexOf("blob:")?_.substr(0,_.lastIndexOf("/")+1):"",m=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),y=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var w=a.print||console.log.bind(console),E=a.printErr||console.warn.bind(console);for(u in c)c.hasOwnProperty(u)&&(a[u]=c[u]);c=null,a.thisProgram&&(f=a.thisProgram);var T,M,N=[];function C(e){T.delete(G.get(e)),N.push(e)}function R(e){var t="i32";switch("*"===t.charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":j[e>>0]=0;break;case"i16":L[e>>1]=0;break;case"i32":U[e>>2]=0;break;case"i64":ue=[0,(se=0,1<=+Math.abs(se)?0<se?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],U[e>>2]=ue[0],U[e+4>>2]=ue[1];break;case"float":F[e>>2]=0;break;case"double":k[e>>3]=0;break;default:ie("invalid type for setValue: "+t)}}function A(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return j[e>>0];case"i16":return L[e>>1];case"i32":case"i64":return U[e>>2];case"float":return F[e>>2];case"double":return k[e>>3];default:ie("invalid type for getValue: "+t)}return null}a.wasmBinary&&(M=a.wasmBinary),a.noExitRuntime,"object"!=typeof WebAssembly&&ie("no native wasm support detected");var O,x=!1;function S(e,t){e||ie("Assertion failed: "+t)}function P(e){var t=a["_"+e];return S(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function q(e,t,n,r){var i,a={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);t=Qt(n),z(e,B,t,n)}return t},array:function(e){var t=Qt(e.length);return j.set(e,t),t}},o=P(e),s=[];if(e=0,r)for(var u=0;u<r.length;u++){var c=a[n[u]];c?(0===e&&(e=Ft()),s[u]=c(r[u])):s[u]=r[u]}return i=n=o.apply(null,s),n="string"===t?W(i):"boolean"===t?!!i:i,0!==e&&kt(e),n}function D(e){var t=Dt(e.length);return e.subarray||e.slice?B.set(e,t):B.set(new Uint8Array(e),t),t}var I,j,B,L,U,F,k,Q="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function V(e,t,n){var r=t+n;for(n=t;e[n]&&!(n>=r);)++n;if(16<n-t&&e.subarray&&Q)return Q.decode(e.subarray(t,n));for(r="";t<n;){var i=e[t++];if(128&i){var a=63&e[t++];if(192==(224&i))r+=String.fromCharCode((31&i)<<6|a);else{var o=63&e[t++];65536>(i=224==(240&i)?(15&i)<<12|a<<6|o:(7&i)<<18|a<<12|o<<6|63&e[t++])?r+=String.fromCharCode(i):(i-=65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}}else r+=String.fromCharCode(i)}return r}function W(e,t){return e?V(B,e,t):""}function z(e,t,n,r){if(!(0<r))return 0;var i=n;r=n+r-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(n+3>=r)break;t[n++]=240|o>>18,t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-i}function K(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:t+4}return t}function J(e){var t=K(e)+1,n=Dt(t);return n&&z(e,j,n,t),n}function H(){var e=O.buffer;I=e,a.HEAP8=j=new Int8Array(e),a.HEAP16=L=new Int16Array(e),a.HEAP32=U=new Int32Array(e),a.HEAPU8=B=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=F=new Float32Array(e),a.HEAPF64=k=new Float64Array(e)}var G,Y=[],$=[],X=[],Z=[];function ee(){var e=a.preRun.shift();Y.unshift(e)}$.push({Ib:function(){St()}});var te=0,ne=null,re=null;function ie(e){throw a.onAbort&&a.onAbort(e),E(e),x=!0,new WebAssembly.RuntimeError("abort("+e+"). Build with -s ASSERTIONS=1 for more info.")}function ae(e){var t=le;return String.prototype.startsWith?t.startsWith(e):0===t.indexOf(e)}function oe(){return ae("data:application/octet-stream;base64,")}a.preloadedImages={},a.preloadedAudios={};var se,ue,ce,le="sql-wasm.wasm";if(!oe()){var he=le;le=a.locateFile?a.locateFile(he,_):_+he}function pe(){var e=le;try{if(e==le&&M)return new Uint8Array(M);if(v)return v(e);throw"both async and sync fetching of the wasm failed"}catch(e){ie(e)}}function de(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t(a);else{var n=t.Ib;"number"==typeof n?void 0===t.mb?G.get(n)():G.get(n)(t.mb):n(void 0===t.mb?null:t.mb)}}}function fe(e,t){for(var n=0,r=e.length-1;0<=r;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e}function me(e){var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=fe(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function ye(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function ve(e){if("/"===e)return"/";var t=(e=(e=me(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)}function ge(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if("string"!=typeof(t=0<=n?arguments[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=fe(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var be=[];function _e(e,t){be[e]={input:[],output:[],cb:t},He(e,we)}var we={open:function(e){var t=be[e.node.rdev];if(!t)throw new Pe(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.cb.flush(e.tty)},flush:function(e){e.tty.cb.flush(e.tty)},read:function(e,t,n,r){if(!e.tty||!e.tty.cb.Ab)throw new Pe(60);for(var i=0,a=0;a<r;a++){try{var o=e.tty.cb.Ab(e.tty)}catch(e){throw new Pe(29)}if(void 0===o&&0===i)throw new Pe(6);if(null==o)break;i++,t[n+a]=o}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,n,r){if(!e.tty||!e.tty.cb.qb)throw new Pe(60);try{for(var i=0;i<r;i++)e.tty.cb.qb(e.tty,t[n+i])}catch(e){throw new Pe(29)}return r&&(e.node.timestamp=Date.now()),i}},Ee={Ab:function(e){if(!e.input.length){var t=null;if(p){var n=Buffer.Cb?Buffer.Cb(256):new Buffer(256),r=0;try{r=g.readSync(process.stdin.fd,n,0,256,null)}catch(e){if(-1==e.toString().indexOf("EOF"))throw e;r=0}t=0<r?n.slice(0,r).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=Ot(t,!0)}return e.input.shift()},qb:function(e,t){null===t||10===t?(w(V(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&0<e.output.length&&(w(V(e.output,0)),e.output=[])}},Te={qb:function(e,t){null===t||10===t?(E(V(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&0<e.output.length&&(E(V(e.output,0)),e.output=[])}},Me={Va:null,Wa:function(){return Me.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(24576==(61440&n)||4096==(61440&n))throw new Pe(63);return Me.Va||(Me.Va={dir:{node:{Ua:Me.Ma.Ua,Ta:Me.Ma.Ta,lookup:Me.Ma.lookup,gb:Me.Ma.gb,rename:Me.Ma.rename,unlink:Me.Ma.unlink,rmdir:Me.Ma.rmdir,readdir:Me.Ma.readdir,symlink:Me.Ma.symlink},stream:{Za:Me.Na.Za}},file:{node:{Ua:Me.Ma.Ua,Ta:Me.Ma.Ta},stream:{Za:Me.Na.Za,read:Me.Na.read,write:Me.Na.write,sb:Me.Na.sb,hb:Me.Na.hb,ib:Me.Na.ib}},link:{node:{Ua:Me.Ma.Ua,Ta:Me.Ma.Ta,readlink:Me.Ma.readlink},stream:{}},wb:{node:{Ua:Me.Ma.Ua,Ta:Me.Ma.Ta},stream:Je}}),Fe((n=Ue(e,t,n,r)).mode)?(n.Ma=Me.Va.dir.node,n.Na=Me.Va.dir.stream,n.Oa={}):32768==(61440&n.mode)?(n.Ma=Me.Va.file.node,n.Na=Me.Va.file.stream,n.Sa=0,n.Oa=null):40960==(61440&n.mode)?(n.Ma=Me.Va.link.node,n.Na=Me.Va.link.stream):8192==(61440&n.mode)&&(n.Ma=Me.Va.wb.node,n.Na=Me.Va.wb.stream),n.timestamp=Date.now(),e&&(e.Oa[t]=n,e.timestamp=n.timestamp),n},Tb:function(e){return e.Oa?e.Oa.subarray?e.Oa.subarray(0,e.Sa):new Uint8Array(e.Oa):new Uint8Array(0)},xb:function(e,t){var n=e.Oa?e.Oa.length:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)>>>0),0!=n&&(t=Math.max(t,256)),n=e.Oa,e.Oa=new Uint8Array(t),0<e.Sa&&e.Oa.set(n.subarray(0,e.Sa),0))},Qb:function(e,t){if(e.Sa!=t)if(0==t)e.Oa=null,e.Sa=0;else{var n=e.Oa;e.Oa=new Uint8Array(t),n&&e.Oa.set(n.subarray(0,Math.min(t,e.Sa))),e.Sa=t}},Ma:{Ua:function(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,Fe(e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.Sa:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Hb=4096,t.blocks=Math.ceil(t.size/t.Hb),t},Ta:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&Me.Qb(e,t.size)},lookup:function(){throw qe[44]},gb:function(e,t,n,r){return Me.createNode(e,t,n,r)},rename:function(e,t,n){if(Fe(e.mode)){try{var r=Le(t,n)}catch(e){}if(r)for(var i in r.Oa)throw new Pe(55)}delete e.parent.Oa[e.name],e.parent.timestamp=Date.now(),e.name=n,t.Oa[n]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.Oa[t],e.timestamp=Date.now()},rmdir:function(e,t){var n,r=Le(e,t);for(n in r.Oa)throw new Pe(55);delete e.Oa[t],e.timestamp=Date.now()},readdir:function(e){var t,n=[".",".."];for(t in e.Oa)e.Oa.hasOwnProperty(t)&&n.push(t);return n},symlink:function(e,t,n){return(e=Me.createNode(e,t,41471,0)).link=n,e},readlink:function(e){if(40960!=(61440&e.mode))throw new Pe(28);return e.link}},Na:{read:function(e,t,n,r,i){var a=e.node.Oa;if(i>=e.node.Sa)return 0;if(8<(e=Math.min(e.node.Sa-i,r))&&a.subarray)t.set(a.subarray(i,i+e),n);else for(r=0;r<e;r++)t[n+r]=a[i+r];return e},write:function(e,t,n,r,i,a){if(t.buffer===j.buffer&&(a=!1),!r)return 0;if((e=e.node).timestamp=Date.now(),t.subarray&&(!e.Oa||e.Oa.subarray)){if(a)return e.Oa=t.subarray(n,n+r),e.Sa=r;if(0===e.Sa&&0===i)return e.Oa=t.slice(n,n+r),e.Sa=r;if(i+r<=e.Sa)return e.Oa.set(t.subarray(n,n+r),i),r}if(Me.xb(e,i+r),e.Oa.subarray&&t.subarray)e.Oa.set(t.subarray(n,n+r),i);else for(a=0;a<r;a++)e.Oa[i+a]=t[n+a];return e.Sa=Math.max(e.Sa,i+r),r},Za:function(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.node.mode)&&(t+=e.node.Sa),0>t)throw new Pe(28);return t},sb:function(e,t,n){Me.xb(e.node,t+n),e.node.Sa=Math.max(e.node.Sa,t+n)},hb:function(e,t,n,r,i,a){if(0!==t)throw new Pe(28);if(32768!=(61440&e.node.mode))throw new Pe(43);if(e=e.node.Oa,2&a||e.buffer!==I){for((0<r||r+n<e.length)&&(e=e.subarray?e.subarray(r,r+n):Array.prototype.slice.call(e,r,r+n)),r=!0,a=16384*Math.ceil(n/16384),t=Dt(a);n<a;)j[t+n++]=0;if(!(n=t))throw new Pe(48);j.set(e,n)}else r=!1,n=e.byteOffset;return{Pb:n,kb:r}},ib:function(e,t,n,r,i){if(32768!=(61440&e.node.mode))throw new Pe(43);return 2&i||Me.Na.write(e,t,0,r,n,!1),0}}},Ne=null,Ce={},Re=[],Ae=1,Oe=null,xe=!0,Se={},Pe=null,qe={};function De(e,t){if(t=t||{},!(e=ge("/",e)))return{path:"",node:null};var n,r={yb:!0,rb:0};for(n in r)void 0===t[n]&&(t[n]=r[n]);if(8<t.rb)throw new Pe(32);e=fe(e.split("/").filter((function(e){return!!e})),!1);var i=Ne;for(r="/",n=0;n<e.length;n++){var a=n===e.length-1;if(a&&t.parent)break;if(i=Le(i,e[n]),r=me(r+"/"+e[n]),i.ab&&(!a||a&&t.yb)&&(i=i.ab.root),!a||t.Ya)for(a=0;40960==(61440&i.mode);)if(i=tt(r),i=De(r=ge(ye(r),i),{rb:t.rb}).node,40<a++)throw new Pe(32)}return{path:r,node:i}}function Ie(e){for(var t;;){if(e===e.parent)return e=e.Wa.Bb,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function je(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%Oe.length}function Be(e){var t=je(e.parent.id,e.name);if(Oe[t]===e)Oe[t]=e.bb;else for(t=Oe[t];t;){if(t.bb===e){t.bb=e.bb;break}t=t.bb}}function Le(e,t){var n;if(n=(n=Ve(e,"x"))?n:e.Ma.lookup?0:2)throw new Pe(n,e);for(n=Oe[je(e.id,t)];n;n=n.bb){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.Ma.lookup(e,t)}function Ue(e,t,n,r){return t=je((e=new At(e,t,n,r)).parent.id,e.name),e.bb=Oe[t],Oe[t]=e}function Fe(e){return 16384==(61440&e)}var ke={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090};function Qe(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t}function Ve(e,t){return xe||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:2}function We(e,t){try{return Le(e,t),20}catch(e){}return Ve(e,"wx")}function ze(e,t,n){try{var r=Le(e,t)}catch(e){return e.Pa}if(e=Ve(e,"wx"))return e;if(n){if(!Fe(r.mode))return 54;if(r===r.parent||"/"===Ie(r))return 10}else if(Fe(r.mode))return 31;return 0}var Ke,Je={open:function(e){e.Na=Ce[e.node.rdev].Na,e.Na.open&&e.Na.open(e)},Za:function(){throw new Pe(70)}};function He(e,t){Ce[e]={Na:t}}function Ge(e,t){var n="/"===t,r=!t;if(n&&Ne)throw new Pe(10);if(!n&&!r){var i=De(t,{yb:!1});if(t=i.path,(i=i.node).ab)throw new Pe(10);if(!Fe(i.mode))throw new Pe(54)}t={type:e,Ub:{},Bb:t,Nb:[]},(e=e.Wa(t)).Wa=t,t.root=e,n?Ne=e:i&&(i.ab=t,i.Wa&&i.Wa.Nb.push(t))}function Ye(e,t,n){var r=De(e,{parent:!0}).node;if(!(e=ve(e))||"."===e||".."===e)throw new Pe(28);var i=We(r,e);if(i)throw new Pe(i);if(!r.Ma.gb)throw new Pe(63);return r.Ma.gb(r,e,t,n)}function $e(e,t){return Ye(e,1023&(void 0!==t?t:511)|16384,0)}function Xe(e,t,n){void 0===n&&(n=t,t=438),Ye(e,8192|t,n)}function Ze(e,t){if(!ge(e))throw new Pe(44);var n=De(t,{parent:!0}).node;if(!n)throw new Pe(44);var r=We(n,t=ve(t));if(r)throw new Pe(r);if(!n.Ma.symlink)throw new Pe(63);n.Ma.symlink(n,t,e)}function et(e){var t=De(e,{parent:!0}).node,n=ve(e),r=Le(t,n),i=ze(t,n,!1);if(i)throw new Pe(i);if(!t.Ma.unlink)throw new Pe(63);if(r.ab)throw new Pe(10);try{Se.willDeletePath&&Se.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.Ma.unlink(t,n),Be(r);try{Se.onDeletePath&&Se.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}}function tt(e){if(!(e=De(e).node))throw new Pe(44);if(!e.Ma.readlink)throw new Pe(28);return ge(Ie(e.parent),e.Ma.readlink(e))}function nt(e,t){if(!(e=De(e,{Ya:!t}).node))throw new Pe(44);if(!e.Ma.Ua)throw new Pe(63);return e.Ma.Ua(e)}function rt(e){return nt(e,!0)}function it(e,t){var n;if(!(n="string"==typeof e?De(e,{Ya:!0}).node:e).Ma.Ta)throw new Pe(63);n.Ma.Ta(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})}function at(e){var t;if(!(t="string"==typeof e?De(e,{Ya:!0}).node:e).Ma.Ta)throw new Pe(63);t.Ma.Ta(t,{timestamp:Date.now()})}function ot(e,t){if(0>t)throw new Pe(28);var n;if(!(n="string"==typeof e?De(e,{Ya:!0}).node:e).Ma.Ta)throw new Pe(63);if(Fe(n.mode))throw new Pe(31);if(32768!=(61440&n.mode))throw new Pe(28);if(e=Ve(n,"w"))throw new Pe(e);n.Ma.Ta(n,{size:t,timestamp:Date.now()})}function st(e,t,n,r){if(""===e)throw new Pe(44);if("string"==typeof t){var i=ke[t];if(void 0===i)throw Error("Unknown file open mode: "+t);t=i}if(n=64&t?4095&(void 0===n?438:n)|32768:0,"object"==typeof e)var o=e;else{e=me(e);try{o=De(e,{Ya:!(131072&t)}).node}catch(e){}}if(i=!1,64&t)if(o){if(128&t)throw new Pe(20)}else o=Ye(e,n,0),i=!0;if(!o)throw new Pe(44);if(8192==(61440&o.mode)&&(t&=-513),65536&t&&!Fe(o.mode))throw new Pe(54);if(!i&&(n=o?40960==(61440&o.mode)?32:Fe(o.mode)&&("r"!==Qe(t)||512&t)?31:Ve(o,Qe(t)):44))throw new Pe(n);512&t&&ot(o,0),t&=-131713,(r=function(e,t){yt||((yt=function(){}).prototype={});var n,r=new yt;for(n in e)r[n]=e[n];return e=r,t=function(e){for(e=e||0;e<=4096;e++)if(!Re[e])return e;throw new Pe(33)}(t),e.fd=t,Re[t]=e}({node:o,path:Ie(o),flags:t,seekable:!0,position:0,Na:o.Na,Sb:[],error:!1},r)).Na.open&&r.Na.open(r),!a.logReadFiles||1&t||(vt||(vt={}),e in vt||(vt[e]=1,E("FS.trackingDelegate error on read file: "+e)));try{Se.onOpenFile&&(o=0,1!=(2097155&t)&&(o|=1),0!=(2097155&t)&&(o|=2),Se.onOpenFile(e,o))}catch(t){E("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return r}function ut(e){if(null===e.fd)throw new Pe(8);e.ob&&(e.ob=null);try{e.Na.close&&e.Na.close(e)}catch(e){throw e}finally{Re[e.fd]=null}e.fd=null}function ct(e,t,n){if(null===e.fd)throw new Pe(8);if(!e.seekable||!e.Na.Za)throw new Pe(70);if(0!=n&&1!=n&&2!=n)throw new Pe(28);e.position=e.Na.Za(e,t,n),e.Sb=[]}function lt(e,t,n,r,i){if(0>r||0>i)throw new Pe(28);if(null===e.fd)throw new Pe(8);if(1==(2097155&e.flags))throw new Pe(8);if(Fe(e.node.mode))throw new Pe(31);if(!e.Na.read)throw new Pe(28);var a=void 0!==i;if(a){if(!e.seekable)throw new Pe(70)}else i=e.position;return t=e.Na.read(e,t,n,r,i),a||(e.position+=t),t}function ht(e,t,n,r,i,a){if(0>r||0>i)throw new Pe(28);if(null===e.fd)throw new Pe(8);if(0==(2097155&e.flags))throw new Pe(8);if(Fe(e.node.mode))throw new Pe(31);if(!e.Na.write)throw new Pe(28);e.seekable&&1024&e.flags&&ct(e,0,2);var o=void 0!==i;if(o){if(!e.seekable)throw new Pe(70)}else i=e.position;t=e.Na.write(e,t,n,r,i,a),o||(e.position+=t);try{e.path&&Se.onWriteToFile&&Se.onWriteToFile(e.path)}catch(t){E("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return t}function pt(){Pe||((Pe=function(e,t){this.node=t,this.Rb=function(e){this.Pa=e},this.Rb(e),this.message="FS error"}).prototype=Error(),Pe.prototype.constructor=Pe,[44].forEach((function(e){qe[e]=new Pe(e),qe[e].stack="<generic error, no stack>"})))}function dt(e,t){var n=0;return e&&(n|=365),t&&(n|=146),n}function ft(e,t,n){e=me("/dev/"+e);var r=dt(!!t,!!n);mt||(mt=64);var i=mt++<<8|0;He(i,{open:function(e){e.seekable=!1},close:function(){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,n,r,i){for(var a=0,o=0;o<i;o++){try{var s=t()}catch(e){throw new Pe(29)}if(void 0===s&&0===a)throw new Pe(6);if(null==s)break;a++,n[r+o]=s}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,r,i){for(var a=0;a<i;a++)try{n(t[r+a])}catch(e){throw new Pe(29)}return i&&(e.node.timestamp=Date.now()),a}}),Xe(e,r,i)}var mt,yt,vt,gt={},bt={};function _t(e,t,n){try{var r=e(t)}catch(e){if(e&&e.node&&me(t)!==me(Ie(e.node)))return-54;throw e}return U[n>>2]=r.dev,U[n+4>>2]=0,U[n+8>>2]=r.ino,U[n+12>>2]=r.mode,U[n+16>>2]=r.nlink,U[n+20>>2]=r.uid,U[n+24>>2]=r.gid,U[n+28>>2]=r.rdev,U[n+32>>2]=0,ue=[r.size>>>0,(se=r.size,1<=+Math.abs(se)?0<se?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],U[n+40>>2]=ue[0],U[n+44>>2]=ue[1],U[n+48>>2]=4096,U[n+52>>2]=r.blocks,U[n+56>>2]=r.atime.getTime()/1e3|0,U[n+60>>2]=0,U[n+64>>2]=r.mtime.getTime()/1e3|0,U[n+68>>2]=0,U[n+72>>2]=r.ctime.getTime()/1e3|0,U[n+76>>2]=0,ue=[r.ino>>>0,(se=r.ino,1<=+Math.abs(se)?0<se?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],U[n+80>>2]=ue[0],U[n+84>>2]=ue[1],0}var wt,Et=void 0;function Tt(){return U[(Et+=4)-4>>2]}function Mt(e){if(!(e=Re[e]))throw new Pe(8);return e}wt=p?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Nt,Ct={};function Rt(){if(!Nt){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:f||"./this.program"};for(e in Ct)t[e]=Ct[e];var n=[];for(e in t)n.push(e+"="+t[e]);Nt=n}return Nt}function At(e,t,n,r){e||(e=this),this.parent=e,this.Wa=e.Wa,this.ab=null,this.id=Ae++,this.name=t,this.mode=n,this.Ma={},this.Na={},this.rdev=r}function Ot(e,t){var n=Array(K(e)+1);return e=z(e,n,0,n.length),t&&(n.length=e),n}Object.defineProperties(At.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}}}),pt(),Oe=Array(4096),Ge(Me,"/"),$e("/tmp"),$e("/home"),$e("/home/web_user"),function(){$e("/dev"),He(259,{read:function(){return 0},write:function(e,t,n,r){return r}}),Xe("/dev/null",259),_e(1280,Ee),_e(1536,Te),Xe("/dev/tty",1280),Xe("/dev/tty1",1536);var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(p)try{var t=n(617);return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){ie("randomDevice")}}();ft("random",e),ft("urandom",e),$e("/dev/shm"),$e("/dev/shm/tmp")}(),function(){$e("/proc");var e=$e("/proc/self");$e("/proc/self/fd"),Ge({Wa:function(){var t=Ue(e,"fd",16895,73);return t.Ma={lookup:function(e,t){var n=Re[+t];if(!n)throw new Pe(8);return(e={parent:null,Wa:{Bb:"fake"},Ma:{readlink:function(){return n.path}}}).parent=e}},t}},"/proc/self/fd")}();var xt={a:function(e,t,n,r){ie("Assertion failed: "+W(e)+", at: "+[t?W(t):"unknown filename",n,r?W(r):"unknown function"])},r:function(e,t){!function(){function e(e){return(e=e.toTimeString().match(/\(([A-Za-z ]+)\)$/))?e[1]:"GMT"}if(!ce){ce=!0;var t=(new Date).getFullYear(),n=new Date(t,0,1),r=new Date(t,6,1);t=n.getTimezoneOffset();var i=r.getTimezoneOffset(),a=Math.max(t,i);U[Ut()>>2]=60*a,U[Lt()>>2]=Number(t!=i),n=e(n),r=e(r),n=J(n),r=J(r),i<t?(U[Bt()>>2]=n,U[Bt()+4>>2]=r):(U[Bt()>>2]=r,U[Bt()+4>>2]=n)}}(),e=new Date(1e3*U[e>>2]),U[t>>2]=e.getSeconds(),U[t+4>>2]=e.getMinutes(),U[t+8>>2]=e.getHours(),U[t+12>>2]=e.getDate(),U[t+16>>2]=e.getMonth(),U[t+20>>2]=e.getFullYear()-1900,U[t+24>>2]=e.getDay();var n=new Date(e.getFullYear(),0,1);U[t+28>>2]=(e.getTime()-n.getTime())/864e5|0,U[t+36>>2]=-60*e.getTimezoneOffset();var r=new Date(e.getFullYear(),6,1).getTimezoneOffset();return e=0|(r!=(n=n.getTimezoneOffset())&&e.getTimezoneOffset()==Math.min(n,r)),U[t+32>>2]=e,e=U[Bt()+(e?4:0)>>2],U[t+40>>2]=e,t},I:function(e,t){try{var n;if(e=W(e),-8&t)var r=-28;else(n=De(e,{Ya:!0}).node)?(e="",4&t&&(e+="r"),2&t&&(e+="w"),1&t&&(e+="x"),r=e&&Ve(n,e)?-2:0):r=-44;return r}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},u:function(e,t){try{return it(e=W(e),t),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},E:function(e){try{return at(e=W(e)),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},v:function(e,t){try{var n=Re[e];if(!n)throw new Pe(8);return it(n.node,t),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},F:function(e){try{var t=Re[e];if(!t)throw new Pe(8);return at(t.node),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},b:function(e,t,n){Et=n;try{var r=Mt(e);switch(t){case 0:var i=Tt();return 0>i?-28:st(r.path,r.flags,0,i).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:return i=Tt(),r.flags|=i,0;case 12:return i=Tt(),L[i+0>>1]=2,0;case 13:case 14:return 0;case 16:case 8:return-28;case 9:return U[qt()>>2]=28,-1;default:return-28}}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},w:function(e,t){try{return _t(nt,Mt(e).path,t)}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},J:function(e,t,n){try{var r=Re[e];if(!r)throw new Pe(8);if(0==(2097155&r.flags))throw new Pe(28);return ot(r.node,n),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},x:function(e,t){try{return 0===t?-28:t<K("/")+1?-68:(z("/",B,e,t),e)}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},G:function(){return 0},d:function(){return 42},t:function(e,t){try{return _t(rt,e=W(e),t)}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},s:function(e,t){try{return"/"===(e=me(e=W(e)))[e.length-1]&&(e=e.substr(0,e.length-1)),$e(e,t),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},i:function(e,t,n,r,i,a){try{e:{a<<=12;var o=!1;if(0!=(16&r)&&0!=e%16384)var s=-28;else{if(0!=(32&r)){var u=Vt(16384,t);if(!u){s=-48;break e}Pt(u,0,t),o=!0}else{var c=Re[i];if(!c){s=-8;break e}var l=a;if(0!=(2&n)&&0==(2&r)&&2!=(2097155&c.flags))throw new Pe(2);if(1==(2097155&c.flags))throw new Pe(2);if(!c.Na.hb)throw new Pe(43);var h=c.Na.hb(c,e,t,l,n,r);u=h.Pb,o=h.kb}bt[u]={Mb:u,Lb:t,kb:o,fd:i,Ob:n,flags:r,offset:a},s=u}}return s}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},j:function(e,t){try{if(-1==(0|e)||0===t)var n=-28;else{var r=bt[e];if(r&&t===r.Lb){var i=Re[r.fd];if(i&&2&r.Ob){var a=r.flags,o=r.offset,s=B.slice(e,e+t);i&&i.Na.ib&&i.Na.ib(i,s,o,t,a)}bt[e]=null,r.kb&&It(r.Mb)}n=0}return n}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},h:function(e,t,n){Et=n;try{return st(W(e),t,n?Tt():0).fd}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},D:function(e,t,n){try{if(e=W(e),0>=n)var r=-28;else{var i=tt(e),a=Math.min(n,K(i)),o=j[t+a];z(i,B,t,n+1),j[t+a]=o,r=a}return r}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},B:function(e){try{var t=De(e=W(e),{parent:!0}).node,n=ve(e),r=Le(t,n),i=ze(t,n,!0);if(i)throw new Pe(i);if(!t.Ma.rmdir)throw new Pe(63);if(r.ab)throw new Pe(10);try{Se.willDeletePath&&Se.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.Ma.rmdir(t,n),Be(r);try{Se.onDeletePath&&Se.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}return 0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},f:function(e,t){try{return _t(nt,e=W(e),t)}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},y:function(e){try{return et(e=W(e)),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),-e.Pa}},l:function(e,t,n){B.copyWithin(e,t,t+n)},c:function(e){var t=B.length;if(2147483648<e)return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+100663296),0<(r=Math.max(e,r))%65536&&(r+=65536-r%65536);e:{try{O.grow(Math.min(2147483648,r)-I.byteLength+65535>>>16),H();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1},p:function(e){for(var t=wt();wt()-t<e;);},n:function(e,t){try{var n=0;return Rt().forEach((function(r,i){var a=t+n;for(i=U[e+4*i>>2]=a,a=0;a<r.length;++a)j[i++>>0]=r.charCodeAt(a);j[i>>0]=0,n+=r.length+1})),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},o:function(e,t){try{var n=Rt();U[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),U[t>>2]=r,0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},e:function(e){try{return ut(Mt(e)),0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},m:function(e,t){try{var n=Mt(e);return j[t>>0]=n.tty?2:Fe(n.mode)?3:40960==(61440&n.mode)?7:4,0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},z:function(e,t,n,r){try{e:{for(var i=Mt(e),a=e=0;a<n;a++){var o=U[t+(8*a+4)>>2],s=lt(i,j,U[t+8*a>>2],o,void 0);if(0>s){var u=-1;break e}if(e+=s,s<o)break}u=e}return U[r>>2]=u,0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},k:function(e,t,n,r,i){try{var a=Mt(e);return-9007199254740992>=(e=4294967296*n+(t>>>0))||9007199254740992<=e?-61:(ct(a,e,r),ue=[a.position>>>0,(se=a.position,1<=+Math.abs(se)?0<se?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],U[i>>2]=ue[0],U[i+4>>2]=ue[1],a.ob&&0===e&&0===r&&(a.ob=null),0)}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},H:function(e){try{var t=Mt(e);return t.Na&&t.Na.fsync?-t.Na.fsync(t):0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},C:function(e,t,n,r){try{e:{for(var i=Mt(e),a=e=0;a<n;a++){var o=ht(i,j,U[t+8*a>>2],U[t+(8*a+4)>>2],void 0);if(0>o){var s=-1;break e}e+=o}s=e}return U[r>>2]=s,0}catch(e){return void 0!==gt&&e instanceof Pe||ie(e),e.Pa}},g:function(e){var t=Date.now();return U[e>>2]=t/1e3|0,U[e+4>>2]=t%1e3*1e3|0,0},A:function(e){switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return U[qt()>>2]=28,-1},K:function(e){var t=Date.now()/1e3|0;return e&&(U[e>>2]=t),t},q:function(e,t){if(t){var n=t+8;t=1e3*U[n>>2],t+=U[n+4>>2]/1e3}else t=Date.now();e=W(e);try{var r=De(e,{Ya:!0}).node;r.Ma.Ta(r,{timestamp:Math.max(t,t)});var i=0}catch(e){if(!(e instanceof Pe)){e:{if(!(i=Error()).stack){try{throw Error()}catch(e){i=e}if(!i.stack){i="(no stack trace available)";break e}}i=i.stack.toString()}throw a.extraStackTrace&&(i+="\n"+a.extraStackTrace()),e+" : "+(i=function(e){return e.replace(/\b_Z[\w\d_]+/g,(function(e){return e==e?e:e+" ["+e+"]"}))}(i))}i=e.Pa,U[qt()>>2]=i,i=-1}return i}};!function(){function e(e){a.asm=e.exports,O=a.asm.L,H(),G=a.asm.Da,te--,a.monitorRunDependencies&&a.monitorRunDependencies(te),0==te&&(null!==ne&&(clearInterval(ne),ne=null),re&&(e=re,re=null,e()))}function t(t){e(t.instance)}function n(e){return function(){if(!M&&(l||h)){if("function"==typeof fetch&&!ae("file://"))return fetch(le,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+le+"'";return e.arrayBuffer()})).catch((function(){return pe()}));if(y)return new Promise((function(e,t){y(le,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return pe()}))}().then((function(e){return WebAssembly.instantiate(e,r)})).then(e,(function(e){E("failed to asynchronously prepare wasm: "+e),ie(e)}))}var r={a:xt};if(te++,a.monitorRunDependencies&&a.monitorRunDependencies(te),a.instantiateWasm)try{return a.instantiateWasm(r,e)}catch(e){return E("Module.instantiateWasm callback failed with error: "+e),!1}M||"function"!=typeof WebAssembly.instantiateStreaming||oe()||ae("file://")||"function"!=typeof fetch?n(t):fetch(le,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,r).then(t,(function(e){return E("wasm streaming compile failed: "+e),E("falling back to ArrayBuffer instantiation"),n(t)}))}))}();var St=a.___wasm_call_ctors=function(){return(St=a.___wasm_call_ctors=a.asm.M).apply(null,arguments)},Pt=a._memset=function(){return(Pt=a._memset=a.asm.N).apply(null,arguments)};a._sqlite3_free=function(){return(a._sqlite3_free=a.asm.O).apply(null,arguments)};var qt=a.___errno_location=function(){return(qt=a.___errno_location=a.asm.P).apply(null,arguments)};a._sqlite3_finalize=function(){return(a._sqlite3_finalize=a.asm.Q).apply(null,arguments)},a._sqlite3_reset=function(){return(a._sqlite3_reset=a.asm.R).apply(null,arguments)},a._sqlite3_clear_bindings=function(){return(a._sqlite3_clear_bindings=a.asm.S).apply(null,arguments)},a._sqlite3_value_blob=function(){return(a._sqlite3_value_blob=a.asm.T).apply(null,arguments)},a._sqlite3_value_text=function(){return(a._sqlite3_value_text=a.asm.U).apply(null,arguments)},a._sqlite3_value_bytes=function(){return(a._sqlite3_value_bytes=a.asm.V).apply(null,arguments)},a._sqlite3_value_double=function(){return(a._sqlite3_value_double=a.asm.W).apply(null,arguments)},a._sqlite3_value_int=function(){return(a._sqlite3_value_int=a.asm.X).apply(null,arguments)},a._sqlite3_value_type=function(){return(a._sqlite3_value_type=a.asm.Y).apply(null,arguments)},a._sqlite3_result_blob=function(){return(a._sqlite3_result_blob=a.asm.Z).apply(null,arguments)},a._sqlite3_result_double=function(){return(a._sqlite3_result_double=a.asm._).apply(null,arguments)},a._sqlite3_result_error=function(){return(a._sqlite3_result_error=a.asm.$).apply(null,arguments)},a._sqlite3_result_int=function(){return(a._sqlite3_result_int=a.asm.aa).apply(null,arguments)},a._sqlite3_result_int64=function(){return(a._sqlite3_result_int64=a.asm.ba).apply(null,arguments)},a._sqlite3_result_null=function(){return(a._sqlite3_result_null=a.asm.ca).apply(null,arguments)},a._sqlite3_result_text=function(){return(a._sqlite3_result_text=a.asm.da).apply(null,arguments)},a._sqlite3_step=function(){return(a._sqlite3_step=a.asm.ea).apply(null,arguments)},a._sqlite3_column_count=function(){return(a._sqlite3_column_count=a.asm.fa).apply(null,arguments)},a._sqlite3_data_count=function(){return(a._sqlite3_data_count=a.asm.ga).apply(null,arguments)},a._sqlite3_column_blob=function(){return(a._sqlite3_column_blob=a.asm.ha).apply(null,arguments)},a._sqlite3_column_bytes=function(){return(a._sqlite3_column_bytes=a.asm.ia).apply(null,arguments)},a._sqlite3_column_double=function(){return(a._sqlite3_column_double=a.asm.ja).apply(null,arguments)},a._sqlite3_column_text=function(){return(a._sqlite3_column_text=a.asm.ka).apply(null,arguments)},a._sqlite3_column_type=function(){return(a._sqlite3_column_type=a.asm.la).apply(null,arguments)},a._sqlite3_column_name=function(){return(a._sqlite3_column_name=a.asm.ma).apply(null,arguments)},a._sqlite3_bind_blob=function(){return(a._sqlite3_bind_blob=a.asm.na).apply(null,arguments)},a._sqlite3_bind_double=function(){return(a._sqlite3_bind_double=a.asm.oa).apply(null,arguments)},a._sqlite3_bind_int=function(){return(a._sqlite3_bind_int=a.asm.pa).apply(null,arguments)},a._sqlite3_bind_text=function(){return(a._sqlite3_bind_text=a.asm.qa).apply(null,arguments)},a._sqlite3_bind_parameter_index=function(){return(a._sqlite3_bind_parameter_index=a.asm.ra).apply(null,arguments)},a._sqlite3_sql=function(){return(a._sqlite3_sql=a.asm.sa).apply(null,arguments)},a._sqlite3_normalized_sql=function(){return(a._sqlite3_normalized_sql=a.asm.ta).apply(null,arguments)},a._sqlite3_errmsg=function(){return(a._sqlite3_errmsg=a.asm.ua).apply(null,arguments)},a._sqlite3_exec=function(){return(a._sqlite3_exec=a.asm.va).apply(null,arguments)},a._sqlite3_prepare_v2=function(){return(a._sqlite3_prepare_v2=a.asm.wa).apply(null,arguments)},a._sqlite3_changes=function(){return(a._sqlite3_changes=a.asm.xa).apply(null,arguments)},a._sqlite3_close_v2=function(){return(a._sqlite3_close_v2=a.asm.ya).apply(null,arguments)},a._sqlite3_create_function_v2=function(){return(a._sqlite3_create_function_v2=a.asm.za).apply(null,arguments)},a._sqlite3_open=function(){return(a._sqlite3_open=a.asm.Aa).apply(null,arguments)};var Dt=a._malloc=function(){return(Dt=a._malloc=a.asm.Ba).apply(null,arguments)},It=a._free=function(){return(It=a._free=a.asm.Ca).apply(null,arguments)};a._RegisterExtensionFunctions=function(){return(a._RegisterExtensionFunctions=a.asm.Ea).apply(null,arguments)};var jt,Bt=a.__get_tzname=function(){return(Bt=a.__get_tzname=a.asm.Fa).apply(null,arguments)},Lt=a.__get_daylight=function(){return(Lt=a.__get_daylight=a.asm.Ga).apply(null,arguments)},Ut=a.__get_timezone=function(){return(Ut=a.__get_timezone=a.asm.Ha).apply(null,arguments)},Ft=a.stackSave=function(){return(Ft=a.stackSave=a.asm.Ia).apply(null,arguments)},kt=a.stackRestore=function(){return(kt=a.stackRestore=a.asm.Ja).apply(null,arguments)},Qt=a.stackAlloc=function(){return(Qt=a.stackAlloc=a.asm.Ka).apply(null,arguments)},Vt=a._memalign=function(){return(Vt=a._memalign=a.asm.La).apply(null,arguments)};function Wt(){function e(){if(!jt&&(jt=!0,a.calledRun=!0,!x)){if(a.noFSInit||Ke||(Ke=!0,pt(),a.stdin=a.stdin,a.stdout=a.stdout,a.stderr=a.stderr,a.stdin?ft("stdin",a.stdin):Ze("/dev/tty","/dev/stdin"),a.stdout?ft("stdout",null,a.stdout):Ze("/dev/tty","/dev/stdout"),a.stderr?ft("stderr",null,a.stderr):Ze("/dev/tty1","/dev/stderr"),st("/dev/stdin",0),st("/dev/stdout",1),st("/dev/stderr",1)),de($),xe=!1,de(X),a.onRuntimeInitialized&&a.onRuntimeInitialized(),a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;){var e=a.postRun.shift();Z.unshift(e)}de(Z)}}if(!(0<te)){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)ee();de(Y),0<te||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),e()}),1)):e())}}if(a.cwrap=function(e,t,n,r){var i=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&i&&!r?P(e):function(){return q(e,t,n,arguments)}},a.UTF8ToString=W,a.stackSave=Ft,a.stackRestore=kt,a.stackAlloc=Qt,re=function e(){jt||Wt(),jt||(re=e)},a.run=Wt,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();return Wt(),o})))};e.exports=i,e.exports.default=i},9312:(e,t,n)=>{"use strict";n.d(t,{__extends:()=>i,__assign:()=>a,__rest:()=>o,__awaiter:()=>s,__generator:()=>u,__values:()=>c,__read:()=>l,__spreadArray:()=>h});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function s(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function h(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.create,Object.create},4249:(e,t,n)=>{"use strict";n.d(t,{DriverUtils:()=>a});var r=n(9312),i=n(3925),a=function(){function e(){}return e.buildDriverOptions=function(e,t){var n,i;if(e.url){var a=this.parseConnectionUrl(e.url);t&&t.useSid&&a.database&&(a.sid=a.database);try{for(var o=(0,r.__values)(Object.keys(a)),s=o.next();!s.done;s=o.next()){var u=s.value;void 0===a[u]&&delete a[u]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return Object.assign({},e,a)}return Object.assign({},e)},e.buildMongoDBDriverOptions=function(e,t){var n,i;if(e.url){var a=this.parseMongoDBConnectionUrl(e.url);t&&t.useSid&&a.database&&(a.sid=a.database);try{for(var o=(0,r.__values)(Object.keys(a)),s=o.next();!s.done;s=o.next()){var u=s.value;void 0===a[u]&&delete a[u]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return Object.assign({},e,a)}return Object.assign({},e)},e.buildAlias=function(e,t){for(var n=e.maxAliasLength,r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];"string"==typeof t?(r.unshift(t),t={shorten:!1,joiner:"_"}):t=Object.assign({shorten:!1,joiner:"_"},t);var o=1===r.length?r[0]:r.join(t.joiner);if(n&&n>0&&o.length>n){if(!0===t.shorten){var s=(0,i.shorten)(o);if(s.length<n)return s}return(0,i.hash)(o,{length:n})}return o},e.buildColumnAlias=function(e,t){for(var n=e.maxAliasLength,i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];return this.buildAlias.apply(this,(0,r.__spreadArray)([{maxAliasLength:n},t],(0,r.__read)(i)))},e.parseConnectionUrl=function(e){var t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),a=i.indexOf("/"),o=-1!==a?i.substr(0,a):i,s=-1!==a?i.substr(a+1):void 0;s&&-1!==s.indexOf("?")&&(s=s.substr(0,s.indexOf("?")));var u=o.lastIndexOf("@"),c=o.substr(0,u),l=o.substr(u+1),h=c,p="",d=c.indexOf(":");-1!==d&&(h=c.substr(0,d),p=c.substr(d+1));var f=(0,r.__read)(l.split(":"),2),m=f[0],y=f[1];return{type:t,host:m,username:decodeURIComponent(h),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}},e.parseMongoDBConnectionUrl=function(e){var t,n,i,a,o,s=e.split(":")[0],u=e.indexOf("//"),c=e.substr(u+2),l=c.indexOf("/"),h=-1!==l?c.substr(0,l):c,p=-1!==l?c.substr(l+1):void 0,d=void 0,f=void 0,m=void 0,y=void 0,v={};p&&-1!==p.indexOf("?")&&(p.substr(p.indexOf("?")+1,p.length).split("&").forEach((function(e){a=e.split("=")[0],o=e.split("=")[1],v[a]=o})),y=v.replicaSet,p=p.substr(0,p.indexOf("?")));var g=h.lastIndexOf("@"),b=h.substr(0,g),_=h.substr(g+1),w=b,E="",T=b.indexOf(":");-1!==T&&(w=b.substr(0,T),E=b.substr(T+1)),y?m=_:(d=(t=(0,r.__read)(_.split(":"),2))[0],f=t[1]);var M={type:s,host:d,hostReplicaSet:m,username:decodeURIComponent(w),password:decodeURIComponent(E),port:f?parseInt(f):void 0,database:p||void 0};try{for(var N=(0,r.__values)(Object.entries(v)),C=N.next();!C.done;C=N.next()){var R=(0,r.__read)(C.value,2),A=R[0],O=R[1];M[A]=O}}catch(e){n={error:e}}finally{try{C&&!C.done&&(i=N.return)&&i.call(N)}finally{if(n)throw n.error}}return M},e}()},2311:(e,t,n)=>{"use strict";n.d(t,{AbstractSqliteDriver:()=>w});var r=n(9312),i=n(5344),a=n(1100),o=n(9338),s=n(4348),u=n(8789),c=n(1369),l=n(1087),h=n(2268),p=n(7764),d=n(870),f=n(2490),m=function(){function e(e){this.connection=e}return e.prototype.build=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return this.queryRunner=this.connection.createQueryRunner(),(e=!(this.connection.driver instanceof a.CockroachDriver)&&"none"!==this.connection.options.migrationsTransactionMode)?[4,this.queryRunner.startTransaction()]:[3,2];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,12,18,20]),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,4];case 3:r.sent(),r.label=4;case 4:return t=this.entityToSyncMetadatas.map((function(e){return i.getTablePath(e)})),[4,this.queryRunner.getTables(t)];case 5:return r.sent(),[4,this.queryRunner.getViews([])];case 6:return r.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 7:return r.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,9];case 8:r.sent(),r.label=9;case 9:return e?[4,this.queryRunner.commitTransaction()]:[3,11];case 10:r.sent(),r.label=11;case 11:return[3,20];case 12:n=r.sent(),r.label=13;case 13:return r.trys.push([13,16,,17]),e?[4,this.queryRunner.rollbackTransaction()]:[3,15];case 14:r.sent(),r.label=15;case 15:return[3,17];case 16:return r.sent(),[3,17];case 17:throw n;case 18:return[4,this.queryRunner.release()];case 19:return r.sent(),[7];case 20:return[2]}}))}))},e.prototype.log=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t=this;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:this.queryRunner=this.connection.createQueryRunner(),n.label=1;case 1:return n.trys.push([1,,9,11]),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,3];case 2:n.sent(),n.label=3;case 3:return e=this.entityToSyncMetadatas.map((function(e){return t.getTablePath(e)})),[4,this.queryRunner.getTables(e)];case 4:return n.sent(),[4,this.queryRunner.getViews([])];case 5:return n.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return n.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[2,this.queryRunner.getMemorySql()];case 9:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 10:return n.sent(),[7];case 11:return[2]}}))}))},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter((function(e){return e.synchronize&&"entity-child"!==e.tableType&&"view"!==e.tableType}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewEntityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter((function(e){return"view"===e.tableType&&e.synchronize}))},enumerable:!1,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.dropOldViews()];case 1:return e.sent(),[4,this.dropOldForeignKeys()];case 2:return e.sent(),[4,this.dropOldIndices()];case 3:return e.sent(),[4,this.dropOldChecks()];case 4:return e.sent(),[4,this.dropOldExclusions()];case 5:return e.sent(),[4,this.dropCompositeUniqueConstraints()];case 6:return e.sent(),[4,this.renameColumns()];case 7:return e.sent(),[4,this.createNewTables()];case 8:return e.sent(),[4,this.dropRemovedColumns()];case 9:return e.sent(),[4,this.addNewColumns()];case 10:return e.sent(),[4,this.updatePrimaryKeys()];case 11:return e.sent(),[4,this.updateExistColumns()];case 12:return e.sent(),[4,this.createNewIndices()];case 13:return e.sent(),[4,this.createNewChecks()];case 14:return e.sent(),[4,this.createNewExclusions()];case 15:return e.sent(),[4,this.createCompositeUniqueConstraints()];case 16:return e.sent(),[4,this.createForeignKeys()];case 17:return e.sent(),[4,this.createViews()];case 18:return e.sent(),[2]}}))}))},e.prototype.getTablePath=function(e){return e instanceof o.Table?e.name:e instanceof u.TableForeignKey?e.referencedTableName:e.tablePath},e.prototype.dropOldForeignKeys=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return c.getTablePath(t)===c.getTablePath(e)})))?0===(i=n.foreignKeys.filter((function(t){var n=e.foreignKeys.find((function(e){return t.name===e.name&&c.getTablePath(t)===c.getTablePath(e.referencedEntityMetadata)}));return!n||n.onDelete&&n.onDelete!==t.onDelete||n.onUpdate&&n.onUpdate!==t.onUpdate}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old foreign keys of "+n.name+": "+i.map((function(e){return e.name})).join(", ")),[4,t.queryRunner.dropForeignKeys(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.renameTables=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2]}))}))},e.prototype.renameColumns=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return c.getTablePath(t)===c.getTablePath(e)})))?e.columns.length!==n.columns.length||0===(i=e.columns.filter((function(e){return!n.columns.find((function(t){return t.name===e.databaseName&&t.type===c.connection.driver.normalizeType(e)&&t.isNullable===e.isNullable&&t.isUnique===c.connection.driver.normalizeIsUnique(e)}))}))).length||i.length>1||0===(a=n.columns.filter((function(t){return!e.columns.find((function(e){return e.databaseName===t.name&&c.connection.driver.normalizeType(e)===t.type&&e.isNullable===t.isNullable&&c.connection.driver.normalizeIsUnique(e)===t.isUnique}))}))).length||a.length>1?[2,"continue"]:((o=a[0].clone()).name=i[0].databaseName,t.connection.logger.logSchemaBuild('renaming column "'+a[0].name+'" in to "'+o.name+'"'),[4,t.queryRunner.renameColumn(n,a[0],o)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldIndices=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.__generator)(this,(function(a){switch(a.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return c.getTablePath(t)===c.getTablePath(e)})))?(i=n.indices.filter((function(t){var n=e.indices.find((function(e){return e.name===t.name}));return!n||!1!==n.synchronize&&(n.isUnique!==t.isUnique||n.isSpatial!==t.isSpatial||!(!c.connection.driver.isFullTextColumnTypeSupported()||n.isFulltext===t.isFulltext)||n.columns.length!==t.columnNames.length||!n.columns.every((function(e){return-1!==t.columnNames.indexOf(e.databaseName)})))})).map((function(e){return(0,r.__awaiter)(c,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: "'+e.name+'" from table '+n.name),[4,this.queryRunner.dropIndex(n,e)];case 1:return t.sent(),[2]}}))}))})),[4,Promise.all(i)]):[2,"continue"];case 1:return a.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldChecks=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:if(this.connection.driver instanceof a.MysqlDriver||this.connection.driver instanceof a.AuroraDataApiDriver)return[2];e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=n.checks.filter((function(t){return!e.checks.find((function(e){return e.name===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old check constraint: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropCheckConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.dropCompositeUniqueConstraints=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return c.getTablePath(t)===c.getTablePath(e)})))?0===(i=n.uniques.filter((function(t){return t.columnNames.length>1&&!e.uniques.find((function(e){return e.name===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old unique constraint: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropUniqueConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldExclusions=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:if(!(this.connection.driver instanceof a.PostgresDriver))return[2];e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=n.exclusions.filter((function(t){return!e.exclusions.find((function(e){return e.name===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("dropping old exclusion constraint: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+n.name+'"'),[4,t.queryRunner.dropExclusionConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewTables=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,s,u,c,l,h=this;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:return[4,this.queryRunner.getCurrentSchema()];case 1:e=p.sent(),t=function(t){var i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n.queryRunner.loadedTables.find((function(n){var r=t.database&&t.database!==h.connection.driver.database?t.database:void 0,i=t.schema||h.connection.driver.options.schema;i=i===e?void 0:i;var a=h.connection.driver.buildTableName(t.tableName,i,r);return n.name===a}))?[2,"continue"]:(n.connection.logger.logSchemaBuild("creating a new table: "+n.getTablePath(t)),i=o.Table.create(t,n.connection.driver),[4,n.queryRunner.createTable(i,!1,!1)]);case 1:return r.sent(),n.queryRunner.loadedTables.push(i),[2]}}))},n=this,p.label=2;case 2:p.trys.push([2,7,8,9]),i=(0,r.__values)(this.entityToSyncMetadatas),a=i.next(),p.label=3;case 3:return a.done?[3,6]:(s=a.value,[5,t(s)]);case 4:p.sent(),p.label=5;case 5:return a=i.next(),[3,3];case 6:return[3,9];case 7:return u=p.sent(),c={error:u},[3,9];case 8:try{a&&!a.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 9:return[2]}}))}))},e.prototype.createViews=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t.queryRunner.loadedViews.find((function(t){var n=e.database&&e.database!==c.connection.driver.database?e.database:void 0,r=e.schema||c.connection.driver.options.schema,i=c.connection.driver.buildTableName(e.tableName,r,n),a="string"==typeof t.expression?t.expression.trim():t.expression(c.connection).getQuery(),o="string"==typeof e.expression?e.expression.trim():e.expression(c.connection).getQuery();return t.name===i&&a===o}))?[2,"continue"]:(t.connection.logger.logSchemaBuild("creating a new view: "+t.getTablePath(e)),n=f.View.create(e,t.connection.driver),[4,t.queryRunner.createView(n)]);case 1:return r.sent(),t.queryRunner.loadedViews.push(n),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.viewEntityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropOldViews=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:e=new Set,t=function(t){return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n.viewEntityToSyncMetadatas.find((function(e){var n=e.database&&e.database!==l.connection.driver.database?e.database:void 0,r=e.schema||l.connection.driver.options.schema,i=l.connection.driver.buildTableName(e.tableName,r,n),a="string"==typeof t.expression?t.expression.trim():t.expression(l.connection).getQuery(),o="string"==typeof e.expression?e.expression.trim():e.expression(l.connection).getQuery();return t.name===i&&a===o}))?[2,"continue"]:(n.connection.logger.logSchemaBuild("dropping an old view: "+t.name),[4,n.queryRunner.dropView(t)]);case 1:return r.sent(),e.add(t),[2]}}))},n=this,h.label=1;case 1:h.trys.push([1,6,7,8]),i=(0,r.__values)(this.queryRunner.loadedViews),a=i.next(),h.label=2;case 2:return a.done?[3,5]:(o=a.value,[5,t(o)]);case 3:h.sent(),h.label=4;case 4:return a=i.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{a&&!a.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 8:return this.queryRunner.loadedViews=this.queryRunner.loadedViews.filter((function(t){return!e.has(t)})),[2]}}))}))},e.prototype.dropRemovedColumns=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return c.getTablePath(t)===c.getTablePath(e)})))?0===(i=n.columns.filter((function(t){return!e.columns.find((function(e){return e.databaseName===t.name}))}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("columns dropped in "+n.name+": "+i.map((function(e){return e.name})).join(", ")),[4,t.queryRunner.dropColumns(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.addNewColumns=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:e=function(e){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=e.columns.filter((function(e){return!n.columns.find((function(t){return t.name===e.databaseName}))}))).length?[2,"continue"]:(a=t.metadataColumnsToTableColumnOptions(i),0===(o=a.map((function(e){return new s.TableColumn(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("new columns added: "+i.map((function(e){return e.databaseName})).join(", ")),[4,t.queryRunner.addColumns(n,o)])):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=h.sent(),u={error:o},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.updatePrimaryKeys=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c,h=this;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:e=function(e){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return h.getTablePath(t)===h.getTablePath(e)})))?(i=e.columns.filter((function(e){return e.isPrimary})),n.columns.filter((function(e){return e.isPrimary})).length!==i.length&&i.length>1?(a=i.map((function(e){return new s.TableColumn(l.TableUtils.createTableColumnOptions(e,h.connection.driver))})),[4,t.queryRunner.updatePrimaryKeys(n,a)]):[3,2]):[2,"continue"];case 1:r.sent(),r.label=2;case 2:return[2]}}))},t=this,p.label=1;case 1:p.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),p.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:p.sent(),p.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=p.sent(),u={error:o},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.updateExistColumns=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,u,c,h,p=this;return(0,r.__generator)(this,(function(d){switch(d.label){case 0:e=function(e){var n,i,o,u,c,h,d,f,m,y,v,g,b,_,w,E,T,M,N;return(0,r.__generator)(this,(function(C){switch(C.label){case 0:if(!(n=t.queryRunner.loadedTables.find((function(t){return p.getTablePath(t)===p.getTablePath(e)}))))return[2,"continue"];if(0===(i=t.connection.driver.findChangedColumns(n.columns,e.columns)).length)return[2,"continue"];C.label=1;case 1:C.trys.push([1,6,7,8]),_=void 0,o=(0,r.__values)(i),u=o.next(),C.label=2;case 2:return u.done?[3,5]:(v=u.value,[4,t.dropColumnReferencedForeignKeys(t.getTablePath(e),v.databaseName)]);case 3:C.sent(),C.label=4;case 4:return u=o.next(),[3,2];case 5:return[3,8];case 6:return c=C.sent(),_={error:c},[3,8];case 7:try{u&&!u.done&&(w=o.return)&&w.call(o)}finally{if(_)throw _.error}return[7];case 8:C.trys.push([8,13,14,15]),E=void 0,h=(0,r.__values)(i),d=h.next(),C.label=9;case 9:return d.done?[3,12]:(v=d.value,[4,t.dropColumnCompositeIndices(t.getTablePath(e),v.databaseName)]);case 10:C.sent(),C.label=11;case 11:return d=h.next(),[3,9];case 12:return[3,15];case 13:return f=C.sent(),E={error:f},[3,15];case 14:try{d&&!d.done&&(T=h.return)&&T.call(h)}finally{if(E)throw E.error}return[7];case 15:if(t.connection.driver instanceof a.MysqlDriver||t.connection.driver instanceof a.AuroraDataApiDriver)return[3,23];C.label=16;case 16:C.trys.push([16,21,22,23]),M=void 0,m=(0,r.__values)(i),y=m.next(),C.label=17;case 17:return y.done?[3,20]:(v=y.value,[4,t.dropColumnCompositeUniques(t.getTablePath(e),v.databaseName)]);case 18:C.sent(),C.label=19;case 19:return y=m.next(),[3,17];case 20:return[3,23];case 21:return g=C.sent(),M={error:g},[3,23];case 22:try{y&&!y.done&&(N=m.return)&&N.call(m)}finally{if(M)throw M.error}return[7];case 23:return 0===(b=i.map((function(e){var t=n.columns.find((function(t){return t.name===e.databaseName})),r=l.TableUtils.createTableColumnOptions(e,p.connection.driver);return{oldColumn:t,newColumn:new s.TableColumn(r)}}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild('columns changed in "'+n.name+'". updating: '+i.map((function(e){return e.databaseName})).join(", ")),[4,t.queryRunner.changeColumns(n,b)]);case 24:return C.sent(),[2]}}))},t=this,d.label=1;case 1:d.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),d.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:d.sent(),d.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return u=d.sent(),c={error:u},[3,8];case 7:try{i&&!i.done&&(h=n.return)&&h.call(n)}finally{if(c)throw c.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewIndices=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=e.indices.filter((function(e){return!n.indices.find((function(t){return t.name===e.name}))&&!0===e.synchronize})).map((function(e){return c.TableIndex.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new indices "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createIndices(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=h.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewChecks=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:if(this.connection.driver instanceof a.MysqlDriver||this.connection.driver instanceof a.AuroraDataApiDriver)return[2];e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=e.checks.filter((function(e){return!n.checks.find((function(t){return t.name===e.name}))})).map((function(e){return p.TableCheck.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new check constraints: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createCheckConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createCompositeUniqueConstraints=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return c.getTablePath(t)===c.getTablePath(e)})))?0===(i=e.uniques.filter((function(e){return e.columns.length>1&&!n.uniques.find((function(t){return t.name===e.name}))})).map((function(e){return h.TableUnique.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new unique constraints: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createUniqueConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),l.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.createNewExclusions=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,s,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:if(!(this.connection.driver instanceof a.PostgresDriver))return[2];e=function(e){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=e.exclusions.filter((function(e){return!n.exclusions.find((function(t){return t.name===e.name}))})).map((function(e){return d.TableExclusion.create(e)}))).length?[2,"continue"]:(t.connection.logger.logSchemaBuild("adding new exclusion constraints: "+i.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+n.name+'"'),[4,t.queryRunner.createExclusionConstraints(n,i)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(o=i.value,[5,e(o)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}}))}))},e.prototype.createForeignKeys=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:e=function(e){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=t.queryRunner.loadedTables.find((function(t){return l.getTablePath(t)===l.getTablePath(e)})))?0===(i=e.foreignKeys.filter((function(e){return!n.foreignKeys.find((function(t){return t.name===e.name&&l.getTablePath(t)===l.getTablePath(e.referencedEntityMetadata)}))}))).length?[2,"continue"]:(a=i.map((function(e){return u.TableForeignKey.create(e,l.connection.driver)})),t.connection.logger.logSchemaBuild("creating a foreign keys: "+i.map((function(e){return e.name})).join(", ")+' on table "'+n.name+'"'),[4,t.queryRunner.createForeignKeys(n,a)]):[2,"continue"];case 1:return r.sent(),[2]}}))},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=(0,r.__values)(this.entityToSyncMetadatas),i=n.next(),h.label=2;case 2:return i.done?[3,5]:(a=i.value,[5,e(a)]);case 3:h.sent(),h.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return o=h.sent(),s={error:o},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}}))}))},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b=this;return(0,r.__generator)(this,(function(_){switch(_.label){case 0:if(!(n=this.queryRunner.loadedTables.find((function(t){return b.getTablePath(t)===e}))))return[2];i=[],(a=n.foreignKeys.find((function(e){return-1!==e.columnNames.indexOf(t)})))&&((o=n.clone()).foreignKeys=[a],i.push(o),n.removeForeignKey(a)),s=function(n){var r=n.foreignKeys.filter((function(n){return b.getTablePath(n)===e&&-1!==n.referencedColumnNames.indexOf(t)}));if(r.length>0){var a=n.clone();a.foreignKeys=r,i.push(a),r.forEach((function(e){return n.removeForeignKey(e)}))}};try{for(u=(0,r.__values)(this.queryRunner.loadedTables),c=u.next();!c.done;c=u.next())l=c.value,s(l)}catch(e){m={error:e}}finally{try{c&&!c.done&&(y=u.return)&&y.call(u)}finally{if(m)throw m.error}}if(!(i.length>0))return[3,8];_.label=1;case 1:_.trys.push([1,6,7,8]),h=(0,r.__values)(i),p=h.next(),_.label=2;case 2:return p.done?[3,5]:(d=p.value,this.connection.logger.logSchemaBuild("dropping related foreign keys of "+d.name+": "+d.foreignKeys.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropForeignKeys(d,d.foreignKeys)]);case 3:_.sent(),_.label=4;case 4:return p=h.next(),[3,2];case 5:return[3,8];case 6:return f=_.sent(),v={error:f},[3,8];case 7:try{p&&!p.done&&(g=h.return)&&g.call(h)}finally{if(v)throw v.error}return[7];case 8:return[2]}}))}))},e.prototype.dropColumnCompositeIndices=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return a.getTablePath(t)===e})))?0===(i=n.indices.filter((function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)}))).length?[2]:(this.connection.logger.logSchemaBuild('dropping related indices of "'+e+'"."'+t+'": '+i.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropIndices(n,i)]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.dropColumnCompositeUniques=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return a.getTablePath(t)===e})))?0===(i=n.uniques.filter((function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)}))).length?[2]:(this.connection.logger.logSchemaBuild('dropping related unique constraints of "'+e+'"."'+t+'": '+i.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropUniqueConstraints(n,i)]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.metadataColumnsToTableColumnOptions=function(e){var t=this;return e.map((function(e){return l.TableUtils.createTableColumnOptions(e,t.connection.driver)}))},e.prototype.createTypeormMetadataTable=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e=this.connection.driver.options.schema,t=this.connection.driver.database,n=this.connection.driver.buildTableName("typeorm_metadata",e,t),[4,this.queryRunner.createTable(new o.Table({database:t,schema:e,name:n,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0}]}),!0)];case 1:return r.sent(),[2]}}))}))},e}(),y=n(4291),v=n(7081),g=n(7768),b=n(4249),_=n(3556),w=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.connection=e,this.options=e.options,this.database=b.DriverUtils.buildDriverOptions(this.options).database}return e.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}}))}))},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close((function(e){return e?n(e):t()}))}))]}))}))},e.prototype.createSchemaBuilder=function(){return new m(this.connection)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=g.ApplyValueTransformers.transformTo(t.transformer,e)),null==e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?i.DateUtils.mixedDateToDateString(e):"time"===t.type?i.DateUtils.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?i.DateUtils.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?i.DateUtils.simpleArrayToString(e):"simple-json"===t.type?i.DateUtils.simpleJsonToString(e):"simple-enum"===t.type?i.DateUtils.simpleEnumToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?g.ApplyValueTransformers.transformFrom(t.transformer,e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"==typeof e&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=i.DateUtils.normalizeHydratedDate(e)):"date"===t.type?e=i.DateUtils.mixedDateToDateString(e):"time"===t.type?e=i.DateUtils.mixedTimeToString(e):"simple-array"===t.type?e=i.DateUtils.stringToSimpleArray(e):"simple-json"===t.type?e=i.DateUtils.stringToSimpleJson(e):"simple-enum"===t.type&&(e=i.DateUtils.stringToSimpleEnum(e,t)),t.transformer&&(e=g.ApplyValueTransformers.transformFrom(t.transformer,e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=this,i=Object.keys(n).map((function(e){return"boolean"==typeof n[e]?!0===n[e]?1:0:n[e]}));return t&&Object.keys(t).length?[e=e.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,(function(e,n,a){if(!t.hasOwnProperty(a))return e;var o=t[a];return n?o.map((function(e){return i.push(e),r.createParameter(a,i.length-1)})).join(", "):o instanceof Function?o():(i.push(o),r.createParameter(a,i.length-1))})),i]:[e,i]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){return e},e.prototype.parseTableName=function(e){var t=this.database,n=void 0;if(e instanceof o.Table||e instanceof f.View){var r=this.parseTableName(e.name);return{database:e.database||r.database||t,schema:e.schema||r.schema||n,tableName:r.tableName}}if(e instanceof u.TableForeignKey)return r=this.parseTableName(e.referencedTableName),{database:e.referencedDatabase||r.database||t,schema:e.referencedSchema||r.schema||n,tableName:r.tableName};if(e instanceof y.EntityMetadata)return{database:e.database||t,schema:e.schema||n,tableName:e.tableName};var i=e.split(".");return 3===i.length?{database:i[0]||t,schema:i[1]||n,tableName:i[2]}:2===i.length?{database:t,schema:i[0],tableName:i[1]}:{database:t,schema:n,tableName:e}},e.prototype.normalizeType=function(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"varchar":e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"==typeof t?""+t:"boolean"==typeof t?t?"1":"0":"function"==typeof t?t():"string"==typeof t?"'"+t+"'":null!=t?""+t:void 0},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some((function(t){return 1===t.columns.length&&t.columns[0]===e}))},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.enum?"varchar":(e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t)},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t,n,r){var i=e.generatedColumns.reduce((function(e,i){var a;return"increment"===i.generationStrategy&&t&&(a=t-r+n+1),a?v.OrmUtils.mergeDeep(e,i.createValueMap(a)):e}),{});return Object.keys(i).length>0?i:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)}))},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.isFullTextColumnTypeSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.createDatabaseConnection=function(){throw new _.TypeORMError("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}()},4117:(e,t,n)=>{"use strict";n.d(t,{EntitySchema:()=>r});var r=function(e){this.options=e}},9143:(e,t,n)=>{"use strict";n.d(t,{AlreadyHasActiveConnectionError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Cannot create a new connection named "'+t+'", because connection with such name already exist and it now has an active connection session.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},5146:(e,t,n)=>{"use strict";n.d(t,{CannotAttachTreeChildrenEntityError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Cannot attach entity "'+t+'" to its parent. Please make sure parent is saved in the database before saving children nodes.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9669:(e,t,n)=>{"use strict";n.d(t,{CannotConnectAlreadyConnectedError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Cannot create a "'+t+'" connection because connection to the database already established.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},5602:(e,t,n)=>{"use strict";n.d(t,{CannotCreateEntityIdMapError:()=>i});var r=n(9312),i=function(e){function t(t,n){var r=e.call(this)||this,i=t.primaryColumns.reduce((function(e,t,n){return t.setEntityValue(e,n+1),e}),{});return r.message='Cannot use given entity id "'+n+'" because "'+t.targetName+'" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(i)+" as an id.",r}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},727:(e,t,n)=>{"use strict";n.d(t,{CannotDetermineEntityError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Cannot "+t+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},4493:(e,t,n)=>{"use strict";n.d(t,{CannotExecuteNotConnectedError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Cannot execute operation on "'+t+'" connection because connection is not yet established.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},7622:(e,t,n)=>{"use strict";var r,i=n(9312);r=n(9858).TypeORMError,(0,i.__extends)((function(e,t){return r.call(this,'Cannot get reflected type for a "'+t+'" method\'s parameter of "'+e.name+'" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.')||this}),r)},3023:(e,t,n)=>{"use strict";n.d(t,{CircularRelationsError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Circular relations detected: "+t+". To resolve this issue you need to set nullable: true somewhere in this dependency structure.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},5586:(e,t,n)=>{"use strict";n.d(t,{ColumnTypeUndefinedError:()=>i});var r=n(9312),i=function(e){function t(t,n){return e.call(this,"Column type for "+t.constructor.name+"#"+n+' is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},7957:(e,t,n)=>{"use strict";n.d(t,{ConnectionNotFoundError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Connection "'+t+'" was not found.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9831:(e,t,n)=>{"use strict";n.d(t,{CustomRepositoryCannotInheritRepositoryError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Custom entity repository "+(t instanceof Function?t.name:t.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},6844:(e,t,n)=>{"use strict";n.d(t,{CustomRepositoryDoesNotHaveEntityError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},7543:(e,t,n)=>{"use strict";n.d(t,{CustomRepositoryNotFoundError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Custom repository "+(t instanceof Function?t.name:t.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},808:(e,t,n)=>{"use strict";n.d(t,{DataTypeNotSupportedError:()=>i});var r=n(9312),i=function(e){function t(t,n,r){var i=e.call(this)||this,a="string"==typeof n?n:n.name;return i.message='Data type "'+a+'" in "'+t.entityMetadata.targetName+"."+t.propertyName+'" is not supported by "'+r+'" database.',i}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},1545:(e,t,n)=>{"use strict";n.d(t,{DriverOptionNotSetError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Driver option ("+t+") is not set. Please set it to perform connection to the database.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8323:(e,t,n)=>{"use strict";n.d(t,{DriverPackageNotInstalledError:()=>i});var r=n(9312),i=function(e){function t(t,n){return e.call(this,t+" package has not been found installed. Try to install it: npm install "+n+" --save")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},2666:(e,t,n)=>{"use strict";n.d(t,{EntityColumnNotFound:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'No entity column "'+t+'" was found.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9505:(e,t,n)=>{"use strict";n.d(t,{EntityMetadataNotFoundError:()=>a});var r=n(9312),i=n(4117),a=function(e){function t(t){var n=e.call(this)||this;return n.message='No metadata for "'+n.stringifyTarget(t)+'" was found.',n}return(0,r.__extends)(t,e),t.prototype.stringifyTarget=function(e){return e instanceof i.EntitySchema?e.options.name:"function"==typeof e||"object"==typeof e&&"name"in e?e.name:e},t}(n(9858).TypeORMError)},7303:(e,t,n)=>{"use strict";n.d(t,{EntityNotFoundError:()=>a});var r=n(9312),i=n(4117),a=function(e){function t(t,n){var r=e.call(this)||this;return r.message='Could not find any entity of type "'+r.stringifyTarget(t)+'" matching: '+r.stringifyCriteria(n),r}return(0,r.__extends)(t,e),t.prototype.stringifyTarget=function(e){return e instanceof i.EntitySchema?e.options.name:"function"==typeof e||"object"==typeof e&&"name"in e?e.name:e},t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(e){}return""+e},t}(n(9858).TypeORMError)},9444:(e,t,n)=>{"use strict";n.d(t,{FindRelationsNotFoundError:()=>i});var r=n(9312),i=function(e){function t(t){var n=e.call(this)||this;return 1===t.length?n.message='Relation "'+t[0]+'" was not found; please check if it is correct and really exists in your entity.':n.message="Relations "+t.map((function(e){return'"'+e+'"'})).join(", ")+" were not found; please check if relations are correct and they exist in your entities.",n}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},2230:(e,t,n)=>{"use strict";n.d(t,{InitializedRelationError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "'+t.entityMetadata.targetName+"#"+t.propertyPath+'". This is ORM requirement to make relations to work properly. Refer docs for more information.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9116:(e,t,n)=>{"use strict";n.d(t,{InsertValuesMissingError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,'Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},1585:(e,t,n)=>{"use strict";n.d(t,{LimitOnUpdateNotSupportedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Your database does not support LIMIT on UPDATE statements.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},894:(e,t,n)=>{"use strict";n.d(t,{LockNotSupportedOnGivenDriverError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Locking not supported on given driver.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9987:(e,t,n)=>{"use strict";n.d(t,{MissingDeleteDateColumnError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Entity "'+t.name+'" does not have delete date columns.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},2732:(e,t,n)=>{"use strict";n.d(t,{MissingDriverError:()=>i});var r=n(9312),i=function(e){function t(t,n){return void 0===n&&(n=[]),e.call(this,'Wrong driver: "'+t+'" given. Supported drivers are: '+n.map((function(e){return'"'+e+'"'})).join(", ")+".")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9296:(e,t,n)=>{"use strict";n.d(t,{MissingPrimaryColumnError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Entity "'+t.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8248:(e,t,n)=>{"use strict";n.d(t,{MustBeEntityError:()=>i});var r=n(9312),i=function(e){function t(t,n){return e.call(this,"Cannot "+t+', given value must be an entity, instead "'+n+'" is given.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},4463:(e,t,n)=>{"use strict";n.d(t,{NoConnectionOptionError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Option "'+t+'" is not set in your connection options, please define "'+t+'" option in your connection options or ormconfig.json')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},2401:(e,t,n)=>{"use strict";n.d(t,{NoNeedToReleaseEntityManagerError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8722:(e,t,n)=>{"use strict";n.d(t,{NoVersionOrUpdateDateColumnError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Entity "+t+" does not have version or update date columns.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},3139:(e,t,n)=>{"use strict";n.d(t,{OffsetWithoutLimitNotSupportedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},6254:(e,t,n)=>{"use strict";n.d(t,{OptimisticLockCanNotBeUsedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"The optimistic lock can be used only with getOne() method.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8548:(e,t,n)=>{"use strict";n.d(t,{OptimisticLockVersionMismatchError:()=>i});var r=n(9312),i=function(e){function t(t,n,r){return e.call(this,"The optimistic lock on entity "+t+" failed, version "+n+" was expected, but is actually "+r+".")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9889:(e,t,n)=>{"use strict";n.d(t,{PessimisticLockTransactionRequiredError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"An open transaction is required for pessimistic lock.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},4951:(e,t,n)=>{"use strict";var r,i=n(9312);r=n(9858).TypeORMError,(0,i.__extends)((function(e,t){return r.call(this,"Primary column "+e.constructor.name+"#"+t+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.")||this}),r)},8746:(e,t,n)=>{"use strict";n.d(t,{QueryFailedError:()=>a});var r=n(9312),i=n(9206),a=function(e){function t(t,n,a){var o=e.call(this,a.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""))||this;if(o.query=t,o.parameters=n,o.driverError=a,a){a.name;var s=(0,r.__rest)(a,["name"]);i.ObjectUtils.assign(o,(0,r.__assign)({},s))}return o}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},5467:(e,t,n)=>{"use strict";n.d(t,{QueryRunnerAlreadyReleasedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Query runner already released. Cannot run queries anymore.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},6207:(e,t,n)=>{"use strict";n.d(t,{QueryRunnerProviderAlreadyReleasedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8998:(e,t,n)=>{"use strict";n.d(t,{RepositoryNotFoundError:()=>a});var r=n(9312),i=n(4117),a=function(e){function t(t,n){var r,a=e.call(this)||this;return r=n instanceof i.EntitySchema?n.options.name:"function"==typeof n||"object"==typeof n&&"name"in n?n.name:n,a.message='No repository for "'+r+'" was found. Looks like this entity is not registered in current "'+t+'" connection?',a}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},4239:(e,t,n)=>{"use strict";n.d(t,{RepositoryNotTreeError:()=>a});var r=n(9312),i=n(4117),a=function(e){function t(t){var n,r=e.call(this)||this;return n=t instanceof i.EntitySchema?t.options.name:"function"==typeof t||"object"==typeof t&&"name"in t?t.name:t,r.message='Repository of the "'+n+'" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',r}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8164:(e,t,n)=>{"use strict";n.d(t,{ReturningStatementNotSupportedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},6549:(e,t,n)=>{"use strict";n.d(t,{SubjectRemovedAndUpdatedError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,'Removed entity "'+t.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},2955:(e,t,n)=>{"use strict";n.d(t,{SubjectWithoutIdentifierError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Internal error. Subject "+t.metadata.targetName+" must have an identifier to perform operation.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},8392:(e,t,n)=>{"use strict";n.d(t,{TransactionAlreadyStartedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Transaction already started for the given connection, commit current transaction before starting a new one.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},95:(e,t,n)=>{"use strict";n.d(t,{TransactionNotStartedError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,"Transaction is not started yet, start transaction before committing or rolling it back.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},7895:(e,t,n)=>{"use strict";n.d(t,{TreeRepositoryNotSupportedError:()=>i});var r=n(9312),i=function(e){function t(t){return e.call(this,"Tree repositories are not supported in "+t.options.type+" driver.")||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},9858:(e,t,n)=>{"use strict";n.d(t,{TypeORMError:()=>i});var r=n(9312),i=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return Object.setPrototypeOf?Object.setPrototypeOf(r,n.prototype):r.__proto__=n.prototype,r}return(0,r.__extends)(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),t}(Error)},2235:(e,t,n)=>{"use strict";n.d(t,{UpdateValuesMissingError:()=>i});var r=n(9312),i=function(e){function t(){return e.call(this,'Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')||this}return(0,r.__extends)(t,e),t}(n(9858).TypeORMError)},3556:(e,t,n)=>{"use strict";n.d(t,{DriverOptionNotSetError:()=>s.DriverOptionNotSetError,DriverPackageNotInstalledError:()=>o.DriverPackageNotInstalledError,FindRelationsNotFoundError:()=>u.FindRelationsNotFoundError,TypeORMError:()=>a.TypeORMError}),n(7622),n(9143),n(2955),n(9669),n(894);var r,i=n(9312),a=n(9858),o=(r=a.TypeORMError,(0,i.__extends)((function(e){return r.call(this,"Connection with "+e+" database is not established. Check connection configuration.")||this}),r),n(5602),function(e){(0,i.__extends)((function(t,n,r){return e.call(this,t+" metadata already exists for the class constructor "+JSON.stringify(n)+(r?" on property "+r:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."))||this}),e)}(a.TypeORMError),n(727),n(2235),n(7895),n(7543),n(95),n(8392),n(7303),n(9505),n(8248),n(8548),n(1585),n(4951),n(9831),n(6207),n(5146),n(6844),n(9987),function(e){(0,i.__extends)((function(t){return e.call(this,'Cannot get a Repository for "'+t+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.")||this}),e)}(a.TypeORMError),n(3023),n(8164),function(e){(0,i.__extends)((function(t,n){return e.call(this,"Using JoinTable on "+t.name+"#"+n.propertyName+" is wrong. "+t.name+"#"+n.propertyName+" has "+n.relationType+" relation, however you can use JoinTable only on many-to-many relations.")||this}),e)}(a.TypeORMError),function(e){(0,i.__extends)((function(t,n){var r=e.call(this)||this;return n.inverseRelation?r.message="JoinColumn is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":r.message="JoinColumn is missing on "+t.name+"#"+n.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",r}),e)}(a.TypeORMError),n(9296),n(2666),n(2732),n(8323)),s=(function(e){(0,i.__extends)((function(t){return e.call(this,'Cannot get entity manager for "'+t+'" connection because connection is not yet established.')||this}),e)}(a.TypeORMError),n(7957),n(8722),n(9116),n(6254),function(e){(0,i.__extends)((function(t,n){return e.call(this,t+" metadata with such name "+n+" already exists. Do you apply decorator twice? Or maybe try to change a name?")||this}),e)}(a.TypeORMError),n(1545)),u=n(9444);n(8998),function(e){(0,i.__extends)((function(t,n){var r=e.call(this)||this,i=t instanceof Function?t.name:t;return r.message='Naming strategy "'+i+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+n+'" connection?',r}),e)}(a.TypeORMError),n(9889),n(4239),n(808),n(2230),function(e){(0,i.__extends)((function(t,n){var r=e.call(this)||this;return n.inverseRelation?r.message="JoinTable is missing on both sides of "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":r.message="JoinTable is missing on "+t.name+"#"+n.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",r}),e)}(a.TypeORMError),n(8746),n(2401),function(e){(0,i.__extends)((function(t,n){return e.call(this,"Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.")||this}),e)}(a.TypeORMError),function(e){(0,i.__extends)((function(t,n){return e.call(this,"Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+t.name+"#"+n.propertyName+" and "+n.inverseEntityMetadata.name+"#"+n.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.")||this}),e)}(a.TypeORMError),n(6549),function(e){(0,i.__extends)((function(){return e.call(this,"Internal error. Persisted entity was not found in the list of prepared operated entities.")||this}),e)}(a.TypeORMError),function(e){(0,i.__extends)((function(t,n){return e.call(this,"Using JoinColumn on "+t.name+"#"+n.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.")||this}),e)}(a.TypeORMError),n(5586),n(5467),n(3139),n(4493),n(4463)},2281:(e,t,n)=>{"use strict";n.d(t,{FindOperator:()=>r});var r=function(){function e(e,t,n,r,i,a){void 0===n&&(n=!0),void 0===r&&(r=!1),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r,this._getSql=i,this._objectLiteralParameters=a}return Object.defineProperty(e.prototype,"useParameter",{get:function(){return this._value instanceof e?this._value.useParameter:this._useParameter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multipleParameters",{get:function(){return this._value instanceof e?this._value.multipleParameters:this._multipleParameters},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value instanceof e?this._value.value:this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectLiteralParameters",{get:function(){return this._value instanceof e?this._value.objectLiteralParameters:this._objectLiteralParameters},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"child",{get:function(){if(this._value instanceof e)return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"getSql",{get:function(){return this._value instanceof e?this._value.getSql:this._getSql},enumerable:!1,configurable:!0}),e}()},5367:(e,t,n)=>{"use strict";n.d(t,{In:()=>i});var r=n(2281);function i(e){return new r.FindOperator("in",e,!0,!0)}},9668:(e,t,n)=>{"use strict";n.d(t,{Column:()=>$t,CreateDateColumn:()=>Xt,Entity:()=>an,JoinColumn:()=>tn,ManyToOne:()=>nn,OneToMany:()=>rn,PrimaryGeneratedColumn:()=>Zt,UpdateDateColumn:()=>en,createConnection:()=>Gt}),n(8706);var r=n(9312),i=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter((function(e){return e.target&&-1!==t.indexOf(e.target)})):e},e}(),a=function(){function e(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t}))},e.prototype.findTree=function(e){return this.trees.find((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateRelationProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterUniques=function(e){return this.uniques.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterChecks=function(e){return this.checks.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterExclusions=function(e){return this.exclusions.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find((function(n){return n.target===e&&n.propertyName===t}))},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter((function(n){return n.target===e&&n.propertyName===t}))},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e,t){return this.transactionEntityManagers.filter((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t}))},e.prototype.filterTransactionRepository=function(e,t){return this.transactionRepositories.filter((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t}))},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter((function(t){return t.target instanceof Function&&e instanceof Function&&i.isInherited(t.target,e)&&"entity-child"===t.type}))},e.prototype.findInheritanceType=function(e){return this.inheritances.find((function(t){return t.target===e}))},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find((function(t){return t.target===e}))},e.prototype.filterByTarget=function(e,t){return e.filter((function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t}))},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach((function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((function(t){return t.propertyName===e.propertyName}))||n.push(e))})),n},e.prototype.filterByTargetAndWithoutDuplicateRelationProperties=function(e,t){var n=[];return e.forEach((function(e){if(t instanceof Array?-1!==t.indexOf(e.target):e.target===t){var r=n.findIndex((function(t){return t.propertyName===e.propertyName}));if(t instanceof Array&&-1!==r&&t.indexOf(e.target)<t.indexOf(n[r].target)){var i=Object.create(n[r]);i.type=e.type,n[r]=i}else-1===r&&n.push(e)}})),n},e.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(e,t){var n=[];return e.forEach((function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((function(t){return t.prefix===e.prefix&&t.propertyName===e.propertyName}))||n.push(e))})),n},e}(),o=function(){function e(){}return e.getGlobalVariable=function(){return"undefined"!=typeof window?window:n.g},e.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},e.pathNormalize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},e.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},e.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},e.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},e.dotenv=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "'+e+'" }).')},e.getEnvVariable=function(e){},e.readFileSync=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},e.appendFileSync=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},e.writeFile=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},e.highlightSql=function(e){return e},e.highlightJson=function(e){return e},e.logInfo=function(e,t){console.info(e+" ",t)},e.logError=function(e,t){console.error(e+" ",t)},e.logWarn=function(e,t){console.warn(e+" ",t)},e.log=function(e){console.log(e)},e.warn=function(e){return e},e.type="browser",e}();"undefined"!=typeof window&&(window.Buffer=n(816).Buffer),void 0!==n.g&&(n.g.Buffer=n(816).Buffer);var s=function(){function e(){}return e.prototype.all=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new Error("Cannot read connection options in a browser context.")}))}))},e.prototype.get=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new Error("Cannot read connection options in a browser context.")}))}))},e.prototype.has=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new Error("Cannot read connection options in a browser context.")}))}))},e}(),u=n(9090),c=n(3925),l=n(9338),h=function(){function e(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}return e.prototype.getTableName=function(e){return e instanceof l.Table&&(e=e.name),e.split(".").pop()},e.prototype.tableName=function(e,t){return t||(0,c.snakeCase)(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){var r=t||e;return n.length?(0,c.camelCase)(n.join("_"))+(0,c.titleCase)(r):r},e.prototype.relationName=function(e){return e},e.prototype.primaryKeyName=function(e,t){var n=(0,r.__spreadArray)([],(0,r.__read)(t));n.sort();var i=this.getTableName(e).replace(".","_")+"_"+n.join("_");return"PK_"+u.RandomGenerator.sha1(i).substr(0,27)},e.prototype.uniqueConstraintName=function(e,t){var n=(0,r.__spreadArray)([],(0,r.__read)(t));n.sort();var i=this.getTableName(e).replace(".","_")+"_"+n.join("_");return"UQ_"+u.RandomGenerator.sha1(i).substr(0,27)},e.prototype.relationConstraintName=function(e,t,n){var i=(0,r.__spreadArray)([],(0,r.__read)(t));i.sort();var a=this.getTableName(e).replace(".","_")+"_"+i.join("_");return n&&(a+="_"+n),"REL_"+u.RandomGenerator.sha1(a).substr(0,26)},e.prototype.defaultConstraintName=function(e,t){var n=this.getTableName(e).replace(".","_")+"_"+t;return"DF_"+u.RandomGenerator.sha1(n).substr(0,27)},e.prototype.foreignKeyName=function(e,t,n,i){var a=(0,r.__spreadArray)([],(0,r.__read)(t));a.sort();var o=this.getTableName(e).replace(".","_")+"_"+a.join("_");return"FK_"+u.RandomGenerator.sha1(o).substr(0,27)},e.prototype.indexName=function(e,t,n){var i=(0,r.__spreadArray)([],(0,r.__read)(t));i.sort();var a=this.getTableName(e).replace(".","_")+"_"+i.join("_");return n&&(a+="_"+n),"IDX_"+u.RandomGenerator.sha1(a).substr(0,26)},e.prototype.checkConstraintName=function(e,t,n){var r=this.getTableName(e).replace(".","_")+"_"+t,i="CHK_"+u.RandomGenerator.sha1(r).substr(0,26);return n?i+"_ENUM":i},e.prototype.exclusionConstraintName=function(e,t){var n=this.getTableName(e).replace(".","_")+"_"+t;return"XCL_"+u.RandomGenerator.sha1(n).substr(0,26)},e.prototype.joinColumnName=function(e,t){return(0,c.camelCase)(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,r){return(0,c.snakeCase)(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return(0,c.camelCase)(e+"_"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.prefixTableName=function(e,t){return e+t},e.prototype.eagerJoinRelationAlias=function(e,t){return e+"_"+t.replace(".","_")},e}(),p=n(4493),d=n(9669),f=n(9505),m=function(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r},y=n(1100),v=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]},g=n(3556),b=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.transaction="all";var n=this.connection.driver.options.schema,r=this.connection.driver.database;this.migrationsDatabase=r,this.migrationsSchema=n,this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n,r)}return e.prototype.executeMigration=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t=this;return(0,r.__generator)(this,(function(n){return[2,this.withQueryRunner((function(n){return(0,r.__awaiter)(t,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.createMigrationsTableIfNotExist(n)];case 1:return t.sent(),[4,e.instance.up(n)];case 2:return t.sent(),[4,this.insertExecutedMigration(n,e)];case 3:return t.sent(),[2,e]}}))}))}))]}))}))},e.prototype.getAllMigrations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve(this.getMigrations())]}))}))},e.prototype.getExecutedMigrations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,this.withQueryRunner((function(t){return(0,r.__awaiter)(e,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:return[2,e.sent()]}}))}))}))]}))}))},e.prototype.getPendingMigrations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getAllMigrations()];case 1:return e=n.sent(),[4,this.getExecutedMigrations()];case 2:return t=n.sent(),[2,e.filter((function(e){return!t.find((function(t){return t.name===e.name}))}))]}}))}))},e.prototype.insertMigration=function(e){var t=this;return new Promise((function(n,r){t.withQueryRunner((function(i){t.insertExecutedMigration(i,e).then(n).catch(r)}))}))},e.prototype.deleteMigration=function(e){var t=this;return new Promise((function(n,r){t.withQueryRunner((function(i){t.deleteExecutedMigration(i,e).then(n).catch(r)}))}))},e.prototype.showMigrations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:return e=!1,t=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(t)];case 1:return p.sent(),[4,this.loadExecutedMigrations(t)];case 2:n=p.sent(),i=this.getMigrations(),a=function(t){n.find((function(e){return e.name===t.name}))?o.connection.logger.logSchemaBuild(" [X] "+t.name):(e=!0,o.connection.logger.logSchemaBuild(" [ ] "+t.name))},o=this;try{for(s=(0,r.__values)(i),u=s.next();!u.done;u=s.next())c=u.value,a(c)}catch(e){l={error:e}}finally{try{u&&!u.done&&(h=s.return)&&h.call(s)}finally{if(l)throw l.error}}return this.queryRunner?[3,4]:[4,t.release()];case 3:p.sent(),p.label=4;case 4:return[2,e]}}))}))},e.prototype.executePendingMigrations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h,p,d,f,m,y,v=this;return(0,r.__generator)(this,(function(g){switch(g.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return g.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=g.sent(),n=this.getLatestTimestampMigration(t),i=this.getMigrations(),a=[],(o=i.filter((function(e){return!t.find((function(t){return t.name===e.name}))}))).length?[3,5]:(this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner?[3,4]:[4,e.release()]);case 3:g.sent(),g.label=4;case 4:return[2,[]];case 5:return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(i.length+" migrations were found in the source code."),n&&this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(o.length+" migrations are new migrations that needs to be executed."),s=!1,"all"!==this.transaction||e.isTransactionActive?[3,7]:[4,e.startTransaction()];case 6:g.sent(),s=!0,g.label=7;case 7:g.trys.push([7,18,23,26]),u=function(t){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return"each"!==c.transaction||e.isTransactionActive?[3,2]:[4,e.startTransaction()];case 1:n.sent(),s=!0,n.label=2;case 2:return[4,t.instance.up(e).then((function(){return(0,r.__awaiter)(v,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.insertExecutedMigration(e,t)];case 1:return n.sent(),"each"===this.transaction&&s?[4,e.commitTransaction()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))})).then((function(){a.push(t),v.connection.logger.logSchemaBuild("Migration "+t.name+" has been executed successfully.")}))];case 3:return n.sent(),[2]}}))},c=this,g.label=8;case 8:g.trys.push([8,13,14,15]),l=(0,r.__values)(o),h=l.next(),g.label=9;case 9:return h.done?[3,12]:(p=h.value,[5,u(p)]);case 10:g.sent(),g.label=11;case 11:return h=l.next(),[3,9];case 12:return[3,15];case 13:return d=g.sent(),m={error:d},[3,15];case 14:try{h&&!h.done&&(y=l.return)&&y.call(l)}finally{if(m)throw m.error}return[7];case 15:return"all"===this.transaction&&s?[4,e.commitTransaction()]:[3,17];case 16:g.sent(),g.label=17;case 17:return[3,26];case 18:if(f=g.sent(),!s)return[3,22];g.label=19;case 19:return g.trys.push([19,21,,22]),[4,e.rollbackTransaction()];case 20:case 21:return g.sent(),[3,22];case 22:throw f;case 23:return this.queryRunner?[3,25]:[4,e.release()];case 24:g.sent(),g.label=25;case 25:return[7];case 26:return[2,a]}}))}))},e.prototype.undoLastMigration=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return r.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=r.sent(),!(n=this.getLatestExecutedMigration(t)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(a=i.find((function(e){return e.name===n.name}))))throw new g.TypeORMError("No migration "+n.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),o=!1,"none"===this.transaction||e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:r.sent(),o=!0,r.label=4;case 4:return r.trys.push([4,9,14,17]),[4,a.instance.down(e)];case 5:return r.sent(),[4,this.deleteExecutedMigration(e,a)];case 6:return r.sent(),this.connection.logger.logSchemaBuild("Migration "+a.name+" has been reverted successfully."),o?[4,e.commitTransaction()]:[3,8];case 7:r.sent(),r.label=8;case 8:return[3,17];case 9:if(s=r.sent(),!o)return[3,13];r.label=10;case 10:return r.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:case 12:return r.sent(),[3,13];case 13:throw s;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:r.sent(),r.label=16;case 16:return[7];case 17:return[2]}}))}))},e.prototype.createMigrationsTableIfNotExist=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof y.MongoDriver?[2]:[4,e.hasTable(this.migrationsTable)];case 1:return t.sent()?[3,3]:[4,e.createTable(new l.Table({database:this.migrationsDatabase,schema:this.migrationsSchema,name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.loadExecutedMigrations=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof y.MongoDriver?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,t.sent().map((function(e){return new m(parseInt(e.id),parseInt(e.timestamp),e.name)}))]}}))}))},e.prototype.getMigrations=function(){var e=this.connection.migrations.map((function(e){var t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw new g.TypeORMError(t+" migration name is wrong. Migration class name should have a JavaScript timestamp appended.");return new m(void 0,n,t,e)}));return this.checkForDuplicateMigrations(e),e.sort((function(e,t){return e.timestamp-t.timestamp}))},e.prototype.checkForDuplicateMigrations=function(e){var t=e.map((function(e){return e.name})),n=Array.from(new Set(t.filter((function(e,n){return t.indexOf(e)<n}))));if(n.length>0)throw Error("Duplicate migrations: "+n.join(", "))},e.prototype.getLatestTimestampMigration=function(e){var t=e.map((function(e){return e})).sort((function(e,t){return-1*(e.timestamp-t.timestamp)}));return t.length>0?t[0]:void 0},e.prototype.getLatestExecutedMigration=function(e){return e.length>0?e[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof y.SqlServerDriver?(n.timestamp=new v(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new v(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof y.MongoDriver?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insertOne(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.deleteExecutedMigration=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof y.SqlServerDriver?(n.timestamp=new v(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new v(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof y.MongoDriver?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,(i=e.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(i.escape("timestamp")+" = :timestamp").andWhere(i.escape("name")+" = :name").setParameters(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.withQueryRunner=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:t=this.queryRunner||this.connection.createQueryRunner(),n.label=1;case 1:return n.trys.push([1,,2,5]),[2,e(t)];case 2:return this.queryRunner?[3,4]:[4,t.release()];case 3:n.sent(),n.label=4;case 4:return[7];case 5:return[2]}}))}))},e}(),_=n(9296),w=n(3023);function E(e,t,n){var r=[],i={};return function a(o){i[o]=!0,r.push(o),e[o].forEach((function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new g.TypeORMError("Dependency Cycle Found: "+r.join(" -> "))}else a(e)})),r.pop(),t&&0!==e[o].length||-1!==n.indexOf(o)||n.push(o)}}var T=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(this.nodes[e]=2===arguments.length?t:e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach((function(t){Object.keys(t).forEach((function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)}),this)})))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new g.TypeORMError("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new g.TypeORMError("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new g.TypeORMError("Node does not exist: "+e);if(!this.hasNode(t))throw new g.TypeORMError("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];E(this.outgoingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new g.TypeORMError("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];E(this.incomingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new g.TypeORMError("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=E(this.outgoingEdges,!1,[]);r.forEach((function(e){i(e)}));var a=E(this.outgoingEdges,e,n);return r.filter((function(e){return 0===t.incomingEdges[e].length})).forEach((function(e){a(e)})),n},e}(),M=n(808),N=n(4463),C=n(2230),R=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach((function(r){return n.validate(r,e,t)})),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new _.MissingPrimaryColumnError(e);if("STI"===e.inheritancePattern||"entity-child"===e.tableType){if(!e.discriminatorColumn)throw new g.TypeORMError("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?");if(void 0===e.discriminatorValue)throw new g.TypeORMError("Entity "+e.name+" has an undefined discriminator value. Discriminator value should be defined.");var r=t.find((function(t){return t!==e&&("STI"===t.inheritancePattern||"entity-child"===t.tableType)&&t.discriminatorValue===e.discriminatorValue&&t.inheritanceTree.some((function(t){return-1!==e.inheritanceTree.indexOf(t)}))}));if(r)throw new g.TypeORMError("Entities "+e.name+" and "+r.name+" have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.")}if(e.relationCounts.forEach((function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new g.TypeORMError("Relation count can not be implemented on ManyToOne or OneToOne relations.")})),n instanceof y.MongoDriver||e.columns.forEach((function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new M.DataTypeNotSupportedError(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new g.TypeORMError("Column "+t.propertyName+" of Entity "+e.name+" does not support length property.");if("enum"===t.type&&!t.enum&&!t.enumName)throw new g.TypeORMError('Column "'+t.propertyName+'" of Entity "'+e.name+'" is defined as enum, but missing "enum" or "enumName" properties.')})),(n instanceof y.MysqlDriver||n instanceof y.AuroraDataApiDriver)&&e.columns.filter((function(e){return e.isGenerated&&"uuid"!==e.generationStrategy})).length>1)throw new g.TypeORMError("Error in "+e.name+" entity. There can be only one auto-increment column in MySql table.");if(n instanceof y.MysqlDriver&&0===t.filter((function(e){return e.database})).length&&!n.database)throw new N.NoConnectionOptionError("database");if(n instanceof y.SqlServerDriver&&e.columns.filter((function(e){return e.charset})).length>1)throw new g.TypeORMError("Character set specifying is not supported in Sql Server");var i=e.create();e.relations.forEach((function(e){if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;var t=e.getEntityValue(i);if(Array.isArray(t))throw new C.InitializedRelationError(e)}})),e.relations.forEach((function(e){})),e.relations.forEach((function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new g.TypeORMError("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")})),e.eagerRelations.forEach((function(e){}))},e.prototype.validateDependencies=function(e){var t=new T;e.forEach((function(e){t.addNode(e.name)})),e.forEach((function(e){e.relationsWithJoinColumns.filter((function(e){return!e.isNullable})).forEach((function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)}))}));try{t.overallOrder()}catch(e){throw new w.CircularRelationsError(e.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach((function(e){e.eagerRelations.forEach((function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new g.TypeORMError("Circular eager relations are disallowed. "+e.targetName+"#"+t.propertyPath+' contains "eager: true", and its inverse side '+t.inverseEntityMetadata.targetName+"#"+t.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')}))}))},e}(),A=n(6207),O=n(7303),x=n(2401),S=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!1,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.manager).merge.apply(t,(0,r.__spreadArray)([this.metadata.target,e],(0,r.__read)(n)))},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.softRemove=function(e,t){return this.manager.softRemove(this.metadata.target,e,t)},e.prototype.recover=function(e,t){return this.manager.recover(this.metadata.target,e,t)},e.prototype.insert=function(e){return this.manager.insert(this.metadata.target,e)},e.prototype.update=function(e,t){return this.manager.update(this.metadata.target,e,t)},e.prototype.delete=function(e){return this.manager.delete(this.metadata.target,e)},e.prototype.softDelete=function(e){return this.manager.softDelete(this.metadata.target,e)},e.prototype.restore=function(e){return this.manager.restore(this.metadata.target,e)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e.prototype.increment=function(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)},e.prototype.decrement=function(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)},e}(),P=n(2311),q=n(9858),D=n(9444),I=n(4249),j=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(Array.isArray(t.select)||t.where instanceof Object||"string"==typeof t.where||Array.isArray(t.relations)||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||"boolean"==typeof t.cache||"number"==typeof t.cache||t.lock instanceof Object||t.loadRelationIds instanceof Object||"boolean"==typeof t.loadRelationIds||"boolean"==typeof t.loadEagerRelations||"boolean"==typeof t.withDeleted||"boolean"==typeof t.transaction)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||"number"==typeof t.skip||"number"==typeof t.take||"string"==typeof t.skip||"string"==typeof t.take)},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(!0===t.transaction&&(e.expressionMap.useTransaction=!0),!e.expressionMap.mainAlias||!e.expressionMap.mainAlias.hasMetadata)return e;var n=e.expressionMap.mainAlias.metadata;if(t.withDeleted&&e.withDeleted(),t.select&&(e.select([]),t.select.forEach((function(t){var i,a;if(!n.hasColumnWithPropertyPath(""+t))throw new g.TypeORMError(t+" column was not found in the "+n.name+" entity.");var o=n.findColumnsWithPropertyPath(""+t);try{for(var s=(0,r.__values)(o),u=s.next();!u.done;u=s.next()){var c=u.value;e.addSelect(e.alias+"."+c.propertyPath)}}catch(e){i={error:e}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}}))),t.relations){var i=(0,r.__spreadArray)([],(0,r.__read)(t.relations));if(this.applyRelationsRecursively(e,i,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),i.length>0)throw new D.FindRelationsNotFoundError(i)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach((function(n){e.leftJoin(t.join.leftJoin[n],n)})),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach((function(n){e.innerJoin(t.join.innerJoin[n],n)})),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach((function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)})),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach((function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)}))),t.cache)if(t.cache instanceof Object){var a=t.cache;e.cache(a.id,a.milliseconds)}else e.cache(t.cache);if(t.lock)if("optimistic"===t.lock.mode)e.setLock(t.lock.mode,t.lock.version);else if("pessimistic_read"===t.lock.mode||"pessimistic_write"===t.lock.mode||"dirty_read"===t.lock.mode||"pessimistic_partial_write"===t.lock.mode||"pessimistic_write_or_fail"===t.lock.mode){var o=t.lock.tables?t.lock.tables.map((function(t){var n=e.expressionMap.aliases.find((function(e){return e.metadata.tableNameWithoutPrefix===t}));if(!n)throw new g.TypeORMError('"'+t+'" is not part of this query');return e.escape(n.name)})):void 0;e.setLock(t.lock.mode,void 0,o)}return!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach((function(r){var i=t.order[r];if(!n.findColumnWithPropertyPath(r))throw new Error(r+" column was not found in the "+n.name+" entity.");switch(i){case 1:e.addOrderBy(e.alias+"."+r,"ASC");break;case-1:e.addOrderBy(e.alias+"."+r,"DESC");break;case"ASC":e.addOrderBy(e.alias+"."+r,"ASC");break;case"DESC":e.addOrderBy(e.alias+"."+r,"DESC")}})),e},e.applyRelationsRecursively=function(e,t,n,r,i){var a=this,o=[];if(i){var s=new RegExp("^"+i.replace(".","\\.")+"\\.");o=t.filter((function(e){return e.match(s)})).map((function(e){return e.replace(s,"")})).filter((function(e){return r.findRelationWithPropertyPath(e)}))}else o=t.filter((function(e){return r.findRelationWithPropertyPath(e)}));o.forEach((function(o){var s=I.DriverUtils.buildAlias(e.connection.driver,{shorten:!0,joiner:"__"},n,o),u=n+"."+o;e.leftJoinAndSelect(u,s),t.splice(t.indexOf(i?i+"."+o:o),1);var c=e.expressionMap.joinAttributes.find((function(e){return e.entityOrProperty===u}));a.applyRelationsRecursively(e,t,c.alias.name,c.metadata,i?i+"."+o:o);var l=r.relations.find((function(e){return e.propertyName===o}));l&&a.joinEagerRelations(e,s,l.inverseEntityMetadata)}))},e.joinEagerRelations=function(e,t,n){var i=this;n.eagerRelations.forEach((function(n){var a,o,s,u,c=I.DriverUtils.buildAlias(e.connection.driver,{shorten:!0},e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath)),l=!0;try{for(var h=(0,r.__values)(e.expressionMap.joinAttributes),p=h.next();!p.done;p=h.next()){var d=p.value;if(void 0===d.condition&&void 0===d.mapToProperty&&void 0===d.isMappingMany&&"LEFT"===d.direction&&d.entityOrProperty===t+"."+n.propertyPath){l=!1,c=d.alias.name;break}}}catch(e){a={error:e}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}l&&e.leftJoin(t+"."+n.propertyPath,c);var f=!0;try{for(var m=(0,r.__values)(e.expressionMap.selects),y=m.next();!y.done;y=m.next()){var v=y.value;if(void 0===v.aliasName&&void 0===v.virtual&&v.selection===c){f=!1;break}}}catch(e){s={error:e}}finally{try{y&&!y.done&&(u=m.return)&&u.call(m)}finally{if(s)throw s.error}}f&&e.addSelect(c),i.joinEagerRelations(e,c,n.inverseEntityMetadata)}))},e}(),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.findTrees=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.findRoots(e)];case 1:return t=r.sent(),[4,Promise.all(t.map((function(t){return n.findDescendantsTree(t,e)})))];case 2:return r.sent(),[2,t]}}))}))},t.prototype.findRoots=function(e){var t,n=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,this.metadata.primaryColumns[0].propertyName),i=this.createQueryBuilder("treeEntity");if(null==e?void 0:e.relations){var a=(0,r.__spreadArray)([],(0,r.__read)(e.relations));if(j.applyRelationsRecursively(i,a,i.expressionMap.mainAlias.name,i.expressionMap.mainAlias.metadata,""),a.length>0)throw new g.FindRelationsNotFoundError(a)}return i.where(("treeEntity",this.manager.connection.driver.escape("treeEntity")+"."+(t=n,this.manager.connection.driver.escape(t)+" IS NULL"))).getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(s){switch(s.label){case 0:if(n=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e),(null==t?void 0:t.relations)&&(i=(0,r.__spreadArray)([],(0,r.__read)(t.relations)),j.applyRelationsRecursively(n,i,n.expressionMap.mainAlias.name,n.expressionMap.mainAlias.metadata,""),i.length>0))throw new g.FindRelationsNotFoundError(i);return[4,n.getRawAndEntities()];case 1:return a=s.sent(),o=this.createRelationMaps("treeEntity",a.raw),this.buildChildrenEntityTree(e,a.entities,o),[2,e]}}))}))},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)};if("closure-table"===this.metadata.treeType){var a=this.metadata.closureJunctionTable.descendantColumns.map((function(n){return i(t)+"."+i(n.propertyPath)+" = "+i(e)+"."+i(n.referencedColumn.propertyPath)})).join(" AND "),o={},s=this.metadata.closureJunctionTable.ancestorColumns.map((function(e){return o[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+"."+i(e.propertyPath)+" = :"+e.referencedColumn.propertyName})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(s).setParameters(o)}if("nested-set"===this.metadata.treeType){s=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath;var u={};return a=this.metadata.treeParentRelation.joinColumns.map((function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return u[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND "),this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",s).where(a,u)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return r.manager.connection.driver instanceof P.AbstractSqliteDriver?e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE "+i.getQuery()+" || '%'":e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE CONCAT("+i.getQuery()+", '%')"}));throw new q.TypeORMError("Supported only in tree entities")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then((function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildParentEntityTree(e,n.entities,r),e}))},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this;if("closure-table"===this.metadata.treeType){var i=this.metadata.closureJunctionTable.ancestorColumns.map((function(n){return t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath})).join(" AND "),a={},o=this.metadata.closureJunctionTable.descendantColumns.map((function(e){return a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(o).setParameters(a)}if("nested-set"===this.metadata.treeType){i="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath;var s={};return o=this.metadata.treeParentRelation.joinColumns.map((function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return s[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND "),this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",i).where(o,s)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return r.manager.connection.driver instanceof P.AbstractSqliteDriver?i.getQuery()+" LIKE "+e+"."+r.metadata.materializedPathColumn.propertyPath+" || '%'":i.getQuery()+" LIKE CONCAT("+e+"."+r.metadata.materializedPathColumn.propertyPath+", '%')"}));throw new q.TypeORMError("Supported only in tree entities")},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map((function(t){var r=n.metadata.treeParentRelation.joinColumns[0],i=r.givenDatabaseName||r.databaseName,a=t[e+"_"+n.metadata.primaryColumns[0].databaseName],o=t[e+"_"+i];return{id:n.manager.connection.driver.prepareHydratedValue(a,n.metadata.primaryColumns[0]),parentId:n.manager.connection.driver.prepareHydratedValue(o,r)}}))},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.filter((function(e){return e.parentId===a})),s=new Set(o.map((function(e){return e.id})));e[i]=t.filter((function(e){return s.has(r.metadata.primaryColumns[0].getEntityValue(e))})),e[i].forEach((function(e){r.buildChildrenEntityTree(e,t,n)}))},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.find((function(e){return e.id===a})),s=t.find((function(e){return!!o&&r.metadata.primaryColumns[0].getEntityValue(e)===o.parentId}));s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(S),L=function(){function e(){}return e.prototype.transform=function(e,t,n,r){return void 0===r&&(r=!1),this.groupAndTransform(e,t,n,r),e},e.prototype.groupAndTransform=function(e,t,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach((function(n){var r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)})),n.relations.length&&n.relations.forEach((function(n){var a=n.getEntityValue(e),o=n.getEntityValue(t,r);if(void 0!==o)if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(o))return;a||(a=[],n.setEntityValue(e,a)),o.forEach((function(e){var t=a.find((function(t){return n.inverseEntityMetadata.compareEntities(e,t)}));t||(t=n.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),a.push(t)),i.groupAndTransform(t,e,n.inverseEntityMetadata,r)}))}else{if(!(o instanceof Object))return void(a instanceof Object||n.setEntityValue(e,o));a||(a=n.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),n.setEntityValue(e,a)),i.groupAndTransform(a,o,n.inverseEntityMetadata,r)}}))},e}(),U=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!1,configurable:!0}),e}(),F=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find((function(e){return!e.relation&&!e.parentLoadMapItem}))},enumerable:!1,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find((function(t){return t.target===e.target&&t.id===e.id}))||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach((function(t){var r=n.loadMapItems.find((function(n){return n.target===e&&n.metadata.compareEntities(t,n.plainEntity)}));r&&(r.entity=t)}))},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach((function(t){var n=e.find((function(e){return e.target===t.target}));n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)})),e},e}(),k=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a=this;return(0,r.__generator)(this,(function(o){switch(o.label){case 0:return t.hasAllPrimaryKeys(e)?(n=new F,(i=function(e,a,o,s){var u=new U(e,a,o,s);n.addLoadMap(u),a.extractRelationValuesFromEntity(e,t.relations).filter((function(e){return null!=e})).forEach((function(e){var t=(0,r.__read)(e,3),n=t[0],a=t[1],o=t[2];return i(a,o,u,n)}))})(e,t),[4,Promise.all(n.groupByTargetIds().map((function(e){return a.manager.findByIds(e.target,e.ids).then((function(t){return n.fillEntities(e.target,t)}))})))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return o.sent(),n.loadMapItems.forEach((function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)})),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}}))}))},e}(),Q=n(7543),V=n(6844),W=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new V.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new V.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!1,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new V.CustomRepositoryDoesNotHaveEntityError(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=Kt().entityRepositories.find((function(t){return t.target===(e instanceof Function?e:e.constructor)}));if(!t)throw new Q.CustomRepositoryNotFoundError(e);return t.entity},e}(),z=n(9831),K=n(8998),J=n(4239),H=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.treeType){var r=new B;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}return r=void 0,r=e.connection.driver instanceof y.MongoDriver?new y.MongoRepository:new S,Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r},e}(),G=n(7895),Y=n(8248),$=function(){function e(e){this.subjects=(0,r.__spreadArray)([],(0,r.__read)(e)),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var n=[];if("delete"===e){var i=this.subjects.filter((function(e){return!e.entity&&!e.databaseEntity}));n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(i))),this.removeAlreadySorted(i)}var a=this.getNonNullableDependencies(),o=this.toposort(a);"insert"===e&&(o=o.reverse()),o.forEach((function(e){var i=t.subjects.filter((function(t){return t.metadata.targetName===e}));n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(i))),t.removeAlreadySorted(i)}));var s=this.getDependencies(),u=this.toposort(s);return"insert"===e&&(u=u.reverse()),u.forEach((function(e){var i=t.subjects.filter((function(t){return t.metadata.targetName===e}));n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(i))),t.removeAlreadySorted(i)})),n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(this.subjects))),n},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach((function(e){t.subjects.splice(t.subjects.indexOf(e),1)}))},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach((function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)})),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce((function(e,t){return t.relationsWithJoinColumns.forEach((function(n){n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e}),[])},e.prototype.getDependencies=function(){return this.metadatas.reduce((function(e,t){return t.relationsWithJoinColumns.forEach((function(n){n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e}),[])},e.prototype.toposort=function(e){for(var t=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.indexOf(i[0])<0&&t.push(i[0]),t.indexOf(i[1])<0&&t.push(i[1])}return t}(e),n=t.length,r=new Array(n),i={},a=n;a--;)i[a]||o(t[a],a,[]);function o(a,s,u){if(u.indexOf(a)>=0)throw new g.TypeORMError("Cyclic dependency: "+JSON.stringify(a));if(!~t.indexOf(a))throw new g.TypeORMError("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(!i[s]){i[s]=!0;var c=e.filter((function(e){return e[0]===a}));if(s=c.length){var l=u.concat(a);do{var h=c[--s][1];o(h,t.indexOf(h),l)}while(s)}r[--n]=a}}return r},e}(),X=n(5344),Z=n(7081),ee=n(7768),te=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach((function(n){t.computeDiffColumns(n),t.computeDiffRelationalColumns(e,n)}))},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach((function(t){if(!t.isVirtual&&!t.isDiscriminator){var n=e.changeMaps.find((function(e){return e.column===t}));n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);var r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i="json"!==t.type&&"jsonb"!==t.type,a=t.getEntityValue(e.databaseEntity,i);if(t.relationMetadata)if(null!=t.relationMetadata.getEntityValue(e.entity))return;var o=r;if(null!==r){switch(t.type){case"date":o=X.DateUtils.mixedDateToDateString(r);break;case"time":case"time with time zone":case"time without time zone":case"timetz":o=X.DateUtils.mixedDateToTimeString(r);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":o=X.DateUtils.mixedDateToUtcDatetimeString(r),a=X.DateUtils.mixedDateToUtcDatetimeString(a);break;case"json":case"jsonb":if(Z.OrmUtils.deepCompare(r,a))return;break;case"simple-array":o=X.DateUtils.simpleArrayToString(r),a=X.DateUtils.simpleArrayToString(a);break;case"simple-enum":o=X.DateUtils.simpleEnumToString(r),a=X.DateUtils.simpleEnumToString(a);break;case"simple-json":o=X.DateUtils.simpleJsonToString(r),a=X.DateUtils.simpleJsonToString(a)}t.transformer&&(o=ee.ApplyValueTransformers.transformTo(t.transformer,r))}if(o instanceof Buffer&&a instanceof Buffer){if(o.equals(a))return}else if(o===a)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}}))},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach((function(n){var r=n.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var a=n.getEntityValue(t.databaseEntity);if(Z.OrmUtils.compareIds(i,a))return;t.diffRelations.push(n)}var o=e.find((function(e){return e.mustBeInserted&&e.entity===r}));o&&(r=o);var s=t.changeMaps.find((function(e){return e.relation===n}));s?s.value=r:t.changeMaps.push({relation:n,value:r})}}))},e}(),ne=n(2955),re=n(6549),ie=n(5436),ae=function(e){function t(){return e.call(this,"Nested sets do not support multiple root entities.")||this}return(0,r.__extends)(t,e),t}(q.TypeORMError),oe=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t=function(e){return c.queryRunner.connection.driver.escape(e)},n=this.getTableName(e.metadata.tablePath),i=t(e.metadata.nestedSetLeftColumn.databaseName),a=t(e.metadata.nestedSetRightColumn.databaseName),!(o=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(o=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),s=e.metadata.getEntityIdMap(o),u=void 0,s?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(s).getRawOne().then((function(e){var t=e?e.right:void 0;return"string"==typeof t?parseInt(t):t}))]:[3,2];case 1:u=r.sent(),r.label=2;case 2:return void 0===u?[3,4]:[4,this.queryRunner.query("UPDATE "+n+" SET "+i+" = CASE WHEN "+i+" > "+u+" THEN "+i+" + 2 ELSE "+i+" END,"+a+" = "+a+" + 2 WHERE "+a+" >= "+u)];case 3:return r.sent(),Z.OrmUtils.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(u),e.metadata.nestedSetRightColumn.createValueMap(u+1)),[3,6];case 4:return[4,this.isUniqueRootEntity(e,o)];case 5:if(!r.sent())throw new ae;Z.OrmUtils.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2)),r.label=6;case 6:return[2]}}))}))},e.prototype.update=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b=this;return(0,r.__generator)(this,(function(_){switch(_.label){case 0:return!(t=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity),!(n=e.databaseEntity)&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((function(t){return Object.entries(e.identifier).every((function(e){var n=(0,r.__read)(e,2),i=n[0],a=n[1];return t[i]===a}))}))),void 0===n||void 0===t?[2]:(i=e.metadata.treeParentRelation.getEntityValue(n),a=e.metadata.getEntityIdMap(i),o=e.metadata.getEntityIdMap(t),Z.OrmUtils.compareIds(a,o)?[2]:t?(s=function(e){return b.queryRunner.connection.driver.escape(e)},u=this.getTableName(e.metadata.tablePath),c=s(e.metadata.nestedSetLeftColumn.databaseName),l=s(e.metadata.nestedSetRightColumn.databaseName),h=e.metadata.getEntityIdMap(n),p=void 0,h?[4,this.getNestedSetIds(e.metadata,h)]:[3,2]):[3,9]);case 1:p=_.sent()[0],_.label=2;case 2:return d=void 0,o?[4,this.getNestedSetIds(e.metadata,o)]:[3,4];case 3:d=_.sent()[0],_.label=4;case 4:return void 0===p||void 0===d?[3,8]:(f=d.left>p.left,m=p.right-p.left+1,void 0,y=f?d.left-p.right:d.right-p.left,v="WHEN "+c+" >= "+p.left+" AND "+c+" < "+p.right+" THEN "+c+" + "+y+" ",g="WHEN "+l+" > "+p.left+" AND "+l+" <= "+p.right+" THEN "+l+" + "+y+" ",f?[4,this.queryRunner.query("UPDATE "+u+" SET "+c+" = CASE WHEN "+c+" > "+p.right+" AND "+c+" <= "+d.left+" THEN "+c+" - "+m+" "+v+"ELSE "+c+" END, "+l+" = CASE WHEN "+l+" > "+p.right+" AND "+l+" < "+d.left+" THEN "+l+" - "+m+" "+g+"ELSE "+l+" END")]:[3,6]);case 5:return _.sent(),[3,8];case 6:return[4,this.queryRunner.query("UPDATE "+u+" SET "+c+" = CASE WHEN "+c+" < "+p.left+" AND "+c+" > "+d.right+" THEN "+c+" + "+m+" "+v+"ELSE "+c+" END, "+l+" = CASE WHEN "+l+" < "+p.left+" AND "+l+" >= "+d.right+" THEN "+l+" + "+m+" "+g+"ELSE "+l+" END")];case 7:_.sent(),_.label=8;case 8:return[3,11];case 9:return[4,this.isUniqueRootEntity(e,t)];case 10:if(!_.sent())throw new ae;_.label=11;case 11:return[2]}}))}))},e.prototype.remove=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b,_,w,E=this;return(0,r.__generator)(this,(function(T){switch(T.label){case 0:Array.isArray(e)||(e=[e]),t=e[0].metadata,n=function(e){return E.queryRunner.connection.driver.escape(e)},i=this.getTableName(t.tablePath),a=n(t.nestedSetLeftColumn.databaseName),o=n(t.nestedSetRightColumn.databaseName),s=[];try{for(u=(0,r.__values)(e),c=u.next();!c.done;c=u.next())l=c.value,(h=t.getEntityIdMap(l.entity))&&s.push(h)}catch(e){g={error:e}}finally{try{c&&!c.done&&(b=u.return)&&b.call(u)}finally{if(g)throw g.error}}return[4,this.getNestedSetIds(t,s)];case 1:p=T.sent(),T.label=2;case 2:T.trys.push([2,7,8,9]),d=(0,r.__values)(p),f=d.next(),T.label=3;case 3:return f.done?[3,6]:(m=f.value,y=m.right-m.left+1,[4,this.queryRunner.query("UPDATE "+i+" SET "+a+" = CASE WHEN "+a+" > "+m.left+" THEN "+a+" - "+y+" ELSE "+a+" END, "+o+" = CASE WHEN "+o+" > "+m.right+" THEN "+o+" - "+y+" ELSE "+o+" END")]);case 4:T.sent(),T.label=5;case 5:return f=d.next(),[3,3];case 6:return[3,9];case 7:return v=T.sent(),_={error:v},[3,9];case 8:try{f&&!f.done&&(w=d.return)&&w.call(d)}finally{if(_)throw _.error}return[7];case 9:return[2]}}))}))},e.prototype.getNestedSetIds=function(e,t){var n={left:e.targetName+"."+e.nestedSetLeftColumn.propertyPath,right:e.targetName+"."+e.nestedSetRightColumn.propertyPath},i=this.queryRunner.manager.createQueryBuilder();return Object.entries(n).forEach((function(e){var t=(0,r.__read)(e,2),n=t[0],a=t[1];i.addSelect(a,n)})),i.from(e.target,e.targetName).whereInIds(t).orderBy(n.right,"DESC").getRawMany().then((function(e){var t,i,a,o,s=[];try{for(var u=(0,r.__values)(e),c=u.next();!c.done;c=u.next()){var l=c.value,h={};try{for(var p=(a=void 0,(0,r.__values)(Object.keys(n))),d=p.next();!d.done;d=p.next()){var f=d.value,m=l?l[f]:void 0;h[f]="string"==typeof m?parseInt(m):m}}catch(e){a={error:e}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(a)throw a.error}}s.push(h)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(t)throw t.error}}return s}))},e.prototype.isUniqueRootEntity=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=function(e){return c.queryRunner.connection.driver.escape(e)},i=this.getTableName(e.metadata.tablePath),a=[],o=e.metadata.treeParentRelation.joinColumns.map((function(e){var r=n(e.databaseName),i=e.getEntityValue(t);return null==i?r+" IS NULL":(a.push(i),r+" = "+c.queryRunner.connection.driver.createParameter("entity_"+e.databaseName,a.length-1))})).join(" AND "),s="count",[4,this.queryRunner.query("SELECT COUNT(1) AS "+n(s)+" FROM "+i+" WHERE "+o,a,!0)];case 1:return u=r.sent(),[2,0===parseInt(u.records[0][s])]}}))}))},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)})).join(".")},e}(),se=n(5146),ue=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h=this;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:return t={},e.metadata.closureJunctionTable.ancestorColumns.forEach((function(n){t[n.databaseName]=e.identifier})),e.metadata.closureJunctionTable.descendantColumns.forEach((function(n){t[n.databaseName]=e.identifier})),[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute()];case 1:return p.sent(),!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n?(i=function(e){return h.queryRunner.connection.driver.escape(e)},a=this.getTableName(e.metadata.closureJunctionTable.tablePath),o=[],s=e.metadata.closureJunctionTable.ancestorColumns.map((function(e){return i(e.databaseName)})),u=e.metadata.closureJunctionTable.descendantColumns.map((function(e){return i(e.databaseName)})),c=e.metadata.primaryColumns.map((function(t){return o.push(t.getEntityValue(e.insertedValueSet?e.insertedValueSet:e.entity)),h.queryRunner.connection.driver.createParameter("child_entity_"+t.databaseName,o.length-1)})),l=e.metadata.closureJunctionTable.descendantColumns.map((function(t){var r=i(t.databaseName),a=t.referencedColumn.getEntityValue(n);if(!a)throw new se.CannotAttachTreeChildrenEntityError(e.metadata.name);return o.push(a),r+" = "+h.queryRunner.connection.driver.createParameter("parent_entity_"+t.referencedColumn.databaseName,o.length-1)})),[4,this.queryRunner.query("INSERT INTO "+a+" ("+(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s)),(0,r.__read)(u)).join(", ")+") SELECT "+s.join(", ")+", "+c.join(", ")+" FROM "+a+" WHERE "+l.join(" AND "),o)]):[3,3];case 2:p.sent(),p.label=3;case 3:return[2]}}))}))},e.prototype.update=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b,_,w,E,T,M,N=this;return(0,r.__generator)(this,(function(C){switch(C.label){case 0:if(!(t=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity),!(n=e.databaseEntity)&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((function(t){return Object.entries(e.identifier).every((function(e){var n=(0,r.__read)(e,2),i=n[0],a=n[1];return t[i]===a}))}))),void 0===n||void 0===t)return[2];if(i=e.metadata.treeParentRelation.getEntityValue(n),a=e.metadata.getEntityIdMap(i),o=e.metadata.getEntityIdMap(t),Z.OrmUtils.compareIds(a,o))return[2];s=function(e){return N.queryRunner.connection.driver.escape(e)},u=e.metadata.closureJunctionTable,c=u.ancestorColumns.map((function(e){return s(e.databaseName)})),l=u.descendantColumns.map((function(e){return s(e.databaseName)})),h=function(e,t){var n,i,a="sub"+t,o=e.createQueryBuilder().select(l.join(", ")).from(u.tablePath,a);try{for(var c=(0,r.__values)(u.ancestorColumns),h=c.next();!h.done;h=c.next()){var p=h.value;o.andWhere(s(a)+"."+s(p.databaseName)+" = :value_"+p.referencedColumn.databaseName)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return e.createQueryBuilder().select(l.join(", ")).from("("+o.getQuery()+")",t).setParameters(o.getParameters()).getQuery()},p={};try{for(d=(0,r.__values)(e.metadata.primaryColumns),f=d.next();!f.done;f=d.next())m=f.value,p["value_"+m.databaseName]=n[m.databaseName]}catch(e){T={error:e}}finally{try{f&&!f.done&&(M=d.return)&&M.call(d)}finally{if(T)throw T.error}}return[4,this.queryRunner.manager.createQueryBuilder().delete().from(u.tablePath).where((function(e){return"("+l.join(", ")+") IN ("+h(e,"descendant")+")"})).andWhere((function(e){return"("+c.join(", ")+") NOT IN ("+h(e,"ancestor")+")"})).setParameters(p).execute()];case 1:return C.sent(),t?(y=[],v=this.getTableName(u.tablePath),g=s("supertree"),b=s("subtree"),_=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(c.map((function(e){return g+"."+e})))),(0,r.__read)(l.map((function(e){return b+"."+e})))),w=e.metadata.closureJunctionTable.ancestorColumns.map((function(e){var t=s(e.databaseName),r=e.referencedColumn.getEntityValue(n);y.push(r);var i=N.queryRunner.connection.driver.createParameter("entity_"+e.referencedColumn.databaseName,y.length-1);return b+"."+t+" = "+i})),E=e.metadata.closureJunctionTable.descendantColumns.map((function(n){var r=s(n.databaseName),i=n.referencedColumn.getEntityValue(t);if(!i)throw new se.CannotAttachTreeChildrenEntityError(e.metadata.name);y.push(i);var a=N.queryRunner.connection.driver.createParameter("parent_entity_"+n.referencedColumn.databaseName,y.length-1);return g+"."+r+" = "+a})),[4,this.queryRunner.query("INSERT INTO "+v+" ("+(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(c)),(0,r.__read)(l)).join(", ")+") SELECT "+_.join(", ")+" FROM "+v+" AS "+g+", "+v+" AS "+b+" WHERE "+(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(w)),(0,r.__read)(E)).join(" AND "),y)]):[3,3];case 2:C.sent(),C.label=3;case 3:return[2]}}))}))},e.prototype.remove=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return this.queryRunner.connection.driver instanceof y.SqlServerDriver?(Array.isArray(e)||(e=[e]),t=function(e){return u.queryRunner.connection.driver.escape(e)},n=e.map((function(e){return e.identifier})),i=e[0].metadata.closureJunctionTable,o=(a=function(e){return e.map((function(e){var r=n.map((function(t){return t[e.referencedColumn.databaseName]}));return t(e.databaseName)+" IN ("+r.join(", ")+")"})).join(" AND ")})(i.ancestorColumns),s=a(i.descendantColumns),[4,this.queryRunner.manager.createQueryBuilder().delete().from(i.tablePath).where(o).orWhere(s).execute()]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)})).join(".")},e}(),ce=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return!(t=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n=e.metadata.getEntityIdMap(t),i="",n?[4,this.getEntityPath(e,n)]:[3,2];case 1:i=r.sent(),r.label=2;case 2:return a=e.metadata.treeParentRelation.joinColumns.map((function(t){return t.referencedColumn.getEntityValue(e.insertedValueSet)})).join("_"),[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set((o={},o[e.metadata.materializedPathColumn.propertyPath]=i+a+".",o)).where(e.identifier).execute()];case 3:return r.sent(),[2]}}))}))},e.prototype.update=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:return!(t=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.entity),!(n=e.databaseEntity)&&t&&(n=e.metadata.treeChildrenRelation.getEntityValue(t).find((function(t){return Object.entries(e.identifier).every((function(e){var n=(0,r.__read)(e,2),i=n[0],a=n[1];return t[i]===a}))}))),i=e.metadata.treeParentRelation.getEntityValue(n),a=e.metadata.getEntityIdMap(i),o=e.metadata.getEntityIdMap(t),Z.OrmUtils.compareIds(a,o)?[2]:(s="",o?[4,this.getEntityPath(e,o)]:[3,2]);case 1:s=p.sent(),p.label=2;case 2:return u="",a?[4,this.getEntityPath(e,a)]:[3,4];case 3:u=p.sent()||"",p.label=4;case 4:return c=e.metadata.treeParentRelation.joinColumns.map((function(e){return e.referencedColumn.getEntityValue(n)})).join("_"),l=e.metadata.materializedPathColumn.propertyPath,[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set((h={},h[l]=function(){return"REPLACE("+l+", '"+u+c+".', '"+s+c+".')"},h)).where(l+" LIKE :path",{path:""+u+c+".%"}).execute()];case 5:return p.sent(),[2]}}))}))},e.prototype.getEntityPath=function(e,t){return this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(t).getRawOne().then((function(e){return e?e.path:void 0}))},e}(),le=function(){function e(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}return e.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return e=void 0,this.options&&!1===this.options.listeners?[3,2]:(e=this.broadcastBeforeEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e&&e.count>0&&(this.insertSubjects.forEach((function(e){return e.recompute()})),this.updateSubjects.forEach((function(e){return e.recompute()})),this.removeSubjects.forEach((function(e){return e.recompute()})),this.softRemoveSubjects.forEach((function(e){return e.recompute()})),this.recoverSubjects.forEach((function(e){return e.recompute()})),this.recompute()),this.insertSubjects=new $(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter((function(e){return e.mustBeUpdated})),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new $(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return t.sent(),this.softRemoveSubjects=this.allSubjects.filter((function(e){return e.mustBeSoftRemoved})),[4,this.executeSoftRemoveOperations()];case 6:return t.sent(),this.recoverSubjects=this.allSubjects.filter((function(e){return e.mustBeRecovered})),[4,this.executeRecoverOperations()];case 7:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 8:return t.sent(),this.options&&!1===this.options.listeners?[3,10]:(e=this.broadcastAfterEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[2]}}))}))},e.prototype.validate=function(){this.allSubjects.forEach((function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new re.SubjectRemovedAndUpdatedError(e)}))},e.prototype.recompute=function(){(new te).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter((function(e){return e.mustBeInserted})),this.updateSubjects=this.allSubjects.filter((function(e){return e.mustBeUpdated})),this.removeSubjects=this.allSubjects.filter((function(e){return e.mustBeRemoved})),this.softRemoveSubjects=this.allSubjects.filter((function(e){return e.mustBeSoftRemoved})),this.recoverSubjects=this.allSubjects.filter((function(e){return e.mustBeRecovered})),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new ie.BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,n.metadata,n.entity)})),this.updateSubjects.length&&this.updateSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.removeSubjects.length&&this.removeSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)})),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.recoverSubjects.length&&this.recoverSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new ie.BroadcasterResult;return this.insertSubjects.length&&this.insertSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,n.metadata,n.entity)})),this.updateSubjects.length&&this.updateSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.removeSubjects.length&&this.removeSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)})),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.recoverSubjects.length&&this.recoverSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),t},e.prototype.executeInsertOperations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h,p=this;return(0,r.__generator)(this,(function(d){switch(d.label){case 0:e=(0,r.__read)(this.groupBulkSubjects(this.insertSubjects,"insert"),2),t=e[0],n=e[1],i=function(e){var n,i,o,s,u,c,l,h,d,f,m,v,g;return(0,r.__generator)(this,(function(b){switch(b.label){case 0:return n=t[e],i=[],o=[],s=[],a.queryRunner.connection.driver instanceof y.MongoDriver?n.forEach((function(e){e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),o.push(e),i.push(e.entity)})):a.queryRunner.connection.driver instanceof y.OracleDriver?n.forEach((function(e){s.push(e)})):n.forEach((function(e){0===e.changeMaps.length||e.metadata.treeType||p.queryRunner.connection.driver instanceof y.OracleDriver||p.queryRunner.connection.driver instanceof y.SapDriver?s.push(e):(o.push(e),i.push(e.createValueSetAndPopChangeMap()))})),a.queryRunner instanceof y.MongoQueryRunner?[4,a.queryRunner.manager.insert(n[0].metadata.target,i)]:[3,2];case 1:return u=b.sent(),n.forEach((function(e,t){e.identifier=u.identifiers[t],e.generatedMap=u.generatedMaps[t],e.insertedValueSet=i[t]})),[3,12];case 2:return i.length>0?[4,a.queryRunner.manager.createQueryBuilder().insert().into(n[0].metadata.target).values(i).updateEntity(!a.options||!1!==a.options.reload).callListeners(!1).execute()]:[3,4];case 3:c=b.sent(),o.forEach((function(e,t){e.identifier=c.identifiers[t],e.generatedMap=c.generatedMaps[t],e.insertedValueSet=i[t]})),b.label=4;case 4:if(!(s.length>0))return[3,12];l=function(e){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"!==e.metadata.treeType?[3,2]:[4,new oe(a.queryRunner).insert(e)];case 1:t.sent(),t.label=2;case 2:return[4,a.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!a.options||!1!==a.options.reload).callListeners(!1).execute().then((function(t){e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]}))];case 3:return t.sent(),"closure-table"!==e.metadata.treeType?[3,5]:[4,new ue(a.queryRunner).insert(e)];case 4:return t.sent(),[3,7];case 5:return"materialized-path"!==e.metadata.treeType?[3,7]:[4,new ce(a.queryRunner).insert(e)];case 6:t.sent(),t.label=7;case 7:return[2]}}))},b.label=5;case 5:b.trys.push([5,10,11,12]),v=void 0,h=(0,r.__values)(s),d=h.next(),b.label=6;case 6:return d.done?[3,9]:(f=d.value,[5,l(f)]);case 7:b.sent(),b.label=8;case 8:return d=h.next(),[3,6];case 9:return[3,12];case 10:return m=b.sent(),v={error:m},[3,12];case 11:try{d&&!d.done&&(g=h.return)&&g.call(h)}finally{if(v)throw v.error}return[7];case 12:return n.forEach((function(e){e.generatedMap&&e.metadata.columns.forEach((function(t){var n=t.getEntityValue(e.generatedMap);if(null!=n){var r=p.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}}))})),[2]}}))},a=this,d.label=1;case 1:d.trys.push([1,6,7,8]),o=(0,r.__values)(n),s=o.next(),d.label=2;case 2:return s.done?[3,5]:(u=s.value,[5,i(u)]);case 3:d.sent(),d.label=4;case 4:return s=o.next(),[3,2];case 5:return[3,8];case 6:return c=d.sent(),l={error:c},[3,8];case 7:try{s&&!s.done&&(h=o.return)&&h.call(o)}finally{if(l)throw l.error}return[7];case 8:return[2]}}))}))},e.prototype.executeUpdateOperations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l=this;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:e=function(e){return(0,r.__awaiter)(l,void 0,void 0,(function(){var t,n,i,a,o,s=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(!e.identifier)throw new ne.SubjectWithoutIdentifierError(e);return this.queryRunner instanceof y.MongoQueryRunner?(t=this.cloneMongoSubjectEntity(e),e.metadata.objectIdColumn&&e.metadata.objectIdColumn.propertyName&&delete t[e.metadata.objectIdColumn.propertyName],e.metadata.createDateColumn&&e.metadata.createDateColumn.propertyName&&delete t[e.metadata.createDateColumn.propertyName],e.metadata.updateDateColumn&&e.metadata.updateDateColumn.propertyName&&(t[e.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(e.metadata.target,e.identifier,t)]):[3,2];case 1:return r.sent(),[3,11];case 2:switch(n=e.createValueSetAndPopChangeMap(),e.metadata.treeType){case"nested-set":return[3,3];case"closure-table":return[3,5];case"materialized-path":return[3,7]}return[3,9];case 3:return[4,new oe(this.queryRunner).update(e)];case 4:return r.sent(),[3,9];case 5:return[4,new ue(this.queryRunner).update(e)];case 6:return r.sent(),[3,9];case 7:return[4,new ce(this.queryRunner).update(e)];case 8:return r.sent(),[3,9];case 9:return i=this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),e.entity?i.whereEntity(e.identifier):i.where(e.identifier),[4,i.execute()];case 10:a=r.sent(),(o=a.generatedMaps[0])&&(e.metadata.columns.forEach((function(e){var t=e.getEntityValue(o);if(null!=t){var n=s.queryRunner.connection.driver.prepareHydratedValue(t,e);e.setEntityValue(o,n)}})),e.generatedMap||(e.generatedMap={}),Object.assign(e.generatedMap,o)),r.label=11;case 11:return[2]}}))}))},t=[],n=[];try{for(i=(0,r.__values)(this.updateSubjects),a=i.next();!a.done;a=i.next())"nested-set"===(o=a.value).metadata.treeType?t.push(o):n.push(o)}catch(e){u={error:e}}finally{try{a&&!a.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}}return s=new Promise((function(n,i){return(0,r.__awaiter)(l,void 0,void 0,(function(){var a,o,s,u,c,l,h;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:p.trys.push([0,7,8,9]),a=(0,r.__values)(t),o=a.next(),p.label=1;case 1:if(o.done)return[3,6];s=o.value,p.label=2;case 2:return p.trys.push([2,4,,5]),[4,e(s)];case 3:return p.sent(),[3,5];case 4:return u=p.sent(),i(u),[3,5];case 5:return o=a.next(),[3,1];case 6:return[3,9];case 7:return c=p.sent(),l={error:c},[3,9];case 8:try{o&&!o.done&&(h=a.return)&&h.call(a)}finally{if(l)throw l.error}return[7];case 9:return n(),[2]}}))}))})),[4,Promise.all((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(n.map(e))),[s]))];case 1:return h.sent(),[2]}}))}))},e.prototype.executeRemoveOperations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:e=(0,r.__read)(this.groupBulkSubjects(this.removeSubjects,"delete"),2),t=e[0],n=e[1],p.label=1;case 1:p.trys.push([1,13,14,15]),i=(0,r.__values)(n),a=i.next(),p.label=2;case 2:return a.done?[3,12]:(o=a.value,s=t[o],u=s.map((function(e){if(!e.identifier)throw new ne.SubjectWithoutIdentifierError(e);return e.identifier})),this.queryRunner instanceof y.MongoQueryRunner?[4,this.queryRunner.manager.delete(s[0].metadata.target,u)]:[3,4]);case 3:return p.sent(),[3,11];case 4:switch(s[0].metadata.treeType){case"nested-set":return[3,5];case"closure-table":return[3,7]}return[3,9];case 5:return[4,new oe(this.queryRunner).remove(s)];case 6:return p.sent(),[3,9];case 7:return[4,new ue(this.queryRunner).remove(s)];case 8:return p.sent(),[3,9];case 9:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(s[0].metadata.target).where(u).callListeners(!1).execute()];case 10:p.sent(),p.label=11;case 11:return a=i.next(),[3,2];case 12:return[3,15];case 13:return c=p.sent(),l={error:c},[3,15];case 14:try{a&&!a.done&&(h=i.return)&&h.call(i)}finally{if(l)throw l.error}return[7];case 15:return[2]}}))}))},e.prototype.cloneMongoSubjectEntity=function(e){var t,n,i={};if(e.entity)try{for(var a=(0,r.__values)(e.metadata.columns),o=a.next();!o.done;o=a.next()){var s=o.value;Z.OrmUtils.mergeDeep(i,s.getEntityValueMap(e.entity))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},e.prototype.executeSoftRemoveOperations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.softRemoveSubjects.map((function(t){return(0,r.__awaiter)(e,void 0,void 0,(function(){var e,n,i,a=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new ne.SubjectWithoutIdentifierError(t);return this.queryRunner instanceof y.MongoQueryRunner?(n=this.cloneMongoSubjectEntity(t),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete n[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete n[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(n[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(n[t.metadata.deleteDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,n)]):[3,2];case 1:return e=r.sent(),[3,4];case 2:return i=this.queryRunner.manager.createQueryBuilder().softDelete().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?i.whereEntity(t.identifier):i.where(t.identifier),[4,i.execute()];case 3:e=r.sent(),r.label=4;case 4:return t.generatedMap=e.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.executeRecoverOperations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.recoverSubjects.map((function(t){return(0,r.__awaiter)(e,void 0,void 0,(function(){var e,n,i,a=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new ne.SubjectWithoutIdentifierError(t);return this.queryRunner instanceof y.MongoQueryRunner?(n=this.cloneMongoSubjectEntity(t),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete n[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete n[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(n[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(n[t.metadata.deleteDateColumn.propertyName]=null),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,n)]):[3,2];case 1:return e=r.sent(),[3,4];case 2:return i=this.queryRunner.manager.createQueryBuilder().restore().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?i.whereEntity(t.identifier):i.where(t.identifier),[4,i.execute()];case 3:e=r.sent(),r.label=4;case 4:return t.generatedMap=e.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.updateSpecialColumnsInPersistedEntities=function(){var e=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach((function(e){e.entity&&e.metadata.primaryColumns.forEach((function(t){t.setEntityValue(e.entity,void 0)}))})),this.allSubjects.forEach((function(t){t.entity&&(t.metadata.relationIds.forEach((function(e){e.setValue(t.entity)})),e.queryRunner instanceof y.MongoQueryRunner&&t.metadata.objectIdColumn&&t.metadata.objectIdColumn.databaseName&&t.metadata.objectIdColumn.databaseName!==t.metadata.objectIdColumn.propertyName&&delete t.entity[t.metadata.objectIdColumn.databaseName])}))},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach((function(e){e.entity&&(e.metadata.columns.forEach((function(t){e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map((function(e){return e.target})).indexOf(t.target)||t.isVirtual||(t.isNullable&&void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null),e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach((function(t){t.relation.joinColumns.forEach((function(n){!0!==n.isVirtual&&n.setEntityValue(e.entity,t.value instanceof Object?n.referencedColumn.getEntityValue(t.value):t.value)}))})))})),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))}))},e.prototype.groupBulkSubjects=function(e,t){var n={},r=[],i="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach((function(e,t){var a=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[a]?n[a].push(e):(n[a]=[e],r.push(a))})),[n,r]},e}(),he=n(727),pe=function(){function e(e){var t;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,(0,r.__spreadArray)([],(0,r.__read)(e.changeMaps))),this.recompute()}return Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mustBeSoftRemoved",{get:function(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mustBeRecovered",{get:function(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!1,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],r=this.changeMaps.reduce((function(r,i){var a,o=i.value;if(o instanceof e&&(o=o.insertedValueSet?o.insertedValueSet:o.entity),t.metadata.isJunction&&i.column)a=i.column.createValueMap(i.column.referencedColumn.getEntityValue(o));else if(i.column)a=i.column.createValueMap(o);else if(i.relation)if(o instanceof Object&&!(o instanceof Buffer)){var s=i.relation.getRelationIdMap(o);if(void 0===s)return n.push(i),t.canBeUpdated=!0,r;a=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s})}else a=i.relation.createValueMap(o),t.updatedRelationMaps.push({relation:i.relation,value:o});return Z.OrmUtils.mergeDeep(r,a),r}),{});return this.changeMaps=n,r},e.prototype.recompute=function(){var e=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach((function(t){if(t.relationMetadata&&t.relationMetadata.inverseEntityMetadata===e.parentSubject.metadata){var n=t.referencedColumn.getEntityValue(e.parentSubject.entity);t.setEntityValue(e.entityWithFulfilledIds,n)}})),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},e}(),de=n(4291),fe=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.metadata.oneToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0!==i){var a=[];i.forEach((function(i){var o=t.inverseEntityMetadata.getEntityIdMap(i),s=n.subjects.find((function(e){return e.entity===i}));if(s&&(o=s.identifier),o)r.find((function(e){return Z.OrmUtils.compareIds(o,e)}))||(s||(s=new pe({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:o}),n.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),a.push(o);else{if(!s)return;s.changeMaps.push({relation:t.inverseRelation,value:e})}})),de.EntityMetadata.difference(r,a).forEach((function(r){var i=new pe({metadata:t.inverseEntityMetadata,parentSubject:e,identifier:r});t.inverseRelation&&"nullify"!==t.inverseRelation.orphanedRowAction?"delete"===t.inverseRelation.orphanedRowAction&&(i.mustBeRemoved=!0):(i.canBeUpdated=!0,i.changeMaps=[{relation:t.inverseRelation,value:null}]),n.subjects.push(i)}))}},e}(),me=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.metadata.oneToOneRelations.forEach((function(n){n.isOwning||!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=void 0;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));var r=t.getEntityValue(e.entity);if(void 0!==r)if(null!==r){var i=t.inverseEntityMetadata.getEntityIdMap(r),a=this.subjects.find((function(e){return!!e.entity&&e.entity===r}));if(a&&(i=a.identifier),!i){if(!a)return;a.changeMaps.push({relation:t.inverseRelation,value:e})}n&&Z.OrmUtils.compareIds(i,n)||(a||(a=new pe({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:i}),this.subjects.push(a)),a.changeMaps.push({relation:t.inverseRelation,value:e}))}else if(n){var o=new pe({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(o)}},e}(),ye=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.entity&&t.metadata.manyToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&n.getEntityValue(e.databaseEntity).forEach((function(r){var i=new pe({metadata:n.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,r)});t.subjects.push(i)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),Array.isArray(i)){i.forEach((function(i){var a=t.inverseEntityMetadata.getEntityIdMap(i),o=n.subjects.find((function(e){return e.entity===i}));if(o&&(a=o.identifier),(a||o)&&!r.find((function(e){return Z.OrmUtils.compareIds(e,a)}))){var s=t.isOwning?e:o||i,u=t.isOwning?o||i:e,c=new pe({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});n.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach((function(e){c.changeMaps.push({column:e,value:s})})),t.junctionEntityMetadata.inverseColumns.forEach((function(e){c.changeMaps.push({column:e,value:u})}))}}));var a=[];i.forEach((function(e){var r=t.inverseEntityMetadata.getEntityIdMap(e),i=n.subjects.find((function(t){return t.entity===e}));i&&(r=i.identifier),null!=r&&a.push(r)})),r.filter((function(e){return!a.find((function(t){return Z.OrmUtils.compareIds(t,e)}))})).forEach((function(r){var i=new pe({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,r)});n.subjects.push(i)}))}},e.prototype.buildJunctionIdentifier=function(e,t,n){var r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach((function(e){Z.OrmUtils.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))})),t.junctionEntityMetadata.inverseColumns.forEach((function(e){Z.OrmUtils.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))})),a},e}(),ve=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return(0,r.__generator)(this,(function(i){switch(i.label){case 0:return t=this.groupByEntityTargets().map((function(t){return(0,r.__awaiter)(n,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h=this;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:return n=[],i=[],t.subjects.forEach((function(e){!e.databaseEntity&&e.identifier&&(n.push(e.identifier),i.push(e))})),n.length?(a=[],"save"===e||"soft-remove"===e||"recover"===e?t.subjects.forEach((function(e){e.metadata.relations.forEach((function(t){void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===a.indexOf(t.propertyPath)&&a.push(t.propertyPath)}))})):a.push.apply(a,(0,r.__spreadArray)([],(0,r.__read)(t.subjects[0].metadata.manyToManyRelations.map((function(e){return e.propertyPath}))))),o={loadEagerRelations:!1,loadRelationIds:{relations:a,disableMixedMap:!0},withDeleted:!0},[4,this.queryRunner.manager.getRepository(t.target).findByIds(n,o)]):[2];case 1:p.sent().forEach((function(e){h.findByPersistEntityLike(t.target,e).forEach((function(t){t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)}))}));try{for(s=(0,r.__values)(i),u=s.next();!u.done;u=s.next())u.value.databaseEntityLoaded=!0}catch(e){c={error:e}}finally{try{u&&!u.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}}return[2]}}))}))})),[4,Promise.all(t)];case 1:return i.sent(),[2]}}))}))},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.filter((function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))}))},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce((function(e,t){var n=e.find((function(e){return e.target===t.metadata.target}));return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e}),[])},e}(),ge=function(){function e(e){this.allSubjects=e}return e.prototype.build=function(e,t){var n=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach((function(i){var a=(0,r.__read)(i,3),o=a[0],s=a[1],u=a[2];if(null!=s&&(o.isCascadeInsert||o.isCascadeUpdate||o.isCascadeSoftRemove||o.isCascadeRecover)&&s instanceof Object){var c=n.findByPersistEntityLike(u.target,s);if(c)return!1===c.canBeInserted&&(c.canBeInserted=!0===o.isCascadeInsert&&"save"===t),!1===c.canBeUpdated&&(c.canBeUpdated=!0===o.isCascadeUpdate&&"save"===t),!1===c.canBeSoftRemoved&&(c.canBeSoftRemoved=!0===o.isCascadeSoftRemove&&"soft-remove"===t),void(!1===c.canBeRecovered&&(c.canBeRecovered=!0===o.isCascadeRecover&&"recover"===t));var l=new pe({metadata:u,parentSubject:e,entity:s,canBeInserted:!0===o.isCascadeInsert&&"save"===t,canBeUpdated:!0===o.isCascadeUpdate&&"save"===t,canBeSoftRemoved:!0===o.isCascadeSoftRemove&&"soft-remove"===t,canBeRecovered:!0===o.isCascadeRecover&&"recover"===t});n.allSubjects.push(l),n.build(l,t)}}))},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find((function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))}))},e}(),be=function(){function e(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}return e.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h,p,d,f=this;return(0,r.__generator)(this,(function(m){switch(m.label){case 0:return this.entity&&"object"==typeof this.entity?[4,Promise.resolve()]:[2,Promise.reject(new Y.MustBeEntityError(this.mode,this.entity))];case 1:m.sent(),e=this.queryRunner||this.connection.createQueryRunner(),t=e.data,this.options&&this.options.data&&(e.data=this.options.data),m.label=2;case 2:return m.trys.push([2,,22,25]),n=Array.isArray(this.entity)?this.entity:[this.entity],i=this.options&&this.options.chunk&&this.options.chunk>0?Z.OrmUtils.chunk(n,this.options.chunk):[n],[4,Promise.all(i.map((function(t){return(0,r.__awaiter)(f,void 0,void 0,(function(){var n,i,a=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=[],t.forEach((function(e){var t=a.target?a.target:e.constructor;if(t===Object)throw new he.CannotDetermineEntityError(a.mode);n.push(new pe({metadata:a.connection.getMetadata(t),entity:e,canBeInserted:"save"===a.mode,canBeUpdated:"save"===a.mode,mustBeRemoved:"remove"===a.mode,canBeSoftRemoved:"soft-remove"===a.mode,canBeRecovered:"recover"===a.mode}))})),i=new ge(n),n.forEach((function(e){i.build(e,a.mode)})),[4,new ve(e,n).load(this.mode)];case 1:return r.sent(),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new fe(n).build(),new me(n).build(),new ye(n).build()):n.forEach((function(e){e.mustBeRemoved&&new ye(n).buildForAllRemoval(e)})),[2,new le(e,n,this.options)]}}))}))})))];case 3:if(a=m.sent(),0===(o=a.filter((function(e){return e.hasExecutableOperations}))).length)return[2];s=!1,m.label=4;case 4:return m.trys.push([4,16,,21]),e.isTransactionActive||this.options&&!1===this.options.transaction?[3,6]:(s=!0,[4,e.startTransaction()]);case 5:m.sent(),m.label=6;case 6:m.trys.push([6,11,12,13]),u=(0,r.__values)(o),c=u.next(),m.label=7;case 7:return c.done?[3,10]:[4,c.value.execute()];case 8:m.sent(),m.label=9;case 9:return c=u.next(),[3,7];case 10:return[3,13];case 11:return l=m.sent(),p={error:l},[3,13];case 12:try{c&&!c.done&&(d=u.return)&&d.call(u)}finally{if(p)throw p.error}return[7];case 13:return!0!==s?[3,15]:[4,e.commitTransaction()];case 14:m.sent(),m.label=15;case 15:return[3,21];case 16:if(h=m.sent(),!s)return[3,20];m.label=17;case 17:return m.trys.push([17,19,,20]),[4,e.rollbackTransaction()];case 18:case 19:return m.sent(),[3,20];case 20:throw h;case 21:return[3,25];case 22:return e.data=t,this.queryRunner?[3,24]:[4,e.release()];case 23:m.sent(),m.label=24;case 24:return[7];case 25:return[2]}}))}))},e}(),_e=n(9206),we=n(4117),Ee=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new L,this.connection=e,t&&(this.queryRunner=t,_e.ObjectUtils.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(n="string"==typeof e?e:void 0,!(i="function"==typeof e?e:t))throw new g.TypeORMError("Transaction method requires callback in second paramter if isolation level is supplied.");if(this.connection.driver instanceof y.MongoDriver)throw new g.TypeORMError("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new A.QueryRunnerProviderAlreadyReleasedError;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new g.TypeORMError("Cannot start transaction because its already started");a=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,8,13,16]),n?[4,a.startTransaction(n)]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,a.startTransaction()];case 4:r.sent(),r.label=5;case 5:return[4,i(a.manager)];case 6:return o=r.sent(),[4,a.commitTransaction()];case 7:return r.sent(),[2,o];case 8:s=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,a.rollbackTransaction()];case 10:case 11:return r.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,a.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}}))}))},e.prototype.query=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){return[2,this.connection.query(e,t,this.queryRunner)]}))}))},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e,i=this.connection.getMetadata(n);return i.hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e,i=this.connection.getMetadata(n);return i.getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);if(!t)return r.create(this.queryRunner);if(Array.isArray(t))return t.map((function(t){return n.create(e,t)}));var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,r,!0),i},e.prototype.merge=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=this.connection.getMetadata(e);return r.forEach((function(e){return n.plainObjectToEntityTransformer.transform(t,e,a)})),t},e.prototype.preload=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=this.connection.getMetadata(e),[4,new k(this.connection.manager).transform(t,n)];case 1:return(i=r.sent())?[2,this.merge(e,i,t)]:[2,void 0]}}))}))},e.prototype.save=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof we.EntitySchema||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof we.EntitySchema&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new be(this.connection,this.queryRunner,"save",r,i,a).execute().then((function(){return i}))},e.prototype.remove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new be(this.connection,this.queryRunner,"remove",r,i,a).execute().then((function(){return i}))},e.prototype.softRemove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof we.EntitySchema||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof we.EntitySchema&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new be(this.connection,this.queryRunner,"soft-remove",r,i,a).execute().then((function(){return i}))},e.prototype.recover=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof we.EntitySchema||"string"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof we.EntitySchema&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new be(this.connection,this.queryRunner,"recover",r,i,a).execute().then((function(){return i}))},e.prototype.insert=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]}))}))},e.prototype.update=function(e,t,n){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new g.TypeORMError("Empty criteria(s) are not allowed for the update method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()},e.prototype.delete=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new g.TypeORMError("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.softDelete=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new g.TypeORMError("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()},e.prototype.restore=function(e,t){return null==t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new g.TypeORMError("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof t||"number"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()},e.prototype.count=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,j.extractFindManyOptionsAlias(t)||n.name),[2,j.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getCount()]}))}))},e.prototype.find=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,j.extractFindManyOptionsAlias(t)||n.name),j.applyFindManyOptionsOrConditionsToQueryBuilder(i,t),j.isFindManyOptions(t)&&!1===t.loadEagerRelations||j.joinEagerRelations(i,i.alias,n),[2,i.getMany()]}))}))},e.prototype.findAndCount=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,j.extractFindManyOptionsAlias(t)||n.name),j.applyFindManyOptionsOrConditionsToQueryBuilder(i,t),j.isFindManyOptions(t)&&!1===t.loadEagerRelations||j.joinEagerRelations(i,i.alias,n),[2,i.getManyAndCount()]}))}))},e.prototype.findByIds=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a;return(0,r.__generator)(this,(function(r){return t.length?(i=this.connection.getMetadata(e),a=this.createQueryBuilder(e,j.extractFindManyOptionsAlias(n)||i.name),j.applyFindManyOptionsOrConditionsToQueryBuilder(a,n),j.isFindManyOptions(n)&&!1===n.loadEagerRelations||j.joinEagerRelations(a,a.alias,i),[2,a.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]}))}))},e.prototype.findOne=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s,u,c;return(0,r.__generator)(this,(function(l){return i=void 0,j.isFindOneOptions(t)?i=t:n&&j.isFindOneOptions(n)&&(i=n),a=void 0,t instanceof Object&&!j.isFindOneOptions(t)&&(a=t),o=this.connection.getMetadata(e),s=o.name,i&&i.join?s=i.join.alias:n&&j.isFindOneOptions(n)&&n.join&&(s=n.join.alias),u=this.createQueryBuilder(e,s),(c="string"==typeof t||"number"==typeof t||t instanceof Date)||(i=(0,r.__assign)((0,r.__assign)({},i||{}),{take:1})),j.applyOptionsToQueryBuilder(u,i),i&&!1===i.loadEagerRelations||j.joinEagerRelations(u,u.alias,u.expressionMap.mainAlias.metadata),a?u.where(a):c&&u.andWhereInIds(o.ensureEntityIdMap(t)),[2,u.getOne()]}))}))},e.prototype.findOneOrFail=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(r){return[2,this.findOne(e,t,n).then((function(n){return void 0===n?Promise.reject(new O.EntityNotFoundError(e,t)):Promise.resolve(n)}))]}))}))},e.prototype.clear=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(t.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.increment=function(e,t,n,i){return(0,r.__awaiter)(this,void 0,void 0,(function(){var a,o,s,u=this;return(0,r.__generator)(this,(function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new g.TypeORMError("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new g.TypeORMError('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight((function(e,t){var n;return(n={})[t]=e,n}),(function(){return u.connection.driver.escape(o.databaseName)+" + "+i})),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]}))}))},e.prototype.decrement=function(e,t,n,i){return(0,r.__awaiter)(this,void 0,void 0,(function(){var a,o,s,u=this;return(0,r.__generator)(this,(function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new g.TypeORMError("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new g.TypeORMError('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight((function(e,t){var n;return(n={})[t]=e,n}),(function(){return u.connection.driver.escape(o.databaseName)+" - "+i})),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]}))}))},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new K.RepositoryNotFoundError(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find((function(e){return e.metadata===t}));if(n)return n;var r=(new H).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new G.TreeRepositoryNotSupportedError(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof B))throw new J.RepositoryNotTreeError(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=Kt().entityRepositories.find((function(t){return t.target===(e instanceof Function?e:e.constructor)}));if(!t)throw new Q.CustomRepositoryNotFoundError(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof W&&(r.manager||(r.manager=this)),r instanceof S){if(!n)throw new z.CustomRepositoryCannotInheritRepositoryError(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){if(!this.queryRunner)throw new x.NoNeedToReleaseEntityManagerError;return[2,this.queryRunner.release()]}))}))},e}(),Te=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return(0,r.__extends)(t,e),t.prototype.loadDatabase=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.driver.load(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.saveDatabase=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.exportDatabase=function(){return this.driver.export()},t}(Ee),Me=n(5467),Ne=n(8392),Ce=n(95),Re=n(4348),Ae=n(2281),Oe=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),null!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter((function(t){return isNaN(+t)&&"function"!=typeof e.args.options.enum[t]})).map((function(t){return e.args.options.enum[t]})):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isDeleteDate="deleteDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),this.onUpdate||(this.onUpdate=e.connection.driver.mappedDataTypes.updateDateDefault),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&void 0===e.args.options.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}return e.prototype.createValueMap=function(e,t){var n,i=this;if(void 0===t&&(t=!1),this.embeddedMetadata){var a=(0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.parentPropertyNames)),o=function(n,r){var a=n.shift();return a?(r[a]={},o(n,r[a]),r):("increment"!==i.generationStrategy&&"rowid"!==i.generationStrategy||"bigint"!==i.type||null===e||(e=String(e)),r[t?i.databaseName:i.propertyName]=e,r)};return o(a,{})}return"increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||null===e||(e=String(e)),(n={})[t?this.databaseName:this.propertyName]=e,n},e.prototype.getEntityValueMap=function(e,t){var n,i,a=this;if(this.embeddedMetadata){var o=(0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.parentPropertyNames)),s=this.embeddedMetadata.isArray,u=function(e,t){var n,r;if(void 0===t)return{};var i=e.shift();if(i){var o=u(e,t[i]);return Object.keys(o).length>0?((n={})[i]=o,n):{}}return s&&Array.isArray(t)?t.map((function(e){var t;return(t={})[a.propertyName]=e[a.propertyName],t})):void 0!==t[a.propertyName]?((r={})[a.propertyName]=t[a.propertyName],r):{}},c=u(o,e);return Object.keys(c).length>0?c:void 0}return this.relationMetadata&&e[this.relationMetadata.propertyName]&&e[this.relationMetadata.propertyName]instanceof Object?(c=this.relationMetadata.joinColumns.reduce((function(t,n){var r=n.referencedColumn.getEntityValueMap(e[a.relationMetadata.propertyName]);return void 0===r?t:Z.OrmUtils.mergeDeep(t,r)}),{}),Object.keys(c).length>0?((n={})[this.propertyName]=c,n):void 0):void 0!==e[this.propertyName]?((i={})[this.propertyName]=e[this.propertyName],i):void 0},e.prototype.getEntityValue=function(e,t){var n=this;if(void 0===t&&(t=!1),null!=e){var i=void 0;if(this.embeddedMetadata){var a=(0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.parentPropertyNames)),o=this.embeddedMetadata.isArray,s=function(e,t){var n=e.shift();return n&&t?s(e,t[n]):t},u=s(a,e);u&&(i=this.relationMetadata&&this.referencedColumn?!((c=this.relationMetadata.getEntityValue(u))&&c instanceof Object)||c instanceof Ae.FindOperator||c instanceof Buffer?!(u[this.propertyName]&&u[this.propertyName]instanceof Object)||u[this.propertyName]instanceof Ae.FindOperator||u[this.propertyName]instanceof Buffer||u[this.propertyName]instanceof Date?u[this.propertyName]:this.referencedColumn.getEntityValue(u[this.propertyName]):this.referencedColumn.getEntityValue(c):this.referencedColumn?this.referencedColumn.getEntityValue(u[this.propertyName]):o&&Array.isArray(u)?u.map((function(e){return e[n.propertyName]})):u[this.propertyName])}else{var c;i=this.relationMetadata&&this.referencedColumn?!((c=this.relationMetadata.getEntityValue(e))&&c instanceof Object)||c instanceof Ae.FindOperator||c instanceof Function||c instanceof Buffer?!(e[this.propertyName]&&e[this.propertyName]instanceof Object)||e[this.propertyName]instanceof Ae.FindOperator||e[this.propertyName]instanceof Function||e[this.propertyName]instanceof Buffer||e[this.propertyName]instanceof Date?e[this.propertyName]:this.referencedColumn.getEntityValue(e[this.propertyName]):this.referencedColumn.getEntityValue(c):this.referencedColumn?this.referencedColumn.getEntityValue(e[this.propertyName]):e[this.propertyName]}return t&&this.transformer&&(i=ee.ApplyValueTransformers.transformTo(this.transformer,i)),i}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n.propertyName]=t,r)};return i((0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.embeddedMetadataTree)),e)}!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in e||(e[this.propertyName]={}),e[this.propertyName][this.referencedColumn.propertyName]=t):e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof y.MongoDriver&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}(),xe=n(1369),Se=n(8789),Pe=n(2490),qe=function(e,t){this.query=e,this.parameters=t},De=n(2268),Ie=function(){this.upQueries=[],this.downQueries=[]},je=function(){function e(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new Ie}return e.prototype.getTable=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadTables([e])];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables.length>0?this.loadedTables[0]:void 0]}}))}))},e.prototype.getTables=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return e?[3,2]:[4,this.loadTables(e)];case 1:return[2,n.sent()];case 2:return t=this,[4,this.loadTables(e)];case 3:return t.loadedTables=n.sent(),[2,this.loadedTables]}}))}))},e.prototype.getView=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadViews([e])];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews.length>0?this.loadedViews[0]:void 0]}}))}))},e.prototype.getViews=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadViews(e)];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews]}}))}))},e.prototype.enableSqlMemory=function(){this.sqlInMemory=new Ie,this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlInMemory=new Ie,this.sqlMemoryMode=!1},e.prototype.clearSqlMemory=function(){this.sqlInMemory=new Ie},e.prototype.getMemorySql=function(){return this.sqlInMemory},e.prototype.executeMemoryUpSql=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=(0,r.__values)(this.sqlInMemory.upQueries),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(n=t.value,i=n.query,a=n.parameters,[4,this.query(i,a)]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},e.prototype.executeMemoryDownSql=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=(0,r.__values)(this.sqlInMemory.downQueries.reverse()),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(n=t.value,i=n.query,a=n.parameters,[4,this.query(i,a)]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},e.prototype.getCachedView=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(t=this.loadedViews.find((function(t){return t.name===e})))?[2,t]:[4,this.loadViews([e])];case 1:if((n=r.sent()).length>0)return this.loadedViews.push(n[0]),[2,n[0]];throw new q.TypeORMError('View "'+e+'" does not exist.')}}))}))},e.prototype.getCachedTable=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(t=this.loadedTables.find((function(t){return t.name===e})))?[2,t]:[4,this.loadTables([e])];case 1:if((n=r.sent()).length>0)return this.loadedTables.push(n[0]),[2,n[0]];throw new q.TypeORMError('Table "'+e+'" does not exist.')}}))}))},e.prototype.replaceCachedTable=function(e,t){var n=this.loadedTables.find((function(t){return t.name===e.name}));n&&(n.database=t.database,n.schema=t.schema,n.name=t.name,n.columns=t.columns,n.indices=t.indices,n.foreignKeys=t.foreignKeys,n.uniques=t.uniques,n.checks=t.checks,n.justCreated=t.justCreated,n.engine=t.engine)},e.prototype.getTablePath=function(e){return e instanceof l.Table?e.name:e instanceof Se.TableForeignKey?e.referencedTableName:e instanceof de.EntityMetadata?e.tablePath:e},e.prototype.getTypeormMetadataTableName=function(){var e=this.connection.driver.options;return this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database)},e.prototype.isColumnChanged=function(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||e.enum!==t.enum},e.prototype.isDefaultColumnLength=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&this.connection.driver.getColumnLength(r))return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length)&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()},e.prototype.isDefaultColumnPrecision=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.precision&&void 0!==r.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].precision||void 0===this.connection.driver.dataTypeDefaults[t.type].precision)&&this.connection.driver.dataTypeDefaults[t.type].precision===n},e.prototype.isDefaultColumnScale=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.scale&&void 0!==r.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].scale||void 0===this.connection.driver.dataTypeDefaults[t.type].scale)&&this.connection.driver.dataTypeDefaults[t.type].scale===n},e.prototype.executeQueries=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p;return(0,r.__generator)(this,(function(d){switch(d.label){case 0:if(e instanceof qe&&(e=[e]),t instanceof qe&&(t=[t]),(c=this.sqlInMemory.upQueries).push.apply(c,(0,r.__spreadArray)([],(0,r.__read)(e))),(l=this.sqlInMemory.downQueries).push.apply(l,(0,r.__spreadArray)([],(0,r.__read)(t))),!0===this.sqlMemoryMode)return[2,Promise.resolve()];d.label=1;case 1:d.trys.push([1,6,7,8]),n=(0,r.__values)(e),i=n.next(),d.label=2;case 2:return i.done?[3,5]:(a=i.value,o=a.query,s=a.parameters,[4,this.query(o,s)]);case 3:d.sent(),d.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return u=d.sent(),h={error:u},[3,8];case 7:try{i&&!i.done&&(p=n.return)&&p.call(n)}finally{if(h)throw h.error}return[7];case 8:return[2]}}))}))},e}(),Be=n(7764),Le=function(e){function t(){return e.call(this)||this}return(0,r.__extends)(t,e),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(this.isTransactionActive)throw new Ne.TransactionAlreadyStartedError;if(!e)return[3,4];if("READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new g.TypeORMError("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");return"READ UNCOMMITTED"!==e?[3,2]:[4,this.query("PRAGMA read_uncommitted = true")];case 1:return r.sent(),[3,4];case 2:return[4,this.query("PRAGMA read_uncommitted = false")];case 3:r.sent(),r.label=4;case 4:return t=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,6];case 5:r.sent(),r.label=6;case 6:return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 7:return r.sent(),n=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,9];case 8:r.sent(),r.label=9;case 9:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:return n.sent(),this.isTransactionActive=!1,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:return n.sent(),this.isTransactionActive=!1,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.stream=function(e,t,n,r){throw new g.TypeORMError("Stream is not supported by sqlite driver.")},t.prototype.getDatabases=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve(!1)]}))}))},t.prototype.getCurrentDatabase=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve(void 0)]}))}))},t.prototype.hasSchema=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("This driver does not support table schemas")}))}))},t.prototype.getCurrentSchema=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve(void 0)]}))}))},t.prototype.hasTable=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t=e instanceof l.Table?e.name:e,n='SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" = \''+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=e instanceof l.Table?e.name:e,i='PRAGMA table_info("'+n+'")',[4,this.query(i)];case 1:return[2,!!r.sent().find((function(e){return e.name===t}))]}}))}))},t.prototype.createDatabase=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropDatabase=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createSchema=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropSchema=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.__awaiter)(this,void 0,void 0,(function(){var a,o,s=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return a=[],o=[],t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.__awaiter)(this,void 0,void 0,(function(){var a,o,s,u,c,h=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof l.Table?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],c=[],i&&o.indices.forEach((function(e){u.push(h.dropIndexSql(e)),c.push(h.createIndexSql(o,e))})),u.push(this.dropTableSql(o,t)),c.push(this.createTableSql(o,a)),[4,this.executeQueries(u,c)];case 6:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t=e instanceof Pe.View?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).name=t,o=new qe('ALTER TABLE "'+n.name+'" RENAME TO "'+t+'"'),s=new qe('ALTER TABLE "'+t+'" RENAME TO "'+n.name+'"'),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.name=a.name,a.uniques.forEach((function(e){e.name=u.connection.namingStrategy.uniqueConstraintName(a,e.columnNames)})),a.foreignKeys.forEach((function(e){e.name=u.connection.namingStrategy.foreignKeyName(a,e.columnNames,u.getTablePath(e),e.referencedColumnNames)})),a.indices.forEach((function(e){e.name=u.connection.namingStrategy.indexName(a,e.columnNames,e.where)})),[4,this.recreateTable(a,n)];case 5:return r.sent(),[2]}}))}))},t.prototype.addColumn=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,this.addColumns(n,[t])]}}))}))},t.prototype.addColumns=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addColumn(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof Re.TableColumn?t:i.columns.find((function(e){return e.name===t}))))throw new g.TypeORMError('Column "'+t+'" was not found in the "'+i.name+'" table.');return s=void 0,n instanceof Re.TableColumn?s=n:(s=o.clone()).name=n,[2,this.changeColumn(i,o,s)]}}))}))},t.prototype.changeColumn=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof Re.TableColumn?t:i.columns.find((function(e){return e.name===t}))))throw new g.TypeORMError('Column "'+t+'" was not found in the "'+i.name+'" table.');return[4,this.changeColumns(i,[{oldColumn:o,newColumn:n}])];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumns=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){e.newColumn.name!==e.oldColumn.name&&(a.findColumnUniques(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.uniqueConstraintName(a,t.columnNames)})),a.findColumnForeignKeys(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.foreignKeyName(a,t.columnNames,o.getTablePath(t),t.referencedColumnNames)})),a.findColumnIndices(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.indexName(a,t.columnNames,t.where)})));var t=a.columns.find((function(t){return t.name===e.oldColumn.name}));t&&(a.columns[a.columns.indexOf(t)]=e.newColumn)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Re.TableColumn?t:n.findColumnByName(t)))throw new g.TypeORMError('Column "'+t+'" was not found in table "'+n.name+'"');return[4,this.dropColumns(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropColumns=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){var t=e instanceof Re.TableColumn?e:n.findColumnByName(e);if(!t)throw new Error('Column "'+e+'" was not found in table "'+n.name+'"');a.removeColumn(t),a.findColumnUniques(t).forEach((function(e){return a.removeUniqueConstraint(e)})),a.findColumnIndices(t).forEach((function(e){return a.removeIndex(e)})),a.findColumnForeignKeys(t).forEach((function(e){return a.removeForeignKey(e)}))})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),n.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return(i=(t=n).clone()).primaryColumns.forEach((function(e){e.isPrimary=!1})),[4,this.recreateTable(i,t)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.createUniqueConstraints(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addUniqueConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof De.TableUnique?t:n.uniques.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied unique constraint was not found in table "+n.name);return[4,this.dropUniqueConstraints(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeUniqueConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.createCheckConstraints(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addCheckConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Be.TableCheck?t:n.checks.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied check constraint was not found in table "+n.name);return[4,this.dropCheckConstraints(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeCheckConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Sqlite does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Sqlite does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Sqlite does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Sqlite does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.createForeignKeys(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addForeignKey(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Se.TableForeignKey?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied foreign key was not found in table "+n.name);return[4,this.dropForeignKeys(e,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeForeignKey(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof xe.TableIndex?t:n.indices.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return r.sent(),[4,this.startTransaction()];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,9,14,16]),[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 4:return e=r.sent(),[4,Promise.all(e.map((function(e){return i.query(e.query)})))];case 5:return r.sent(),[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 6:return t=r.sent(),[4,Promise.all(t.map((function(e){return i.query(e.query)})))];case 7:return r.sent(),[4,this.commitTransaction()];case 8:return r.sent(),[3,16];case 9:n=r.sent(),r.label=10;case 10:return r.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:case 12:return r.sent(),[3,13];case 13:throw n;case 14:return[4,this.query("PRAGMA foreign_keys = ON;")];case 15:return r.sent(),[7];case 16:return[2]}}))}))},t.prototype.loadViews=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(e||(e=[]),t=e.map((function(e){return"'"+e+"'"})).join(", "),n='SELECT "t".* FROM "'+this.getTypeormMetadataTableName()+'" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = \'view\' WHERE "t"."type" = \'VIEW\'',t.length>0&&(n+=' AND "t"."name" IN ('+t+")"),[4,this.query(n)]):[2,[]];case 2:return[2,r.sent().map((function(e){var t=new Pe.View;return t.name=e.name,t.expression=e.value,t}))]}}))}))},t.prototype.loadTables=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,h,p,d,f,m,y=this;return(0,r.__generator)(this,(function(v){switch(v.label){case 0:return e&&0===e.length?[2,[]]:(t=[],e?[3,2]:(u='SELECT * FROM "sqlite_master" WHERE "type" = \'table\'',i=(n=t.push).apply,a=[t],o=[[]],[4,this.query(u)]));case 1:return i.apply(n,a.concat([r.__spreadArray.apply(void 0,o.concat([r.__read.apply(void 0,[v.sent()])]))])),[3,4];case 2:return s=e.map((function(e){return"'"+e+"'"})).join(", "),u='SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" IN ('+s+")",h=(c=t.push).apply,p=[t],d=[[]],[4,this.query(u)];case 3:h.apply(c,p.concat([r.__spreadArray.apply(void 0,d.concat([r.__read.apply(void 0,[v.sent()])]))])),v.label=4;case 4:return 0===t.length?[2,[]]:(f=t.map((function(e){return"'"+e.name+"'"})).join(", "),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'index\' AND "tbl_name" IN ('+f+")")]);case 5:return m=v.sent(),[2,Promise.all(t.map((function(e){return(0,r.__awaiter)(y,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,h,p,d,f,y,v,g,b,_,w,E,T,M,N=this;return(0,r.__generator)(this,(function(C){switch(C.label){case 0:return(t=new l.Table).name=e.name,n=e.sql,[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:for(i=r.__read.apply(void 0,[C.sent(),3]),a=i[0],o=i[1],s=i[2],u=void 0,c=e.sql,-1!==(h=c.toUpperCase().indexOf("AUTOINCREMENT"))&&(u=c.substr(0,h),p=u.lastIndexOf(","),d=u.lastIndexOf("("),-1!==p?u=(u=(u=u.substr(p)).substr(0,u.lastIndexOf('"'))).substr(u.indexOf('"')+1):-1!==d&&(u=(u=(u=u.substr(d)).substr(0,u.lastIndexOf('"'))).substr(u.indexOf('"')+1))),t.columns=a.map((function(e){var t=new Re.TableColumn;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=u===e.name,t.isGenerated&&(t.generationStrategy="increment"),"varchar"===t.type){var r=n.match(new RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\\1\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));r&&(t.enum=r[2].substr(1,r[2].length-2).split("','"))}var i=t.type.indexOf("(");if(-1!==i){var a=t.type,o=a.substr(0,i);if(N.driver.withLengthColumnTypes.find((function(e){return e===o}))){var s=parseInt(a.substring(i+1,a.length-1));s&&(t.length=s.toString(),t.type=o)}if(N.driver.withPrecisionColumnTypes.find((function(e){return e===o}))){var c=new RegExp("^"+o+"\\((\\d+),?\\s?(\\d+)?\\)"),l=a.match(c);l&&l[1]&&(t.precision=+l[1]),N.driver.withScaleColumnTypes.find((function(e){return e===o}))&&l&&l[2]&&(t.scale=+l[2]),t.type=o}}return t})),f=Z.OrmUtils.uniq(s,(function(e){return e.id})),t.foreignKeys=f.map((function(e){var n=s.filter((function(t){return t.id===e.id&&t.table===e.table})),r=n.map((function(e){return e.from})),i=n.map((function(e){return e.to})),a=N.connection.namingStrategy.foreignKeyName(t,r,e.referencedTableName,e.referencedColumnNames);return new Se.TableForeignKey({name:a,columnNames:r,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})})),v=[],g=/CONSTRAINT "([^"]*)" UNIQUE \((.*?)\)/g;null!==(y=g.exec(n));)v.push({name:y[1],columns:y[2].substr(1,y[2].length-2).split('", "')});return b=o.filter((function(e){return"u"===e.origin})).map((function(e){return e.name})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return(0,r.__awaiter)(N,void 0,void 0,(function(){var n,i,a,s,u;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=o.find((function(t){return t.name===e})),[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return i=r.sent(),1===(a=i.sort((function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)})).map((function(e){return e.name}))).length&&(s=t.columns.find((function(e){return!!a.find((function(t){return t===e.name}))})))&&(s.isUnique=!0),u=v.find((function(e){return e.columns.every((function(e){return-1!==a.indexOf(e)}))})),[2,new De.TableUnique({name:u?u.name:this.connection.namingStrategy.uniqueConstraintName(t,a),columnNames:a})]}}))}))})),_=t,[4,Promise.all(b)];case 2:for(_.uniques=C.sent(),E=/CONSTRAINT "([^"]*)" CHECK (\(.*?\))([,]|[)]$)/g;null!==(w=E.exec(n));)t.checks.push(new Be.TableCheck({name:w[1],expression:w[2]}));return T=o.filter((function(e){return"c"===e.origin})).map((function(e){return e.name})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return(0,r.__awaiter)(N,void 0,void 0,(function(){var n,i,a,s,u,c;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=m.find((function(t){return t.name===e})),i=/WHERE (.*)/.exec(n.sql),a=o.find((function(t){return t.name===e})),[4,this.query('PRAGMA index_info("'+a.name+'")')];case 1:return s=r.sent(),u=s.sort((function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)})).map((function(e){return e.name})),c="1"===a.unique||1===a.unique,[2,new xe.TableIndex({table:t,name:a.name,columnNames:u,isUnique:c,where:i?i[1]:void 0})]}}))}))})),[4,Promise.all(T)];case 3:return M=C.sent(),t.indices=M.filter((function(e){return!!e})),[2,t]}}))}))})))]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.filter((function(e){return e.isPrimary})),i=r.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})),a=r.length>1;if(a&&i)throw new g.TypeORMError("Sqlite does not support AUTOINCREMENT on composite primary key");var o=e.columns.map((function(e){return n.buildCreateColumnSql(e,a)})).join(", "),s='CREATE TABLE "'+e.name+'" ('+o;e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new De.TableUnique({name:n.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0&&(s+=", "+e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", ")),e.checks.length>0&&(s+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e,t.expression))+'" CHECK ('+t.expression+")"})).join(", ")),e.foreignKeys.length>0&&t&&(s+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e,t.columnNames,n.getTablePath(t),t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a})).join(", ")),r.length>1&&(s+=", PRIMARY KEY ("+r.map((function(e){return'"'+e.name+'"'})).join(", ")+")"),s+=")";var u=this.connection.entityMetadatas.find((function(t){return n.getTablePath(e)===n.getTablePath(t)}));return u&&u.withoutRowid&&(s+=" WITHOUT ROWID"),new qe(s)},t.prototype.dropTableSql=function(e,t){var n=e instanceof l.Table?e.name:e;return new qe(t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"')},t.prototype.createViewSql=function(e){return"string"==typeof e.expression?new qe('CREATE VIEW "'+e.name+'" AS '+e.expression):new qe('CREATE VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=(0,r.__read)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new qe(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof Pe.View?e.name:e;return new qe('DROP VIEW "'+t+'"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof Pe.View?e.name:e,n=this.connection.createQueryBuilder(),i=(0,r.__read)(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape("type")+" = 'VIEW'").andWhere(n.escape("name")+" = :name",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new qe(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new qe("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e){var t=e instanceof xe.TableIndex?e.name:e;return new qe('DROP INDEX "'+t+'"')},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return n+=e instanceof Oe?" "+this.driver.normalizeType(e):" "+this.connection.driver.createFullType(e),e.enum&&(n+=" CHECK( "+e.name+" IN ("+e.enum.map((function(e){return"'"+e+"'"})).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n},t.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s,u=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return i=[],a=[],t.indices.forEach((function(e){i.push(u.dropIndexSql(e)),a.push(u.createIndexSql(t,e))})),e.name="temporary_"+e.name,i.push(this.createTableSql(e,!0)),a.push(this.dropTableSql(e)),n&&(o=e.columns.map((function(e){return'"'+e.name+'"'})).join(", "),s=t.columns.map((function(e){return'"'+e.name+'"'})).join(", "),t.columns.length<e.columns.length?o=e.columns.filter((function(e){return t.columns.find((function(t){return t.name===e.name}))})).map((function(e){return'"'+e.name+'"'})).join(", "):t.columns.length>e.columns.length&&(s=t.columns.filter((function(t){return e.columns.find((function(e){return e.name===t.name}))})).map((function(e){return'"'+e.name+'"'})).join(", ")),i.push(new qe('INSERT INTO "'+e.name+'"('+o+") SELECT "+s+' FROM "'+t.name+'"')),a.push(new qe('INSERT INTO "'+t.name+'"('+s+") SELECT "+o+' FROM "'+e.name+'"'))),i.push(this.dropTableSql(t)),a.push(this.createTableSql(t,!0)),i.push(new qe('ALTER TABLE "'+e.name+'" RENAME TO "'+t.name+'"')),a.push(new qe('ALTER TABLE "'+t.name+'" RENAME TO "'+e.name+'"')),e.name=t.name,e.indices.forEach((function(t){t.name||(t.name=u.connection.namingStrategy.indexName(e,t.columnNames,t.where)),i.push(u.createIndexSql(e,t)),a.push(u.dropIndexSql(t))})),[4,this.executeQueries(i,a)];case 1:return r.sent(),this.replaceCachedTable(t,e),[2]}}))}))},t}(je),Ue=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,n){var r=this;n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var a=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))},e.prototype.broadcastBeforeUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(s){if(o.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){var u=s.beforeUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}}))},e.prototype.broadcastBeforeRemoveEvent=function(e,t,n,r){var i=this;n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(a){if(i.isAllowedSubscriber(a,t.target)&&a.beforeRemove){var o=a.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}}))},e.prototype.broadcastAfterInsertEvent=function(e,t,n){var r=this;n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterInsert){var a=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))},e.prototype.broadcastBeforeTransactionStartEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.beforeTransactionStart){var r=n.beforeTransactionStart({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterTransactionStartEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.afterTransactionStart){var r=n.afterTransactionStart({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastBeforeTransactionCommitEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.beforeTransactionCommit){var r=n.beforeTransactionCommit({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterTransactionCommitEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.afterTransactionCommit){var r=n.afterTransactionCommit({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastBeforeTransactionRollbackEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.beforeTransactionRollback){var r=n.beforeTransactionRollback({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterTransactionRollbackEvent=function(e){var t=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(n){if(n.afterTransactionRollback){var r=n.afterTransactionRollback({connection:t.queryRunner.connection,queryRunner:t.queryRunner,manager:t.queryRunner.manager});r instanceof Promise&&e.promises.push(r),e.count++}}))},e.prototype.broadcastAfterUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(s){if(o.isAllowedSubscriber(s,t.target)&&s.afterUpdate){var u=s.afterUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}}))},e.prototype.broadcastAfterRemoveEvent=function(e,t,n,r){var i=this;n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(a){if(i.isAllowedSubscriber(a,t.target)&&a.afterRemove){var o=a.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}}))},e.prototype.broadcastLoadEventsForAll=function(e,t,n){var r=this;n.forEach((function(n){n instanceof Promise||(t.relations.length&&t.relations.forEach((function(t){if(!t.isLazy||n.hasOwnProperty(t.propertyName)){var i=t.getEntityValue(n);i instanceof Object&&r.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,Array.isArray(i)?i:[i])}})),t.afterLoadListeners.length&&t.afterLoadListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterLoad){var a=i.afterLoad(n,{connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})))}))},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}(),Fe=n(8746),ke=function(){this.records=[]},Qe=function(e){function t(t){var n=e.call(this)||this;return n.isDirty=!1,n.driver=t,n.connection=t.connection,n.broadcaster=new Ue(n),n}return(0,r.__extends)(t,e),t.prototype.flush=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return this.isDirty?[4,this.driver.autoSave()]:[3,2];case 1:e.sent(),this.isDirty=!1,e.label=2;case 2:return[2]}}))}))},t.prototype.release=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.flush()];case 1:return t.sent(),[2,e.prototype.release.call(this)]}}))}))},t.prototype.commitTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.flush()];case 2:return t.sent(),[2]}}))}))},t.prototype.query=function(e,t,n){var i=this;if(void 0===t&&(t=[]),void 0===n&&(n=!1),this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;var a=e.trim().split(" ",1)[0];return new Promise((function(o,s){return(0,r.__awaiter)(i,void 0,void 0,(function(){var i,u,c,l,h,p,d,f;return(0,r.__generator)(this,(function(r){i=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),u=+new Date;try{for(c=i.prepare(e),t&&(t=t.map((function(e){return void 0!==e?e:null})),c.bind(t)),l=this.driver.options.maxQueryExecutionTime,h=+new Date,p=h-u,l&&p>l&&this.driver.connection.logger.logQuerySlow(p,e,t,this),d=[];c.step();)d.push(c.getAsObject());(f=new ke).affected=i.getRowsModified(),f.records=d,f.raw=d,c.free(),"SELECT"!==a&&(this.isDirty=!0),o(n?f:f.raw)}catch(n){c&&c.free(),this.driver.connection.logger.logQueryError(n,e,t,this),s(new Fe.QueryFailedError(e,t,n))}return[2]}))}))}))},t}(Le),Ve=n(8323),We=n(1545),ze=function(e){function t(t){var n=e.call(this,t)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new We.DriverOptionNotSetError("location or autoSaveCallback");return n.loadDependencies(),n}return(0,r.__extends)(t,e),t.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}}))}))},t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(e){n(e)}}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Qe(this)),this.queryRunner},t.prototype.load=function(e,t){return void 0===t&&(t=!0),(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if("string"!=typeof e)return[3,8];if("node"!==o.type)return[3,1];if(o.fileExist(e))return n=o.readFileSync(e),[2,this.createDatabaseConnectionWithImport(n)];if(t)throw new g.TypeORMError("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 1:return i=null,this.options.useLocalForage?window.localforage?[4,window.localforage.getItem(e)]:[3,3]:[3,5];case 2:return i=r.sent(),[3,4];case 3:throw new g.TypeORMError("localforage is not defined - please import localforage.js into your site");case 4:return[3,6];case 5:i=o.getGlobalVariable().localStorage.getItem(e),r.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(t)throw new g.TypeORMError("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}}))}))},t.prototype.save=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(!e&&!this.options.location)throw new g.TypeORMError("No location is set, specify a location parameter or add the location option to your configuration");if(t="",e?t=e:this.options.location&&(t=this.options.location),"node"!==o.type)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),n=Buffer.from(this.databaseConnection.export()),[4,o.writeFile(t,n)];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),new g.TypeORMError("Could not save database, error: "+i);case 4:return[3,10];case 5:return a=this.databaseConnection.export(),s=[].slice.call(a),this.options.useLocalForage?window.localforage?[4,window.localforage.setItem(t,JSON.stringify(s))]:[3,7]:[3,9];case 6:return r.sent(),[3,8];case 7:throw new g.TypeORMError("localforage is not defined - please import localforage.js into your site");case 8:return[3,10];case 9:o.getGlobalVariable().localStorage.setItem(t,JSON.stringify(s)),r.label=10;case 10:return[2]}}))}))},t.prototype.autoSave=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))},t.prototype.export=function(){return this.databaseConnection.export()},t.prototype.createGeneratedMap=function(e,t){var n=this,r=e.generatedColumns.reduce((function(e,t){if(t.isPrimary&&"increment"===t.generationStrategy){var r="SELECT last_insert_rowid()";try{var i=n.databaseConnection.exec(r);return n.connection.logger.logQuery(r),Z.OrmUtils.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(e){n.connection.logger.logQueryError(e,r,[])}}return e}),{});return Object.keys(r).length>0?r:void 0},t.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},t.prototype.createDatabaseConnectionWithImport=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return"function"==typeof this.sqlite.Database?(n=this.sqlite,[3,3]):[3,1];case 1:return[4,this.sqlite(this.options.sqlJsConfig)];case 2:n=r.sent(),r.label=3;case 3:return t=n,e&&e.length>0?this.databaseConnection=new t.Database(e):this.databaseConnection=new t.Database,[2,new Promise((function(e,t){try{i.databaseConnection.exec("PRAGMA foreign_keys = ON;"),e(i.databaseConnection)}catch(e){t(e)}}))]}}))}))},t.prototype.loadDependencies=function(){if("browser"===o.type)this.sqlite=window.SQL;else try{this.sqlite=o.load("sql.js")}catch(e){throw new Ve.DriverPackageNotInstalledError("sql.js","sql.js")}},t}(P.AbstractSqliteDriver),Ke=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof y.MongoDriver?new y.MongoEntityManager(e):e.driver instanceof ze?new Te(e,t):new Ee(e,t)},e}(),Je=n(2732),He=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Ue(n),n}return(0,r.__extends)(t,e),t.prototype.query=function(e,t,n){return void 0===n&&(n=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){var i=this;return(0,r.__generator)(this,(function(a){if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return[2,new Promise((function(a,o){return(0,r.__awaiter)(i,void 0,void 0,(function(){var i,s,u=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return i=r.sent(),this.driver.connection.logger.logQuery(e,t,this),s=+new Date,i.executeSql(e,t,(function(r){var i=u.driver.options.maxQueryExecutionTime,o=+new Date-s;i&&o>i&&u.driver.connection.logger.logQuerySlow(o,e,t,u);var c=new ke;if("INSERT INTO"===e.substr(0,11))c.raw=r.insertId;else{for(var l=[],h=0;h<r.rows.length;h++)l.push(r.rows.item(h));c.records=l,c.raw=l}a(n?c:c.raw)}),(function(n){u.driver.connection.logger.logQueryError(n,e,t,u),o(new Fe.QueryFailedError(e,t,n))})),[2]}}))}))}))]}))}))},t.prototype.startTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Transactions are not supported by the Cordova driver")}))}))},t.prototype.commitTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Transactions are not supported by the Cordova driver")}))}))},t.prototype.rollbackTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){throw new g.TypeORMError("Transactions are not supported by the Cordova driver")}))}))},t.prototype.clearDatabase=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,,7,9]),[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 3:return e=r.sent(),[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 4:return t=r.sent(),[4,Promise.all(e.map((function(e){return n.query(e.query)})))];case 5:return r.sent(),[4,Promise.all(t.map((function(e){return n.query(e.query)})))];case 6:return r.sent(),[3,9];case 7:return[4,this.query("PRAGMA foreign_keys = ON;")];case 8:return r.sent(),[7];case 9:return[2]}}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Le),Ge=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new We.DriverOptionNotSetError("database");if(!n.options.location)throw new We.DriverOptionNotSetError("location");return n.loadDependencies(),n}return(0,r.__extends)(t,e),t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new He(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,(function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],(function(e){t(r)}),(function(e){n(e)}))}),(function(e){n(e)}))}))},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new Ve.DriverPackageNotInstalledError("Cordova-SQLite","cordova-sqlite-storage")}},t}(P.AbstractSqliteDriver),Ye=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Ue(n),n}return(0,r.__extends)(t,e),t.prototype.query=function(e,t,n){var i=this;if(void 0===n&&(n=!1),this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return new Promise((function(a,o){return(0,r.__awaiter)(i,void 0,void 0,(function(){var i,s,u=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return i=r.sent(),this.driver.connection.logger.logQuery(e,t,this),s=+new Date,i.executeSql(e,t,(function(r){var i=u.driver.options.maxQueryExecutionTime,o=+new Date-s;i&&o>i&&u.driver.connection.logger.logQuerySlow(o,e,t,u);var c=new ke;if("INSERT INTO"===e.substr(0,11)&&(c.raw=r.insertId),(null==r?void 0:r.hasOwnProperty("rowsAffected"))&&(c.affected=r.rowsAffected),null==r?void 0:r.hasOwnProperty("rows")){for(var l=[],h=0;h<r.rows.length;h++)l.push(r.rows.item(h));c.raw=l,c.records=l}a(n?c:c.raw)}),(function(n){u.driver.connection.logger.logQueryError(n,e,t,u),o(new Fe.QueryFailedError(e,t,n))})),[2]}}))}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Le),$e=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new We.DriverOptionNotSetError("database");if(!n.options.location)throw new We.DriverOptionNotSetError("location");return n.loadDependencies(),n}return(0,r.__extends)(t,e),t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Ye(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,(function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],(function(e){t(r)}),(function(e){n(e)}))}),(function(e){n(e)}))}))},t.prototype.loadDependencies=function(){try{this.sqlite=n(7021)}catch(e){throw new Ve.DriverPackageNotInstalledError("React-Native","react-native-sqlite-storage")}},t}(P.AbstractSqliteDriver),Xe=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Ue(n),n}return(0,r.__extends)(t,e),t.prototype.query=function(e,t,n){return void 0===n&&(n=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a=this;return(0,r.__generator)(this,(function(r){if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return i=this.driver.connection,[2,new Promise((function(r,o){var s="INSERT INTO"===e.substr(0,11),u=function(a,u){var l=this.driver.options.maxQueryExecutionTime,h=+new Date-c;if(l&&h>l&&i.logger.logQuerySlow(h,e,t,this),a)i.logger.logQueryError(a,e,t,this),o(new Fe.QueryFailedError(e,t,a));else{var p=new ke;p.raw=u,!s&&Array.isArray(u)&&(p.records=u),r(n?p:p.raw)}};a.driver.connection.logger.logQuery(e,t,a);var c=+new Date;a.connect().then((function(n){s?n.execSQL(e,t,u):n.all(e,t,u)}))}))]}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Le),Ze=function(e){function t(t){var n=e.call(this,t)||this;if(n.connection=t,n.options=t.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new We.DriverOptionNotSetError("database");return n.loadDependencies(),n}return(0,r.__extends)(t,e),t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close().then(t).catch(n)}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Xe(this)),this.queryRunner},t.prototype.normalizeType=function(t){return t.type===Buffer?"blob":e.prototype.normalizeType.call(this,t)},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{readOnly:e.options.readOnly,key:e.options.key,multithreading:e.options.multithreading,migrate:e.options.migrate,iosFlags:e.options.iosFlags,androidFlags:e.options.androidFlags},e.options.extra||{});new e.sqlite(e.options.database,r,(function(r,i){if(r)return n(r);i.resultType(e.sqlite.RESULTSASOBJECT),i.execSQL("PRAGMA foreign_keys = ON;",[],(function(e,r){if(e)return n(e);t(i)}))}))}))},t.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new Ve.DriverPackageNotInstalledError("Nativescript","nativescript-sqlite")},t}(P.AbstractSqliteDriver),et=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Ue(n),n}return(0,r.__extends)(t,e),t.prototype.startTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(this.isTransactionActive&&void 0!==this.transaction)throw new Ne.TransactionAlreadyStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionStartEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!0,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!1,this.transaction=void 0,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!1,this.transaction=void 0,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},t.prototype.query=function(e,t,n){return void 0===n&&(n=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){var i=this;return(0,r.__generator)(this,(function(a){if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return[2,new Promise((function(a,o){return(0,r.__awaiter)(i,void 0,void 0,(function(){var i,s,u=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return i=r.sent(),this.driver.connection.logger.logQuery(e,t,this),s=+new Date,i.transaction((function(r){void 0===u.transaction&&(u.startTransaction(),u.transaction=r),u.transaction.executeSql(e,t,(function(r,i){var o=u.driver.options.maxQueryExecutionTime,c=+new Date-s;o&&c>o&&u.driver.connection.logger.logQuerySlow(c,e,t,u);var l=new ke;if("INSERT INTO"===e.substr(0,11)&&(l.raw=i.insertId),(null==i?void 0:i.hasOwnProperty("rowsAffected"))&&(l.affected=i.rowsAffected),null==i?void 0:i.hasOwnProperty("rows")){for(var h=[],p=0;p<i.rows.length;p++)h.push(i.rows.item(p));l.raw=h,l.records=h}a(n?l:l.raw)}),(function(n,r){u.driver.connection.logger.logQueryError(r,e,t,u),o(new Fe.QueryFailedError(e,t,r))}))}),(function(e){u.rollbackTransaction()}),(function(){u.isTransactionActive=!1,u.transaction=void 0})),[2]}}))}))}))]}))}))},t}(Le),tt=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new We.DriverOptionNotSetError("database");if(!n.options.driver)throw new We.DriverOptionNotSetError("driver");return n.sqlite=n.options.driver,n}return(0,r.__extends)(t,e),t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){try{e.queryRunner=void 0,e.databaseConnection._db.close(),e.databaseConnection=void 0,t()}catch(e){n(e)}}))]}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new et(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){try{var r=e.sqlite.openDatabase(e.options.database);r.transaction((function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],(function(e,n){t(r)}),(function(e,t){n({transaction:e,error:t})}))}),(function(e){n(e)}))}catch(e){n(e)}}))},t}(P.AbstractSqliteDriver),nt=n(870),rt=function(){function e(){}return e.isGreaterOrEqual=function(e,t){var n=it(e),r=it(t);return n[0]>r[0]||n[0]===r[0]&&n[1]>r[1]||n[0]===r[0]&&n[1]===r[1]&&n[2]>=r[2]},e}();function it(e){void 0===e&&(e="");var t=[0,0,0];return e.split(".").forEach((function(e,n){return t[n]=parseInt(e,10)})),t}var at=function(e){function t(t,n,r){var i=e.call(this,t,r)||this;return i.client=n,i}return(0,r.__extends)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((function(t){var n=(0,r.__read)(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((function(t){var n=(0,r.__read)(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection}))),this.databaseConnectionPromise)},t.prototype.startTransaction=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(this.isTransactionActive)throw new Ne.TransactionAlreadyStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionStartEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.isTransactionActive=!0,[4,this.client.startTransaction()];case 3:return n.sent(),t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.client.commitTransaction()];case 3:return n.sent(),this.isTransactionActive=!1,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.client.rollbackTransaction()];case 3:return n.sent(),t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.query=function(e,t,n){return void 0===n&&(n=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return[4,this.client.query(e,t)];case 1:return i=r.sent(),(a=new ke).raw=i,(null==i?void 0:i.hasOwnProperty("records"))&&Array.isArray(i.records)&&(a.records=i.records),(null==i?void 0:i.hasOwnProperty("numberOfRecordsUpdated"))&&(a.affected=i.numberOfRecordsUpdated),n?[2,a]:[2,a.raw]}}))}))},t}(function(e){function t(t,n){return e.call(this,t,n)||this}return(0,r.__extends)(t,e),t}(function(e){function t(t,n){var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.mode=n,r.broadcaster=new Ue(r),r}return(0,r.__extends)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((function(t){var n=(0,r.__read)(t,2),i=n[0],a=n[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=i;var o=function(t){return e.releasePostgresConnection(t)};return e.releaseCallback=function(){e.databaseConnection.removeListener("error",o),a()},e.databaseConnection.on("error",o),e.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((function(t){var n=(0,r.__read)(t,2),i=n[0],a=n[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=i;var o=function(t){return e.releasePostgresConnection(t)};return e.releaseCallback=function(){e.databaseConnection.removeListener("error",o),a()},e.databaseConnection.on("error",o),e.databaseConnection}))),this.databaseConnectionPromise)},t.prototype.releasePostgresConnection=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){return this.isReleased||(this.isReleased=!0,this.releaseCallback&&(this.releaseCallback(e),this.releaseCallback=void 0),-1!==(t=this.driver.connectedQueryRunners.indexOf(this))&&this.driver.connectedQueryRunners.splice(t,1)),[2]}))}))},t.prototype.release=function(){return this.releasePostgresConnection()},t.prototype.startTransaction=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(this.isTransactionActive)throw new Ne.TransactionAlreadyStartedError;return t=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionStartEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 3:return r.sent(),e?[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)]:[3,5];case 4:r.sent(),r.label=5;case 5:return n=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))},t.prototype.commitTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("COMMIT")];case 3:return n.sent(),this.isTransactionActive=!1,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionCommitEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isTransactionActive)throw new Ce.TransactionNotStartedError;return e=new ie.BroadcasterResult,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:return n.sent(),this.isTransactionActive=!1,t=new ie.BroadcasterResult,this.broadcaster.broadcastAfterTransactionRollbackEvent(t),t.promises.length>0?[4,Promise.all(t.promises)]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.query=function(e,t,n){return void 0===n&&(n=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s,u,c,l,h;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return[4,this.connect()];case 1:i=r.sent(),this.driver.connection.logger.logQuery(e,t,this),r.label=2;case 2:return r.trys.push([2,4,,5]),a=+new Date,[4,i.query(e,t)];case 3:switch(o=r.sent(),s=this.driver.options.maxQueryExecutionTime,u=+new Date,c=u-a,s&&c>s&&this.driver.connection.logger.logQuerySlow(c,e,t,this),l=new ke,(null==o?void 0:o.hasOwnProperty("rows"))&&(l.records=o.rows),(null==o?void 0:o.hasOwnProperty("rowCount"))&&(l.affected=o.rowCount),o.command){case"DELETE":case"UPDATE":l.raw=[o.rows,o.rowCount];break;default:l.raw=o.rows}return n?[2,l]:[2,l.raw];case 4:throw h=r.sent(),this.driver.connection.logger.logQueryError(h,e,t,this),new Fe.QueryFailedError(e,t,h);case 5:return[2]}}))}))},t.prototype.stream=function(e,t,n,i){var a=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return new Promise((function(s,u){return(0,r.__awaiter)(a,void 0,void 0,(function(){var a,c,l;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return a=r.sent(),this.driver.connection.logger.logQuery(e,t,this),c=a.query(new o(e,t)),n&&c.on("end",n),i&&c.on("error",i),s(c),[3,3];case 2:return l=r.sent(),u(l),[3,3];case 3:return[2]}}))}))}))},t.prototype.getDatabases=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.query("SELECT * FROM pg_database WHERE datname='"+e+"';")];case 1:return[2,!!t.sent().length]}}))}))},t.prototype.getCurrentDatabase=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.query("SELECT * FROM current_database()")];case 1:return[2,e.sent()[0].current_database]}}))}))},t.prototype.hasSchema=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = \''+e+"'")];case 1:return[2,!!t.sent().length]}}))}))},t.prototype.getCurrentSchema=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return[2,e.sent()[0].current_schema]}}))}))},t.prototype.hasTable=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(t=this.driver.parseTableName(e)).schema?[3,2]:(n=t,[4,this.getCurrentSchema()]);case 1:n.schema=r.sent(),r.label=2;case 2:return i='SELECT * FROM "information_schema"."tables" WHERE "table_schema" = \''+t.schema+"' AND \"table_name\" = '"+t.tableName+"'",[4,this.query(i)];case 3:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=this.driver.parseTableName(e)).schema?[3,2]:(i=n,[4,this.getCurrentSchema()]);case 1:i.schema=r.sent(),r.label=2;case 2:return a='SELECT * FROM "information_schema"."columns" WHERE "table_schema" = \''+n.schema+"' AND \"table_name\" = '"+n.tableName+"' AND \"column_name\" = '"+t+"'",[4,this.query(a)];case 3:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t?[4,this.hasDatabase(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return n='CREATE DATABASE "'+e+'"',i='DROP DATABASE "'+e+'"',[4,this.executeQueries(new qe(n),new qe(i))];case 3:return r.sent(),[2]}}))}))},t.prototype.dropDatabase=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t?'DROP DATABASE IF EXISTS "'+e+'"':'DROP DATABASE "'+e+'"',i='CREATE DATABASE "'+e+'"',[4,this.executeQueries(new qe(n),new qe(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.createSchema=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=-1===e.indexOf(".")?e:e.split(".")[1],i=t?'CREATE SCHEMA IF NOT EXISTS "'+n+'"':'CREATE SCHEMA "'+n+'"',a='DROP SCHEMA "'+n+'" CASCADE',[4,this.executeQueries(new qe(i),new qe(a))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropSchema=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return i=-1===e.indexOf(".")?e:e.split(".")[1],a=t?'DROP SCHEMA IF EXISTS "'+i+'" '+(n?"CASCADE":""):'DROP SCHEMA "'+i+'" '+(n?"CASCADE":""),o='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(new qe(a),new qe(o))];case 1:return r.sent(),[2]}}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.__awaiter)(this,void 0,void 0,(function(){var a,o,s,u,c,l,h,p,d,f,m,y,v=this;return(0,r.__generator)(this,(function(g){switch(g.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(g.sent())return[2,Promise.resolve()];g.label=2;case 2:a=[],o=[],s=e.columns.filter((function(e){return"enum"===e.type||"simple-enum"===e.type})),u=[],g.label=3;case 3:g.trys.push([3,8,9,10]),c=(0,r.__values)(s),l=c.next(),g.label=4;case 4:return l.done?[3,7]:(h=l.value,[4,this.hasEnumType(e,h)]);case 5:p=g.sent(),d=this.buildEnumName(e,h),p||-1!==u.indexOf(d)||(u.push(d),a.push(this.createEnumTypeSql(e,h,d)),o.push(this.dropEnumTypeSql(e,h,d))),g.label=6;case 6:return l=c.next(),[3,4];case 7:return[3,10];case 8:return f=g.sent(),m={error:f},[3,10];case 9:try{l&&!l.done&&(y=c.return)&&y.call(c)}finally{if(m)throw m.error}return[7];case 10:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((function(t){return o.push(v.dropForeignKeySql(e,t))})),i&&e.indices.forEach((function(t){t.name||(t.name=v.connection.namingStrategy.indexName(e,t.columnNames,t.where)),a.push(v.createIndexSql(e,t)),o.push(v.dropIndexSql(e,t))})),[4,this.executeQueries(a,o)];case 11:return g.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),(0,r.__awaiter)(this,void 0,void 0,(function(){var a,o,s,u,c,l=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,o=this.getTablePath(e),[4,this.getCachedTable(o)];case 3:return s=r.sent(),u=[],c=[],i&&s.indices.forEach((function(e){u.push(l.dropIndexSql(s,e)),c.push(l.createIndexSql(s,e))})),n&&s.foreignKeys.forEach((function(e){return u.push(l.dropForeignKeySql(s,e))})),u.push(this.dropTableSql(s)),c.push(this.createTableSql(s,a)),[4,this.executeQueries(u,c)];case 4:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t=e instanceof Pe.View?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,d,f,m,y,v,g,b,_,w,E,T=this;return(0,r.__generator)(this,(function(M){switch(M.label){case 0:return n=[],i=[],e instanceof l.Table?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=M.sent(),M.label=3;case 3:s=(a=o).clone(),u=this.driver.parseTableName(a),c=u.schema,h=u.tableName,s.name=c?c+"."+t:t,n.push(new qe("ALTER TABLE "+this.escapePath(a)+' RENAME TO "'+t+'"')),i.push(new qe("ALTER TABLE "+this.escapePath(s)+' RENAME TO "'+h+'"')),s.primaryColumns.length>0&&(p=s.primaryColumns.map((function(e){return e.name})),d=this.connection.namingStrategy.primaryKeyName(a,p),f=this.connection.namingStrategy.primaryKeyName(s,p),n.push(new qe("ALTER TABLE "+this.escapePath(s)+' RENAME CONSTRAINT "'+d+'" TO "'+f+'"')),i.push(new qe("ALTER TABLE "+this.escapePath(s)+' RENAME CONSTRAINT "'+f+'" TO "'+d+'"'))),s.columns.map((function(e){if(e.isGenerated&&"increment"===e.generationStrategy){var t=T.buildSequencePath(a,e.name),r=T.buildSequenceName(a,e.name),o=T.buildSequencePath(s,e.name),u=T.buildSequenceName(s,e.name),c="ALTER SEQUENCE "+T.escapePath(t)+' RENAME TO "'+u+'"',l="ALTER SEQUENCE "+T.escapePath(o)+' RENAME TO "'+r+'"';n.push(new qe(c)),i.push(new qe(l))}})),s.uniques.forEach((function(e){var t=T.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);n.push(new qe("ALTER TABLE "+T.escapePath(s)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new qe("ALTER TABLE "+T.escapePath(s)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),s.indices.forEach((function(e){var t=T.driver.parseTableName(s).schema,r=T.connection.namingStrategy.indexName(s,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',o=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';n.push(new qe(a)),i.push(new qe(o)),e.name=r})),s.foreignKeys.forEach((function(e){var t=T.connection.namingStrategy.foreignKeyName(s,e.columnNames,T.getTablePath(e),e.referencedColumnNames);n.push(new qe("ALTER TABLE "+T.escapePath(s)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new qe("ALTER TABLE "+T.escapePath(s)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),m=s.columns.filter((function(e){return"enum"===e.type||"simple-enum"===e.type})),M.label=4;case 4:M.trys.push([4,9,10,11]),y=(0,r.__values)(m),v=y.next(),M.label=5;case 5:return v.done?[3,8]:(g=v.value).enumName?[3,7]:[4,this.getUserDefinedTypeName(a,g)];case 6:b=M.sent(),n.push(new qe('ALTER TYPE "'+b.schema+'"."'+b.name+'" RENAME TO '+this.buildEnumName(s,g,!1))),i.push(new qe("ALTER TYPE "+this.buildEnumName(s,g)+' RENAME TO "'+b.name+'"')),M.label=7;case 7:return v=y.next(),[3,5];case 8:return[3,11];case 9:return _=M.sent(),w={error:_},[3,11];case 10:try{v&&!v.done&&(E=y.return)&&E.call(y)}finally{if(w)throw w.error}return[7];case 11:return[4,this.executeQueries(n,i)];case 12:return M.sent(),[2]}}))}))},t.prototype.addColumn=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,d,f,m;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=[],s=[],"enum"!==t.type&&"simple-enum"!==t.type?[3,5]:[4,this.hasEnumType(n,t)];case 4:r.sent()||(o.push(this.createEnumTypeSql(n,t)),s.push(this.dropEnumTypeSql(n,t))),r.label=5;case 5:return o.push(new qe("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,t))),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+t.name+'"')),t.isPrimary&&((u=a.primaryColumns).length>0&&(c=this.connection.namingStrategy.primaryKeyName(a,u.map((function(e){return e.name}))),h=u.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+c+'"')),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+h+")"))),u.push(t),p=this.connection.namingStrategy.primaryKeyName(a,u.map((function(e){return e.name}))),d=u.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new qe("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+d+")")),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+p+'"'))),(f=a.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))&&(o.push(this.createIndexSql(n,f)),s.push(this.dropIndexSql(n,f))),t.isUnique&&(m=new De.TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(n,[t.name]),columnNames:[t.name]}),a.uniques.push(m),o.push(new qe("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+m.name+'" UNIQUE ("'+t.name+'")')),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+m.name+'"'))),t.comment&&(o.push(new qe("COMMENT ON COLUMN "+this.escapePath(n)+'."'+t.name+'" IS '+this.escapeComment(t.comment))),s.push(new qe("COMMENT ON COLUMN "+this.escapePath(n)+'."'+t.name+'" IS '+this.escapeComment(t.comment)))),[4,this.executeQueries(o,s)];case 6:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.addColumns=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.addColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof Re.TableColumn?t:i.columns.find((function(e){return e.name===t}))))throw new g.TypeORMError('Column "'+t+'" was not found in the "'+i.name+'" table.');return n instanceof Re.TableColumn?s=n:(s=o.clone()).name=n,[2,this.changeColumn(i,o,s)]}}))}))},t.prototype.changeColumn=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s,u,c,h,p,d,f,m,y,v,b,_,w,E,T,M,N,C,R,A,O,x,S,P,q,D,I,j=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],c=!1,!(h=t instanceof Re.TableColumn?t:i.columns.find((function(e){return e.name===t}))))throw new g.TypeORMError('Column "'+t+'" was not found in the "'+i.name+'" table.');return h.type===n.type&&h.length===n.length&&n.isArray===h.isArray?[3,6]:[4,this.dropColumn(i,h)];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,10];case 6:return h.name===n.name?[3,9]:(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+h.name+'" TO "'+n.name+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+n.name+'" TO "'+h.name+'"')),"enum"!==h.type&&"simple-enum"!==h.type?[3,8]:[4,this.getUserDefinedTypeName(i,h)]);case 7:p=r.sent(),s.push(new qe('ALTER TYPE "'+p.schema+'"."'+p.name+'" RENAME TO '+this.buildEnumName(i,n,!1))),u.push(new qe("ALTER TYPE "+this.buildEnumName(i,n)+' RENAME TO "'+p.name+'"')),r.label=8;case 8:!0===h.isPrimary&&(S=o.primaryColumns,D=S.map((function(e){return e.name})),d=this.connection.namingStrategy.primaryKeyName(o,D),D.splice(D.indexOf(h.name),1),D.push(n.name),f=this.connection.namingStrategy.primaryKeyName(o,D),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+d+'" TO "'+f+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+f+'" TO "'+d+'"'))),!0===h.isGenerated&&"increment"===n.generationStrategy&&(m=this.buildSequencePath(i,h.name),y=this.buildSequenceName(i,h.name),v=this.buildSequencePath(i,n.name),b=this.buildSequenceName(i,n.name),_="ALTER SEQUENCE "+this.escapePath(m)+' RENAME TO "'+b+'"',w="ALTER SEQUENCE "+this.escapePath(v)+' RENAME TO "'+y+'"',s.push(new qe(_)),u.push(new qe(w))),o.findColumnUniques(h).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=j.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);s.push(new qe("ALTER TABLE "+j.escapePath(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),u.push(new qe("ALTER TABLE "+j.escapePath(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),o.findColumnIndices(h).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=j.driver.parseTableName(i).schema,r=j.connection.namingStrategy.indexName(o,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',c=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';s.push(new qe(a)),u.push(new qe(c)),e.name=r})),o.findColumnForeignKeys(h).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=j.connection.namingStrategy.foreignKeyName(o,e.columnNames,j.getTablePath(e),e.referencedColumnNames);s.push(new qe("ALTER TABLE "+j.escapePath(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),u.push(new qe("ALTER TABLE "+j.escapePath(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),E=o.columns.find((function(e){return e.name===h.name})),o.columns[o.columns.indexOf(E)].name=n.name,h.name=n.name,r.label=9;case 9:n.precision===h.precision&&n.scale===h.scale||(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(n))),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(h)))),"enum"!==n.type&&"simple-enum"!==n.type||"enum"!==h.type&&"simple-enum"!==h.type||Z.OrmUtils.isArraysEqual(n.enum,h.enum)&&n.enumName===h.enumName||(T=n.isArray?"[]":"",M=this.buildEnumName(i,n),N=this.buildEnumName(i,h),C=this.buildEnumName(i,h,!1),R=this.buildEnumName(i,h,!0,!1,!0),A=this.buildEnumName(i,h,!1,!1,!0),s.push(new qe("ALTER TYPE "+N+" RENAME TO "+A)),u.push(new qe("ALTER TYPE "+R+" RENAME TO "+C)),s.push(this.createEnumTypeSql(i,n,M)),u.push(this.dropEnumTypeSql(i,n,M)),null!==h.default&&void 0!==h.default&&(c=!0,s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+h.name+'" DROP DEFAULT')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+h.name+'" SET DEFAULT '+h.default))),O=""+M+T+' USING "'+n.name+'"::"text"::'+M+T,x=""+R+T+' USING "'+n.name+'"::"text"::'+R+T,s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+O)),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+x)),null!==n.default&&void 0!==n.default&&(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default)),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))),s.push(this.dropEnumTypeSql(i,h,R)),u.push(this.createEnumTypeSql(i,h,R))),h.isNullable!==n.isNullable&&(n.isNullable?(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+h.name+'" DROP NOT NULL')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+h.name+'" SET NOT NULL'))):(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+h.name+'" SET NOT NULL')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+h.name+'" DROP NOT NULL')))),h.comment!==n.comment&&(s.push(new qe("COMMENT ON COLUMN "+this.escapePath(i)+'."'+h.name+'" IS '+this.escapeComment(n.comment))),u.push(new qe("COMMENT ON COLUMN "+this.escapePath(i)+'."'+n.name+'" IS '+this.escapeComment(h.comment)))),n.isPrimary!==h.isPrimary&&((S=o.primaryColumns).length>0&&(q=this.connection.namingStrategy.primaryKeyName(o,S.map((function(e){return e.name}))),D=S.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+q+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+q+'" PRIMARY KEY ('+D+")"))),!0===n.isPrimary?(S.push(n),o.columns.find((function(e){return e.name===n.name})).isPrimary=!0,q=this.connection.namingStrategy.primaryKeyName(o,S.map((function(e){return e.name}))),D=S.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+q+'" PRIMARY KEY ('+D+")")),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+q+'"'))):(P=S.find((function(e){return e.name===n.name})),S.splice(S.indexOf(P),1),o.columns.find((function(e){return e.name===n.name})).isPrimary=!1,S.length>0&&(q=this.connection.namingStrategy.primaryKeyName(o,S.map((function(e){return e.name}))),D=S.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+q+'" PRIMARY KEY ('+D+")")),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+q+'"'))))),n.isUnique!==h.isUnique&&(!0===n.isUnique?(I=new De.TableUnique({name:this.connection.namingStrategy.uniqueConstraintName(i,[n.name]),columnNames:[n.name]}),o.uniques.push(I),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+I.name+'" UNIQUE ("'+n.name+'")')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+I.name+'"'))):(I=o.uniques.find((function(e){return 1===e.columnNames.length&&!!e.columnNames.find((function(e){return e===n.name}))})),o.uniques.splice(o.uniques.indexOf(I),1),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+I.name+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+I.name+'" UNIQUE ("'+n.name+'")')))),h.isGenerated!==n.isGenerated&&"uuid"!==n.generationStrategy&&(!0===n.isGenerated?(s.push(new qe("CREATE SEQUENCE IF NOT EXISTS "+this.escapePath(this.buildSequencePath(i,n))+" OWNED BY "+this.escapePath(i)+'."'+n.name+'"')),u.push(new qe("DROP SEQUENCE "+this.escapePath(this.buildSequencePath(i,n)))),s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+"\" SET DEFAULT nextval('"+this.escapePath(this.buildSequencePath(i,n))+"')")),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))):(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+"\" SET DEFAULT nextval('"+this.escapePath(this.buildSequencePath(i,n))+"')")),s.push(new qe("DROP SEQUENCE "+this.escapePath(this.buildSequencePath(i,n)))),u.push(new qe("CREATE SEQUENCE IF NOT EXISTS "+this.escapePath(this.buildSequencePath(i,n))+" OWNED BY "+this.escapePath(i)+'."'+n.name+'"')))),n.default===h.default||c||(null!==n.default&&void 0!==n.default?(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default)),null!==h.default&&void 0!==h.default?u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+h.default)):u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))):null!==h.default&&void 0!==h.default&&(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+h.default)))),(n.spatialFeatureType||"").toLowerCase()===(h.spatialFeatureType||"").toLowerCase()&&n.srid===h.srid||(s.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(n))),u.push(new qe("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(h)))),r.label=10;case 10:return[4,this.executeQueries(s,u)];case 11:return r.sent(),this.replaceCachedTable(i,o),[2]}}))}))},t.prototype.changeColumns=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:h.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),h.label=1;case 1:return i.done?[3,4]:(a=i.value,o=a.oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)]);case 2:h.sent(),h.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u=h.sent(),c={error:u},[3,7];case 6:try{i&&!i.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 7:return[2]}}))}))},t.prototype.dropColumn=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,d,f,m,y,v,b;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Re.TableColumn?t:n.findColumnByName(t)))throw new g.TypeORMError('Column "'+t+'" was not found in table "'+n.name+'"');return o=n.clone(),s=[],u=[],a.isPrimary&&(c=this.connection.namingStrategy.primaryKeyName(o,o.primaryColumns.map((function(e){return e.name}))),h=o.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+c+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+h+")")),o.findColumnByName(a.name).isPrimary=!1,o.primaryColumns.length>0&&(p=this.connection.namingStrategy.primaryKeyName(o,o.primaryColumns.map((function(e){return e.name}))),d=o.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+d+")")),u.push(new qe("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+p+'"')))),(f=o.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.indices.splice(o.indices.indexOf(f),1),s.push(this.dropIndexSql(n,f)),u.push(this.createIndexSql(n,f))),(m=o.checks.find((function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.checks.splice(o.checks.indexOf(m),1),s.push(this.dropCheckConstraintSql(n,m)),u.push(this.createCheckConstraintSql(n,m))),(y=o.uniques.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.uniques.splice(o.uniques.indexOf(y),1),s.push(this.dropUniqueConstraintSql(n,y)),u.push(this.createUniqueConstraintSql(n,y))),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+a.name+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,a))),"enum"!==a.type&&"simple-enum"!==a.type?[3,6]:[4,this.hasEnumType(n,a)];case 4:return r.sent()?[4,this.getUserDefinedTypeName(n,a)]:[3,6];case 5:v=r.sent(),b='"'+v.schema+'"."'+v.name+'"',s.push(this.dropEnumTypeSql(n,a,b)),u.push(this.createEnumTypeSql(n,a,b)),r.label=6;case 6:return[4,this.executeQueries(s,u)];case 7:return r.sent(),o.removeColumn(a),this.replaceCachedTable(n,o),[2]}}))}))},t.prototype.dropColumns=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,d,f;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map((function(e){return e.name})),s=[],u=[],(c=a.primaryColumns).length>0&&(h=this.connection.namingStrategy.primaryKeyName(a,c.map((function(e){return e.name}))),p=c.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+h+'"')),u.push(new qe("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")"))),a.columns.filter((function(e){return-1!==o.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),d=this.connection.namingStrategy.primaryKeyName(a,o),f=o.map((function(e){return'"'+e+'"'})).join(", "),s.push(new qe("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+d+'" PRIMARY KEY ('+f+")")),u.push(new qe("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+d+'"')),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name}))),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.createUniqueConstraint(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof De.TableUnique?t:n.uniques.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied unique constraint was not found in table "+n.name);return o=this.dropUniqueConstraintSql(n,a),s=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropUniqueConstraint(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Be.TableCheck?t:n.checks.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.exclusionConstraintName(n,t.expression)),a=this.createExclusionConstraintSql(n,t),o=this.dropExclusionConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addExclusionConstraint(t),[2]}}))}))},t.prototype.createExclusionConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createExclusionConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropExclusionConstraint=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof nt.TableExclusion?t:n.exclusions.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied exclusion constraint was not found in table "+n.name);return o=this.dropExclusionConstraintSql(n,a),s=this.createExclusionConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeExclusionConstraint(a),[2]}}))}))},t.prototype.dropExclusionConstraints=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropExclusionConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createForeignKey=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n,t.columnNames,this.getTablePath(t),t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.createForeignKey(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof Se.TableForeignKey?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropForeignKey(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.createIndex=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.createIndex(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.dropIndex=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e instanceof l.Table?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof xe.TableIndex?t:n.indices.find((function(e){return e.name===t}))))throw new g.TypeORMError("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=(0,r.__values)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropIndex(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}}))}))},t.prototype.clearTable=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter((function(e){return e.schema})).forEach((function(t){e.find((function(e){return e===t.schema}))||e.push(t.schema)})),e.push(this.driver.options.schema||"current_schema()"),t=e.map((function(e){return"current_schema()"===e?e:"'"+e+"'"})).join(", "),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,13,,18]),[4,this.getVersion()];case 3:return n=r.sent(),i='SELECT \'DROP VIEW IF EXISTS "\' || schemaname || \'"."\' || viewname || \'" CASCADE;\' as "query" FROM "pg_views" WHERE "schemaname" IN ('+t+") AND \"viewname\" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')",[4,this.query(i)];case 4:return a=r.sent(),[4,Promise.all(a.map((function(e){return h.query(e.query)})))];case 5:return r.sent(),rt.isGreaterOrEqual(n,"9.3")?(o='SELECT \'DROP MATERIALIZED VIEW IF EXISTS "\' || schemaname || \'"."\' || matviewname || \'" CASCADE;\' as "query" FROM "pg_matviews" WHERE "schemaname" IN ('+t+")",[4,this.query(o)]):[3,8];case 6:return s=r.sent(),[4,Promise.all(s.map((function(e){return h.query(e.query)})))];case 7:r.sent(),r.label=8;case 8:return u='SELECT \'DROP TABLE IF EXISTS "\' || schemaname || \'"."\' || tablename || \'" CASCADE;\' as "query" FROM "pg_tables" WHERE "schemaname" IN ('+t+") AND \"tablename\" NOT IN ('spatial_ref_sys')",[4,this.query(u)];case 9:return c=r.sent(),[4,Promise.all(c.map((function(e){return h.query(e.query)})))];case 10:return r.sent(),[4,this.dropEnumTypes(t)];case 11:return r.sent(),[4,this.commitTransaction()];case 12:return r.sent(),[3,18];case 13:l=r.sent(),r.label=14;case 14:return r.trys.push([14,16,,17]),[4,this.rollbackTransaction()];case 15:case 16:return r.sent(),[3,17];case 17:throw l;case 18:return[2]}}))}))},t.prototype.loadViews=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(e||(e=[]),[4,this.getCurrentDatabase()]):[2,[]];case 2:return t=r.sent(),[4,this.getCurrentSchema()];case 3:return n=r.sent(),i=0===e.length?"1=1":e.map((function(e){return o.driver.parseTableName(e)})).map((function(e){var t=e.schema,r=e.tableName;return t||(t=o.driver.options.schema||n),'("t"."schema" = \''+t+'\' AND "t"."name" = \''+r+"')"})).join(" OR "),a='SELECT "t".* FROM '+this.escapePath(this.getTypeormMetadataTableName())+' "t" INNER JOIN "pg_catalog"."pg_class" "c" ON "c"."relname" = "t"."name" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "c"."relnamespace" AND "n"."nspname" = "t"."schema" WHERE "t"."type" IN (\'VIEW\', \'MATERIALIZED_VIEW\') '+(i?"AND ("+i+")":""),[4,this.query(a)];case 4:return[2,r.sent().map((function(e){var r=new Pe.View,i=e.schema!==n||o.driver.options.schema?e.schema:void 0;return r.database=t,r.schema=e.schema,r.name=o.driver.buildTableName(e.name,i),r.expression=e.value,r.materialized="MATERIALIZED_VIEW"===e.type,r}))]}}))}))},t.prototype.loadTables=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,h,p,d,f,m,y,v,g,b,_,w,E,T,M,N,C,R,A,O=this;return(0,r.__generator)(this,(function(x){switch(x.label){case 0:return e&&0===e.length?[2,[]]:[4,this.getCurrentSchema()];case 1:return t=x.sent(),[4,this.getCurrentDatabase()];case 2:return n=x.sent(),i=[],e?[3,4]:(h='SELECT "table_schema", "table_name" FROM "information_schema"."tables"',o=(a=i.push).apply,s=[i],u=[[]],[4,this.query(h)]);case 3:return o.apply(a,s.concat([r.__spreadArray.apply(void 0,u.concat([r.__read.apply(void 0,[x.sent()])]))])),[3,6];case 4:return c=e.map((function(e){return O.driver.parseTableName(e)})).map((function(e){var n=e.schema,r=e.tableName;return'("table_schema" = \''+(n||t)+"' AND \"table_name\" = '"+r+"')"})).join(" OR "),h='SELECT "table_schema", "table_name" FROM "information_schema"."tables" WHERE '+c,d=(p=i.push).apply,f=[i],m=[[]],[4,this.query(h)];case 5:d.apply(p,f.concat([r.__spreadArray.apply(void 0,m.concat([r.__read.apply(void 0,[x.sent()])]))])),x.label=6;case 6:return 0===i.length?[2,[]]:(y=i.map((function(e){return'("table_schema" = \''+e.table_schema+"' AND \"table_name\" = '"+e.table_name+"')"})).join(" OR "),v='SELECT columns.*, pg_catalog.col_description((\'"\' || table_catalog || \'"."\' || table_schema || \'"."\' || table_name || \'"\')::regclass::oid, ordinal_position) AS description, (\'"\' || "udt_schema" || \'"."\' || "udt_name" || \'"\')::"regtype" AS "regtype", pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type" FROM "information_schema"."columns" LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr" ON "col_attr"."attname" = "columns"."column_name" AND "col_attr"."attrelid" = ( SELECT "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls" LEFT JOIN "pg_catalog"."pg_namespace" AS "ns" ON "ns"."oid" = "cls"."relnamespace" WHERE "cls"."relname" = "columns"."table_name" AND "ns"."nspname" = "columns"."table_schema" ) WHERE '+y,g=i.map((function(e){return'("ns"."nspname" = \''+e.table_schema+'\' AND "t"."relname" = \''+e.table_name+"')"})).join(" OR "),b='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN \'p\' THEN \'PRIMARY\' WHEN \'u\' THEN \'UNIQUE\' WHEN \'c\' THEN \'CHECK\' WHEN \'x\' THEN \'EXCLUDE\' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN (\'r\', \'p\') AND ('+g+")",_='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN \'t\' THEN \'TRUE\' ELSE\'FALSE\' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN (\'r\', \'p\') AND "cnst"."contype" IS NULL AND ('+g+")",w=i.map((function(e){return'("ns"."nspname" = \''+e.table_schema+'\' AND "cl"."relname" = \''+e.table_name+"')"})).join(" OR "),[4,this.hasSupportForPartitionedTables()]);case 7:return E=x.sent(),T='SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN \'INITIALLY DEFERRED\' ELSE \'INITIALLY IMMEDIATE\' END as condeferred, CASE "con1"."confdeltype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confdeltype", CASE "con1"."confupdtype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = \'f\' AND ('+w+') ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" '+(E?' AND "cl"."relispartition" = \'f\'':"")+'INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"',[4,Promise.all([this.query(v),this.query(b),this.query(_),this.query(T)])];case 8:return M=r.__read.apply(void 0,[x.sent(),4]),N=M[0],C=M[1],R=M[2],A=M[3],[2,Promise.all(i.map((function(e){return(0,r.__awaiter)(O,void 0,void 0,(function(){var i,a,o,s,u,c,h,p,d,f=this;return(0,r.__generator)(this,(function(m){switch(m.label){case 0:return i=new l.Table,o=(a=function(e,n){return e[n]!==t||f.driver.options.schema&&f.driver.options.schema!==t?e[n]:void 0})(e,"table_schema"),i.database=n,i.schema=e.table_schema,i.name=this.driver.buildTableName(e.table_name,o),s=i,[4,Promise.all(N.filter((function(t){return t.table_name===e.table_name&&t.table_schema===e.table_schema})).map((function(t){return(0,r.__awaiter)(f,void 0,void 0,(function(){var n,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b,_;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=C.filter((function(e){return e.table_name===t.table_name&&e.table_schema===t.table_schema&&e.column_name===t.column_name})),(a=new Re.TableColumn).name=t.column_name,a.type=t.regtype.toLowerCase(),"numeric"!==a.type&&"decimal"!==a.type&&"float"!==a.type||(null===t.numeric_precision||this.isDefaultColumnPrecision(i,a,t.numeric_precision)?null===t.numeric_scale||this.isDefaultColumnScale(i,a,t.numeric_scale)||(a.precision=void 0):a.precision=t.numeric_precision,null===t.numeric_scale||this.isDefaultColumnScale(i,a,t.numeric_scale)?null===t.numeric_precision||this.isDefaultColumnPrecision(i,a,t.numeric_precision)||(a.scale=void 0):a.scale=t.numeric_scale),"interval"!==a.type&&"time without time zone"!==a.type&&"time with time zone"!==a.type&&"timestamp without time zone"!==a.type&&"timestamp with time zone"!==a.type||(a.precision=this.isDefaultColumnPrecision(i,a,t.datetime_precision)?void 0:t.datetime_precision),"USER-DEFINED"!==t.data_type&&"ARRAY"!==t.data_type?[3,3]:[4,this.getUserDefinedTypeName(i,a)];case 1:return o=r.sent().name,s=this.buildEnumName(i,a,!1,!0),u=s!==o?o:void 0,c='SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = \''+e.table_schema+'\' AND "t"."typname" = \''+(u||o)+"'",[4,this.query(c)];case 2:(d=r.sent()).length&&(a.type="enum",a.enum=d.map((function(e){return e.value})),a.enumName=u),"ARRAY"===t.data_type&&(a.isArray=!0,l=a.type.replace("[]",""),a.type=this.connection.driver.normalizeType({type:l})),r.label=3;case 3:return"geometry"!==a.type?[3,5]:(h='SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geometry_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geometry_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = \''+t.column_name+"' AND\n                          \"table_schema\" = '"+t.table_schema+"' AND\n                          \"table_name\" = '"+t.table_name+"'",[4,this.query(h)]);case 4:(d=r.sent()).length>0&&(a.spatialFeatureType=d[0].type,a.srid=d[0].srid),r.label=5;case 5:return"geography"!==a.type?[3,7]:(p='SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geography_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geography_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = \''+t.column_name+"' AND\n                          \"table_schema\" = '"+t.table_schema+"' AND\n                          \"table_name\" = '"+t.table_name+"'",[4,this.query(p)]);case 6:(d=r.sent()).length>0&&(a.spatialFeatureType=d[0].type,a.srid=d[0].srid),r.label=7;case 7:return-1!==this.driver.withLengthColumnTypes.indexOf(a.type)&&(a.isArray?(m=/\((\d+)\)/.exec(t.format_type),f=m?m[1]:void 0):t.character_maximum_length&&(f=t.character_maximum_length.toString()),f&&(a.length=this.isDefaultColumnLength(i,a,f)?"":f)),a.isNullable="YES"===t.is_nullable,a.isPrimary=!!n.find((function(e){return"PRIMARY"===e.constraint_type})),y=n.find((function(e){return"UNIQUE"===e.constraint_type})),v=!!y&&!!C.find((function(e){return"UNIQUE"===e.constraint_type&&e.constraint_name===y.constraint_name&&e.column_name!==t.column_name})),a.isUnique=!!y&&!v,null!==t.column_default&&void 0!==t.column_default&&(g="nextval('"+this.buildSequenceName(i,t.column_name)+"'::regclass)",b="nextval('"+this.buildSequencePath(i,t.column_name)+"'::regclass)",(_=t.column_default.replace(/"/g,""))===g||_===b?(a.isGenerated=!0,a.generationStrategy="increment"):"gen_random_uuid()"===t.column_default||/^uuid_generate_v\d\(\)/.test(t.column_default)?(a.isGenerated=!0,a.generationStrategy="uuid"):"now()"===t.column_default||-1!==t.column_default.indexOf("'now'::text")?a.default=t.column_default:(a.default=t.column_default.replace(/::[\w\s\[\]\"]+/g,""),a.default=a.default.replace(/^(-?\d+)$/,"'$1'"))),a.comment=t.description?t.description:void 0,t.character_set_name&&(a.charset=t.character_set_name),t.collation_name&&(a.collation=t.collation_name),[2,a]}}))}))})))];case 1:return s.columns=m.sent(),u=Z.OrmUtils.uniq(C.filter((function(t){return t.table_name===e.table_name&&t.table_schema===e.table_schema&&"UNIQUE"===t.constraint_type})),(function(e){return e.constraint_name})),i.uniques=u.map((function(e){var t=C.filter((function(t){return t.constraint_name===e.constraint_name}));return new De.TableUnique({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name}))})})),c=Z.OrmUtils.uniq(C.filter((function(t){return t.table_name===e.table_name&&t.table_schema===e.table_schema&&"CHECK"===t.constraint_type})),(function(e){return e.constraint_name})),i.checks=c.map((function(e){var t=C.filter((function(t){return t.constraint_name===e.constraint_name}));return new Be.TableCheck({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),expression:e.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})})),h=Z.OrmUtils.uniq(C.filter((function(t){return t.table_name===e.table_name&&t.table_schema===e.table_schema&&"EXCLUDE"===t.constraint_type})),(function(e){return e.constraint_name})),i.exclusions=h.map((function(e){return new nt.TableExclusion({name:e.constraint_name,expression:e.expression.substring(8)})})),p=Z.OrmUtils.uniq(A.filter((function(t){return t.table_name===e.table_name&&t.table_schema===e.table_schema})),(function(e){return e.constraint_name})),i.foreignKeys=p.map((function(e){var t=A.filter((function(t){return t.constraint_name===e.constraint_name})),n=a(e,"referenced_table_schema"),r=f.driver.buildTableName(e.referenced_table_name,n);return new Se.TableForeignKey({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),referencedTableName:r,referencedColumnNames:t.map((function(e){return e.referenced_column_name})),onDelete:e.on_delete,onUpdate:e.on_update,deferrable:e.deferrable?e.deferred:void 0})})),d=Z.OrmUtils.uniq(R.filter((function(t){return t.table_name===e.table_name&&t.table_schema===e.table_schema})),(function(e){return e.constraint_name})),i.indices=d.map((function(e){var t=R.filter((function(t){return t.table_schema===e.table_schema&&t.table_name===e.table_name&&t.constraint_name===e.constraint_name}));return new xe.TableIndex({table:i,name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),isUnique:"TRUE"===e.is_unique,where:e.condition,isSpatial:t.every((function(e){return f.driver.spatialTypes.indexOf(e.type_name)>=0})),isFulltext:!1})})),[2,i]}}))}))})))]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(t){return n.buildCreateColumnSql(e,t)})).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;if(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new De.TableUnique({name:n.connection.namingStrategy.uniqueConstraintName(e,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0){var a=e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", ");i+=", "+a}if(e.checks.length>0){var o=e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e,t.expression))+'" CHECK ('+t.expression+")"})).join(", ");i+=", "+o}if(e.exclusions.length>0){var s=e.exclusions.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.exclusionConstraintName(e,t.expression))+'" EXCLUDE '+t.expression})).join(", ");i+=", "+s}if(e.foreignKeys.length>0&&t){var u=e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e,t.columnNames,n.getTablePath(t),t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapePath(n.getTablePath(t))+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),t.deferrable&&(a+=" DEFERRABLE "+t.deferrable),a})).join(", ");i+=", "+u}var c=e.columns.filter((function(e){return e.isPrimary}));if(c.length>0){var l=this.connection.namingStrategy.primaryKeyName(e,c.map((function(e){return e.name}))),h=c.map((function(e){return'"'+e.name+'"'})).join(", ");i+=', CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")"}return i+=")",e.columns.filter((function(e){return e.comment})).forEach((function(t){return i+="; COMMENT ON COLUMN "+n.escapePath(e)+'."'+t.name+'" IS '+n.escapeComment(t.comment)})),new qe(i)},t.prototype.getVersion=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.query("SHOW SERVER_VERSION")];case 1:return[2,e.sent()[0].server_version]}}))}))},t.prototype.dropTableSql=function(e){return new qe("DROP TABLE "+this.escapePath(e))},t.prototype.createViewSql=function(e){var t=e.materialized?"MATERIALIZED ":"",n=this.escapePath(e);return"string"==typeof e.expression?new qe("CREATE "+t+"VIEW "+n+" AS "+e.expression):new qe("CREATE "+t+"VIEW "+n+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=h.sent(),n=this.driver.parseTableName(e),i=n.schema,a=n.tableName,i||(i=t),o=e.materialized?"MATERIALIZED_VIEW":"VIEW",s="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),u=(0,r.__read)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:o,schema:i,name:a,value:s}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new qe(c,l)]}}))}))},t.prototype.dropViewSql=function(e){var t=e.materialized?"MATERIALIZED ":"";return new qe("DROP "+t+"VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l;return(0,r.__generator)(this,(function(h){switch(h.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=h.sent(),n=this.driver.parseTableName(e),i=n.schema,a=n.tableName,i||(i=t),o=e.materialized?"MATERIALIZED_VIEW":"VIEW",s=this.connection.createQueryBuilder(),u=(0,r.__read)(s.delete().from(this.getTypeormMetadataTableName()).where(s.escape("type")+" = :type",{type:o}).andWhere(s.escape("schema")+" = :schema",{schema:i}).andWhere(s.escape("name")+" = :name",{name:a}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new qe(c,l)]}}))}))},t.prototype.dropEnumTypes=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t='SELECT \'DROP TYPE IF EXISTS "\' || n.nspname || \'"."\' || t.typname || \'" CASCADE;\' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN ('+e+') GROUP BY "n"."nspname", "t"."typname"',[4,this.query(t)];case 1:return n=r.sent(),[4,Promise.all(n.map((function(e){return i.query(e.query)})))];case 2:return r.sent(),[2]}}))}))},t.prototype.hasEnumType=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(n=this.driver.parseTableName(e).schema)?[3,2]:[4,this.getCurrentSchema()];case 1:n=r.sent(),r.label=2;case 2:return i=this.buildEnumName(e,t,!1,!0),a='SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = \''+n+'\' AND "t"."typname" = \''+i+"'",[4,this.query(a)];case 3:return[2,!!r.sent().length]}}))}))},t.prototype.createEnumTypeSql=function(e,t,n){n||(n=this.buildEnumName(e,t));var r=t.enum.map((function(e){return"'"+e.replace("'","''")+"'"})).join(", ");return new qe("CREATE TYPE "+n+" AS ENUM("+r+")")},t.prototype.dropEnumTypeSql=function(e,t,n){return n||(n=this.buildEnumName(e,t)),new qe("DROP TYPE "+n)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new qe("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON '+this.escapePath(e)+" "+(t.isSpatial?"USING GiST ":"")+"("+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof xe.TableIndex?t.name:t,r=this.driver.parseTableName(e).schema;return new qe(r?'DROP INDEX "'+r+'"."'+n+'"':'DROP INDEX "'+n+'"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e,t),r=t.map((function(e){return'"'+e+'"'})).join(", ");return new qe("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map((function(e){return e.name})),n=this.connection.namingStrategy.primaryKeyName(e,t);return new qe("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new qe("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof De.TableUnique?t.name:t;return new qe("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new qe("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof Be.TableCheck?t.name:t;return new qe("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createExclusionConstraintSql=function(e,t){return new qe("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" EXCLUDE '+t.expression)},t.prototype.dropExclusionConstraintSql=function(e,t){var n=t instanceof nt.TableExclusion?t.name:t;return new qe("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(","),i="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapePath(this.getTablePath(t))+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),t.deferrable&&(i+=" DEFERRABLE "+t.deferrable),new qe(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof Se.TableForeignKey?t.name:t;return new qe("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.buildSequenceName=function(e,t){var n=this.driver.parseTableName(e).tableName,r=t instanceof Re.TableColumn?t.name:t,i=n+"_"+r+"_seq";return i.length>this.connection.driver.maxAliasLength&&(i=n.substring(0,29)+"_"+r.substring(0,Math.max(29,63-e.name.length-5))+"_seq"),i},t.prototype.buildSequencePath=function(e,t){var n=this.driver.parseTableName(e).schema;return n?n+"."+this.buildSequenceName(e,t):this.buildSequenceName(e,t)},t.prototype.buildEnumName=function(e,t,n,r,i){void 0===n&&(n=!0);var a=this.driver.parseTableName(e),o=a.schema,s=a.tableName,u=t.enumName?t.enumName:s+"_"+t.name.toLowerCase()+"_enum";return o&&n&&(u=o+"."+u),i&&(u+="_old"),u.split(".").map((function(e){return r?e:'"'+e+'"'})).join(".")},t.prototype.getUserDefinedTypeName=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,s;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=this.driver.parseTableName(e),i=n.schema,a=n.tableName,i?[3,2]:[4,this.getCurrentSchema()];case 1:i=r.sent(),r.label=2;case 2:return[4,this.query('SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = \''+i+"' AND \"table_name\" = '"+a+"' AND \"column_name\"='"+t.name+"'")];case 3:return o=r.sent(),0===(s=o[0].udt_name).indexOf("_")&&(s=s.substr(1,s.length)),[2,{schema:o[0].udt_schema,name:s}]}}))}))},t.prototype.escapeComment=function(e){return e&&0!==e.length?"'"+(e=e.replace(/'/g,"''").replace(/\u0000/g,""))+"'":"NULL"},t.prototype.escapePath=function(e){var t=this.driver.parseTableName(e),n=t.schema,r=t.tableName;return n?'"'+n+'"."'+r+'"':'"'+r+'"'},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+t.name+'"';return!0===t.isGenerated&&"uuid"!==t.generationStrategy&&("integer"!==t.type&&"int"!==t.type&&"int4"!==t.type||(n+=" SERIAL"),"smallint"!==t.type&&"int2"!==t.type||(n+=" SMALLSERIAL"),"bigint"!==t.type&&"int8"!==t.type||(n+=" BIGSERIAL")),"enum"===t.type||"simple-enum"===t.type?(n+=" "+this.buildEnumName(e,t),t.isArray&&(n+=" array")):t.isGenerated&&"uuid"!==t.type||(n+=" "+this.connection.driver.createFullType(t)),t.charset&&(n+=' CHARACTER SET "'+t.charset+'"'),t.collation&&(n+=' COLLATE "'+t.collation+'"'),!0!==t.isNullable&&(n+=" NOT NULL"),void 0!==t.default&&null!==t.default&&(n+=" DEFAULT "+t.default),t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(n+=" DEFAULT "+this.driver.uuidGenerator),n},t.prototype.hasSupportForPartitionedTables=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")];case 1:return[2,!!e.sent().length]}}))}))},t}(je))),ot=function(e){function t(t){var n=e.call(this)||this;return n.connection=t,n.options=t.options,n.isReplicated=!1,n.loadDependencies(),n.client=new n.DataApiDriver(n.options.region,n.options.secretArn,n.options.resourceArn,n.options.database,(function(e,t){return n.connection.logger.logQuery(e,t)}),n.options.serviceConfigOptions,n.options.formatOptions),n.database=I.DriverUtils.buildDriverOptions(n.options).database,n}return(0,r.__extends)(t,e),t.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2]}))}))},t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2]}))}))},t.prototype.createQueryRunner=function(e){var t=this;return new at(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(function(e,n){return t.connection.logger.logQuery(e,n)}),this.options.serviceConfigOptions,this.options.formatOptions),e)},t.prototype.preparePersistentValue=function(t,n){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?e.prototype.preparePersistentValue.call(this,t,n):(n.transformer&&(t=ee.ApplyValueTransformers.transformTo(n.transformer,t)),this.client.preparePersistentValue(t,n))},t.prototype.prepareHydratedValue=function(t,n){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?e.prototype.prepareHydratedValue.call(this,t,n):(n.transformer&&(t=ee.ApplyValueTransformers.transformFrom(n.transformer,t)),this.client.prepareHydratedValue(t,n))},t.prototype.loadDependencies=function(){var e=o.load("typeorm-aurora-data-api-driver").pg;this.DataApiDriver=e},t.prototype.executeQuery=function(e,t){return this.connection.query(t)},t.prototype.afterConnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.checkMetadataForExtensions()];case 1:return(e=t.sent()).hasExtensions?[4,this.enableExtensions(e,this.connection)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,Promise.resolve()]}}))}))},t}(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t}(y.PostgresDriver)),st=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Ue(n),n}return(0,r.__extends)(t,e),t.prototype.executeSet=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return[4,this.connect()];case 1:return[2,t.sent().executeSet(e,!1)]}}))}))},t.prototype.query=function(e,t,n){return void 0===n&&(n=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,s,u;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(this.isReleased)throw new Me.QueryRunnerAlreadyReleasedError;return[4,this.connect()];case 1:i=r.sent(),this.driver.connection.logger.logQuery(e,t,this),a=e.substr(0,e.indexOf(" ")),r.label=2;case 2:return r.trys.push([2,9,,10]),o=void 0,-1===["BEGIN","ROLLBACK","COMMIT","CREATE","ALTER","DROP"].indexOf(a)?[3,4]:[4,i.execute(e,!1)];case 3:return o=r.sent(),[3,8];case 4:return-1===["INSERT","UPDATE","DELETE"].indexOf(a)?[3,6]:[4,i.run(e,t,!1)];case 5:return o=r.sent(),[3,8];case 6:return[4,i.query(e,t||[])];case 7:o=r.sent(),r.label=8;case 8:return s=new ke,(null==o?void 0:o.hasOwnProperty("values"))&&(s.raw=o.values,s.records=o.values),(null==o?void 0:o.hasOwnProperty("changes"))&&(s.affected=o.changes.changes,s.raw=o.changes.lastId||o.changes.changes),n?[2,s]:[2,s.raw];case 9:throw u=r.sent(),this.driver.connection.logger.logQueryError(u,e,t,this),new Fe.QueryFailedError(e,t,u);case 10:return[2]}}))}))},t.prototype.parametrize=function(e){return Object.keys(e).map((function(e){return'"'+e+'"=?'}))},t}(Le),ut=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new g.DriverOptionNotSetError("database");if(!n.options.driver)throw new g.DriverOptionNotSetError("driver");return n.sqlite=n.options.driver,n}return(0,r.__extends)(t,e),t.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return this.databaseConnection=this.createDatabaseConnection(),[4,this.databaseConnection];case 1:return e.sent(),[2]}}))}))},t.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return this.queryRunner=void 0,[4,this.databaseConnection];case 1:return[2,t.sent().close().then((function(){e.databaseConnection=void 0}))]}}))}))},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new st(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return e=this.options.mode||"no-encryption",t="no-encryption"!==e,n=void 0===this.options.version?1:this.options.version,[4,this.sqlite.createConnection(this.options.database,t,e,n)];case 1:return[4,(i=r.sent()).open()];case 2:return r.sent(),[4,i.query("PRAGMA foreign_keys = ON")];case 3:return r.sent(),this.options.journalMode&&-1!==["DELETE","TRUNCATE","PERSIST","MEMORY","WAL","OFF"].indexOf(this.options.journalMode)?[4,i.query("PRAGMA journal_mode = "+this.options.journalMode)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2,i]}}))}))},t.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new g.DriverPackageNotInstalledError("Capacitor","@capacitor-community/sqlite")},t}(P.AbstractSqliteDriver),ct=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new y.MysqlDriver(e);case"postgres":return new y.PostgresDriver(e);case"cockroachdb":return new y.CockroachDriver(e);case"sap":return new y.SapDriver(e);case"mariadb":return new y.MysqlDriver(e);case"sqlite":return new y.SqliteDriver(e);case"better-sqlite3":return new y.BetterSqlite3Driver(e);case"cordova":return new Ge(e);case"nativescript":return new Ze(e);case"react-native":return new $e(e);case"sqljs":return new ze(e);case"oracle":return new y.OracleDriver(e);case"mssql":return new y.SqlServerDriver(e);case"mongodb":return new y.MongoDriver(e);case"expo":return new tt(e);case"aurora-data-api":return new y.AuroraDataApiDriver(e);case"aurora-data-api-pg":return new ot(e);case"capacitor":return new ut(e);default:throw new Je.MissingDriverError(t,["aurora-data-api","aurora-data-api-pg","better-sqlite3","capacitor","cockroachdb","cordova","expo","mariadb","mongodb","mssql","mysql","nativescript","oracle","postgres","react-native","sap","sqlite","sqljs"])}},e}();function lt(e,t,n){return void 0===n&&(n=[".js",".cjs",".ts"]),[]}var ht=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find((function(t){return t.type===e}));return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}());function pt(e){return ht.get(e)}var dt=function(){function e(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map((function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e.trim()}))).forEach((function(e){return n[e]=1}));else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map((function(e){return String(e)}))).forEach((function(e){return n[e]=1})):(r=Object.keys(i).map((function(e){return String(e)})),Object.keys(i).forEach((function(e){return n[e]=i[e]})))}this.columns=r.map((function(e){var n=t.entityMetadata.columns.find((function(t){return t.propertyPath===e}));if(n)return[n];var r=t.entityMetadata.relations.find((function(t){return t.isWithJoinColumn&&t.propertyName===e}));if(r)return r.joinColumns;var i=t.givenName?'"'+t.givenName+'" ':"",a=t.entityMetadata.targetName;throw new g.TypeORMError("Index "+i+"contains column that is missing in the entity ("+a+"): "+e)})).reduce((function(e,t){return e.concat(t)}))}return this.columnNamesWithOrderingMap=Object.keys(n).reduce((function(e,r){var i=t.entityMetadata.columns.find((function(e){return e.propertyPath===r}));return i&&(e[i.databasePath]=n[r]),e}),{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tableName,this.columns.map((function(e){return e.databaseName})),this.where),this},e}(),ft=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.createForeignKeyConstraints=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("recover"),this.isPrimary=t.options.primary||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.createForeignKeyConstraints=!1!==t.options.createForeignKeyConstraints,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.orphanedRowAction=t.options.orphanedRowAction||"nullify",this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((function(e){return e.referencedColumn}));return de.EntityMetadata.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((function(e){return e.referencedColumn}));if(t.length>1)throw new g.TypeORMError("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){if(this.embeddedMetadata){var n=(0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.parentPropertyNames)),i=function(e,t){var n=e.shift();return n?t[n]?i(e,t[n]):void 0:t},a=i(n,e);return this.isLazy?void 0!==a["__"+this.propertyName+"__"]?a["__"+this.propertyName+"__"]:!0===t?a[this.propertyName]:void 0:a?a[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n]=t,r)};return i((0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.embeddedMetadataTree)),e)}e[n]=t},e.prototype.createValueMap=function(e){var t,n=this;if(this.embeddedMetadata){var i=(0,r.__spreadArray)([],(0,r.__read)(this.embeddedMetadata.parentPropertyNames)),a=function(t,r){var i=t.shift();return i?(r[i]={},a(t,r[i]),r):(r[n.propertyName]=e,r)};return a(i,{})}return(t={})[this.propertyName]=e,t},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,(0,r.__spreadArray)([],(0,r.__read)(t)))},e.prototype.registerJoinColumns=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.joinColumns=e,this.inverseJoinColumns=t,this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),mt=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isAlwaysUsingConstructor=!0,this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(e){return!(null==e?void 0:e.fromDeserializer)||this.isAlwaysUsingConstructor?new this.type:Object.create(this.type.prototype)},e.prototype.build=function(e){return this.embeddeds.forEach((function(t){return t.build(e)})),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),e.options.entitySkipConstructor&&(this.isAlwaysUsingConstructor=!e.options.entitySkipConstructor),this},e.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw new g.TypeORMError("Invalid prefix option given for "+this.entityMetadata.targetName+"#"+this.propertyName)},e.prototype.buildPrefix=function(e){if(e.driver instanceof y.MongoDriver)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push.apply(t,(0,r.__spreadArray)([],(0,r.__read)(this.buildPartialPrefix()))),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildColumnsFromTree())}),this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationsFromTree())}),this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildListenersFromTree())}),this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildIndicesFromTree())}),this.indices)},e.prototype.buildUniquesFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildUniquesFromTree())}),this.uniques)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationIdsFromTree())}),this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationCountsFromTree())}),this.relationCounts)},e}(),yt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(Array.isArray(n))e[this.propertyName]=n.map((function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)})).filter((function(e){return null!=e}));else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new g.TypeORMError("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),vt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new g.TypeORMError("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),gt=function(){function e(){}return e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove",e}(),bt=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map((function(e){return e.databaseName})),this.referencedColumnNames=this.referencedColumns.map((function(e){return e.databaseName})),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=e.foreignKeyName(this.entityMetadata.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)},e}(),_t=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this,i=this.collectReferencedColumns(e,t),a=this.collectInverseReferencedColumns(e,t),o=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),s=new de.EntityMetadata({connection:this.connection,args:{target:"",name:o,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});s.build();var u=i.map((function(r){var i=t.joinColumns?t.joinColumns.find((function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)})):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new Oe({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{name:a,length:r.length||!(n.connection.driver instanceof y.MysqlDriver||n.connection.driver instanceof y.AuroraDataApiDriver)||"uuid"!==r.generationStrategy&&"uuid"!==r.type?r.length:"36",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,enum:r.enum,enumName:r.enumName,nullable:!1,primary:!0}}})})),c=a.map((function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find((function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)})):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new Oe({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{length:r.length||!(n.connection.driver instanceof y.MysqlDriver||n.connection.driver instanceof y.AuroraDataApiDriver)||"uuid"!==r.generationStrategy&&"uuid"!==r.type?r.length:"36",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,enum:r.enum,enumName:r.enumName,name:a,nullable:!1,primary:!0}}})}));return this.changeDuplicatedColumnNames(u,c),s.ownerColumns=u,s.inverseColumns=c,s.ownColumns=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(u)),(0,r.__read)(c)),s.ownColumns.forEach((function(t){return t.relationMetadata=e})),s.foreignKeys=e.createForeignKeyConstraints?[new bt({entityMetadata:s,referencedEntityMetadata:e.entityMetadata,columns:u,referencedColumns:i,onDelete:e.onDelete||"CASCADE",onUpdate:this.connection.driver instanceof y.OracleDriver?"NO ACTION":e.onUpdate||"CASCADE"}),new bt({entityMetadata:s,referencedEntityMetadata:e.inverseEntityMetadata,columns:c,referencedColumns:a,onDelete:e.inverseRelation?e.inverseRelation.onDelete:"CASCADE",onUpdate:this.connection.driver instanceof y.OracleDriver?"NO ACTION":e.inverseRelation?e.inverseRelation.onUpdate:"CASCADE"})]:[],s.ownIndices=[new dt({entityMetadata:s,columns:u,args:{target:s.target,synchronize:!0}}),new dt({entityMetadata:s,columns:c,args:{target:s.target,synchronize:!0}})],s},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find((function(e){return!!e.referencedColumnName}));return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter((function(e){return e.isPrimary})):t.joinColumns.map((function(t){var n=e.entityMetadata.columns.find((function(e){return e.propertyName===t.referencedColumnName}));if(!n)throw new g.TypeORMError("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n}))},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find((function(e){return!!e.referencedColumnName}));return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map((function(t){var n=e.inverseEntityMetadata.ownColumns.find((function(e){return e.propertyName===t.referencedColumnName}));if(!n)throw new g.TypeORMError("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n}))},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach((function(e){t.forEach((function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}}))}))},e}(),wt=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new de.EntityMetadata({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.treeOptions&&e.treeOptions.closureTableName?e.treeOptions.closureTableName:e.tableNameWithoutPrefix,type:"closure-junction"}});return n.build(),e.primaryColumns.forEach((function(r){n.ownColumns.push(new Oe({connection:t.connection,entityMetadata:n,closureType:"ancestor",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.ancestorColumnName?e.treeOptions.ancestorColumnName(r):r.propertyName+"_ancestor",options:{primary:!0,length:r.length,type:r.type}}})),n.ownColumns.push(new Oe({connection:t.connection,entityMetadata:n,closureType:"descendant",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:e.treeOptions&&e.treeOptions.descendantColumnName?e.treeOptions.descendantColumnName(r):r.propertyName+"_descendant",options:{primary:!0,length:r.length,type:r.type}}}))})),n.ownIndices=[new dt({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new dt({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],e.treeLevelColumn&&n.ownColumns.push(new Oe({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new bt({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns,onDelete:this.connection.driver instanceof y.SqlServerDriver?"NO ACTION":"CASCADE"}),new bt({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns,onDelete:this.connection.driver instanceof y.SqlServerDriver?"NO ACTION":"CASCADE"})],n},e}(),Et=function(){function e(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map((function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e.trim()}))).forEach((function(e){return n[e]=1}));else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map((function(e){return String(e)}))).forEach((function(e){return n[e]=1})):(r=Object.keys(i).map((function(e){return String(e)})),Object.keys(i).forEach((function(e){return n[e]=i[e]})))}this.columns=r.map((function(e){var n=t.entityMetadata.columns.find((function(t){return t.propertyPath===e}));if(n)return[n];var r=t.entityMetadata.relations.find((function(t){return t.isWithJoinColumn&&t.propertyName===e}));if(r)return r.joinColumns;var i=t.givenName?'"'+t.givenName+'" ':"",a=t.entityMetadata.targetName;throw new g.TypeORMError("Unique constraint "+i+"contains column that is missing in the entity ("+a+"): "+e)})).reduce((function(e,t){return e.concat(t)}))}return this.columnNamesWithOrderingMap=Object.keys(n).reduce((function(e,r){var i=t.entityMetadata.columns.find((function(e){return e.propertyPath===r}));return i&&(e[i.databasePath]=n[r]),e}),{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tableName,this.columns.map((function(e){return e.databaseName}))),this},e}(),Tt=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t),r=this.collectColumns(e,t,n);if(!n.length||!t.createForeignKeyConstraints)return{foreignKey:void 0,columns:r,uniqueConstraint:void 0};var i=new bt({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if(this.connection.driver instanceof y.OracleDriver&&r.every((function(e){return e.isPrimary})))return{foreignKey:i,columns:r,uniqueConstraint:void 0};if(n.length>0&&t.isOneToOne){var a=new Et({entityMetadata:t.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tableName,i.columns.map((function(e){return e.databaseName}))),target:t.entityMetadata.target}});return a.build(this.connection.namingStrategy),{foreignKey:i,columns:r,uniqueConstraint:a}}return{foreignKey:i,columns:r,uniqueConstraint:void 0}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find((function(e){return!!e.referencedColumnName})),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map((function(e){var n=t.inverseEntityMetadata.ownColumns.find((function(t){return t.propertyName===e.referencedColumnName}));if(!n)throw new g.TypeORMError("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n}))},e.prototype.collectColumns=function(e,t,n){var r=this;return n.map((function(n){var i=e.find((function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)})),a=i?i.name:r.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),o=t.entityMetadata.ownColumns.find((function(e){return e.databaseName===a}));return o||(o=new Oe({connection:r.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:n.type,length:n.length||!(r.connection.driver instanceof y.MysqlDriver||r.connection.driver instanceof y.AuroraDataApiDriver)||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,enum:n.enum,enumName:n.enumName,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(o)),o.referencedColumn=n,o.type=n.type,o.relationMetadata=t,o.build(r.connection),o}))},e}(),Mt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=this,r=t.shift();r&&e[r]&&(0===t.length?e[r]instanceof Array?e[r].map((function(e){return e[n.propertyName]()})):e[r][this.propertyName]():e[r]&&this.callEntityEmbeddedMethod(e[r],t))},e}(),Nt=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tableName,this.expression),this},e}(),Ct=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tableName,this.expression),this},e}(),Rt=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new _t(e),this.closureJunctionEntityMetadataBuilder=new wt(e),this.relationJoinColumnBuilder=new Tt(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter((function(e){return"regular"===e.type||"closure"===e.type||"entity-child"===e.type||"view"===e.type})).map((function(e){return t.createEntityMetadata(e)}));return n.forEach((function(e){return t.computeParentEntityMetadata(n,e)})),n.forEach((function(e){e.childEntityMetadatas=n.filter((function(t){return e.target instanceof Function&&t.target instanceof Function&&i.isInherited(t.target,e.target)}))})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){return e.build()})),n.filter((function(e){return"entity-child"===e.tableType})).forEach((function(e){return e.build()})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){return t.computeEntityMetadataStep1(n,e)})),n.filter((function(e){return"entity-child"===e.tableType})).forEach((function(e){return t.computeEntityMetadataStep1(n,e)})),n.forEach((function(e){return t.computeEntityMetadataStep2(e)})),n.forEach((function(e){return t.computeInverseProperties(e,n)})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){e.relations.filter((function(e){return e.isOneToOne||e.isManyToOne})).forEach((function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n),a=i.foreignKey,o=i.columns,s=i.uniqueConstraint;if(a&&(n.registerForeignKeys(a),e.foreignKeys.push(a)),o&&n.registerJoinColumns(o),s)if(t.connection.driver instanceof y.MysqlDriver||t.connection.driver instanceof y.AuroraDataApiDriver||t.connection.driver instanceof y.SqlServerDriver||t.connection.driver instanceof y.SapDriver){var u=new dt({entityMetadata:s.entityMetadata,columns:s.columns,args:{target:s.target,name:s.name,unique:!0,synchronize:!0}});t.connection.driver instanceof y.SqlServerDriver&&(u.where=u.columns.map((function(e){return t.connection.driver.escape(e.databaseName)+" IS NOT NULL"})).join(" AND ")),n.embeddedMetadata?n.embeddedMetadata.indices.push(u):n.entityMetadata.ownIndices.push(u),t.computeEntityMetadataStep2(e)}else n.embeddedMetadata?n.embeddedMetadata.uniques.push(s):n.entityMetadata.ownUniques.push(s),t.computeEntityMetadataStep2(e);a&&t.connection.driver instanceof y.CockroachDriver&&(u=new dt({entityMetadata:n.entityMetadata,columns:a.columns,args:{target:n.entityMetadata.target,synchronize:!0}}),n.embeddedMetadata?n.embeddedMetadata.indices.push(u):n.entityMetadata.ownIndices.push(u),t.computeEntityMetadataStep2(e))})),e.relations.filter((function(e){return e.isManyToMany})).forEach((function(e){var i=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(i){var a=t.junctionEntityMetadataBuilder.build(e,i);e.registerForeignKeys.apply(e,(0,r.__spreadArray)([],(0,r.__read)(a.foreignKeys))),e.registerJoinColumns(a.ownIndices[0].columns,a.ownIndices[1].columns),e.registerJunctionEntityMetadata(a),t.computeEntityMetadataStep2(a),t.computeInverseProperties(a,n),n.push(a)}}))})),n.forEach((function(e){e.relationsWithJoinColumns=e.relations.filter((function(e){return e.isWithJoinColumn})),e.hasNonNullableRelations=e.relationsWithJoinColumns.some((function(e){return!e.isNullable||e.isPrimary}))})),n.filter((function(e){return"closure-table"===e.treeType})).forEach((function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadataStep2(r),t.computeInverseProperties(r,n),n.push(r)})),n.filter((function(e){return"STI"===e.inheritancePattern&&e.discriminatorColumn})).forEach((function(e){return t.createKeysForTableInheritance(e)})),n.forEach((function(e){e.indices.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.uniques.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.checks.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.exclusions.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.filter((function(e){return e.target instanceof Function})).forEach((function(e){e.relations.filter((function(e){return e.isLazy})).forEach((function(n){t.connection.relationLoader.enableLazyLoad(n,e.target.prototype)}))})),n.forEach((function(e){e.columns.forEach((function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,"uuid"===r.strategy?n.type="uuid":"rowid"===r.strategy?n.type="int":n.type=n.type||Number,n.build(t.connection),t.computeEntityMetadataStep2(e))}))})),n},e.prototype.createEntityMetadata=function(e){var t,n=e.target instanceof Function?i.getInheritanceTree(e.target):[e.target],a=this.metadataArgsStorage.findInheritanceType(e.target),o=this.metadataArgsStorage.findTree(e.target);return(a&&"STI"===a.pattern||"entity-child"===e.type)&&(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map((function(e){return e.target})).filter((function(e){return e instanceof Function})),n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(t)))),new de.EntityMetadata({connection:this.connection,args:e,inheritanceTree:n,tableTree:o,inheritancePattern:a?a.pattern:void 0})},e.prototype.computeParentEntityMetadata=function(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find((function(e){return-1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern})))},e.prototype.computeEntityMetadataStep1=function(e,t){var n,i,a,o=this,s=this.metadataArgsStorage.findInheritanceType(t.target),u=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=void 0!==u?u.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map((function(e){return"STI"===t.inheritancePattern&&(e.columns=e.columns.map((function(e){return e.isNullable=!0,e}))),e})),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map((function(n){if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find((function(e){return e.propertyName===n.propertyName}));var r=new Oe({connection:o.connection,entityMetadata:t,args:n});return e.find((function(e){return"entity-child"===e.tableType&&e.target===n.target}))&&(r.isNullable=!0),r})),s&&s.column){var c=s.column&&s.column.name?s.column.name:"type",l=t.ownColumns.find((function(e){return e.propertyName===c}));l?l.isDiscriminator=!0:((l=new Oe({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:c,options:s.column||{name:c,type:"varchar",nullable:!1}}})).isVirtual=!0,l.isDiscriminator=!0,t.ownColumns.push(l))}if("entity-child"===t.tableType){var h=t.parentEntityMetadata.ownColumns.find((function(e){return e.isDiscriminator}));h&&!t.ownColumns.find((function(e){return e===h}))&&t.ownColumns.push(h)}var p=this.connection.namingStrategy;if("materialized-path"===t.treeType)t.ownColumns.push(new Oe({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:p.materializedPathColumnName,type:"varchar",nullable:!0,default:""}}}));else if("nested-set"===t.treeType){var d=p.nestedSetColumnNames,f=d.left,m=d.right;t.ownColumns.push(new Oe({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:f,options:{name:f,type:"integer",nullable:!1,default:1}}})),t.ownColumns.push(new Oe({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:m,options:{name:m,type:"integer",nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map((function(e){if("entity-child"===t.tableType){var n=t.parentEntityMetadata.ownRelations.find((function(t){return t.propertyName===e.propertyName})),r=e.type instanceof Function?e.type():e.type;if(n.type!==r){var i=Object.create(n);return i.type=r,i}return n}return new ft({entityMetadata:t,args:e})})),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find((function(t){return t.propertyName===e.propertyName})):new yt({entityMetadata:t,args:e})})),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find((function(t){return t.propertyName===e.propertyName})):new vt({entityMetadata:t,args:e})})),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map((function(e){return new Mt({entityMetadata:t,args:e})})),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map((function(e){return new Nt({entityMetadata:t,args:e})})),this.connection.driver instanceof y.PostgresDriver&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map((function(e){return new Ct({entityMetadata:t,args:e})}))),this.connection.driver instanceof y.CockroachDriver){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((function(e){return!e.unique})).map((function(e){return new dt({entityMetadata:t,args:e})}));var v=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((function(e){return e.unique})).map((function(e){return new Et({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})}));(n=t.ownUniques).push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(v)))}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map((function(e){return new dt({entityMetadata:t,args:e})}));if(this.connection.driver instanceof y.MysqlDriver||this.connection.driver instanceof y.AuroraDataApiDriver||this.connection.driver instanceof y.SapDriver){var g=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((function(e){return new dt({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})}));(i=t.ownIndices).push.apply(i,(0,r.__spreadArray)([],(0,r.__read)(g)))}else v=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((function(e){return new Et({entityMetadata:t,args:e})})),(a=t.ownUniques).push.apply(a,(0,r.__spreadArray)([],(0,r.__read)(v)))},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map((function(t){var r=new mt({entityMetadata:e,args:t}),a=i.getInheritanceTree(r.type);return r.columns=n.metadataArgsStorage.filterColumns(a).map((function(t){return new Oe({connection:n.connection,entityMetadata:e,embeddedMetadata:r,args:t})})),r.relations=n.metadataArgsStorage.filterRelations(a).map((function(t){return new ft({entityMetadata:e,embeddedMetadata:r,args:t})})),r.listeners=n.metadataArgsStorage.filterListeners(a).map((function(t){return new Mt({entityMetadata:e,embeddedMetadata:r,args:t})})),r.indices=n.metadataArgsStorage.filterIndices(a).map((function(t){return new dt({entityMetadata:e,embeddedMetadata:r,args:t})})),r.uniques=n.metadataArgsStorage.filterUniques(a).map((function(t){return new Et({entityMetadata:e,embeddedMetadata:r,args:t})})),r.relationIds=n.metadataArgsStorage.filterRelationIds(a).map((function(t){return new yt({entityMetadata:e,args:t})})),r.relationCounts=n.metadataArgsStorage.filterRelationCounts(a).map((function(t){return new vt({entityMetadata:e,args:t})})),r.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(a)),r.embeddeds.forEach((function(e){return e.parentEmbeddedMetadata=r})),e.allEmbeddeds.push(r),r}))},e.prototype.computeEntityMetadataStep2=function(e){var t=this;e.embeddeds.forEach((function(e){return e.build(t.connection)})),e.embeddeds.forEach((function(e){e.columnsFromTree.forEach((function(e){return e.build(t.connection)})),e.relationsFromTree.forEach((function(e){return e.build()}))})),e.ownColumns.forEach((function(e){return e.build(t.connection)})),e.ownRelations.forEach((function(e){return e.build()})),e.relations=e.embeddeds.reduce((function(e,t){return e.concat(t.relationsFromTree)}),e.ownRelations),e.eagerRelations=e.relations.filter((function(e){return e.isEager})),e.lazyRelations=e.relations.filter((function(e){return e.isLazy})),e.oneToOneRelations=e.relations.filter((function(e){return e.isOneToOne})),e.oneToManyRelations=e.relations.filter((function(e){return e.isOneToMany})),e.manyToOneRelations=e.relations.filter((function(e){return e.isManyToOne})),e.manyToManyRelations=e.relations.filter((function(e){return e.isManyToMany})),e.ownerOneToOneRelations=e.relations.filter((function(e){return e.isOneToOneOwner})),e.ownerManyToManyRelations=e.relations.filter((function(e){return e.isManyToManyOwner})),e.treeParentRelation=e.relations.find((function(e){return e.isTreeParent})),e.treeChildrenRelation=e.relations.find((function(e){return e.isTreeChildren})),e.columns=e.embeddeds.reduce((function(e,t){return e.concat(t.columnsFromTree)}),e.ownColumns),e.listeners=e.embeddeds.reduce((function(e,t){return e.concat(t.listenersFromTree)}),e.ownListeners),e.afterLoadListeners=e.listeners.filter((function(e){return e.type===gt.AFTER_LOAD})),e.afterInsertListeners=e.listeners.filter((function(e){return e.type===gt.AFTER_INSERT})),e.afterUpdateListeners=e.listeners.filter((function(e){return e.type===gt.AFTER_UPDATE})),e.afterRemoveListeners=e.listeners.filter((function(e){return e.type===gt.AFTER_REMOVE})),e.beforeInsertListeners=e.listeners.filter((function(e){return e.type===gt.BEFORE_INSERT})),e.beforeUpdateListeners=e.listeners.filter((function(e){return e.type===gt.BEFORE_UPDATE})),e.beforeRemoveListeners=e.listeners.filter((function(e){return e.type===gt.BEFORE_REMOVE})),e.indices=e.embeddeds.reduce((function(e,t){return e.concat(t.indicesFromTree)}),e.ownIndices),e.uniques=e.embeddeds.reduce((function(e,t){return e.concat(t.uniquesFromTree)}),e.ownUniques),e.primaryColumns=e.columns.filter((function(e){return e.isPrimary})),e.nonVirtualColumns=e.columns.filter((function(e){return!e.isVirtual})),e.ancestorColumns=e.columns.filter((function(e){return"ancestor"===e.closureType})),e.descendantColumns=e.columns.filter((function(e){return"descendant"===e.closureType})),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter((function(e){return e.isGenerated||e.isObjectId})),e.hasUUIDGeneratedColumns=e.columns.filter((function(e){return e.isGenerated||"uuid"===e.generationStrategy})).length>0,e.createDateColumn=e.columns.find((function(e){return e.isCreateDate})),e.updateDateColumn=e.columns.find((function(e){return e.isUpdateDate})),e.deleteDateColumn=e.columns.find((function(e){return e.isDeleteDate})),e.versionColumn=e.columns.find((function(e){return e.isVersion})),e.discriminatorColumn=e.columns.find((function(e){return e.isDiscriminator})),e.treeLevelColumn=e.columns.find((function(e){return e.isTreeLevel})),e.nestedSetLeftColumn=e.columns.find((function(e){return e.isNestedSetLeft})),e.nestedSetRightColumn=e.columns.find((function(e){return e.isNestedSetRight})),e.materializedPathColumn=e.columns.find((function(e){return e.isMaterializedPath})),e.objectIdColumn=e.columns.find((function(e){return e.isObjectId})),e.foreignKeys.forEach((function(e){return e.build(t.connection.namingStrategy)})),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach((function(e){return e.build()})),e.relationCounts.forEach((function(e){return e.build()})),e.embeddeds.forEach((function(e){e.relationIdsFromTree.forEach((function(e){return e.build()})),e.relationCountsFromTree.forEach((function(e){return e.build()}))}))},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach((function(n){var r=t.find((function(e){return e.target===n.type||"string"==typeof n.type&&(e.targetName===n.type||e.givenTableName===n.type)}));if(!r)throw new g.TypeORMError("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find((function(e){return e.propertyPath===n.inverseSidePropertyPath}))}))},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new dt({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))},e}(),At=function(){function e(){}return e.prototype.transform=function(e){var t=new a;return e.forEach((function(e){var n=e.options,i={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize,expression:n.expression};t.tables.push(i),Object.keys(n.columns).forEach((function(e){var r=n.columns[e],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.deleteDate&&(i="deleteDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel"),r.objectId&&(i="objectId");var a={target:n.target||n.name,mode:i,propertyName:e,options:{type:r.type,name:r.objectId?"_id":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,update:r.update,select:r.select,insert:r.insert,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer,spatialFeatureType:r.spatialFeatureType,srid:r.srid}};if(t.columns.push(a),r.generated){var o={target:n.target||n.name,propertyName:e,strategy:"string"==typeof r.generated?r.generated:"increment"};t.generations.push(o)}r.unique&&t.uniques.push({target:n.target||n.name,columns:[e]})})),n.relations&&Object.keys(n.relations).forEach((function(e){var i,a,o=n.relations[e],s={target:n.target||n.name,propertyName:e,relationType:o.type,isLazy:o.lazy||!1,type:o.target,inverseSideProperty:o.inverseSide,isTreeParent:o.treeParent,isTreeChildren:o.treeChildren,options:{eager:o.eager||!1,cascade:o.cascade,nullable:o.nullable,onDelete:o.onDelete,onUpdate:o.onUpdate,deferrable:o.deferrable,primary:o.primary,persistence:o.persistence,orphanedRowAction:o.orphanedRowAction}};if(t.relations.push(s),o.joinColumn)if("boolean"==typeof o.joinColumn){var u={target:n.target||n.name,propertyName:e};t.joinColumns.push(u)}else{var c=Array.isArray(o.joinColumn)?o.joinColumn:[o.joinColumn];try{for(var l=(0,r.__values)(c),h=l.next();!h.done;h=l.next()){var p=h.value;u={target:n.target||n.name,propertyName:e,name:p.name,referencedColumnName:p.referencedColumnName},t.joinColumns.push(u)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}}if(o.joinTable)if("boolean"==typeof o.joinTable){var d={target:n.target||n.name,propertyName:e};t.joinTables.push(d)}else d={target:n.target||n.name,propertyName:e,name:o.joinTable.name,database:o.joinTable.database,schema:o.joinTable.schema,joinColumns:o.joinTable.joinColumn?[o.joinTable.joinColumn]:o.joinTable.joinColumns,inverseJoinColumns:o.joinTable.inverseJoinColumn?[o.joinTable.inverseJoinColumn]:o.joinTable.inverseJoinColumns},t.joinTables.push(d)})),n.indices&&n.indices.forEach((function(e){var r={target:n.target||n.name,name:e.name,unique:!0===e.unique,spatial:!0===e.spatial,fulltext:!0===e.fulltext,parser:e.parser,synchronize:!1!==e.synchronize,where:e.where,sparse:e.sparse,columns:e.columns};t.indices.push(r)})),n.uniques&&n.uniques.forEach((function(e){var r={target:n.target||n.name,name:e.name,columns:e.columns};t.uniques.push(r)})),n.checks&&n.checks.forEach((function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.checks.push(r)})),n.exclusions&&n.exclusions.forEach((function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.exclusions.push(r)}))})),t},e}(),Ot=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=(0,r.__read)(Z.OrmUtils.splitClassesAndStrings(e),2),n=t[0];return t[1],(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(n)),(0,r.__read)(lt(this.connection.logger))).map((function(e){return pt(e)}))},e.prototype.buildSubscribers=function(e){var t=(0,r.__read)(Z.OrmUtils.splitClassesAndStrings(e||[]),2),n=t[0],i=(t[1],(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(n)),(0,r.__read)(lt(this.connection.logger))));return Kt().filterSubscribers(i).map((function(e){return pt(e.target)}))},e.prototype.buildEntityMetadatas=function(e){var t=(0,r.__read)(Z.OrmUtils.splitClassesAndStrings(e||[]),2),n=t[0],i=(t[1],n.filter((function(e){return e instanceof we.EntitySchema==0}))),a=n.filter((function(e){return e instanceof we.EntitySchema})),o=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(i)),(0,r.__read)(lt(this.connection.logger)));o.forEach((function(e){e instanceof we.EntitySchema&&a.push(e)}));var s=new Rt(this.connection,Kt()).build(o),u=(new At).transform(a),c=new Rt(this.connection,u).build();return(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s)),(0,r.__read)(c))},e}(),xt=n(1814),St=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("query: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),Pt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");o.logInfo("query:",o.highlightSql(r))}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");o.logError("query failed:",o.highlightSql(i)),o.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");o.logWarn("query is slow:",o.highlightSql(i)),o.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&o.log(e)},e.prototype.logMigration=function(e,t){o.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&o.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&o.logInfo("INFO:",t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(o.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),qt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t}(function(){function e(){}return e.prototype.logQuery=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logQueryError=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logQuerySlow=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logSchemaBuild=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.logMigration=function(){throw new Error("This logger is not applicable in a browser context")},e.prototype.log=function(){throw new Error("This logger is not applicable in a browser context")},e}()),Dt=n(495),It=n.n(Dt),jt=function(){function e(){this.debugQueryLog=It()("typeorm:query:log"),this.debugQueryError=It()("typeorm:query:error"),this.debugQuerySlow=It()("typeorm:query:slow"),this.debugSchemaBuild=It()("typeorm:schema"),this.debugMigration=It()("typeorm:migration"),this.debugLog=It()("typeorm:log"),this.debugInfo=It()("typeorm:info"),this.debugWarn=It()("typeorm:warn")}return e.prototype.logQuery=function(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(o.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))},e.prototype.logQueryError=function(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(o.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))},e.prototype.logQuerySlow=function(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(o.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),Bt=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new St(t);case"file":return new qt(t);case"advanced-console":return new Pt(t);case"debug":return new jt}return new Pt(t)},e}(),Lt=function(){function e(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}return e.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){if(e=this.connection.options.cache,"redis"===this.clientType)e&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient();else if("ioredis"===this.clientType)e&&e.port?e.options?this.client=new this.redis(e.port,e.options):this.client=new this.redis(e.port):e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType)if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new q.TypeORMError("options.startupNodes required for "+this.clientType+".");this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}return[2]}))}))},e.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.client.quit((function(r,i){if(r)return n(r);t(),e.client=void 0}))}))]}))}))},e.prototype.synchronize=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2]}))}))},e.prototype.getFromCache=function(e,t){var n=this;return new Promise((function(t,r){e.identifier?n.client.get(e.identifier,(function(e,n){if(e)return r(e);t(JSON.parse(n))})):e.query?n.client.get(e.query,(function(e,n){if(e)return r(e);t(JSON.parse(n))})):t(void 0)}))},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t=this;return(0,r.__generator)(this,(function(n){return[2,new Promise((function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,(function(e,t){if(e)return r(e);n()})):e.query&&t.client.set(e.query,JSON.stringify(e),"PX",e.duration,(function(e,t){if(e)return r(e);n()}))}))]}))}))},e.prototype.clear=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e=this;return(0,r.__generator)(this,(function(t){return[2,new Promise((function(t,n){e.client.flushdb((function(e,r){if(e)return n(e);t()}))}))]}))}))},e.prototype.remove=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t=this;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t.deleteKey(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype.deleteKey=function(e){var t=this;return new Promise((function(n,r){t.client.del(e,(function(e,t){if(e)return r(e);n()}))}))},e.prototype.loadRedis=function(){try{return"ioredis/cluster"===this.clientType?o.load("ioredis"):o.load(this.clientType)}catch(e){throw new q.TypeORMError("Cannot use cache because "+this.clientType+' is not installed. Please run "npm i '+this.clientType+' --save".')}},e}(),Ut=function(){function e(e){this.connection=e;var t=this.connection.driver.options.schema,n=this.connection.driver.database,r=("object"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheDatabase=n,this.queryResultCacheSchema=t,this.queryResultCacheTable=this.connection.driver.buildTableName(r,t,n)}return e.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2]}))}))},e.prototype.disconnect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2]}))}))},e.prototype.synchronize=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(this.queryResultCacheTable)];case 1:return n.sent()?[2]:[4,e.createTable(new l.Table({database:this.queryResultCacheDatabase,schema:this.queryResultCacheSchema,name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return n.sent(),[2]}}))}))},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof y.SqlServerDriver?new v(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?this.connection.driver instanceof y.OracleDriver?n.where("dbms_lob.compare("+n.escape("cache")+"."+n.escape("query")+", :query) = 0",{query:e.query}).getRawOne():n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof y.SqlServerDriver?new v(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){var t="string"==typeof e.duration?parseInt(e.duration):e.duration;return("string"==typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=this.getQueryRunner(n),i=e,this.connection.driver instanceof y.SqlServerDriver&&(i={identifier:new v(e.identifier,"nvarchar"),time:new v(e.time,"bigint"),duration:new v(e.duration,"int"),query:new v(e.query,"nvarchar"),result:new v(e.result,"nvarchar")}),t&&t.identifier?((a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i)).where(a.escape("identifier")+" = :condition",{condition:i.identifier}),[4,a.execute()]):[3,2];case 1:return r.sent(),[3,6];case 2:return t&&t.query?(a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i),this.connection.driver instanceof y.OracleDriver?a.where('dbms_lob.compare("query", :condition) = 0',{condition:i.query}):a.where(a.escape("query")+" = :condition",{condition:i.query}),[4,a.execute()]):[3,4];case 3:return r.sent(),[3,6];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(i).execute()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},e.prototype.clear=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){return[2,this.getQueryRunner(e).clearTable(this.queryResultCacheTable)]}))}))},e.prototype.remove=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,Promise.all(e.map((function(e){var r=n.getQueryRunner(t).manager.createQueryBuilder();return r.delete().from(n.queryResultCacheTable).where(r.escape("identifier")+" = :identifier",{identifier:e}).execute()})))];case 1:return r.sent(),[2]}}))}))},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner()},e}(),Ft=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new q.TypeORMError("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");var e=this.connection.options.cache;return e.provider&&"function"==typeof e.provider?e.provider(this.connection):"redis"===e.type||"ioredis"===e.type||"ioredis/cluster"===e.type?new Lt(this.connection,e.type):new Ut(this.connection)},e}(),kt=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n):this.loadManyToManyNotOwner(e,t,n)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.entityMetadata.primaryColumns,a=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map((function(t){return e.entityMetadata.name+"."+t.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName})).join(" AND "),o=e.entityMetadata.name,s=this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,o,a);if(1===i.length)s.where(o+"."+i[0].propertyPath+" IN (:..."+o+"_"+i[0].propertyName+")"),s.setParameter(o+"_"+i[0].propertyName,r.map((function(e){return i[0].getEntityValue(e)})));else{var u=r.map((function(e,t){return i.map((function(n,r){var i=o+"_entity_"+t+"_"+r;return s.setParameter(i,n.getEntityValue(e)),o+"."+n.propertyPath+" = :"+i})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ");s.where(u)}return s.getMany()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.inverseRelation.joinColumns,o=this.connection.createQueryBuilder(n).select(i).from(e.inverseRelation.entityMetadata.target,i);if(1===a.length)o.where(i+"."+a[0].propertyPath+" IN (:..."+i+"_"+a[0].propertyName+")"),o.setParameter(i+"_"+a[0].propertyName,r.map((function(e){return a[0].referencedColumn.getEntityValue(e)})));else{var s=r.map((function(e,t){return a.map((function(n,r){var a=i+"_entity_"+t+"_"+r;return o.setParameter(a,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+a})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ");o.where(s)}return o.getMany()},e.prototype.loadManyToManyOwner=function(e,t,n){var i=Array.isArray(t)?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.joinColumns.map((function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"})),u=e.inverseJoinColumns.map((function(e){return o+"."+e.propertyName+"="+a+"."+e.referencedColumn.propertyName})),c=e.joinColumns.reduce((function(e,t){return e[t.propertyName]=i.map((function(e){return t.referencedColumn.getEntityValue(e)})),e}),{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s)),(0,r.__read)(u)).join(" AND ")).setParameters(c).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t,n){var i=Array.isArray(t)?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.inverseRelation.joinColumns.map((function(e){return o+"."+e.propertyName+" = "+a+"."+e.referencedColumn.propertyName})),u=e.inverseRelation.inverseJoinColumns.map((function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"})),c=e.inverseRelation.inverseJoinColumns.reduce((function(e,t){return e[t.propertyName]=i.map((function(e){return t.referencedColumn.getEntityValue(e)})),e}),{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s)),(0,r.__read)(u)).join(" AND ")).setParameters(c).getMany()},e.prototype.enableLazyLoad=function(e,t,n){var r=this,i="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",o="__has_"+e.propertyName+"__",s=function(e,t){return e[i]=t,e[o]=!0,delete e[a],t},u=function(e,t){return delete e[o],delete e[i],e[a]=t,t.then((function(n){return e[a]===t?s(e,n):n})),t};Object.defineProperty(t,e.propertyName,{get:function(){if(!0===this[o]||void 0!==this[i])return Promise.resolve(this[i]);if(this[a])return this[a];var t=r.load(e,this,n).then((function(t){return e.isOneToOne||e.isManyToOne?0===t.length?null:t[0]:t}));return u(this,t)},set:function(e){e instanceof Promise?u(this,e):s(this,e)},configurable:!0})},e}(),Qt=function(){function e(e){this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new Bt).create(this.options.logger,this.options.logging),this.driver=(new ct).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new h,this.queryResultCache=e.cache?new Ft(this).create():void 0,this.relationLoader=new kt(this),this.isConnected=!1}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof y.MongoEntityManager))throw new q.TypeORMError("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof Te))throw new q.TypeORMError("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!1,configurable:!0}),e.prototype.connect=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:if(this.isConnected)throw new d.CannotConnectAlreadyConnectedError(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:_e.ObjectUtils.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations({transaction:this.options.migrationsTransactionMode})]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}}))}))},e.prototype.close=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:if(!this.isConnected)throw new p.CannotExecuteNotConnectedError(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return _e.ObjectUtils.assign(this,{isConnected:!1}),[2]}}))}))},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){switch(t.label){case 0:if(!this.isConnected)throw new p.CannotExecuteNotConnectedError(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return t.sent(),[2]}}))}))},e.prototype.dropDatabase=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u;return(0,r.__generator)(this,(function(c){switch(c.label){case 0:e=this.createQueryRunner(),c.label=1;case 1:if(c.trys.push([1,,13,15]),!(this.driver instanceof y.SqlServerDriver||this.driver instanceof y.MysqlDriver||this.driver instanceof y.AuroraDataApiDriver))return[3,10];t=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach((function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)})),c.label=2;case 2:c.trys.push([2,7,8,9]),n=(0,r.__values)(t),i=n.next(),c.label=3;case 3:return i.done?[3,6]:(a=i.value,[4,e.clearDatabase(a)]);case 4:c.sent(),c.label=5;case 5:return i=n.next(),[3,3];case 6:return[3,9];case 7:return o=c.sent(),s={error:o},[3,9];case 8:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 9:return[3,12];case 10:return[4,e.clearDatabase()];case 11:c.sent(),c.label=12;case 12:return[3,15];case 13:return[4,e.release()];case 14:return c.sent(),[7];case 15:return[2]}}))}))},e.prototype.runMigrations=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new p.CannotExecuteNotConnectedError(this.name);return(t=new b(this)).transaction=e&&e.transaction||"all",[4,t.executePendingMigrations()];case 1:return[2,n.sent()]}}))}))},e.prototype.undoLastMigration=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new p.CannotExecuteNotConnectedError(this.name);return(t=new b(this)).transaction=e&&e.transaction||"all",[4,t.undoLastMigration()];case 1:return n.sent(),[2]}}))}))},e.prototype.showMigrations=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:if(!this.isConnected)throw new p.CannotExecuteNotConnectedError(this.name);return[4,new b(this).showMigrations()];case 1:return[2,e.sent()]}}))}))},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new f.EntityMetadataNotFoundError(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof y.MongoDriver))throw new q.TypeORMError("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){return[2,this.manager.transaction(e,t)]}))}))},e.prototype.query=function(e,t,n){return(0,r.__awaiter)(this,void 0,void 0,(function(){var i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(this instanceof y.MongoEntityManager)throw new q.TypeORMError("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new A.QueryRunnerProviderAlreadyReleasedError;i=n||this.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,i.query(e,t)];case 2:return[2,r.sent()];case 3:return n?[3,5]:[4,i.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof y.MongoEntityManager)throw new q.TypeORMError("Query Builder is not supported by MongoDB.");if(t){var r=this.getMetadata(e);return new xt.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new xt.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new q.TypeORMError('Relation "'+t+'" was not found in '+e+" entity.");if(!n.isManyToMany)throw new q.TypeORMError('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new Ke).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find((function(t){return t.target===e||(e instanceof we.EntitySchema?t.name===e.options.name:"string"==typeof e&&(-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e))}))},e.prototype.buildMetadatas=function(){var e=new Ot(this),t=new R,n=e.buildSubscribers(this.options.subscribers||[]);_e.ObjectUtils.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[]);_e.ObjectUtils.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);_e.ObjectUtils.assign(this,{migrations:i}),t.validateMany(this.entityMetadatas.filter((function(e){return"view"!==e.tableType})),this.driver)},e}(),Vt=n(7957),Wt=n(9143),zt=function(){function e(){this.connectionMap=new Map}return Object.defineProperty(e.prototype,"connections",{get:function(){return Array.from(this.connectionMap.values())},enumerable:!1,configurable:!0}),e.prototype.has=function(e){return this.connectionMap.has(e)},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connectionMap.get(e);if(!t)throw new Vt.ConnectionNotFoundError(e);return t},e.prototype.create=function(e){var t=this.connectionMap.get(e.name||"default");if(t&&t.isConnected)throw new Wt.AlreadyHasActiveConnectionError(e.name||"default");var n=new Qt(e);return this.connectionMap.set(n.name,n),n},e}();function Kt(){var e=o.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new a),e.typeormMetadataArgsStorage}function Jt(e){return void 0===e&&(e="default"),(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(t){return[2,(new s).get(e)]}))}))}function Ht(){return pt(zt)}function Gt(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t="string"==typeof e?e:"default",e instanceof Object?(i=e,[3,3]):[3,1];case 1:return[4,Jt(t)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,Ht().create(n).connect()]}}))}))}var Yt=n(5586);function $t(e,t){return function(n,r){var i;"string"==typeof e||e instanceof Function?i=e:e&&(t=e,i=e.type),t||(t={});var a=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",n,r):void 0;if(!i&&a&&(i=a),!t.type&&i&&(t.type=i),"hstore"!==t.type||t.hstoreType||(t.hstoreType=a===Object?"object":"string"),e instanceof Function)Kt().embeddeds.push({target:n.constructor,propertyName:r,isArray:a===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:e});else{if(!t.type)throw new Yt.ColumnTypeUndefinedError(n,r);!0===t.unique&&Kt().uniques.push({target:n.constructor,columns:[r]}),Kt().columns.push({target:n.constructor,propertyName:r,mode:"regular",options:t}),t.generated&&Kt().generations.push({target:n.constructor,propertyName:r,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}function Xt(e){return function(t,n){Kt().columns.push({target:t.constructor,propertyName:n,mode:"createDate",options:e||{}})}}function Zt(e,t){var n,r={};return e?("string"==typeof e&&(n=e),e instanceof Object&&(n="increment",Object.assign(r,e))):n="increment",t instanceof Object&&Object.assign(r,t),function(e,t){r.type||("increment"===n?r.type=Number:"uuid"===n?r.type="uuid":"rowid"===n&&(r.type="int")),r.primary=!0,Kt().columns.push({target:e.constructor,propertyName:t,mode:"regular",options:r}),Kt().generations.push({target:e.constructor,propertyName:t,strategy:n})}}function en(e){return function(t,n){Kt().columns.push({target:t.constructor,propertyName:n,mode:"updateDate",options:e||{}})}}function tn(e){return function(t,n){(Array.isArray(e)?e:[e||{}]).forEach((function(e){Kt().joinColumns.push({target:t.constructor,propertyName:n,name:e.name,referencedColumnName:e.referencedColumnName})}))}}function nn(e,t,n){var r;return"object"==typeof t?n=t:r=t,function(t,i){n||(n={});var a=n&&!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",t,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}Kt().relations.push({target:t.constructor,propertyName:i,relationType:"many-to-one",isLazy:a,type:e,inverseSideProperty:r,options:n})}}function rn(e,t,n){return function(r,i){n||(n={});var a=n&&!0===n.lazy;if(!a&&Reflect&&Reflect.getMetadata){var o=Reflect.getMetadata("design:type",r,i);o&&"string"==typeof o.name&&"promise"===o.name.toLowerCase()&&(a=!0)}Kt().relations.push({target:r.constructor,propertyName:i,isLazy:a,relationType:"one-to-many",type:e,inverseSideProperty:t,options:n})}}function an(e,t){var n=("object"==typeof e?e:t)||{},r="string"==typeof e?e:n.name;return function(e){Kt().tables.push({target:e,name:r,type:"regular",orderBy:n.orderBy?n.orderBy:void 0,engine:n.engine?n.engine:void 0,database:n.database?n.database:void 0,schema:n.schema?n.schema:void 0,synchronize:n.synchronize,withoutRowid:n.withoutRowid})}}n(4951),n(7622),n(5367),function(){function e(){}e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(e){return this.constructor.getRepository().save(this,e)},e.prototype.remove=function(e){return this.constructor.getRepository().remove(this,e)},e.prototype.softRemove=function(e){return this.constructor.getRepository().softRemove(this,e)},e.prototype.recover=function(e){return this.constructor.getRepository().recover(this,e)},e.prototype.reload=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,(e=this.constructor).getRepository().findOneOrFail(e.getId(this))];case 1:return t=n.sent(),_e.ObjectUtils.assign(this,t),[2]}}))}))},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||(void 0===e&&(e="default"),Ht().get(e))).getRepository(this);var e},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!1,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.getRepository()).merge.apply(t,(0,r.__spreadArray)([e],(0,r.__read)(n)))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.softRemove=function(e,t){return this.getRepository().softRemove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.findOneOrFail=function(e,t){return this.getRepository().findOneOrFail(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()}}(),n(6170),n(380),n(856),n(5254),n(5749),n(5766),n(6110),n(4368),n(4494)},4291:(e,t,n)=>{"use strict";n.d(t,{EntityMetadata:()=>s});var r=n(9312),i=n(5602),a=n(7081),o=n(3925),s=function(){function e(e){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isAlwaysUsingConstructor=!0,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.treeOptions=e.tableTree?e.tableTree.options:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid}return e.prototype.create=function(e,t){var n,r=this;if(this.target instanceof Function)return n=!(null==t?void 0:t.fromDeserializer)||this.isAlwaysUsingConstructor?new this.target:Object.create(this.target.prototype),this.lazyRelations.forEach((function(t){return r.connection.relationLoader.enableLazyLoad(t,n,e)})),n;var i={};return this.lazyRelations.forEach((function(t){return r.connection.relationLoader.enableLazyLoad(t,i,e)})),i},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every((function(t){var n=t.getEntityValue(e);return null!=n&&""!==n}))},e.prototype.hasAllPrimaryKeys=function(e){return this.primaryColumns.every((function(t){return null!=t.getEntityValue(e)}))},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new i.CannotCreateEntityIdMapError(this,e);return this.primaryColumns[0].createValueMap(e)},e.prototype.getEntityIdMap=function(t){if(t)return e.getValueMap(t,this.primaryColumns,{skipNulls:!0})},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t},e.prototype.compareEntities=function(e,t){var n=this.getEntityIdMap(e);if(!n)return!1;var r=this.getEntityIdMap(t);return!!r&&a.OrmUtils.compareIds(n,r)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find((function(t){return t.propertyName===e}))},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find((function(t){return t.databaseName===e}))},e.prototype.hasColumnWithPropertyPath=function(e){return this.columns.some((function(t){return t.propertyPath===e}))||this.hasRelationWithPropertyPath(e)},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find((function(t){return t.propertyPath===e}));if(t)return t;var n=this.relations.find((function(t){return t.propertyPath===e}));return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find((function(t){return t.propertyPath===e}));if(t)return[t];var n=this.findRelationWithPropertyPath(e);return n&&n.joinColumns?n.joinColumns:[]},e.prototype.hasRelationWithPropertyPath=function(e){return this.relations.some((function(t){return t.propertyPath===e}))},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find((function(t){return t.propertyPath===e}))},e.prototype.hasEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.some((function(t){return t.propertyPath===e}))},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find((function(t){return t.propertyPath===e}))},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=this,r=[];return t.forEach((function(t){var i=t.getEntityValue(e);Array.isArray(i)?i.forEach((function(e){return r.push([t,e,n.getInverseEntityMetadata(e,t)])})):i&&r.push([t,i,n.getInverseEntityMetadata(i,t)])})),r},e.prototype.getInverseEntityMetadata=function(e,t){return t.inverseEntityMetadata.childEntityMetadatas.find((function(t){return t.target===e.constructor}))||t.inverseEntityMetadata},e.createPropertyPath=function(e,t,n){var i=this;void 0===n&&(n="");var a=[];return Object.keys(t).forEach((function(o){var s=n?n+"."+o:o;if(e.hasEmbeddedWithPropertyPath(s)){var u=i.createPropertyPath(e,t[o],s);a.push.apply(a,(0,r.__spreadArray)([],(0,r.__read)(u)))}else{var c=n?n+"."+o:o;a.push(c)}})),a},e.difference=function(e,t){return e.filter((function(e){return!t.find((function(t){return a.OrmUtils.compareIds(e,t)}))}))},e.getValueMap=function(e,t,n){return t.reduce((function(t,r){var i=r.getEntityValueMap(e,n);if(void 0!==t&&null!=i)return a.OrmUtils.mergeDeep(t,i)}),{})},e.prototype.build=function(){var e,t=this.connection.namingStrategy,n=this.connection.options.entityPrefix,r=this.connection.options.entitySkipConstructor;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:(null===(e=this.connection.options)||void 0===e?void 0:e.hasOwnProperty("schema"))&&(this.schema=this.connection.options.schema),this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=t.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=t.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=t.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=(0,o.shorten)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=n?t.prefixTableName(n,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.connection.driver.buildTableName(this.tableName,this.schema,this.database),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,void 0!==r&&(this.isAlwaysUsingConstructor=!r),this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type},e.prototype.registerColumn=function(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce((function(e,t){return e.concat(t.columnsFromTree)}),this.ownColumns),this.primaryColumns=this.columns.filter((function(e){return e.isPrimary})),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter((function(e){return e.isGenerated||"uuid"===e.generationStrategy})).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach((function(t){return t.registerColumn(e)})))},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach((function(t){return a.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))})),this.relations.forEach((function(t){return a.OrmUtils.mergeDeep(e,t.createValueMap(t.propertyPath))})),e},e}()},1100:(e,t,n)=>{"use strict";n.d(t,{MongoDriver:()=>r,MongoQueryRunner:()=>i,MongoEntityManager:()=>a,MongoRepository:()=>o,PostgresDriver:()=>s,AuroraDataApiDriver:()=>u,CockroachDriver:()=>c,SqlServerDriver:()=>l,SapDriver:()=>h,MysqlDriver:()=>p,OracleDriver:()=>d,SqliteDriver:()=>f,BetterSqlite3Driver:()=>m});var r=function(){},i=function(){},a=function(){},o=function(){},s=function(){},u=function(){},c=function(){},l=function(){},h=function(){},p=function(){},d=function(){},f=function(){},m=function(){}},5766:(e,t,n)=>{"use strict";n.d(t,{Brackets:()=>r});var r=function(e){this.whereFactory=e}},380:(e,t,n)=>{"use strict";n.d(t,{DeleteQueryBuilder:()=>l});var r=n(9312),i=n(1100),a=n(6170),o=n(4494),s=n(8164),u=n(5436),c=n(4117),l=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.__extends)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createDeleteExpression()).trim()},t.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,s,c,l,h;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:e=(0,r.__read)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a=!1,p.label=1;case 1:return p.trys.push([1,11,16,19]),!0!==this.expressionMap.useTransaction||!1!==i.isTransactionActive?[3,3]:[4,i.startTransaction()];case 2:p.sent(),a=!0,p.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(l=new u.BroadcasterResult,i.broadcaster.broadcastBeforeRemoveEvent(l,this.expressionMap.mainAlias.metadata),l.promises.length>0?[4,Promise.all(l.promises)]:[3,5]):[3,5];case 4:p.sent(),p.label=5;case 5:return[4,i.query(t,n,!0)];case 6:return s=p.sent(),c=o.DeleteResult.from(s),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(l=new u.BroadcasterResult,i.broadcaster.broadcastAfterRemoveEvent(l,this.expressionMap.mainAlias.metadata),l.promises.length>0?[4,Promise.all(l.promises)]:[3,8]):[3,8];case 7:p.sent(),p.label=8;case 8:return a?[4,i.commitTransaction()]:[3,10];case 9:p.sent(),p.label=10;case 10:return[2,c];case 11:if(h=p.sent(),!a)return[3,15];p.label=12;case 12:return p.trys.push([12,14,,15]),[4,i.rollbackTransaction()];case 13:case 14:return p.sent(),[3,15];case 15:throw h;case 16:return i===this.queryRunner?[3,18]:[4,i.release()];case 17:p.sent(),p.label=18;case 18:return[7];case 19:return[2]}}))}))},t.prototype.from=function(e,t){e=e instanceof c.EntitySchema?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.getWhereInIdsCondition(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.getWhereInIdsCondition(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.getWhereInIdsCondition(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new s.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression();return n&&(this.connection.driver instanceof i.PostgresDriver||this.connection.driver instanceof i.CockroachDriver)?"DELETE FROM "+e+t+" RETURNING "+n:""!==n&&this.connection.driver instanceof i.SqlServerDriver?"DELETE FROM "+e+" OUTPUT "+n+t:"DELETE FROM "+e+t},t}(a.QueryBuilder)},856:(e,t,n)=>{"use strict";n.d(t,{InsertQueryBuilder:()=>f});var r=n(9312),i=n(1100),a=n(6170),o=n(9090),s=n(6110),u=n(8164),c=n(9116),l=n(6287),h=n(2311),p=n(5436),d=n(4117),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return(e+=this.createInsertExpression()).trim()},t.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,o,u,c,h,d,f,m,y,v,g,b,_,w,E,T,M,N,C=this;return(0,r.__generator)(this,(function(R){switch(R.label){case 0:if(0===(e=this.getValueSets()).length)return[2,new s.InsertResult];t=this.obtainQueryRunner(),n=!1,R.label=1;case 1:return R.trys.push([1,13,18,21]),!0!==this.expressionMap.useTransaction||!1!==t.isTransactionActive?[3,3]:[4,t.startTransaction()];case 2:R.sent(),n=!0,R.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(a=new p.BroadcasterResult,e.forEach((function(e){t.broadcaster.broadcastBeforeInsertEvent(a,C.expressionMap.mainAlias.metadata,e)})),a.promises.length>0?[4,Promise.all(a.promises)]:[3,5]):[3,5];case 4:R.sent(),R.label=5;case 5:if(o=null,u=null,c=new l.ReturningResultsEntityUpdator(t,this.expressionMap),h=[],Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)try{for(d=(0,r.__values)(this.expressionMap.returning),f=d.next();!f.done;f=d.next())m=f.value,h.push.apply(h,(0,r.__spreadArray)([],(0,r.__read)(this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(m))))}catch(e){M={error:e}}finally{try{f&&!f.done&&(N=d.return)&&N.call(d)}finally{if(M)throw M.error}}return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(e.length>1&&this.connection.driver instanceof i.OracleDriver||(this.expressionMap.extraReturningColumns=c.getInsertionReturningColumns()),h.push.apply(h,(0,r.__spreadArray)([],(0,r.__read)(this.expressionMap.extraReturningColumns.filter((function(e){return!h.includes(e)})))))),h.length>0&&this.connection.driver instanceof i.SqlServerDriver&&(o=this.connection.driver.buildTableVariableDeclaration("@OutputTable",h),u="SELECT * FROM @OutputTable"),y=(0,r.__read)(this.getQueryAndParameters(),2),v=y[0],g=y[1],b=[o,v,u].filter((function(e){return null!=e})).join(";\n\n"),[4,t.query(b,g,!0)];case 6:return _=R.sent(),w=s.InsertResult.from(_),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,c.insert(w,e)]:[3,8];case 7:R.sent(),R.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(E=new p.BroadcasterResult,e.forEach((function(e){t.broadcaster.broadcastAfterInsertEvent(E,C.expressionMap.mainAlias.metadata,e)})),E.promises.length>0?[4,Promise.all(E.promises)]:[3,10]):[3,10];case 9:R.sent(),R.label=10;case 10:return n?[4,t.commitTransaction()]:[3,12];case 11:R.sent(),R.label=12;case 12:return[2,w];case 13:if(T=R.sent(),!n)return[3,17];R.label=14;case 14:return R.trys.push([14,16,,17]),[4,t.rollbackTransaction()];case 15:case 16:return R.sent(),[3,17];case 17:throw T;case 18:return t===this.queryRunner?[3,20]:[4,t.release()];case 19:R.sent(),R.label=20;case 20:return[7];case 21:return[2]}}))}))},t.prototype.into=function(e,t){e=e instanceof d.EntitySchema?e.options.name:e;var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new u.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.orIgnore=function(e){return void 0===e&&(e=!0),this.expressionMap.onIgnore=!!e,this},t.prototype.orUpdate=function(e,t){return Array.isArray(e)?(this.expressionMap.onUpdate={overwrite:e,conflict:t},this):(this.expressionMap.onUpdate={conflict:null==e?void 0:e.conflict_target,columns:null==e?void 0:e.columns,overwrite:null==e?void 0:e.overwrite},this)},t.prototype.createInsertExpression=function(){var e=this,t=this.getTableName(this.getMainTableName()),n=this.createValuesExpression(),r=this.connection.driver instanceof i.OracleDriver&&this.getValueSets().length>1?null:this.createReturningExpression(),a=this.createColumnNamesExpression(),o="INSERT ";if((this.connection.driver instanceof i.MysqlDriver||this.connection.driver instanceof i.AuroraDataApiDriver)&&(o+=this.expressionMap.onIgnore?" IGNORE ":""),o+="INTO "+t,a?o+="("+a+")":!n&&(this.connection.driver instanceof i.MysqlDriver||this.connection.driver instanceof i.AuroraDataApiDriver)&&(o+="()"),r&&this.connection.driver instanceof i.SqlServerDriver&&(o+=" OUTPUT "+r),n?this.connection.driver instanceof i.OracleDriver&&this.getValueSets().length>1?o+=" "+n:o+=" VALUES "+n:this.connection.driver instanceof i.MysqlDriver||this.connection.driver instanceof i.AuroraDataApiDriver?o+=" VALUES ()":o+=" DEFAULT VALUES",this.connection.driver instanceof i.PostgresDriver||this.connection.driver instanceof h.AbstractSqliteDriver||this.connection.driver instanceof i.CockroachDriver)if(this.expressionMap.onIgnore)o+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)o+=" ON CONFLICT "+this.expressionMap.onConflict+" ";else if(this.expressionMap.onUpdate){var s=this.expressionMap.onUpdate,u=s.overwrite,c=s.columns,l=s.conflict,p="ON CONFLICT";Array.isArray(l)?p+=" ( "+l.map((function(t){return e.escape(t)})).join(", ")+" )":l&&(p+=" ON CONSTRAINT "+this.escape(l)),Array.isArray(u)?(o+=" "+p+" DO UPDATE SET ",o+=null==u?void 0:u.map((function(t){return e.escape(t)+" = EXCLUDED."+e.escape(t)})).join(", "),o+=" "):c&&(o+=" "+p+" DO UPDATE SET ",o+=c.map((function(t){return e.escape(t)+" = :"+t})).join(", "),o+=" ")}if((this.connection.driver instanceof i.MysqlDriver||this.connection.driver instanceof i.AuroraDataApiDriver)&&this.expressionMap.onUpdate){var d=this.expressionMap.onUpdate;u=d.overwrite,c=d.columns,Array.isArray(u)?(o+=" ON DUPLICATE KEY UPDATE ",o+=u.map((function(t){return e.escape(t)+" = VALUES("+e.escape(t)+")"})).join(", "),o+=" "):Array.isArray(c)&&(o+=" ON DUPLICATE KEY UPDATE ",o+=c.map((function(t){return e.escape(t)+" = :"+t})).join(", "),o+=" ")}return r&&(this.connection.driver instanceof i.PostgresDriver||this.connection.driver instanceof i.OracleDriver||this.connection.driver instanceof i.CockroachDriver)&&(o+=" RETURNING "+r),this.connection.driver instanceof i.SqlServerDriver&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter((function(t){return e.expressionMap.insertColumns.length>0?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):t.isInsert})).some((function(t){return e.isOverridingAutoIncrementBehavior(t)}))&&(o="SET IDENTITY_INSERT "+t+" ON; "+o+"; SET IDENTITY_INSERT "+t+" OFF"),o},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter((function(t){return e.expressionMap.insertColumns.length?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):!!t.isInsert&&!!(!t.isGenerated||"increment"!==t.generationStrategy||e.connection.driver instanceof i.OracleDriver||e.connection.driver instanceof h.AbstractSqliteDriver||e.connection.driver instanceof i.MysqlDriver||e.connection.driver instanceof i.AuroraDataApiDriver||e.connection.driver instanceof i.SqlServerDriver&&e.isOverridingAutoIncrementBehavior(t))})):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(t.length>0)return t.map((function(t){return e.escape(t.databaseName)})).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var n=this.getValueSets();if(1===n.length)return Object.keys(n[0]).map((function(t){return e.escape(t)})).join(", ")}return this.expressionMap.insertColumns.map((function(t){return e.escape(t)})).join(", ")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){var r="";return t.forEach((function(a,s){n.forEach((function(u,c){0===c&&(e.connection.driver instanceof i.OracleDriver&&t.length>1?r+=" SELECT ":r+="(");var l=u.getEntityValue(a);if(l instanceof Function||(l=e.connection.driver.preparePersistentValue(l,u)),u.isVersion&&void 0===l)r+="1";else if(u.isDiscriminator)r+=e.createParameter(e.expressionMap.mainAlias.metadata.discriminatorValue);else if(u.isGenerated&&"uuid"===u.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===l)l=o.RandomGenerator.uuid4(),r+=e.createParameter(l),s in e.expressionMap.locallyGenerated||(e.expressionMap.locallyGenerated[s]={}),u.setEntityValue(e.expressionMap.locallyGenerated[s],l);else if(void 0===l)e.connection.driver instanceof i.OracleDriver&&t.length>1||e.connection.driver instanceof h.AbstractSqliteDriver||e.connection.driver instanceof i.SapDriver?void 0!==u.default&&null!==u.default?r+=e.connection.driver.normalizeDefault(u):r+="NULL":r+="DEFAULT";else if(l instanceof Function)r+=l();else{e.connection.driver instanceof i.SqlServerDriver&&(l=e.connection.driver.parametrizeValue(u,l));var p=e.createParameter(l);if((e.connection.driver instanceof i.MysqlDriver||e.connection.driver instanceof i.AuroraDataApiDriver)&&-1!==e.connection.driver.spatialTypes.indexOf(u.type)){var d=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";null!=u.srid?r+=d+"("+p+", "+u.srid+")":r+=d+"("+p+")"}else e.connection.driver instanceof i.PostgresDriver&&-1!==e.connection.driver.spatialTypes.indexOf(u.type)?null!=u.srid?r+="ST_SetSRID(ST_GeomFromGeoJSON("+p+"), "+u.srid+")::"+u.type:r+="ST_GeomFromGeoJSON("+p+")::"+u.type:e.connection.driver instanceof i.SqlServerDriver&&-1!==e.connection.driver.spatialTypes.indexOf(u.type)?r+=u.type+"::STGeomFromText("+p+", "+(u.srid||"0")+")":r+=p}c===n.length-1?s===t.length-1?e.connection.driver instanceof i.OracleDriver&&t.length>1?r+=" FROM DUAL ":r+=")":e.connection.driver instanceof i.OracleDriver&&t.length>1?r+=" FROM DUAL UNION ALL ":r+="), ":r+=", "}))})),"()"===r?"":r}var a="";return t.forEach((function(n,r){Object.keys(n).forEach((function(o,s){0===s&&(a+="(");var u=n[o];u instanceof Function?a+=u():void 0===u?e.connection.driver instanceof h.AbstractSqliteDriver||e.connection.driver instanceof i.SapDriver?a+="NULL":a+="DEFAULT":a+=e.createParameter(u),s===Object.keys(n).length-1?r===t.length-1?a+=")":a+="), ":a+=", "}))})),"()"===a?"":a},t.prototype.getValueSets=function(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new c.InsertValuesMissingError},t.prototype.isOverridingAutoIncrementBehavior=function(e){return e.isPrimary&&e.isGenerated&&"increment"===e.generationStrategy&&this.getValueSets().some((function(t){return void 0!==e.getEntityValue(t)&&null!==e.getEntityValue(t)}))},t}(a.QueryBuilder)},3047:(e,t,n)=>{"use strict";n.d(t,{JoinAttribute:()=>s});var r=n(9312),i=n(82),a=n(9206),o=n(3556),s=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,a.ObjectUtils.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){var e=this;return this.isSelectedEvaluated||(this.isSelectedCache=function(){var t,n,i=function(t){return t.selection===e.alias.name||e.metadata&&e.metadata.columns.find((function(n){return t.selection===e.alias.name+"."+n.propertyPath}))?{value:!0}:void 0};try{for(var a=(0,r.__values)(e.queryExpressionMap.selects),o=a.next();!o.done;o=a.next()){var s=i(o.value);if("object"==typeof s)return s.value}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1}(),this.isSelectedEvaluated=!0),this.isSelectedCache},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(i.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(i.QueryBuilderUtils.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){var e=this;return this.relationEvaluated||(this.relationCache=function(){if(i.QueryBuilderUtils.isAliasProperty(e.entityOrProperty)){var t=e.queryExpressionMap.findAliasByName(e.parentAlias),n=t.metadata.findRelationWithPropertyPath(e.relationPropertyPath);if(n)return n;if(t.metadata.parentEntityMetadata&&(n=t.metadata.parentEntityMetadata.findRelationWithPropertyPath(e.relationPropertyPath)))return n;throw new o.TypeORMError("Relation with property path "+e.relationPropertyPath+" in entity was not found.")}}.bind(this)(),this.relationEvaluated=!0),this.relationCache},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new o.TypeORMError("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!1,configurable:!0}),e}()},6170:(e,t,n)=>{"use strict";n.d(t,{QueryBuilder:()=>v});var r=n(9312),i=n(9206),a=n(3556),o=function(){function e(e){i.ObjectUtils.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new a.TypeORMError('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!1,configurable:!0}),e}(),s=n(3047),u=n(8835),c=n(2783),l=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={}}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce((function(n,r){return n[e.mainAlias.name+"."+r]=t[r],n}),{})}return this.orderBys},enumerable:!1,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!=typeof e.target||(t=e.target);var n=new o;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find((function(t){return t.name===e}));if(!t)throw new a.TypeORMError('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=(0,r.__read)(e.split("."),2),n=t[0],i=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(i)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new a.TypeORMError("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new a.TypeORMError("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!1,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map((function(e){return e})),n.maxExecutionTime=this.maxExecutionTime,n.selectDistinct=this.selectDistinct,n.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach((function(e){return n.aliases.push(new o(e))})),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.onIgnore=this.onIgnore,n.onUpdate=this.onUpdate,n.joinAttributes=this.joinAttributes.map((function(e){return new s.JoinAttribute(t.connection,t,e)})),n.relationIdAttributes=this.relationIdAttributes.map((function(e){return new u.RelationIdAttribute(t,e)})),n.relationCountAttributes=this.relationCountAttributes.map((function(e){return new c.RelationCountAttribute(t,e)})),n.wheres=this.wheres.map((function(e){return(0,r.__assign)({},e)})),n.havings=this.havings.map((function(e){return(0,r.__assign)({},e)})),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map((function(e){return e})),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.lockTables=this.lockTables,n.withDeleted=this.withDeleted,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n.insertColumns=this.insertColumns,n.whereEntities=this.whereEntities,n.updateEntity=this.updateEntity,n.callListeners=this.callListeners,n.useTransaction=this.useTransaction,n.nativeParameters=Object.assign({},this.nativeParameters),n.comment=this.comment,n},e}(),h=n(5766),p=n(1100),d=n(4117),f=n(2281),m=n(5367),y=n(2666),v=function(){function e(t,n){this.parameterIndex=0,t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new l(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new a.TypeORMError("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!1,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map((function(e){return{selection:e}})):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=n(1814).SelectQueryBuilder;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=n(856).InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if((e=e instanceof d.EntitySchema?e.options.name:e)instanceof Function||"string"==typeof e){var i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;var a=n(5254).UpdateQueryBuilder;return this instanceof a?this:new a(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=n(380).DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.softDelete=function(){this.expressionMap.queryType="soft-delete";var e=n(8682).SoftDeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.restore=function(){this.expressionMap.queryType="restore";var e=n(8682).SoftDeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2===arguments.length?e:void 0,i=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){var a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}var o=n(5749).RelationQueryBuilder;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every((function(e){return!!n.findRelationWithPropertyPath(e)}))},e.prototype.hasParameter=function(e){var t;return(null===(t=this.parentQueryBuilder)||void 0===t?void 0:t.hasParameter(e))||e in this.expressionMap.parameters},e.prototype.setParameter=function(e,t){if(t instanceof Function)throw new a.TypeORMError("Function parameter isn't supported in the parameters. Please check \""+e+'" parameter.');if(!e.match(/^([A-Za-z0-9_.]+)$/))throw new a.TypeORMError("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(e,t),this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t,n;try{for(var i=(0,r.__values)(Object.entries(e)),a=i.next();!a.done;a=i.next()){var o=(0,r.__read)(a.value,2),s=o[0],u=o[1];this.setParameter(s,u)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return this},e.prototype.createParameter=function(e){var t;do{t="orm_param_"+this.parameterIndex++}while(this.hasParameter(t));return this.setParameter(t,e),":"+t},e.prototype.setNativeParameters=function(e){var t=this;return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach((function(n){t.expressionMap.nativeParameters[n]=e[n]})),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter((function(e){return e.discriminatorColumn})).map((function(e){return e.discriminatorValue}));n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.printSql=function(){var e=(0,r.__read)(this.getQueryAndParameters(),2),t=e[0],n=e[1];return this.connection.logger.logQuery(t,n),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.__generator)(this,(function(a){switch(a.label){case 0:e=(0,r.__read)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,3,6]),[4,i.query(t,n)];case 2:return[2,a.sent()];case 3:return i===this.queryRunner?[3,5]:[4,i.release()];case 4:a.sent(),a.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.comment=function(e){return this.expressionMap.comment=e,this},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.escape(e)})).join(".")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new a.TypeORMError('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}if("string"==typeof e){var r="("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:r?void 0:e,subQuery:r?e:void 0})}var i=e(this.subQuery());this.setParameters(i.getParameters());var a=i.getQuery();return this.expressionMap.createAlias({type:"from",name:t,subQuery:a})},e.prototype.replacePropertyNames=function(e){var t,n,i=this,a=function(e){return e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},o=function(t){var n,o,u,c,l,h,p,d,f,m,y,v;if(!t.hasMetadata)return"continue";var g=s.expressionMap.aliasNamePrefixingEnabled?t.name+".":"",b=s.expressionMap.aliasNamePrefixingEnabled?s.escape(t.name)+".":"",_={};try{for(var w=(n=void 0,(0,r.__values)(t.metadata.relations)),E=w.next();!E.done;E=w.next())(N=E.value).joinColumns.length>0&&(_[N.propertyPath]=N.joinColumns[0].databaseName)}catch(e){n={error:e}}finally{try{E&&!E.done&&(o=w.return)&&o.call(w)}finally{if(n)throw n.error}}try{for(var T=(u=void 0,(0,r.__values)(t.metadata.relations)),M=T.next();!M.done;M=T.next()){var N=M.value;try{for(var C=(l=void 0,(0,r.__values)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(N.joinColumns)),(0,r.__read)(N.inverseJoinColumns)))),R=C.next();!R.done;R=C.next()){var A=R.value,O=N.propertyPath+"."+A.referencedColumn.propertyPath;_[O]=A.databaseName}}catch(e){l={error:e}}finally{try{R&&!R.done&&(h=C.return)&&h.call(C)}finally{if(l)throw l.error}}}}catch(e){u={error:e}}finally{try{M&&!M.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var x=(p=void 0,(0,r.__values)(t.metadata.columns)),S=x.next();!S.done;S=x.next()){var P=S.value;_[P.databaseName]=P.databaseName}}catch(e){p={error:e}}finally{try{S&&!S.done&&(d=x.return)&&d.call(x)}finally{if(p)throw p.error}}try{for(var q=(f=void 0,(0,r.__values)(t.metadata.columns)),D=q.next();!D.done;D=q.next())P=D.value,_[P.propertyName]=P.databaseName}catch(e){f={error:e}}finally{try{D&&!D.done&&(m=q.return)&&m.call(q)}finally{if(f)throw f.error}}try{for(var I=(y=void 0,(0,r.__values)(t.metadata.columns)),j=I.next();!j.done;j=I.next())P=j.value,_[P.propertyPath]=P.databaseName}catch(e){y={error:e}}finally{try{j&&!j.done&&(v=I.return)&&v.call(I)}finally{if(y)throw y.error}}var B=Object.keys(_);B.length&&(e=e.replace(new RegExp("([ =(]|^.{0})"+a(g)+"("+B.map(a).join("|")+")(?=[ =),]|.{0}$)","gm"),(function(e,t,n){return""+t+b+i.escape(_[n])})))},s=this;try{for(var u=(0,r.__values)(this.expressionMap.aliases),c=u.next();!c.done;c=u.next())o(c.value)}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return e},e.prototype.createComment=function(){return this.expressionMap.comment?"/* "+this.expressionMap.comment.replace("*/","")+" */ ":""},e.prototype.createWhereExpression=function(){var e=[],t=this.createWhereClausesExpression(this.expressionMap.wheres);if(t.length>0&&"1=1"!==t&&e.push(this.replacePropertyNames(t)),this.expressionMap.mainAlias.hasMetadata){var n=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&n.deleteDateColumn){var r=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+n.deleteDateColumn.propertyName:n.deleteDateColumn.propertyName,i=this.replacePropertyNames(r)+" IS NULL";e.push(i)}n.discriminatorColumn&&n.parentEntityMetadata&&(r=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+n.discriminatorColumn.databaseName:n.discriminatorColumn.databaseName,i=this.replacePropertyNames(r)+" IN (:...discriminatorColumnValues)",e.push(i))}return this.expressionMap.extraAppendedAndWhereCondition&&(i=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition),e.push(i)),e.length?1===e.length?" WHERE "+e[0]:" WHERE ( "+e.join(" ) AND ( ")+" )":""},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns(),n=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported()&&t.push.apply(t,(0,r.__spreadArray)([],(0,r.__read)(this.expressionMap.extraReturningColumns.filter((function(e){return-1===t.indexOf(e)}))))),t.length){var i=t.map((function(t){var r=e.escape(t.databaseName);return n instanceof p.SqlServerDriver?"insert"===e.expressionMap.queryType||"update"===e.expressionMap.queryType||"soft-delete"===e.expressionMap.queryType||"restore"===e.expressionMap.queryType?"INSERTED."+r:e.escape(e.getMainTableName())+"."+r:r})).join(", ");return n instanceof p.OracleDriver&&(i+=" INTO "+t.map((function(t){return e.createParameter({type:n.columnTypeToNativeParameter(t.type),dir:n.oracle.BIND_OUT})})).join(", ")),n instanceof p.SqlServerDriver&&("insert"!==this.expressionMap.queryType&&"update"!==this.expressionMap.queryType||(i+=" INTO @OutputTable")),i}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""},e.prototype.getReturningColumns=function(){var e=this,t=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach((function(n){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,(0,r.__spreadArray)([],(0,r.__read)(e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n))))})),t},e.prototype.createWhereClausesExpression=function(e){var t=this;return e.map((function(e,n){var r=t.createWhereConditionExpression(e.condition);switch(e.type){case"and":return(n>0?"AND ":"")+r;case"or":return(n>0?"OR ":"")+r}return r})).join(" ").trim()},e.prototype.createWhereConditionExpression=function(e,t){if(void 0===t&&(t=!1),"string"==typeof e)return e;if(Array.isArray(e))return 0===e.length?"1=1":1!==e.length||t?"("+this.createWhereClausesExpression(e)+")":this.createWhereClausesExpression(e);var n=this.connection.driver;switch(e.operator){case"lessThan":return e.parameters[0]+" < "+e.parameters[1];case"lessThanOrEqual":return e.parameters[0]+" <= "+e.parameters[1];case"moreThan":return e.parameters[0]+" > "+e.parameters[1];case"moreThanOrEqual":return e.parameters[0]+" >= "+e.parameters[1];case"notEqual":return e.parameters[0]+" != "+e.parameters[1];case"equal":return e.parameters[0]+" = "+e.parameters[1];case"ilike":return n instanceof p.PostgresDriver||n instanceof p.CockroachDriver?e.parameters[0]+" ILIKE "+e.parameters[1]:"UPPER("+e.parameters[0]+") LIKE UPPER("+e.parameters[1]+")";case"like":return e.parameters[0]+" LIKE "+e.parameters[1];case"between":return e.parameters[0]+" BETWEEN "+e.parameters[1]+" AND "+e.parameters[2];case"in":return e.parameters.length<=1?"0=1":e.parameters[0]+" IN ("+e.parameters.slice(1).join(", ")+")";case"any":return e.parameters[0]+" = ANY("+e.parameters[1]+")";case"isNull":return e.parameters[0]+" IS NULL";case"not":return"NOT("+this.createWhereConditionExpression(e.condition)+")";case"brackets":return""+this.createWhereConditionExpression(e.condition,!0)}throw new TypeError("Unsupported FindOperator "+f.FindOperator.constructor.name)},e.prototype.getWhereInIdsCondition=function(e){var t,n=this.expressionMap.mainAlias.metadata,i=(Array.isArray(e)?e:[e]).map((function(e){return n.ensureEntityIdMap(e)}));if(!n.hasMultiplePrimaryKeys){var a=n.primaryColumns[0];if(!a.transformer&&!a.relationMetadata&&!a.embeddedMetadata)return(t={})[a.propertyName]=(0,m.In)(i.map((function(e){return a.getEntityValue(e,!1)}))),t}return new h.Brackets((function(e){var t,n,a=function(t){e.orWhere(new h.Brackets((function(e){return e.where(t)})))};try{for(var o=(0,r.__values)(i),s=o.next();!s.done;s=o.next())a(s.value)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}))},e.prototype.findColumnsForPropertyPath=function(e){for(var t=this.expressionMap.mainAlias,n=[],i=e.split("."),a=function(){var e=i[0];if(!(null==t?void 0:t.hasMetadata))return"break";if(t.metadata.hasEmbeddedWithPropertyPath(e))return i.unshift(i.shift()+"."+i.shift()),"continue";if(t.metadata.hasRelationWithPropertyPath(e)){var a=o.expressionMap.joinAttributes.find((function(t){return t.relationPropertyPath===e}));if(!(null==a?void 0:a.alias)){var s=n.length>0?n.join(".")+"."+e:e;throw new Error("Cannot find alias for relation at "+s)}return t=a.alias,n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(e.split(".")))),i.shift(),"continue"}return"break"},o=this;i.length>1&&"break"!==a(););if(!t)throw new Error("Cannot find alias for property "+e);var s=i.join("."),u=t.metadata.findColumnsWithPropertyPath(s);if(!u.length)throw new y.EntityColumnNotFound(e);return[t,n,u]},e.prototype.createPropertyPath=function(e,t,n){var i,a;void 0===n&&(n="");var o=[],s=function(i){var a=n?n+"."+i:i;if(null===t[i]||"object"!=typeof t[i]||t[i]instanceof f.FindOperator)return o.push(a),"continue";if(e.hasEmbeddedWithPropertyPath(a)){var s=u.createPropertyPath(e,t[i],a);return o.push.apply(o,(0,r.__spreadArray)([],(0,r.__read)(s))),"continue"}if(e.hasRelationWithPropertyPath(a)){var c=e.findRelationWithPropertyPath(a);if("one-to-one"===c.relationType||"many-to-one"===c.relationType){var l=c.joinColumns.map((function(e){return e.referencedColumn})).filter((function(e){return!!e}));if(l.length>0&&l.every((function(e){return e.getEntityValue(t[i],!1)})))return o.push(a),"continue"}if("one-to-many"===c.relationType||"many-to-many"===c.relationType)throw new Error("Cannot query across "+c.relationType+" for property "+a);var h=c.inverseEntityMetadata.primaryColumns;if(h.length>0&&h.every((function(e){return e.getEntityValue(t[i],!1)}))){var p=h.map((function(e){return a+"."+e.propertyPath}));return o.push.apply(o,(0,r.__spreadArray)([],(0,r.__read)(p))),"continue"}return s=u.createPropertyPath(c.inverseEntityMetadata,t[i]).map((function(e){return a+"."+e})),o.push.apply(o,(0,r.__spreadArray)([],(0,r.__read)(s))),"continue"}o.push(a)},u=this;try{for(var c=(0,r.__values)(Object.keys(t)),l=c.next();!l.done;l=c.next())s(l.value)}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}return o},e.prototype.getPredicates=function(e){var t,n,i,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b,_,w,E,T,M,N,C,R,A,O,x,S,P;return(0,r.__generator)(this,(function(q){switch(q.label){case 0:if(!this.expressionMap.mainAlias.hasMetadata)return[3,15];t=this.createPropertyPath(this.expressionMap.mainAlias.metadata,e),q.label=1;case 1:q.trys.push([1,12,13,14]),n=(0,r.__values)(t),i=n.next(),q.label=2;case 2:if(i.done)return[3,11];a=i.value,o=(0,r.__read)(this.findColumnsForPropertyPath(a),3),s=o[0],u=o[1],c=o[2],q.label=3;case 3:q.trys.push([3,8,9,10]),R=void 0,l=(0,r.__values)(c),h=l.next(),q.label=4;case 4:if(h.done)return[3,7];p=h.value,d=e;try{for(O=void 0,f=(0,r.__values)(u),m=f.next();!m.done;m=f.next()){if(y=m.value,!d||!(y in d)){d={};break}d=d[y]}}catch(e){O={error:e}}finally{try{m&&!m.done&&(x=f.return)&&x.call(f)}finally{if(O)throw O.error}}return T=this.expressionMap.aliasNamePrefixingEnabled?s.name+"."+p.propertyPath:p.propertyPath,E=p.getEntityValue(d,!0),[4,[T,E]];case 5:q.sent(),q.label=6;case 6:return h=l.next(),[3,4];case 7:return[3,10];case 8:return v=q.sent(),R={error:v},[3,10];case 9:try{h&&!h.done&&(A=l.return)&&A.call(l)}finally{if(R)throw R.error}return[7];case 10:return i=n.next(),[3,2];case 11:return[3,14];case 12:return g=q.sent(),N={error:g},[3,14];case 13:try{i&&!i.done&&(C=n.return)&&C.call(n)}finally{if(N)throw N.error}return[7];case 14:return[3,22];case 15:q.trys.push([15,20,21,22]),b=(0,r.__values)(Object.keys(e)),_=b.next(),q.label=16;case 16:return _.done?[3,19]:(w=_.value,E=e[w],[4,[T=this.expressionMap.aliasNamePrefixingEnabled?this.alias+"."+w:w,E]]);case 17:q.sent(),q.label=18;case 18:return _=b.next(),[3,16];case 19:return[3,22];case 20:return M=q.sent(),S={error:M},[3,22];case 21:try{_&&!_.done&&(P=b.return)&&P.call(b)}finally{if(S)throw S.error}return[7];case 22:return[2]}}))},e.prototype.getWherePredicateCondition=function(e,t){var n,i;if(t instanceof f.FindOperator){var a=[];if(t.useParameter)if(t.objectLiteralParameters)this.setParameters(t.objectLiteralParameters);else if(t.multipleParameters)try{for(var o=(0,r.__values)(t.value),s=o.next();!s.done;s=o.next()){var u=s.value;a.push(this.createParameter(u))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}else a.push(this.createParameter(t.value));return"raw"===t.type?t.getSql?t.getSql(e):{operator:"equal",parameters:[e,t.value]}:"not"===t.type?t.child?{operator:t.type,condition:this.getWherePredicateCondition(e,t.child)}:{operator:"notEqual",parameters:(0,r.__spreadArray)([e],(0,r.__read)(a))}:{operator:t.type,parameters:(0,r.__spreadArray)([e],(0,r.__read)(a))}}return null===t?{operator:"isNull",parameters:[e]}:{operator:"equal",parameters:[e,this.createParameter(t)]}},e.prototype.getWhereCondition=function(e){var t,n,i,a;if("string"==typeof e)return e;if(e instanceof h.Brackets){var o=this.createQueryBuilder();return o.parentQueryBuilder=this,o.expressionMap.mainAlias=this.expressionMap.mainAlias,o.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,o.expressionMap.parameters=this.expressionMap.parameters,o.expressionMap.nativeParameters=this.expressionMap.nativeParameters,o.expressionMap.wheres=[],e.whereFactory(o),{operator:"brackets",condition:o.expressionMap.wheres}}if(e instanceof Function)return e(this);var s=Array.isArray(e)?e:[e],u=[];try{for(var c=(0,r.__values)(s),l=c.next();!l.done;l=c.next()){var p=l.value,d=[];try{for(var f=(i=void 0,(0,r.__values)(this.getPredicates(p))),m=f.next();!m.done;m=f.next()){var y=(0,r.__read)(m.value,2),v=y[0],g=y[1];d.push({type:"and",condition:this.getWherePredicateCondition(v,g)})}}catch(e){i={error:e}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}u.push({type:"or",condition:d})}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return 1===u.length?u[0].condition:u},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner()},e}()},82:(e,t,n)=>{"use strict";n.d(t,{QueryBuilderUtils:()=>i});var r=n(9312),i=function(){function e(){}return e.isAliasProperty=function(e){if("string"!=typeof e||-1===e.indexOf("."))return!1;var t=(0,r.__read)(e.split("."),2),n=t[0],i=t[1];return!(!n||!i)&&-1===e.indexOf("(")&&-1===e.indexOf(")")},e}()},5749:(e,t,n)=>{"use strict";n.d(t,{RelationQueryBuilder:()=>c});var r=n(9312),i=n(6170),a=n(1100),o=n(3556),s=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,s,u,c,l,h,p,d,f,m,y,v=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(l=t.joinColumns.reduce((function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t}),{}),!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(l).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return r.sent(),[3,10];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==e?[3,4]:(n={},t.inverseRelation.joinColumns.forEach((function(e){n[e.propertyName]=null})),p=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i={},s=[],p.forEach((function(e,n){t.inverseRelation.joinColumns.map((function(t,r){var a="joinColumn_"+n+"_"+r;i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,s.push(t.propertyPath+" = :"+a)}))})),(u=s.map((function(e){return"("+e+")"})).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(u).setParameters(i).execute()]:[2]);case 3:return r.sent(),[3,10];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(Array.isArray(this.expressionMap.of))throw new o.TypeORMError("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return c=this.expressionMap.of,l=t.inverseRelation.joinColumns.reduce((function(e,t){var n=c instanceof Object?t.referencedColumn.getEntityValue(c):c;return t.setEntityValue(e,n),e}),{}),!e||Array.isArray(e)&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(l).whereInIds(e).execute()];case 5:return r.sent(),[3,10];case 6:return h=t.junctionEntityMetadata,p=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],d=Array.isArray(e)?e:[e],f=t.isManyToManyOwner?p:d,m=t.isManyToManyOwner?d:p,y=[],f.forEach((function(e){m.forEach((function(t){var n={};h.ownerColumns.forEach((function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e})),h.inverseColumns.forEach((function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t})),y.push(n)}))})),y.length?this.queryBuilder.connection.driver instanceof a.OracleDriver||this.queryBuilder.connection.driver instanceof a.SapDriver?[4,Promise.all(y.map((function(e){return v.queryBuilder.createQueryBuilder().insert().into(h.tableName).values(e).execute()})))]:[3,8]:[2];case 7:return r.sent(),[3,10];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(h.tableName).values(y).execute()];case 9:r.sent(),r.label=10;case 10:return[2]}}))}))},e}(),u=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p,d,f;return(0,r.__generator)(this,(function(m){switch(m.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],n=Array.isArray(e)?e:[e],i={},t.inverseRelation.joinColumns.forEach((function(e){i[e.propertyName]=null})),a={},o=[],u.forEach((function(e,i){o.push.apply(o,(0,r.__spreadArray)([],(0,r.__read)(n.map((function(n,o){return(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(t.inverseRelation.joinColumns.map((function(t,n){var r="joinColumn_"+i+"_"+o+"_"+n;return a[r]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+" = :"+r})))),(0,r.__read)(t.inverseRelation.entityMetadata.primaryColumns.map((function(e,t){var r="primaryColumn_"+o+"_"+o+"_"+t;return a[r]=n instanceof Object?e.getEntityValue(n):n,e.propertyPath+" = :"+r})))).join(" AND ")})))))})),(f=o.map((function(e){return"("+e+")"})).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(f).setParameters(a).execute()]:[2]):[3,2];case 1:return m.sent(),[3,4];case 2:return s=t.junctionEntityMetadata,u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],c=Array.isArray(e)?e:[e],l=t.isManyToManyOwner?u:c,h=t.isManyToManyOwner?c:u,p={},d=[],l.forEach((function(e,t){d.push.apply(d,(0,r.__spreadArray)([],(0,r.__read)(h.map((function(n,i){return(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s.ownerColumns.map((function(n,r){var a="firstValue_"+t+"_"+i+"_"+r;return p[a]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+" = :"+a})))),(0,r.__read)(s.inverseColumns.map((function(e,r){var a="secondValue_"+t+"_"+i+"_"+r;return p[a]=n instanceof Object?e.referencedColumn.getEntityValue(n):n,e.databaseName+" = :"+a})))).join(" AND ")})))))})),f=d.map((function(e){return"("+e+")"})).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(s.tableName).where(f).setParameters(p).execute()];case 3:m.sent(),m.label=4;case 4:return[2]}}))}))},e}(),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new o.TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new o.TypeORMError('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new o.TypeORMError('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new s(this,this.expressionMap).update(e)]}))}))},t.prototype.add=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new o.TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new o.TypeORMError('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new o.TypeORMError('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new s(this,this.expressionMap).update(e)]}))}))},t.prototype.remove=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new o.TypeORMError("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new o.TypeORMError('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return[2,new u(this,this.expressionMap).remove(e)]}))}))},t.prototype.addAndRemove=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}}))}))},t.prototype.loadOne=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,this.loadMany().then((function(e){return e[0]}))]}))}))},t.prototype.loadMany=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t;return(0,r.__generator)(this,(function(n){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new o.TypeORMError("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,e,this.queryRunner)]}))}))},t}(i.QueryBuilder)},6287:(e,t,n)=>{"use strict";n.d(t,{ReturningResultsEntityUpdator:()=>o});var r=n(9312),i=n(1100),a=n(3556),o=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,o=this;return(0,r.__generator)(this,(function(s){switch(s.label){case 0:return n=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map((function(t,s){return(0,r.__awaiter)(o,void 0,void 0,(function(){var o,u,c,l,h=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(this.queryRunner.connection.driver instanceof i.OracleDriver&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((function(e,t,n){return e[h.expressionMap.extraReturningColumns[n].databaseName]=t[0],e}),{})),o=Array.isArray(e.raw)?e.raw[s]:e.raw,(u=this.queryRunner.connection.driver.createGeneratedMap(n,o))&&(this.queryRunner.manager.merge(n.target,t,u),e.generatedMaps.push(u)),[3,3]):[3,1];case 1:if(!(this.getUpdationReturningColumns().length>0))return[3,3];if(!(c=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw new a.TypeORMError("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((function(e){return n.targetName+"."+e.propertyPath}))).addSelect(this.getUpdationReturningColumns().map((function(e){return n.targetName+"."+e.propertyPath}))).from(n.target,n.targetName).where(c).setOption("create-pojo").getOne()];case 2:(l=r.sent())&&(this.queryRunner.manager.merge(n.target,t,l),e.generatedMaps.push(l)),r.label=3;case 3:return[2]}}))}))})))];case 1:return s.sent(),[2]}}))}))},e.prototype.insert=function(e,t){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,o,s,u,c,l=this;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n=this.expressionMap.mainAlias.metadata,o=this.getInsertionReturningColumns(),s=t.map((function(r,a){l.queryRunner.connection.driver instanceof i.OracleDriver&&Array.isArray(e.raw)&&l.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e}),{}));var o=Array.isArray(e.raw)?e.raw[a]:e.raw,s=l.queryRunner.connection.driver.createGeneratedMap(n,o,a,t.length)||{};return a in l.expressionMap.locallyGenerated&&l.queryRunner.manager.merge(n.target,s,l.expressionMap.locallyGenerated[a]),l.queryRunner.manager.merge(n.target,r,s),s})),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&o.length>0?(u=t.map((function(e){var t=n.getEntityIdMap(e);if(!t)throw new a.TypeORMError("Cannot update entity because entity id is not set in the entity.");return t})),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((function(e){return n.targetName+"."+e.propertyPath}))).addSelect(o.map((function(e){return n.targetName+"."+e.propertyPath}))).from(n.target,n.targetName).where(u).setOption("create-pojo").getMany()]):[3,2];case 1:c=r.sent(),t.forEach((function(e,t){l.queryRunner.manager.merge(n.target,s[t],c[t]),l.queryRunner.manager.merge(n.target,e,c[t])})),r.label=2;case 2:return t.forEach((function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r])})),[2]}}))}))},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter((function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isDeleteDate||t.isVersion}))},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter((function(e){return e.isUpdateDate||e.isVersion}))},e}()},1814:(e,t,n)=>{"use strict";n.d(t,{SelectQueryBuilder:()=>A});var r=n(9312),i=n(1100),a=n(7081),o=n(4249),s=function(){function e(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}return e.prototype.transform=function(e,t){var n=this,r=this.group(e,t),i=[];return r.forEach((function(e){var r=n.transformRawResultsGroup(e,t);void 0===r||Object.values(r).every((function(e){return null===e}))||i.push(r)})),i},e.prototype.group=function(e,t){var n=this,i=new Map,a=[];return"view"===t.metadata.tableType?a.push.apply(a,(0,r.__spreadArray)([],(0,r.__read)(t.metadata.columns.map((function(e){return o.DriverUtils.buildAlias(n.driver,t.name,e.databaseName)}))))):a.push.apply(a,(0,r.__spreadArray)([],(0,r.__read)(t.metadata.primaryColumns.map((function(e){return o.DriverUtils.buildAlias(n.driver,t.name,e.databaseName)}))))),e.forEach((function(e){var t=a.map((function(t){var n=e[t];return Buffer.isBuffer(n)?n.toString("hex"):"object"==typeof n?JSON.stringify(n):n})).join("_"),n=i.get(t);n?n.push(e):i.set(t,[e])})),i},e.prototype.transformRawResultsGroup=function(e,t){var n=this,r=t.metadata;if(r.discriminatorColumn){var i=e.map((function(e){return e[o.DriverUtils.buildAlias(n.driver,t.name,t.metadata.discriminatorColumn.databaseName)]})),a=r.childEntityMetadatas.find((function(e){return void 0!==i.find((function(t){return t===e.discriminatorValue}))}));a&&(r=a)}var s=-1!==this.expressionMap.options.indexOf("create-pojo")?{}:r.create(this.queryRunner,{fromDeserializer:!0}),u=this.transformColumns(e,t,s,r),c=this.transformJoins(e,s,t,r),l=this.transformRelationIds(e,t,s,r),h=this.transformRelationCounts(e,t,s);return u||0===r.primaryColumns.filter((function(e){return!1===e.isVirtual})).length&&(c||l||h)?s:void 0},e.prototype.transformColumns=function(e,t,n,r){var i=this,a=!1;return r.columns.forEach((function(s){if(!(r.childEntityMetadatas.length>0&&-1!==r.childEntityMetadatas.map((function(e){return e.target})).indexOf(s.target))){var u=e[0][o.DriverUtils.buildAlias(i.driver,t.name,s.databaseName)];void 0===u||s.isVirtual||i.expressionMap.selects.find((function(e){return e.selection===t.name||e.selection===t.name+"."+s.propertyPath}))&&(s.setEntityValue(n,i.driver.prepareHydratedValue(u,s)),null!==u&&(a=!0))}})),a},e.prototype.transformJoins=function(e,t,n,r){var i=this,a=!1;return this.expressionMap.joinAttributes.forEach((function(o){if(o.metadata&&o.isSelected){if(o.relation){var s=r.relations.find((function(e){return e.propertyPath===o.relation.propertyPath}));if(!s)return;s.inverseEntityMetadata&&(o.alias.metadata=s.inverseEntityMetadata)}if(o.mapToProperty){if(o.mapToPropertyParentAlias!==n.name)return}else if(!o.relation||o.parentAlias!==n.name||o.relationPropertyPath!==o.relation.propertyPath)return;var u=i.transform(e,o.alias);u=o.isMany?u:u[0],void 0!==(u=o.isMany||void 0!==u?u:null)&&(o.mapToPropertyPropertyName?t[o.mapToPropertyPropertyName]=u:o.relation.setEntityValue(t,u),a=!0)}})),a},e.prototype.transformRelationIds=function(e,t,n,r){var i=this,o=!1;return this.rawRelationIdResults.forEach((function(r){if(r.relationIdAttribute.parentAlias===t.name){var s=r.relationIdAttribute.relation,u=i.createValueMapFromJoinColumns(s,r.relationIdAttribute.parentAlias,e);if(null!=u){var c=r.results.map((function(e){var t=i.extractEntityPrimaryIds(s,e);if(!1!==a.OrmUtils.compareIds(t,u)){var n,o=(n=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map((function(e){return e})):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map((function(e){return e})):s.isOwning?s.inverseJoinColumns.map((function(e){return e})):s.inverseRelation.joinColumns.map((function(e){return e}))).reduce((function(t,n){var r=e[n.databaseName];return s.isOneToMany||s.isOneToOneNotOwner?(n.isVirtual&&n.referencedColumn&&n.referencedColumn.propertyName!==n.propertyName&&(r=n.referencedColumn.createValueMap(r)),a.OrmUtils.mergeDeep(t,n.createValueMap(r))):(n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),a.OrmUtils.mergeDeep(t,n.referencedColumn.createValueMap(r)))}),{});return 1===n.length&&!1===r.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?n[0].getEntityValue(o):n[0].referencedColumn.getEntityValue(o):o}})).filter((function(e){return void 0!==e})),l=r.relationIdAttribute.mapToPropertyPropertyPath.split("."),h=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&e.length>0?void h(e,t[r],n):t};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(h(l,n,c[0]),o=!0):(h(l,n,c),c.length>0&&(o=!0))}}})),o},e.prototype.transformRelationCounts=function(e,t,n){var r=this,i=!1;return this.rawRelationCountResults.filter((function(e){return e.relationCountAttribute.parentAlias===t.name})).forEach((function(a){var s,u=a.relationCountAttribute.relation;s=u.isOneToMany?u.inverseRelation.joinColumns[0].referencedColumn.databaseName:u.isOwning?u.joinColumns[0].referencedColumn.databaseName:u.inverseRelation.joinColumns[0].referencedColumn.databaseName;var c=e[0][o.DriverUtils.buildAlias(r.driver,t.name,s)];null!=c&&(n[a.relationCountAttribute.mapToPropertyPropertyName]=0,a.results.filter((function(e){return e.parentId===c})).forEach((function(e){n[a.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0})))})),i},e.prototype.createValueMapFromJoinColumns=function(e,t,n){var r=this;return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((function(e){return e})):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((function(e){return e})):e.isOwning?e.joinColumns.map((function(e){return e})):e.inverseRelation.inverseJoinColumns.map((function(e){return e}))).reduce((function(i,a){return n.forEach((function(n){e.isManyToOne||e.isOneToOneOwner?i[a.databaseName]=r.driver.prepareHydratedValue(n[o.DriverUtils.buildAlias(r.driver,t,a.databaseName)],a):i[a.databaseName]=r.driver.prepareHydratedValue(n[o.DriverUtils.buildAlias(r.driver,t,a.referencedColumn.databaseName)],a)})),i}),{})},e.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((function(e){return e})):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((function(e){return e})):e.isOwning?e.joinColumns.map((function(e){return e})):e.inverseRelation.inverseJoinColumns.map((function(e){return e}))).reduce((function(e,n){return e[n.databaseName]=t[n.databaseName],e}),{})},e}(),u=n(9889),c=n(8722),l=n(8548),h=n(6254),p=n(3047),d=n(8835),f=n(2783),m=n(9858),y=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return(0,r.__generator)(this,(function(i){return t=this.relationIdAttributes.map((function(t){return(0,r.__awaiter)(n,void 0,void 0,(function(){var n,i,a,s,u,c,l,h,p,d,f,y,v,g,b,_,w,E,T,M,N,C,R,A,O=this;return(0,r.__generator)(this,(function(x){switch(x.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new m.TypeORMError("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return n=[],A=e.map((function(e){var r={},i=[];t.relation.joinColumns.forEach((function(n){r[n.databaseName]=O.connection.driver.prepareHydratedValue(e[o.DriverUtils.buildAlias(O.connection.driver,t.parentAlias,n.databaseName)],n.referencedColumn);var a=n.databaseName+":"+r[n.databaseName];-1===i.indexOf(a)&&i.push(a)})),t.relation.entityMetadata.primaryColumns.forEach((function(n){r[n.databaseName]=O.connection.driver.prepareHydratedValue(e[o.DriverUtils.buildAlias(O.connection.driver,t.parentAlias,n.databaseName)],n);var a=n.databaseName+":"+r[n.databaseName];-1===i.indexOf(a)&&i.push(a)})),i.sort();var a=i.join("::");return-1!==n.indexOf(a)?null:(n.push(a),r)})).filter((function(e){return e})),[2,{relationIdAttribute:t,results:A}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(i=t.relation,a=i.isOwning?i.joinColumns:i.inverseRelation.joinColumns,s=i.inverseEntityMetadata.target,u=i.inverseEntityMetadata.tableName,c=t.alias||u,l=[],h={},(C=e.map((function(e,n){var r=[],i={},s=a.map((function(a){var s=a.databaseName+n,u=e[o.DriverUtils.buildAlias(O.connection.driver,t.parentAlias,a.referencedColumn.databaseName)],l=c+":"+a.propertyPath+":"+u;return-1!==r.indexOf(l)?"":(r.push(l),i[s]=u,c+"."+a.propertyPath+" = :"+s)})).filter((function(e){return e})).join(" AND ");r.sort();var u=r.join("::");return-1!==l.indexOf(u)?"":(l.push(u),Object.assign(h,i),s)})).filter((function(e){return e})).map((function(e){return"("+e+")"})).join(" OR "))?(p=this.connection.createQueryBuilder(this.queryRunner),a.forEach((function(e){p.addSelect(c+"."+e.propertyPath,e.databaseName)})),i.inverseRelation.entityMetadata.primaryColumns.forEach((function(e){p.addSelect(c+"."+e.propertyPath,e.databaseName)})),p.from(s,c).where("("+C+")").setParameters(h),t.queryBuilderFactory&&t.queryBuilderFactory(p),[4,p.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return(A=x.sent()).forEach((function(e){a.forEach((function(t){e[t.databaseName]=O.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})),i.inverseRelation.entityMetadata.primaryColumns.forEach((function(t){e[t.databaseName]=O.connection.driver.prepareHydratedValue(e[t.databaseName],t)}))})),[2,{relationIdAttribute:t,results:A}];case 3:return d=t.relation,f=d.isOwning?d.joinColumns:d.inverseRelation.inverseJoinColumns,y=d.isOwning?d.inverseJoinColumns:d.inverseRelation.joinColumns,v=t.junctionAlias,g=t.joinInverseSideMetadata.tableName,b=t.alias||g,_=d.isOwning?d.junctionEntityMetadata.tableName:d.inverseRelation.junctionEntityMetadata.tableName,0===(w=e.map((function(e){return f.reduce((function(n,r){return n[r.propertyPath]=e[o.DriverUtils.buildAlias(O.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],n}),{})}))).length?[2,{relationIdAttribute:t,results:[]}]:(E={},T=[],M=w.map((function(e,t){var n=[],r={},i=Object.keys(e).map((function(i){var a=i+t,o=e[i],s=v+":"+i+":"+o;return-1!==n.indexOf(s)?"":(n.push(s),r[a]=o,v+"."+i+" = :"+a)})).filter((function(e){return e})).join(" AND ");n.sort();var a=n.join("::");return-1!==T.indexOf(a)?"":(T.push(a),Object.assign(E,r),i)})).filter((function(e){return e})),N=y.map((function(e){return v+"."+e.propertyPath+" = "+b+"."+e.referencedColumn.propertyPath})).join(" AND "),C=M.map((function(e){return"("+e+" AND "+N+")"})).join(" OR "),R=this.connection.createQueryBuilder(this.queryRunner),y.forEach((function(e){R.addSelect(v+"."+e.propertyPath,e.databaseName).addOrderBy(v+"."+e.propertyPath)})),f.forEach((function(e){R.addSelect(v+"."+e.propertyPath,e.databaseName).addOrderBy(v+"."+e.propertyPath)})),R.from(g,b).innerJoin(_,v,C).setParameters(E),t.queryBuilderFactory&&t.queryBuilderFactory(R),[4,R.getRawMany()]);case 4:return(A=x.sent()).forEach((function(e){(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(f)),(0,r.__read)(y)).forEach((function(t){e[t.databaseName]=O.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}))})),[2,{relationIdAttribute:t,results:A}]}}))}))})),[2,Promise.all(t)]}))}))},e}(),v=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach((function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)})),this.expressionMap.joinAttributes.forEach((function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach((function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)}))}))},e.prototype.metadataToAttribute=function(e,t){return new d.RelationIdAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),g=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i=this;return(0,r.__generator)(this,(function(a){return t=function(e,t,n){return n.indexOf(e)===t},n=this.relationCountAttributes.map((function(n){return(0,r.__awaiter)(i,void 0,void 0,(function(){var i,a,o,s,u,c,l,h,p,d,f,m,y,v,g,b,_,w;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return n.relation.isOneToMany?(i=n.relation,a=i.inverseRelation,o=a.joinColumns[0].referencedColumn.propertyName,s=i.inverseEntityMetadata.target,m=i.inverseEntityMetadata.tableName,y=n.alias||m,u=a.propertyName,0===(d=(d=e.map((function(e){return e[n.parentAlias+"_"+o]})).filter((function(e){return!!e}))).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:((b=this.connection.createQueryBuilder(this.queryRunner)).select(y+"."+u,"parentId").addSelect("COUNT(*)","cnt").from(s,y).where(y+"."+u+" IN (:...ids)").addGroupBy(y+"."+u).setParameter("ids",d),n.queryBuilderFactory&&n.queryBuilderFactory(b),_={relationCountAttribute:n},[4,b.getRawMany()])):[3,2];case 1:return[2,(_.results=r.sent(),_)];case 2:return l=void 0,h=void 0,p=void 0,n.relation.isOwning?(c=n.relation.joinColumns[0].referencedColumn.databaseName,l=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,h=n.relation.junctionEntityMetadata.columns[0],p=n.relation.junctionEntityMetadata.columns[1]):(c=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,l=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,h=n.relation.junctionEntityMetadata.columns[1],p=n.relation.junctionEntityMetadata.columns[0]),0===(d=(d=e.map((function(e){return e[n.parentAlias+"_"+c]})).filter((function(e){return!!e}))).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:(f=n.junctionAlias,m=n.joinInverseSideMetadata.tableName,y=n.alias||m,v=n.relation.junctionEntityMetadata.tableName,g=f+"."+h.propertyName+" IN ("+d.map((function(e){return isNaN(e)?"'"+e+"'":e}))+") AND "+f+"."+p.propertyName+" = "+y+"."+l,(b=this.connection.createQueryBuilder(this.queryRunner)).select(f+"."+h.propertyName,"parentId").addSelect("COUNT("+b.escape(y)+"."+b.escape(l)+")","cnt").from(m,y).innerJoin(v,f,g).addGroupBy(f+"."+h.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(b),w={relationCountAttribute:n},[4,b.getRawMany()]);case 3:return[2,(w.results=r.sent(),w)]}}))}))})),[2,Promise.all(n)]}))}))},e}(),b=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach((function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)})),this.expressionMap.joinAttributes.forEach((function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach((function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)}))}))},e.prototype.metadataToAttribute=function(e,t){return new f.RelationCountAttribute(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),_=n(6170),w=n(894),E=n(2311),T=n(3139),M=n(5436),N=n(9206),C=n(7303),R=n(3556),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.__extends)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return e+=this.createSelectExpression(),e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e=(e+=this.createLockExpression()).trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map((function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map((function(e){return{selection:e}})));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.maxExecutionTime=function(e){return this.expressionMap.maxExecutionTime=e,this},t.prototype.distinct=function(e){return void 0===e&&(e=!0),this.expressionMap.selectDistinct=e,this},t.prototype.distinctOn=function(e){return this.expressionMap.selectDistinctOn=e,this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return this.join("INNER",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return this.join("LEFT",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new d.RelationIdAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new f.RelationCountAttribute(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach((function(n){void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(n.propertyPath)||t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+n.propertyPath,t.expressionMap.mainAlias.name+"."+n.propertyPath,e)})),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.getWhereInIdsCondition(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.getWhereInIdsCondition(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.getWhereInIdsCondition(e))},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){var r,i;if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new R.TypeORMError('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new R.TypeORMError('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new R.TypeORMError('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new R.TypeORMError('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new R.TypeORMError('Provided "limit" value is not a number. Please provide a numeric value.');return this},t.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new R.TypeORMError('Provided "offset" value is not a number. Please provide a numeric value.');return this},t.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new R.TypeORMError('Provided "take" value is not a number. Please provide a numeric value.');return this},t.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new R.TypeORMError('Provided "skip" value is not a number. Please provide a numeric value.');return this},t.prototype.setLock=function(e,t,n){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this.expressionMap.lockTables=n,this},t.prototype.withDeleted=function(){return this.expressionMap.withDeleted=!0,this},t.prototype.getRawOne=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.getRawMany=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h.OptimisticLockCanNotBeUsedError;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return[4,this.loadRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getRawAndEntities=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getOne=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=r.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((i=n.updateDateColumn.getEntityValue(t)).getTime()!==this.expressionMap.lockVersion.getTime())throw new l.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,i)}else if((i=n.versionColumn.getEntityValue(t))!==this.expressionMap.lockVersion)throw new l.OptimisticLockVersionMismatchError(n.name,this.expressionMap.lockVersion,i);return[2,t]}}))}))},t.prototype.getOneOrFail=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e;return(0,r.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getOne()];case 1:if(!(e=t.sent()))throw new C.EntityNotFoundError(this.expressionMap.mainAlias.target,this);return[2,e]}}))}))},t.prototype.getMany=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h.OptimisticLockCanNotBeUsedError;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}}))}))},t.prototype.getCount=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h.OptimisticLockCanNotBeUsedError;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getManyAndCount=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new h.OptimisticLockCanNotBeUsedError;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,8,13,16]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 5:return i=r.sent(),a=[n.entities,i],t?[4,e.commitTransaction()]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2,a];case 8:if(o=r.sent(),!t)return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:case 11:return r.sent(),[3,12];case 12:throw o;case 13:return e===this.queryRunner?[3,15]:[4,e.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}}))}))},t.prototype.stream=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return(0,r.__generator)(this,(function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,e=(0,r.__read)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a=!1,l.label=1;case 1:return l.trys.push([1,6,,11]),!0!==this.expressionMap.useTransaction||!1!==i.isTransactionActive?[3,3]:[4,i.startTransaction()];case 2:l.sent(),a=!0,l.label=3;case 3:return o=function(){if(i!==c.queryRunner)return i.release()},s=i.stream(t,n,o,o),a?[4,i.commitTransaction()]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2,s];case 6:if(u=l.sent(),!a)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,i.rollbackTransaction()];case 8:case 9:return l.sent(),[3,10];case 10:throw u;case 11:return[2]}}))}))},t.prototype.cache=function(e,t){return"boolean"==typeof e?this.expressionMap.cache=e:"number"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!=typeof e&&"number"!=typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.setOption=function(e){return this.expressionMap.options.push(e),this},t.prototype.join=function(e,t,n,r,i,a,o){this.setParameters(i||{});var s=new p.JoinAttribute(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=a,s.isMappingMany=o,s.entityOrProperty=t,s.condition=r||void 0,this.expressionMap.joinAttributes.push(s),s.metadata){if(s.metadata.deleteDateColumn&&!this.expressionMap.withDeleted){var u=n+"."+s.metadata.deleteDateColumn.propertyName+" IS NULL";s.condition=s.condition?" "+s.condition+" AND "+u:""+u}s.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata})}else{var c="";if(t instanceof Function){var l=t(this.subQuery());this.setParameters(l.getParameters()),c=l.getQuery()}else c=t;var h=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===h?t:void 0,subQuery:!0===h?c:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new R.TypeORMError("Cannot build query because main alias is not set (call qb#from method)");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var a=this.expressionMap.mainAlias.metadata;t.push.apply(t,(0,r.__spreadArray)([],(0,r.__read)(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,a)))),n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,a))))}this.expressionMap.joinAttributes.forEach((function(i){if(i.metadata)t.push.apply(t,(0,r.__spreadArray)([],(0,r.__read)(e.buildEscapedEntityColumnSelects(i.alias.name,i.metadata)))),n.push.apply(n,(0,r.__spreadArray)([],(0,r.__read)(e.findEntityColumnSelects(i.alias.name,i.metadata))));else if(e.expressionMap.selects.some((function(e){return e.selection===i.alias.name}))){t.push({selection:e.escape(i.alias.name)+".*"});var a=e.expressionMap.selects.find((function(e){return e.selection===i.alias.name}));n.push(a)}})),this.expressionMap.selects.filter((function(e){return-1===n.indexOf(e)})).forEach((function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})})),0===t.length&&t.push({selection:"*"});var o="";if(this.connection.driver instanceof i.SqlServerDriver)switch(this.expressionMap.lockMode){case"pessimistic_read":o=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":o=" WITH (UPDLOCK, ROWLOCK)";break;case"dirty_read":o=" WITH (NOLOCK)"}var s=this.expressionMap.aliases.filter((function(e){return"from"===e.type&&(e.tablePath||e.subQuery)})).map((function(t){return t.subQuery?t.subQuery+" "+e.escape(t.name):e.getTableName(t.tablePath)+" "+e.escape(t.name)}));return this.createSelectDistinctExpression()+t.map((function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")})).join(", ")+" FROM "+s.join(", ")+o},t.prototype.createSelectDistinctExpression=function(){var e=this,t=this.expressionMap,n=t.selectDistinct,r=t.selectDistinctOn,a=t.maxExecutionTime,o=this.connection.driver,s="SELECT ";return a>0&&o instanceof i.MysqlDriver&&(s+="/*+ MAX_EXECUTION_TIME("+this.expressionMap.maxExecutionTime+") */ "),o instanceof i.PostgresDriver&&r.length>0?s="SELECT DISTINCT ON ("+r.map((function(t){return e.replacePropertyNames(t)})).join(", ")+") ":n&&(s="SELECT DISTINCT "),s},t.prototype.createJoinExpression=function(){var e=this;return this.expressionMap.joinAttributes.map((function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,a=t.condition?" AND ("+t.condition+")":"",o=t.parentAlias;if(!o||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return" "+t.direction+" JOIN "+s+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){var u=n.joinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+o+"."+n.propertyPath+"."+e.referencedColumn.propertyPath})).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}if(n.isOneToMany||n.isOneToOneNotOwner)return u=n.inverseRelation.joinColumns.map((function(e){return"entity-child"===n.inverseEntityMetadata.tableType&&n.inverseEntityMetadata.discriminatorColumn&&(a+=" AND "+i+"."+n.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+n.inverseEntityMetadata.discriminatorValue+"'"),i+"."+n.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND ")," "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a);var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,h="",p="";return n.isOwning?(h=n.joinColumns.map((function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND "),p=n.inverseJoinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath})).join(" AND ")):(h=n.inverseRelation.inverseJoinColumns.map((function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND "),p=n.inverseRelation.joinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath})).join(" AND "))," "+t.direction+" JOIN "+e.getTableName(c)+" "+e.escape(l)+" ON "+e.replacePropertyNames(h)+" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(p+a)})).join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitOffsetExpression=function(){var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof i.SqlServerDriver){var n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(this.connection.driver instanceof i.MysqlDriver||this.connection.driver instanceof i.AuroraDataApiDriver||this.connection.driver instanceof i.SapDriver){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new T.OffsetWithoutLimitNotSupportedError}else if(this.connection.driver instanceof E.AbstractSqliteDriver){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver instanceof i.OracleDriver){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""},t.prototype.createLockExpression=function(){var e=this.connection.driver,t="";if(this.expressionMap.lockTables){if(!(e instanceof i.PostgresDriver))throw new R.TypeORMError("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new R.TypeORMError("lockTables cannot be an empty array");t=" OF "+this.expressionMap.lockTables.join(", ")}switch(this.expressionMap.lockMode){case"pessimistic_read":if(e instanceof i.MysqlDriver||e instanceof i.AuroraDataApiDriver)return" LOCK IN SHARE MODE";if(e instanceof i.PostgresDriver)return" FOR SHARE"+t;if(e instanceof i.OracleDriver)return" FOR UPDATE";if(e instanceof i.SqlServerDriver)return"";throw new w.LockNotSupportedOnGivenDriverError;case"pessimistic_write":if(e instanceof i.MysqlDriver||e instanceof i.AuroraDataApiDriver||e instanceof i.OracleDriver)return" FOR UPDATE";if(e instanceof i.PostgresDriver)return" FOR UPDATE"+t;if(e instanceof i.SqlServerDriver)return"";throw new w.LockNotSupportedOnGivenDriverError;case"pessimistic_partial_write":if(e instanceof i.PostgresDriver)return" FOR UPDATE"+t+" SKIP LOCKED";if(e instanceof i.MysqlDriver)return" FOR UPDATE SKIP LOCKED";throw new w.LockNotSupportedOnGivenDriverError;case"pessimistic_write_or_fail":if(e instanceof i.PostgresDriver)return" FOR UPDATE"+t+" NOWAIT";if(e instanceof i.MysqlDriver)return" FOR UPDATE NOWAIT";throw new w.LockNotSupportedOnGivenDriverError;case"for_no_key_update":if(e instanceof i.PostgresDriver)return" FOR NO KEY UPDATE"+t;throw new w.LockNotSupportedOnGivenDriverError;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map((function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}})).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,a=this.expressionMap.selects.some((function(t){return t.selection===e})),s=[];if(a&&s.push.apply(s,(0,r.__spreadArray)([],(0,r.__read)(t.columns.filter((function(e){return!0===e.isSelect}))))),s.push.apply(s,(0,r.__spreadArray)([],(0,r.__read)(t.columns.filter((function(t){return n.expressionMap.selects.some((function(n){return n.selection===e+"."+t.propertyPath}))}))))),0===s.length)return[];var u=this.expressionMap.queryEntity?t.primaryColumns.filter((function(e){return-1===s.indexOf(e)})):[];return(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(s)),(0,r.__read)(u)).map((function(t){var r=n.expressionMap.selects.find((function(n){return n.selection===e+"."+t.propertyPath})),s=n.escape(e)+"."+n.escape(t.databaseName);return-1!==n.connection.driver.spatialTypes.indexOf(t.type)&&((n.connection.driver instanceof i.MysqlDriver||n.connection.driver instanceof i.AuroraDataApiDriver)&&(s=(n.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText")+"("+s+")"),n.connection.driver instanceof i.PostgresDriver&&(s=t.precision?"ST_AsGeoJSON("+s+", "+t.precision+")::json":"ST_AsGeoJSON("+s+")::json"),n.connection.driver instanceof i.SqlServerDriver&&(s+=".ToString()")),{selection:s,aliasName:r&&r.aliasName?r.aliasName:o.DriverUtils.buildAlias(n.connection.driver,e,t.databaseName),virtual:r?!0===r.virtual:!a}}))},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find((function(t){return t.selection===e}));return n?[n]:this.expressionMap.selects.filter((function(n){return t.columns.some((function(t){return n.selection===e+"."+t.propertyPath}))}))},t.prototype.computeCountExpression=function(){var e=this,t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata.primaryColumns,r=this.escape(t);if(0===this.expressionMap.joinAttributes.length&&0===this.expressionMap.relationIdAttributes.length&&0===this.expressionMap.relationCountAttributes.length)return"COUNT(1)";if(this.connection.driver instanceof i.CockroachDriver||this.connection.driver instanceof i.PostgresDriver)return"COUNT(DISTINCT("+n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(", ")+"))";if(this.connection.driver instanceof i.MysqlDriver)return"COUNT(DISTINCT "+n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(", ")+")";if(this.connection.driver instanceof i.SqlServerDriver){var a=n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(", '|;|', ");return 1===n.length?"COUNT(DISTINCT("+a+"))":"COUNT(DISTINCT(CONCAT("+a+")))"}return"COUNT(DISTINCT("+n.map((function(t){return r+"."+e.escape(t.databaseName)})).join(" || '|;|' || ")+"))"},t.prototype.executeCountQuery=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:return t=this.computeCountExpression(),[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(t,"cnt").setOption("disable-global-order").loadRawResults(e)];case 1:return(n=r.sent())&&n[0]&&n[0].cnt?[2,parseInt(n[0].cnt)]:[2,0]}}))}))},t.prototype.executeEntitiesAndRawResults=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,l,h,p,d,f,m,_,w,E,T,N,C,A,O,x,S,P=this;return(0,r.__generator)(this,(function(q){switch(q.label){case 0:if(!this.expressionMap.mainAlias)throw new R.TypeORMError('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new u.PessimisticLockTransactionRequiredError;if("optimistic"===this.expressionMap.lockMode&&!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn)throw new c.NoVersionOrUpdateDateColumnError(n.name);return i=new y(this.connection,e,this.expressionMap.relationIdAttributes),a=new g(this.connection,e,this.expressionMap.relationCountAttributes),new v(this.expressionMap).transform(),new b(this.expressionMap).transform(),l=[],h=[],(this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0?(p=(0,r.__read)(this.createOrderByCombinedWithSelectExpression("distinctAlias"),2),d=p[0],f=p[1],m=this.expressionMap.mainAlias.metadata,_=this.expressionMap.mainAlias.name,w=m.primaryColumns.map((function(e){var t=P.escape("distinctAlias"),n=P.escape(o.DriverUtils.buildAlias(P.connection.driver,_,e.databaseName));return f[n]||(f[n]="ASC"),t+"."+n+' as "'+o.DriverUtils.buildAlias(P.connection.driver,"ids_"+_,e.databaseName)+'"'})),[4,new t(this.connection,e).select("DISTINCT "+w.join(", ")).addSelect(d).from("("+this.clone().orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(f).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return(l=q.sent()).length>0?(E="",T={},m.hasMultiplePrimaryKeys?E=l.map((function(e,t){return m.primaryColumns.map((function(n){var r="orm_distinct_ids_"+t+"_"+n.databaseName;return T[r]=e["ids_"+_+"_"+n.databaseName],_+"."+n.propertyPath+"=:"+r})).join(" AND ")})).join(" OR "):(N=o.DriverUtils.buildAlias(this.connection.driver,"ids_"+_,m.primaryColumns[0].databaseName),(C=l.map((function(e){return e[N]}))).every((function(e){return"number"==typeof e}))?E=_+"."+m.primaryColumns[0].propertyPath+" IN ("+C.join(", ")+")":(T.orm_distinct_ids=C,E=_+"."+m.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:E}).setParameters(T).loadRawResults(e)]):[3,3];case 2:l=q.sent(),q.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:l=q.sent(),q.label=6;case 6:return l.length>0?[4,i.load(l)]:[3,10];case 7:return A=q.sent(),[4,a.load(l)];case 8:return O=q.sent(),x=new s(this.expressionMap,this.connection.driver,A,O,this.queryRunner),h=x.transform(l,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(S=new M.BroadcasterResult,e.broadcaster.broadcastLoadEventsForAll(S,this.expressionMap.mainAlias.metadata,h),S.promises.length>0?[4,Promise.all(S.promises)]:[3,10]):[3,10];case 9:q.sent(),q.label=10;case 10:return[2,{raw:l,entities:h}]}}))}))},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,r=Object.keys(n).map((function(n){if(-1!==n.indexOf(".")){var r=n.split("."),i=r[0],a=r.slice(1).join("."),s=t.expressionMap.findAliasByName(i).metadata.findColumnWithPropertyPath(a);return t.escape(e)+"."+t.escape(o.DriverUtils.buildAlias(t.connection.driver,i,s.databaseName))}return t.expressionMap.selects.find((function(e){return e.selection===n||e.aliasName===n}))?t.escape(e)+"."+n:""})).join(", "),i={};return Object.keys(n).forEach((function(r){if(-1!==r.indexOf(".")){var a=r.split("."),s=a[0],u=a.slice(1).join("."),c=t.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyPath(u);i[t.escape(e)+"."+t.escape(o.DriverUtils.buildAlias(t.connection.driver,s,c.databaseName))]=n[r]}else t.expressionMap.selects.find((function(e){return e.selection===r||e.aliasName===r}))?i[t.escape(e)+"."+r]=n[r]:i[r]=n[r]})),[r,i]},t.prototype.loadRawResults=function(e){return(0,r.__awaiter)(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h;return(0,r.__generator)(this,(function(p){switch(p.label){case 0:if(t=(0,r.__read)(this.getQueryAndParameters(),2),n=t[0],i=t[1],a=n+" -- PARAMETERS: "+JSON.stringify(i),o="object"==typeof this.connection.options.cache?this.connection.options.cache:{},s=void 0,u=!1,!this.connection.queryResultCache||!this.expressionMap.cache&&!o.alwaysEnabled)return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},e)];case 2:return(s=p.sent())&&!this.connection.queryResultCache.isExpired(s)?[2,JSON.parse(s.result)]:[3,4];case 3:if(c=p.sent(),!o.ignoreErrors)throw c;return u=!0,[3,4];case 4:return[4,e.query(n,i,!0)];case 5:if(l=p.sent(),u||!this.connection.queryResultCache||!this.expressionMap.cache&&!o.alwaysEnabled)return[3,9];p.label=6;case 6:return p.trys.push([6,8,,9]),[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(l.records)},s,e)];case 7:return p.sent(),[3,9];case 8:if(h=p.sent(),!o.ignoreErrors)throw h;return[3,9];case 9:return[2,l.records]}}))}))},t.prototype.mergeExpressionMap=function(e){return N.ObjectUtils.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return"number"==typeof e||null==e?e:Number(e)},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},t}(_.QueryBuilder)},8682:(e,t,n)=>{"use strict";n.d(t,{SoftDeleteQueryBuilder:()=>m});var r=n(9312),i=n(1100),a=n(6170),o=n(4368),s=n(8164),u=n(6287),c=n(5436),l=n(1585),h=n(9987),p=n(2235),d=n(4117),f=n(3556),m=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.__extends)(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,a,s,l,h,p,d;return(0,r.__generator)(this,(function(f){switch(f.label){case 0:e=this.obtainQueryRunner(),t=!1,f.label=1;case 1:return f.trys.push([1,13,18,21]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:f.sent(),t=!0,f.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(p=new c.BroadcasterResult,e.broadcaster.broadcastBeforeUpdateEvent(p,this.expressionMap.mainAlias.metadata),p.promises.length>0?[4,Promise.all(p.promises)]:[3,5]):[3,5];case 4:f.sent(),f.label=5;case 5:return n=new u.ReturningResultsEntityUpdator(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=n.getUpdationReturningColumns()),i=(0,r.__read)(this.getQueryAndParameters(),2),a=i[0],s=i[1],[4,e.query(a,s,!0)];case 6:return l=f.sent(),h=o.UpdateResult.from(l),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,n.update(h,this.expressionMap.whereEntities)]:[3,8];case 7:f.sent(),f.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(p=new c.BroadcasterResult,e.broadcaster.broadcastAfterUpdateEvent(p,this.expressionMap.mainAlias.metadata),p.promises.length>0?[4,Promise.all(p.promises)]:[3,10]):[3,10];case 9:f.sent(),f.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:f.sent(),f.label=12;case 12:return[2,h];case 13:if(d=f.sent(),!t)return[3,17];f.label=14;case 14:return f.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:case 16:return f.sent(),[3,17];case 17:throw d;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:f.sent(),f.label=20;case 20:return[7];case 21:return[2]}}))}))},t.prototype.from=function(e,t){e=e instanceof d.EntitySchema?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.getWhereInIdsCondition(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.getWhereInIdsCondition(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.getWhereInIdsCondition(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new s.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new f.TypeORMError(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach((function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new f.TypeORMError("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)})),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new f.TypeORMError('Cannot get entity metadata for the given alias "'+this.expressionMap.mainAlias+'"');if(!e.deleteDateColumn)throw new h.MissingDeleteDateColumnError(e);var t=[];switch(this.expressionMap.queryType){case"soft-delete":t.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":t.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new f.TypeORMError('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),t.length<=0)throw new p.UpdateValuesMissingError;var n=this.createWhereExpression(),r=this.createReturningExpression();return r&&(this.connection.driver instanceof i.PostgresDriver||this.connection.driver instanceof i.OracleDriver||this.connection.driver instanceof i.CockroachDriver)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n+" RETURNING "+r:r&&this.connection.driver instanceof i.SqlServerDriver?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+" OUTPUT "+r+n:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.MysqlDriver)return" LIMIT "+e;throw new l.LimitOnUpdateNotSupportedError}return""},t}(a.QueryBuilder)},5254:(e,t,n)=>{"use strict";n.d(t,{UpdateQueryBuilder:()=>f});var r=n(9312),i=n(1100),a=n(6170),o=n(4368),s=n(8164),u=n(6287),c=n(5436),l=n(1585),h=n(2235),p=n(2666),d=n(3556),f=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return(0,r.__extends)(t,e),t.prototype.getQuery=function(){var e=this.createComment();return e+=this.createUpdateExpression(),e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,s,l,h,p,d,f,m,y,v,g,b,_,w,E,T;return(0,r.__generator)(this,(function(M){switch(M.label){case 0:e=this.obtainQueryRunner(),t=!1,M.label=1;case 1:return M.trys.push([1,13,18,21]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:M.sent(),t=!0,M.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(_=new c.BroadcasterResult,e.broadcaster.broadcastBeforeUpdateEvent(_,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),_.promises.length>0?[4,Promise.all(_.promises)]:[3,5]):[3,5];case 4:M.sent(),M.label=5;case 5:if(n=null,a=null,s=new u.ReturningResultsEntityUpdator(e,this.expressionMap),l=[],Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)try{for(h=(0,r.__values)(this.expressionMap.returning),p=h.next();!p.done;p=h.next())d=p.value,l.push.apply(l,(0,r.__spreadArray)([],(0,r.__read)(this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(d))))}catch(e){E={error:e}}finally{try{p&&!p.done&&(T=h.return)&&T.call(h)}finally{if(E)throw E.error}}return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=s.getUpdationReturningColumns(),l.push.apply(l,(0,r.__spreadArray)([],(0,r.__read)(this.expressionMap.extraReturningColumns.filter((function(e){return!l.includes(e)})))))),l.length>0&&this.connection.driver instanceof i.SqlServerDriver&&(n=this.connection.driver.buildTableVariableDeclaration("@OutputTable",l),a="SELECT * FROM @OutputTable"),f=(0,r.__read)(this.getQueryAndParameters(),2),m=f[0],y=f[1],v=[n,m,a],[4,e.query(v.filter((function(e){return null!=e})).join(";\n\n"),y,!0)];case 6:return g=M.sent(),b=o.UpdateResult.from(g),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,s.update(b,this.expressionMap.whereEntities)]:[3,8];case 7:M.sent(),M.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(_=new c.BroadcasterResult,e.broadcaster.broadcastAfterUpdateEvent(_,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),_.promises.length>0?[4,Promise.all(_.promises)]:[3,10]):[3,10];case 9:M.sent(),M.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:M.sent(),M.label=12;case 12:return[2,b];case 13:if(w=M.sent(),!t)return[3,17];M.label=14;case 14:return M.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:case 16:return M.sent(),[3,17];case 17:throw w;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:M.sent(),M.label=20;case 20:return[7];case 21:return[2]}}))}))},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.getWhereCondition(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.getWhereInIdsCondition(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.getWhereInIdsCondition(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.getWhereInIdsCondition(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new s.ReturningStatementNotSupportedError;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new d.TypeORMError(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach((function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new d.TypeORMError("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)})),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[],a=[];if(n?(this.createPropertyPath(n,t).forEach((function(o){var s=n.findColumnsWithPropertyPath(o);if(s.length<=0)throw new p.EntityColumnNotFound(o);s.forEach((function(n){if(n.isUpdate){a.push(n);var o=n.getEntityValue(t);if(n.referencedColumn&&o instanceof Object&&!(o instanceof Buffer)?o=n.referencedColumn.getEntityValue(o):o instanceof Function||(o=e.connection.driver.preparePersistentValue(o,n)),o instanceof Function)r.push(e.escape(n.databaseName)+" = "+o());else if(e.connection.driver instanceof i.SapDriver&&null===o)r.push(e.escape(n.databaseName)+" = NULL");else{e.connection.driver instanceof i.SqlServerDriver&&(o=e.connection.driver.parametrizeValue(n,o));var s=e.createParameter(o),u=null;if((e.connection.driver instanceof i.MysqlDriver||e.connection.driver instanceof i.AuroraDataApiDriver)&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)){var c=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";u=null!=n.srid?c+"("+s+", "+n.srid+")":c+"("+s+")"}else u=e.connection.driver instanceof i.PostgresDriver&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?null!=n.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+s+"), "+n.srid+")::"+n.type:"ST_GeomFromGeoJSON("+s+")::"+n.type:e.connection.driver instanceof i.SqlServerDriver&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?n.type+"::STGeomFromText("+s+", "+(n.srid||"0")+")":s;r.push(e.escape(n.databaseName)+" = "+u)}}}))})),n.versionColumn&&-1===a.indexOf(n.versionColumn)&&r.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&-1===a.indexOf(n.updateDateColumn)&&r.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(t).map((function(n){var a=t[n];if(a instanceof Function)r.push(e.escape(n)+" = "+a());else if(e.connection.driver instanceof i.SapDriver&&null===a)r.push(e.escape(n)+" = NULL");else{var o=e.createParameter(a);r.push(e.escape(n)+" = "+o)}})),r.length<=0)throw new h.UpdateValuesMissingError;var o=this.createWhereExpression(),s=this.createReturningExpression();return s&&(this.connection.driver instanceof i.PostgresDriver||this.connection.driver instanceof i.OracleDriver||this.connection.driver instanceof i.CockroachDriver)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+o+" RETURNING "+s:s&&this.connection.driver instanceof i.SqlServerDriver?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+" OUTPUT "+s+o:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+o},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"==typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.MysqlDriver||this.connection.driver instanceof i.AuroraDataApiDriver)return" LIMIT "+e;throw new l.LimitOnUpdateNotSupportedError}return""},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new h.UpdateValuesMissingError},t}(a.QueryBuilder)},2783:(e,t,n)=>{"use strict";n.d(t,{RelationCountAttribute:()=>s});var r=n(9312),i=n(82),a=n(9206),o=n(9858),s=function(){function e(e,t){this.expressionMap=e,a.ObjectUtils.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=(0,r.__read)(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rc"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value is a string representation of alias property");var e=(0,r.__read)(this.relationName.split("."),2),t=e[0],n=e[1],a=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!a)throw new o.TypeORMError("Relation with property path "+n+" in entity was not found.");return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!1,configurable:!0}),e}()},8835:(e,t,n)=>{"use strict";n.d(t,{RelationIdAttribute:()=>s});var r=n(9312),i=n(82),a=n(9206),o=n(9858),s=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,a.ObjectUtils.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.QueryBuilderUtils.isAliasProperty(this.relationName))throw new o.TypeORMError("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new o.TypeORMError("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=(0,r.__read)(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rid"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!1,configurable:!0}),e}()},4494:(e,t,n)=>{"use strict";n.d(t,{DeleteResult:()=>r});var r=function(){function e(){}return e.from=function(e){var t=new this;return t.raw=e.records,t.affected=e.affected,t},e}()},6110:(e,t,n)=>{"use strict";n.d(t,{InsertResult:()=>r});var r=function(){function e(){this.identifiers=[],this.generatedMaps=[]}return e.from=function(e){var t=new this;return t.raw=e.raw,t},e}()},4368:(e,t,n)=>{"use strict";n.d(t,{UpdateResult:()=>r});var r=function(){function e(){this.generatedMaps=[]}return e.from=function(e){var t=new this;return t.raw=e.records,t.affected=e.affected,t},e}()},9338:(e,t,n)=>{"use strict";n.d(t,{Table:()=>h});var r=n(9312),i=n(4348),a=n(1369),o=n(8789),s=n(1087),u=n(2268),c=n(7764),l=n(870),h=function(){function e(e){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,e.columns&&(this.columns=e.columns.map((function(e){return new i.TableColumn(e)}))),e.indices&&(this.indices=e.indices.map((function(e){return new a.TableIndex(e)}))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map((function(t){return new o.TableForeignKey((0,r.__assign)((0,r.__assign)({},t),{referencedDatabase:(null==t?void 0:t.referencedDatabase)||e.database,referencedSchema:(null==t?void 0:t.referencedSchema)||e.schema}))}))),e.uniques&&(this.uniques=e.uniques.map((function(e){return new u.TableUnique(e)}))),e.checks&&(this.checks=e.checks.map((function(e){return new c.TableCheck(e)}))),e.exclusions&&(this.exclusions=e.exclusions.map((function(e){return new l.TableExclusion(e)}))),void 0!==e.justCreated&&(this.justCreated=e.justCreated),this.engine=e.engine)}return Object.defineProperty(e.prototype,"primaryColumns",{get:function(){return this.columns.filter((function(e){return e.isPrimary}))},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return new e({schema:this.schema,database:this.database,name:this.name,columns:this.columns.map((function(e){return e.clone()})),indices:this.indices.map((function(e){return e.clone()})),foreignKeys:this.foreignKeys.map((function(e){return e.clone()})),uniques:this.uniques.map((function(e){return e.clone()})),checks:this.checks.map((function(e){return e.clone()})),exclusions:this.exclusions.map((function(e){return e.clone()})),justCreated:this.justCreated,engine:this.engine})},e.prototype.addColumn=function(e){this.columns.push(e)},e.prototype.removeColumn=function(e){var t=this.columns.find((function(t){return t.name===e.name}));t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.addUniqueConstraint=function(e){if(this.uniques.push(e),1===e.columnNames.length){var t=this.columns.find((function(t){return t.name===e.columnNames[0]}));t&&(t.isUnique=!0)}},e.prototype.removeUniqueConstraint=function(e){var t=this.uniques.find((function(t){return t.name===e.name}));if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){var n=this.columns.find((function(e){return e.name===t.columnNames[0]}));n&&(n.isUnique=!1)}},e.prototype.addCheckConstraint=function(e){this.checks.push(e)},e.prototype.removeCheckConstraint=function(e){var t=this.checks.find((function(t){return t.name===e.name}));t&&this.checks.splice(this.checks.indexOf(t),1)},e.prototype.addExclusionConstraint=function(e){this.exclusions.push(e)},e.prototype.removeExclusionConstraint=function(e){var t=this.exclusions.find((function(t){return t.name===e.name}));t&&this.exclusions.splice(this.exclusions.indexOf(t),1)},e.prototype.addForeignKey=function(e){this.foreignKeys.push(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find((function(t){return t.name===e.name}));t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.addIndex=function(e,t){if(void 0===t&&(t=!1),this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){var n=this.columns.find((function(t){return t.name===e.columnNames[0]}));n&&(n.isUnique=!0)}},e.prototype.removeIndex=function(e,t){void 0===t&&(t=!1);var n=this.indices.find((function(t){return t.name===e.name}));if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){var r=this.columns.find((function(e){return e.name===n.columnNames[0]}));r&&(r.isUnique=this.indices.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===r.name&&!!n.isUnique})))}},e.prototype.findColumnByName=function(e){return this.columns.find((function(t){return t.name===e}))},e.prototype.findColumnIndices=function(e){return this.indices.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnForeignKeys=function(e){return this.foreignKeys.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnUniques=function(e){return this.uniques.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnChecks=function(e){return this.checks.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.create=function(t,n){var r=t.database===n.database?void 0:t.database,i=t.schema===n.options.schema?void 0:t.schema;return new e({database:t.database,schema:t.schema,name:n.buildTableName(t.tableName,i,r),engine:t.engine,columns:t.columns.filter((function(e){return e})).map((function(e){return s.TableUtils.createTableColumnOptions(e,n)})),indices:t.indices.filter((function(e){return!0===e.synchronize})).map((function(e){return a.TableIndex.create(e)})),uniques:t.uniques.map((function(e){return u.TableUnique.create(e)})),checks:t.checks.map((function(e){return c.TableCheck.create(e)})),exclusions:t.exclusions.map((function(e){return l.TableExclusion.create(e)}))})},e}()},7764:(e,t,n)=>{"use strict";n.d(t,{TableCheck:()=>i});var r=n(9312),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,columnNames:this.columnNames?(0,r.__spreadArray)([],(0,r.__read)(this.columnNames)):[],expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},4348:(e,t,n)=>{"use strict";n.d(t,{TableColumn:()=>r});var r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||e.unsigned||!1,this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}return e.prototype.clone=function(){return new e({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},e}()},870:(e,t,n)=>{"use strict";n.d(t,{TableExclusion:()=>r});var r=function(){function e(e){this.name=e.name,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},8789:(e,t,n)=>{"use strict";n.d(t,{TableForeignKey:()=>i});var r=n(9312),i=function(){function e(e){this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedDatabase=e.referencedDatabase,this.referencedSchema=e.referencedSchema,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.__spreadArray)([],(0,r.__read)(this.columnNames)),referencedColumnNames:(0,r.__spreadArray)([],(0,r.__read)(this.referencedColumnNames)),referencedDatabase:this.referencedDatabase,referencedSchema:this.referencedSchema,referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})},e.create=function(t,n){return new e({name:t.name,columnNames:t.columnNames,referencedColumnNames:t.referencedColumnNames,referencedDatabase:t.referencedEntityMetadata.database,referencedSchema:t.referencedEntityMetadata.schema,referencedTableName:t.referencedTablePath,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable})},e}()},1369:(e,t,n)=>{"use strict";n.d(t,{TableIndex:()=>i});var r=n(9312),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.parser=e.parser,this.where=e.where?e.where:""}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.__spreadArray)([],(0,r.__read)(this.columnNames)),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,parser:this.parser,where:this.where})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map((function(e){return e.databaseName})),isUnique:t.isUnique,isSpatial:t.isSpatial,isFulltext:t.isFulltext,parser:t.parser,where:t.where})},e}()},2268:(e,t,n)=>{"use strict";n.d(t,{TableUnique:()=>i});var r=n(9312),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames}return e.prototype.clone=function(){return new e({name:this.name,columnNames:(0,r.__spreadArray)([],(0,r.__read)(this.columnNames))})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map((function(e){return e.databaseName}))})},e}()},1087:(e,t,n)=>{"use strict";n.d(t,{TableUtils:()=>r});var r=function(){function e(){}return e.createTableColumnOptions=function(e,t){return{name:e.databaseName,length:t.getColumnLength(e),width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map((function(e){return e+""})):e.enum,enumName:e.enumName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}},e}()},2490:(e,t,n)=>{"use strict";n.d(t,{View:()=>r});var r=function(){function e(e){e&&(this.database=e.database,this.schema=e.schema,this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}return e.prototype.clone=function(){return new e({database:this.database,schema:this.schema,name:this.name,expression:this.expression,materialized:this.materialized})},e.create=function(t,n){return new e({database:t.database,schema:t.schema,name:n.buildTableName(t.tableName,t.schema,t.database),expression:t.expression,materialized:t.tableMetadataArgs.materialized})},e}()},5436:(e,t,n)=>{"use strict";n.d(t,{BroadcasterResult:()=>r});var r=function(){this.count=0,this.promises=[]}},7768:(e,t,n)=>{"use strict";n.d(t,{ApplyValueTransformers:()=>r});var r=function(){function e(){}return e.transformFrom=function(e,t){return Array.isArray(e)?e.slice().reverse().reduce((function(e,t){return t.from(e)}),t):e.from(t)},e.transformTo=function(e,t){return Array.isArray(e)?e.reduce((function(e,t){return t.to(e)}),t):e.to(t)},e}()},5344:(e,t,n)=>{"use strict";n.d(t,{DateUtils:()=>i});var r=n(9312),i=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&"string"==typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r="string"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"==typeof e){var t=(0,r.__read)(e.split(":"),3),n=t[0],i=t[1],a=t[2],o=new Date;return n&&o.setHours(parseInt(n)),i&&o.setMinutes(parseInt(i)),a&&o.setSeconds(parseInt(a)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),"string"==typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map((function(e){return 1===e.length?"0"+e:e})).join(":"):e},e.mixedDateToDatetimeString=function(e,t){if("string"==typeof e&&(e=new Date(e)),e instanceof Date){var n=this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());t&&(n+="."+this.formatMilliseconds(e.getMilliseconds())),e=n}return e},e.mixedDateToUtcDatetimeString=function(e){return"string"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return Array.isArray(e)?e.map((function(e){return String(e)})).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"==typeof e?e.length>0?e.split(","):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){return"string"==typeof e?JSON.parse(e):e},e.simpleEnumToString=function(e){return""+e},e.stringToSimpleEnum=function(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<10?"00"+e:e<100?"0"+e:String(e)},e}()},9206:(e,t,n)=>{"use strict";n.d(t,{ObjectUtils:()=>i});var r=n(9312),i=function(){function e(){}return e.assign=function(e){for(var t,n,i,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u=(0,r.__values)(o),c=u.next();!c.done;c=u.next()){var l=c.value;try{for(var h=(i=void 0,(0,r.__values)(Object.getOwnPropertyNames(l))),p=h.next();!p.done;p=h.next()){var d=p.value;e[d]=l[d]}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}},e}()},7081:(e,t,n)=>{"use strict";n.d(t,{OrmUtils:()=>i});var r=n(9312),i=function(){function e(){}return e.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),(function(n,r){return e.slice(r*t,r*t+t)}))},e.splitClassesAndStrings=function(e){return[e.filter((function(e){return"string"!=typeof e})),e.filter((function(e){return"string"==typeof e}))]},e.groupBy=function(e,t){return e.reduce((function(e,n){var r=t(n),i=e.find((function(e){return e.id===r}));return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e}),[])},e.uniq=function(e,t){return e.reduce((function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find((function(e){return t(e)===i}))}else r="string"==typeof t?!!e.find((function(e){return e[t]===n[t]})):-1!==e.indexOf(n);return r||e.push(n),e}),[])},e.isPlainObject=function(e){return null!=e&&(!e.constructor||e.constructor===Object)},e.mergeArrayKey=function(e,t,n,r){r.has(n)?e[t]=r.get(n):n instanceof Promise||(this.isPlainObject(n)||Array.isArray(n)?(e[t]||(e[t]=Array.isArray(n)?[]:{}),r.set(n,e[t]),this.merge(e[t],n,r),r.delete(n)):e[t]=n)},e.mergeObjectKey=function(e,t,n,r){var i,a,o;r.has(n)?Object.assign(e,((i={})[t]=r.get(n),i)):n instanceof Promise||(this.isPlainObject(n)||Array.isArray(n)?(e[t]||Object.assign(e,((o={})[t]=Array.isArray(n)?[]:{},o)),r.set(n,e[t]),this.merge(e[t],n,r),r.delete(n)):Object.assign(e,((a={})[t]=n,a)))},e.merge=function(e,t,n){var i,a;if(void 0===n&&(n=new Map),this.isPlainObject(e)&&this.isPlainObject(t))try{for(var o=(0,r.__values)(Object.keys(t)),s=o.next();!s.done;s=o.next()){var u=s.value;this.mergeObjectKey(e,u,t[u],n)}}catch(e){i={error:e}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(i)throw i.error}}if(Array.isArray(e)&&Array.isArray(t))for(u=0;u<t.length;u++)this.mergeArrayKey(e,u,t[u],n)},e.mergeDeep=function(t){for(var n,i,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if(!a.length)return t;try{for(var s=(0,r.__values)(a),u=s.next();!u.done;u=s.next()){var c=u.value;e.merge(t,c)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return t},e.deepCompare=function(){for(var e,t,n,r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(n=[],r=[],!this.compare2Objects(n,r,arguments[0],arguments[e]))return!1;return!0},e.compareIds=function(t,n){return null!=t&&null!=n&&(("string"==typeof t.id&&"string"==typeof n.id||"number"==typeof t.id&&"number"==typeof n.id)&&1===Object.keys(t).length&&1===Object.keys(n).length?t.id===n.id:e.deepCompare(t,n))},e.toBoolean=function(e){return"boolean"==typeof e?e:"string"==typeof e?"true"===e||"1"===e:"number"==typeof e&&e>0},e.zipObject=function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})},e.isArraysEqual=function(e,t){return e.length===t.length&&e.every((function(e){return-1!==t.indexOf(e)}))},e.compare2Objects=function(e,t,n,r){var i;if(Number.isNaN(n)&&Number.isNaN(r))return!0;if(n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if(("function"==typeof n.equals||n.equals instanceof Function)&&n.equals(r))return!0;if("function"==typeof n&&"function"==typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||n instanceof String&&r instanceof String||n instanceof Number&&r instanceof Number)return n.toString()===r.toString();if(!(n instanceof Object&&r instanceof Object))return!1;if(n.isPrototypeOf(r)||r.isPrototypeOf(n))return!1;if(n.constructor!==r.constructor)return!1;if(n.prototype!==r.prototype)return!1;if(e.indexOf(n)>-1||t.indexOf(r)>-1)return!1;for(i in r){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1}for(i in n){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1;switch(typeof n[i]){case"object":case"function":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[i],r[i]))return!1;e.pop(),t.pop();break;default:if(n[i]!==r[i])return!1}}return!0},e}()},9090:(e,t,n)=>{"use strict";n.d(t,{RandomGenerator:()=>r});var r=function(){function e(){}return e.sha1=function(e){var t,n,r,i,a,o,s,u,c,l=function(e,t){return e<<t|e>>>32-t},h=function(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},p=new Array(80),d=1732584193,f=4023233417,m=2562383102,y=271733878,v=3285377520,g=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<g-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(g%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(g-1)<<24|8388608;break;case 2:n=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:n=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(b.push(n);b.length%16!=14;)b.push(0);for(b.push(g>>>29),b.push(g<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=d,a=f,o=m,s=y,u=v,n=0;n<=19;n++)c=l(i,5)+(a&o|~a&s)+u+p[n]+1518500249&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(a^o^s)+u+p[n]+1859775393&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(a&o|a&s|o&s)+u+p[n]+2400959708&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(a^o^s)+u+p[n]+3395469782&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;d=d+i&4294967295,f=f+a&4294967295,m=m+o&4294967295,y=y+s&4294967295,v=v+u&4294967295}return(c=h(d)+h(f)+h(m)+h(y)+h(v)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e}()},3925:(e,t,n)=>{"use strict";n.d(t,{camelCase:()=>a,snakeCase:()=>o,titleCase:()=>s,shorten:()=>u,hash:()=>c});var r=n(4458),i=n.n(r);function a(e,t){return void 0===t&&(t=!1),e.replace(/^([A-Z])|[\s-_](\w)/g,(function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()}))}function o(e){return e.replace(/([A-Z])([A-Z])([a-z])/g,"$1_$2$3").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}function s(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function u(e,t){void 0===t&&(t={});var n=t.segmentLength,r=void 0===n?4:n,i=t.separator,a=void 0===i?"__":i,o=t.termLength,s=void 0===o?2:o;return e.split(a).reduce((function(e,t){var n=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),i=n.length>1?s:r,a=n.map((function(e){return e.substr(0,i)})).join("");return e.push(a),e}),[]).join(a)}function c(e,t){void 0===t&&(t={});var n=i()("sha256");n.update(e,"utf8");var r=n.digest("hex");return t.length?r.slice(0,t.length):r}},495:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(4810)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},4810:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,a,o=null;function s(...e){if(!s.enabled)return;const r=s,i=Number(new Date),a=i-(n||i);r.diff=a,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const a=t.formatters[i];if("function"==typeof a){const t=e[o];n=a.call(r,t),e.splice(o,1),o--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,a=t.enabled(e)),a),set:e=>{o=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(1327),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},1327:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,o){o=o||{};var s,u,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===c&&isFinite(e))return o.long?(s=e,(u=Math.abs(s))>=i?a(s,u,i,"day"):u>=r?a(s,u,r,"hour"):u>=n?a(s,u,n,"minute"):u>=t?a(s,u,t,"second"):s+" ms"):function(e){var a=Math.abs(e);return a>=i?Math.round(e/i)+"d":a>=r?Math.round(e/r)+"h":a>=n?Math.round(e/n)+"m":a>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},9887:(e,t,n)=>{"use strict";var r;n.d(t,{default:()=>l});var i=new Uint8Array(16);function a(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}const o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,s=function(e){return"string"==typeof e&&o.test(e)};for(var u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));const l=function(e,t,n){var r=(e=e||{}).random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n}(r)}},8500:(e,t,n)=>{"use strict";e.exports=n.p+"assets/sql-wasm.wasm"}}]);
//# sourceMappingURL=271.js.map